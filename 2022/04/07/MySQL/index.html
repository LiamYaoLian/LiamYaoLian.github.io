<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"liamyaolian.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Overview server layer + storage engine layer server layer  connector: connects client to server; wait_timeout can decide how long it will wait before disconnecting if the client has not sent a query.">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="https://liamyaolian.github.io/2022/04/07/MySQL/index.html">
<meta property="og:site_name" content="Liam Lian&#39;s Blog">
<meta property="og:description" content="Overview server layer + storage engine layer server layer  connector: connects client to server; wait_timeout can decide how long it will wait before disconnecting if the client has not sent a query.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://liamyaolian.github.io/image/mysql/4.png">
<meta property="og:image" content="https://liamyaolian.github.io/image/mysql/5.png">
<meta property="og:image" content="https://liamyaolian.github.io/image/mysql/6.png">
<meta property="og:image" content="https://liamyaolian.github.io/image/mysql/2.webp">
<meta property="og:image" content="https://liamyaolian.github.io/image/mysql/1.webp">
<meta property="og:image" content="https://liamyaolian.github.io/image/mysql/3.webp">
<meta property="article:published_time" content="2022-04-08T00:25:28.000Z">
<meta property="article:modified_time" content="2022-04-23T17:05:19.687Z">
<meta property="article:author" content="Liam Lian">
<meta property="article:tag" content="DB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://liamyaolian.github.io/image/mysql/4.png">

<link rel="canonical" href="https://liamyaolian.github.io/2022/04/07/MySQL/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>MySQL | Liam Lian's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Liam Lian's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/04/07/MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-07 20:25:28" itemprop="dateCreated datePublished" datetime="2022-04-07T20:25:28-04:00">2022-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-23 13:05:19" itemprop="dateModified" datetime="2022-04-23T13:05:19-04:00">2022-04-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><ul>
<li>server layer + storage engine layer<ul>
<li><p>server layer</p>
<ul>
<li>connector: connects client to server; wait_timeout can decide how long it will wait before disconnecting if the client has not sent a query.</li>
<li>cache: After MySQL 8.0, not have this.</li>
<li>analyzer: lexical and syntax analysis</li>
<li>optimizer: which index to use, which table to be joined first</li>
<li>executor: execute; update binlog in disk<br>the server layer has functions, stored procedures, trigger, view, etc</li>
</ul>
</li>
<li><p>storage engine: store, update log</p>
<ul>
<li>engines: InnoDb, MyISAM, Memory, etc</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="comments"><a href="#comments" class="headerlink" title="comments"></a>comments</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"><span class="comment">/**/</span></span><br></pre></td></tr></table></figure>

<h2 id="data-types"><a href="#data-types" class="headerlink" title="data types"></a>data types</h2><h2 id="Number"><a href="#Number" class="headerlink" title="Number"></a>Number</h2><ul>
<li>TINYINT: 1 byte</li>
<li>SMALLINT: 2 bytes</li>
<li>MEDIUMINT: 3 bytes</li>
<li>INT: 4 bytes</li>
<li>BIGINT: 8 bytes</li>
<li>FLOAT: 4 bytes</li>
<li>DOUBLE: 8 bytes</li>
<li>DECIMAL(x,y)</li>
</ul>
<h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><ul>
<li>char: 255</li>
<li>varchar: variable length; 理论65535，不允许非空字段时最大65533，允许非空字段65532</li>
<li>text: variable length; 65535</li>
<li>MEDIUMTEXT: variable length; 1千6百万字符</li>
<li>LONGTEXT: variable length; 42亿字符<h2 id="Date-and-Time"><a href="#Date-and-Time" class="headerlink" title="Date and Time"></a>Date and Time</h2></li>
<li>Date</li>
<li>Time</li>
<li>Year</li>
<li>Datetime</li>
<li>Timestamp: converted from the current time zone to UTC for storage, and converted back from UTC to the current time zone for retrieval</li>
</ul>
<h2 id="Queries"><a href="#Queries" class="headerlink" title="Queries"></a>Queries</h2><p><img src="/../image/mysql/4.png" alt="undo log and read-view"></p>
<h3 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">drop database (if exists) database_name;</span><br><span class="line">create database database_name;</span><br><span class="line">show databases;</span><br></pre></td></tr></table></figure>

<h3 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> database.table_name (</span><br><span class="line">column1 datatype [<span class="keyword">constraint</span>] [comment],</span><br><span class="line">column2 datatype [<span class="keyword">constraint</span>] [comment],</span><br><span class="line">column3 datatype [<span class="keyword">constraint</span>] [comment],</span><br><span class="line">INDEX [ 索引名称 ] ( 字段 )</span><br><span class="line"><span class="keyword">foreign</span> key (deptno) <span class="keyword">references</span> t_dept(deptno)</span><br><span class="line">....) [comment];</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> (if <span class="keyword">exists</span>) database.table_name;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> database.new_table_name</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">(<span class="keyword">SELECT</span> column1, column2,...</span><br><span class="line"><span class="keyword">FROM</span> existing_table_name</span><br><span class="line"><span class="keyword">WHERE</span> ....);</span><br><span class="line"></span><br><span class="line"><span class="keyword">Show</span> tables;</span><br><span class="line"><span class="keyword">describe</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称</span><br><span class="line"><span class="keyword">ADD</span> 列<span class="number">1</span> 数据类型 [ 约束 ] [COMMENT 注释] ,</span><br><span class="line"><span class="keyword">ADD</span> 列<span class="number">2</span> 数据类型 [ 约束 ] [COMMENT 注释] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称</span><br><span class="line">MODIFY 列<span class="number">1</span> 数据类型 [ 约束 ] [COMMENT 注释] ,</span><br><span class="line">MODIFY 列<span class="number">2</span> 数据类型 [ 约束 ] [COMMENT 注释] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称</span><br><span class="line">CHANGE 列<span class="number">1</span> 新列名<span class="number">1</span> 数据类型 [ 约束 ] [COMMENT 注释] ,</span><br><span class="line">CHANGE 列<span class="number">2</span> 新列名<span class="number">2</span> 数据类型 [ 约束 ] [COMMENT 注释] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称</span><br><span class="line"><span class="keyword">DROP</span> 列<span class="number">1</span> ,</span><br><span class="line"><span class="keyword">DROP</span> 列<span class="number">2</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 RENAME 新表名 ;</span><br></pre></td></tr></table></figure>
<h4 id="constraints"><a href="#constraints" class="headerlink" title="constraints"></a>constraints</h4><ul>
<li>PRIMARY KEY</li>
<li>NOT NULL</li>
<li>UNIQUE</li>
<li>FOREIGN KEY</li>
</ul>
<h3 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h3><ul>
<li><p>&#x3D;</p>
</li>
<li><p>&lt;&gt;, !&#x3D;</p>
</li>
<li><p>is null, is not null</p>
</li>
<li><p>between and</p>
</li>
<li><p>in</p>
</li>
<li><p>EXISTS</p>
<ul>
<li>EXISTS关键字是把原来在子查询之外的条件判断，写到了子查询的里面<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查询工资等级3和4级的员工信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> empno, ename, sal, comm</span><br><span class="line"><span class="keyword">from</span> t_emp</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_salgrade <span class="keyword">where</span> grade <span class="keyword">in</span> (<span class="number">3</span>, <span class="number">4</span>) <span class="keyword">and</span> sal <span class="keyword">between</span> losal <span class="keyword">and</span> hisal);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>like</p>
<ul>
<li>%: zero or more</li>
<li>_: single</li>
</ul>
</li>
<li><p>regexp</p>
<ul>
<li><code>ename regexp &quot;[a-zA-Z]&#123;4&#125;</code></li>
</ul>
</li>
<li><p>NOT</p>
</li>
<li><p>AND</p>
</li>
<li><p>OR</p>
</li>
<li><p>XOR</p>
</li>
<li><p>&amp;</p>
</li>
<li><p>|</p>
</li>
<li><p>~: bitwise not</p>
</li>
<li><p>^: bitwise XOR</p>
</li>
<li><p>&lt;&lt;</p>
</li>
<li><blockquote>
<blockquote>
</blockquote>
</blockquote>
</li>
</ul>
<h4 id="Priority"><a href="#Priority" class="headerlink" title="Priority"></a>Priority</h4><ul>
<li>() &gt; NOT &gt;And &gt; Or</li>
</ul>
<h3 id="Insert"><a href="#Insert" class="headerlink" title="Insert"></a>Insert</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">IGNORE只插入数据库不存在</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">INSERT</span> [ IGNORE ] <span class="keyword">INTO</span> 表名 [(字段名 [,字段名] ...)] <span class="keyword">VALUES</span> (值的列表);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 （字段名）(</span><br><span class="line"><span class="keyword">SELECT</span> 字段名或值</span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line"><span class="keyword">WHERE</span> 条件);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> demo.goodsmaster</span><br><span class="line">(itemnumber, barcode, goodsname, specification, unit, price)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">4</span>,<span class="string">&#x27;0003&#x27;</span>,<span class="string">&#x27;尺子&#x27;</span>,<span class="string">&#x27;三角型&#x27;</span>,<span class="string">&#x27;把&#x27;</span>,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*MySQL dialect*/</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 <span class="keyword">SET</span> 字段<span class="number">1</span><span class="operator">=</span>值<span class="number">1</span>, 字段<span class="number">2</span><span class="operator">=</span>值<span class="number">2</span>, …… ;</span><br></pre></td></tr></table></figure>

<ul>
<li>can skip inserting some columns if null allowed or have default values</li>
<li>ON DUPLICATE: 假设我们要把门店 B 的商品数据，插入到门店 A 的商品表中去，如果有重复的商品编号，就用门店 B 的条码，替换门店 A 的条码，用门店 B 的商品名称，替换门店 A 的商品名称；如果没有重复的编号，就直接把门店 B 的商品数据插入到门店 A 的商品表中。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; SELECT *</span><br><span class="line">    -&gt; FROM demo.goodsmaster;</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">| itemnumber | barcode | goodsname | specification | unit | salesprice |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">|          1 | 0001    | 书        | 16开          | 本   |      89.00 |</span><br><span class="line">|          2 | 0002    | 笔        | 10支装        | 包   |       5.00 |</span><br><span class="line">|          3 | 0003    | 橡皮      | NULL          | 个   |       3.00 |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT *</span><br><span class="line">    -&gt; FROM demo.goodsmaster1;</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">| itemnumber | barcode | goodsname | specification | unit | salesprice |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">|          1 | 0001    | 教科书    | NULL          | NULL |      89.00 |</span><br><span class="line">|          4 | 0004    | 馒头      |               |      |       1.50 |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO demo.goodsmaster</span><br><span class="line">SELECT *</span><br><span class="line">FROM demo.goodsmaster1 as a</span><br><span class="line">ON DUPLICATE KEY UPDATE barcode = a.barcode,goodsname=a.goodsname;</span><br><span class="line">-- 运行结果如下</span><br><span class="line">mysql&gt; SELECT *</span><br><span class="line">    -&gt; FROM demo.goodsmaster;</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">| itemnumber | barcode | goodsname | specification | unit | salesprice |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">|          1 | 0001    | 教科书    | 16开          | 本   |      89.00 |</span><br><span class="line">|          2 | 0002    | 笔        | 10支装        | 包   |       5.00 |</span><br><span class="line">|          3 | 0003    | 橡皮      | NULL          | 个   |       3.00 |</span><br><span class="line">|          4 | 0004    | 馒头      |               |      |       1.50 |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">DELETE [ IGNORE ] FROM 表名 [ LEFT | RIGHT ] JOIN 表2 ON 条件</span><br><span class="line">WHERE 条件</span><br><span class="line">[ ORDER BY …… ]</span><br><span class="line">[ LIMIT …… ] ;</span><br><span class="line"></span><br><span class="line">// 删除全部数据</span><br><span class="line">DELETE FROM demo.goodsmaster; // undo log</span><br><span class="line">Truncate table table_name; // no in undo log</span><br></pre></td></tr></table></figure>
<ul>
<li>ignore: if foreign key exists so some records cannot be deleted, will ignore these records</li>
<li>sequence: from -&gt; where -&gt; order by -&gt; limit -&gt; delete</li>
</ul>
<h3 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">UPDATE 表名</span><br><span class="line">SET 字段名=值</span><br><span class="line">WHERE 条件</span><br><span class="line">[ ORDER BY …… ]</span><br><span class="line">[ LIMIT param ] ; /*can only have one param*/</span><br></pre></td></tr></table></figure>
<ul>
<li>sequence: from -&gt; where -&gt; order by -&gt; limit -&gt; set</li>
<li>Don’t update primary key</li>
<li>因为WHERE子句中的子查询效率非常低，所以我们可以利用表连接的方式来改造UPDATE语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表<span class="number">1</span> [ <span class="keyword">LEFT</span> <span class="operator">|</span> <span class="keyword">RIGHT</span> ] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 条件</span><br><span class="line"><span class="keyword">SET</span> 字段<span class="number">1</span> <span class="operator">=</span> 值<span class="number">1</span> , 字段<span class="number">2</span> <span class="operator">=</span> 值<span class="number">2</span> , …… ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> 表<span class="number">1</span> , 表<span class="number">2</span></span><br><span class="line"><span class="keyword">SET</span> 字段<span class="number">1</span> <span class="operator">=</span> 值<span class="number">1</span> , 字段<span class="number">2</span> <span class="operator">=</span> 值<span class="number">2</span> , ……</span><br><span class="line"><span class="keyword">WHERE</span> 连接条件 ;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SELECT *|字段列表</span><br><span class="line">FROM 数据源</span><br><span class="line">WHERE 条件</span><br><span class="line">GROUP BY 字段</span><br><span class="line">HAVING 条件</span><br><span class="line">ORDER BY 字段</span><br><span class="line">LIMIT 起始点，行数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    [ALL | DISTINCT | DISTINCTROW ]</span><br><span class="line">    [HIGH_PRIORITY]</span><br><span class="line">    [STRAIGHT_JOIN]</span><br><span class="line">    [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]</span><br><span class="line">    [SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]</span><br><span class="line">    select_expr [, select_expr] ...</span><br><span class="line">    [into_option]</span><br><span class="line">    [FROM table_references</span><br><span class="line">      [PARTITION partition_list]]</span><br><span class="line">    [WHERE where_condition]</span><br><span class="line">    [GROUP BY &#123;col_name | expr | position&#125;, ... [WITH ROLLUP]]</span><br><span class="line">    [HAVING where_condition]</span><br><span class="line">    [WINDOW window_name AS (window_spec)</span><br><span class="line">        [, window_name AS (window_spec)] ...]</span><br><span class="line">    [ORDER BY &#123;col_name | expr | position&#125;</span><br><span class="line">      [ASC | DESC], ... [WITH ROLLUP]]</span><br><span class="line">    [LIMIT &#123;[offset,] row_count | row_count OFFSET offset&#125;]</span><br><span class="line">    [into_option]</span><br><span class="line">    [FOR &#123;UPDATE | SHARE&#125;</span><br><span class="line">        [OF tbl_name [, tbl_name] ...]</span><br><span class="line">        [NOWAIT | SKIP LOCKED]</span><br><span class="line">      | LOCK IN SHARE MODE]</span><br><span class="line">    [into_option]</span><br><span class="line"></span><br><span class="line">into_option: &#123;</span><br><span class="line">    INTO OUTFILE &#x27;file_name&#x27;</span><br><span class="line">        [CHARACTER SET charset_name]</span><br><span class="line">        export_options</span><br><span class="line">  | INTO DUMPFILE &#x27;file_name&#x27;</span><br><span class="line">  | INTO var_name [, var_name] ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>Windows<ul>
<li>window functions also operate on a subset of rows but they do not reduce the number of rows returned by the query<br>···<br>window_function_name(expression) OVER (<br> [PARTITION BY <expression>[{,<expression>…}]]<br> [ORDER BY <expression> [ASC|DESC], [{,<expression>…}]] &#x2F;&#x2F; how the rows are ordered within a partition<br> [frame_unit {<frame_start>|<frame_between>}]<br>)</li>
</ul>
</li>
</ul>
<p>&#x2F;&#x2F; running total<br>SUM(total_price) OVER(ORDER BY Sales_Date rows between UNBOUNDED PRECEDING and current row) AS Running_Total<br>···</p>
<ul>
<li><p>A frame is defined with respect to the current row, which allows a frame to move within a partition depending on the position of the current row within its partition.</p>
</li>
<li><p>The frame unit specifies the type of relationship between the current row and frame rows. It can be ROWS or RANGE. The offsets of the current row and frame rows are the row numbers if the frame unit is ROWS and row values the frame unit is RANGE.</p>
</li>
<li><p>The frame_start defines the frame boundary and contains one of the following:</p>
<ul>
<li>UNBOUNDED PRECEDING: frame starts at the first row of the partition.</li>
<li>N PRECEDING: a physical N of rows before the first current row. N can be a literal number or an expression that evaluates to a number.</li>
<li>CURRENT ROW: the row of the current calculation</li>
</ul>
</li>
<li><p>The frame_between defines the frame boundary and is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BETWEEN frame_boundary_1 AND frame_boundary_2   </span><br></pre></td></tr></table></figure>
<p>The frame_boundary_1 and frame_boundary_2 can each contain one of the following:</p>
<ul>
<li>frame_start: as mentioned previously.</li>
<li>UNBOUNDED FOLLOWING: the frame ends at the final row in the partition.</li>
<li>N FOLLOWING: a physical N of rows after the current row.</li>
</ul>
</li>
<li><p>If you don’t specify the frame_definition in the OVER clause, then MySQL uses the following frame by default:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</span><br></pre></td></tr></table></figure>
<p>  <img src="/../image/mysql/5.png" alt="windows function"></p>
</li>
<li><p>Aggregate: Count, Sum, Avg, Min, Max</p>
</li>
<li><p>Offset:</p>
<ul>
<li>first_value(column_name)</li>
<li>last_value(column_name)</li>
<li>lead(<expression>[,offset[, default_value]]): running diff, e.g. y-o-y; If offset is zero, then the LAG() function evaluates the expression for the current row. If you don’t specify the offset, then the LAG() function uses one by default.</li>
<li>lag(<expression>[,offset[, default_value]]): running diff, e.g. y-o-y</li>
</ul>
</li>
<li><p>Rank</p>
<ul>
<li>row_number: Assigns a sequential integer to every row within its partition; application: Removing duplicate rows</li>
<li>rank</li>
<li>dense_rank</li>
</ul>
</li>
</ul>
<ul>
<li><p>distinct</p>
<ul>
<li>If you have null value in the column, select distinct will only show one null value</li>
<li>Select multiple columns: MySQL uses the combination of values in these columns to determine the uniqueness of the row in the result set</li>
</ul>
</li>
<li><p>Use of an unqualified * with other items in the select list may produce a parse error. To avoid this problem, use a qualified tbl_name.* reference:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT AVG(score), t1.* FROM t1 ...</span><br></pre></td></tr></table></figure></li>
<li><p>You need not specify a tbl_name or db_name.tbl_name prefix for a column reference unless the reference would be ambiguous.</p>
</li>
<li><p>The INTO clause, if present, can appear in any position indicated by the syntax description, but within a given statement can appear only once, not in multiple positions.</p>
</li>
<li><p>column alias:</p>
</li>
</ul>
<ul>
<li>it is good practice to be in the habit of using AS explicitly when specifying column aliases.</li>
<li>can be used in GROUP BY, ORDER BY, or HAVING clauses</li>
<li>If the column alias contains spaces, you need to place it inside quotes</li>
<li>The execute order after select can use the alias name, otherwise no. It is not permissible to refer to a column alias in a WHERE clause, because the column value might not yet be determined when the WHERE clause is executed.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT CONCAT(&#x27;Jane&#x27;,&#x27; &#x27;,&#x27;Doe&#x27;) AS &#x27;Full name&#x27;;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>from: table, derived table<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tbl_name [[AS] alias] [index_hint]</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>devrived table must have an alias</li>
<li>If you name more than one table, you are performing a join.</li>
<li>The use of index hints provides the optimizer with information about how to choose indexes during query processing. For a description of the syntax for specifying these hints, see Section 8.9.4, “Index Hints”.You can use SET max_seeks_for_key&#x3D;value as an alternative way to force MySQL to prefer key scans instead of table scans. See Section 5.1.8, “Server System Variables”.</li>
</ul>
<ul>
<li><p>where</p>
<ul>
<li>old: 筛选掉记录最多的条件写在最左侧</li>
</ul>
</li>
<li><p>GROUP BY</p>
<ul>
<li>permits a WITH ROLLUP modifier. See Section 12.20.2, “GROUP BY Modifiers”.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    productLine,</span><br><span class="line">    orderYear,</span><br><span class="line">    SUM(orderValue) totalOrderValue</span><br><span class="line">FROM</span><br><span class="line">    sales</span><br><span class="line">GROUP BY</span><br><span class="line">    productline,</span><br><span class="line">    orderYear</span><br><span class="line">WITH ROLLUP;</span><br></pre></td></tr></table></figure>
<img src="/../image/mysql/6.png" alt="with rollup"><br><a target="_blank" rel="noopener" href="https://www.mysqltutorial.org/mysql-rollup/">https://www.mysqltutorial.org/mysql-rollup/</a></li>
<li>The number of dimension column you selected can not larger than that of followed by clause group by</li>
<li>GROUP_CONCAT函数可以把分组查询中的某个字段拼接成一个字符串</li>
</ul>
</li>
<li><p>order by</p>
<ul>
<li>asc, desc</li>
<li>If ORDER BY occurs within a parenthesized query expression and also is applied in the outer query, the results are undefined and may change in a future version of MySQL.</li>
<li>When you use ORDER BY or GROUP BY to sort a column in a SELECT, the server sorts values using only the initial number of bytes indicated by the max_sort_length system variable.</li>
</ul>
</li>
<li><p>limit:</p>
</li>
</ul>
<ul>
<li>start index is 0</li>
<li><code>limit 1, 2</code>: 1 means starting from 1 (included, first row is 0); 2 means 2 records</li>
<li>With one argument, the value specifies the number of rows to return from the beginning of the result set</li>
<li>For prepared statements, you can use placeholders. <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET @skip=1; SET @numrows=5;</span><br><span class="line">PREPARE STMT FROM &#x27;SELECT * FROM tbl LIMIT ?, ?&#x27;;</span><br><span class="line">EXECUTE STMT USING @skip, @numrows;</span><br></pre></td></tr></table></figure></li>
<li>If LIMIT occurs within a parenthesized query expression and also is applied in the outer query, the results are undefined and may change in a future version of MySQL</li>
</ul>
<ul>
<li><p>HAVING</p>
<ul>
<li>The query result includes only groups satisfying the HAVING conditions. (If no GROUP BY is present, all rows implicitly form a single aggregate group.)</li>
<li>The WHERE clause specifies conditions on columns in the select list, but cannot refer to aggregate functions.</li>
<li>SQL standard: HAVING must reference only columns in the GROUP BY clause or columns used in aggregate functions. Extension: permits HAVING to refer to columns in the SELECT list and columns in outer subqueries. If a HAVING column name is used both in GROUP BY and as an aliased column in the select column list, preference is given to the column in the GROUP BY column</li>
</ul>
</li>
<li><p>aggregation function</p>
</li>
</ul>
<ul>
<li>AVG: ignore null, 只能用于数字类型，非数字数据统计结果为0</li>
<li>COUNT<ul>
<li>COUNT(*) to count the number of rows in a table</li>
<li>COUNT(column) ignores NULL values</li>
</ul>
</li>
<li>MAX: ignore null</li>
<li>MIN: ignore null</li>
<li>SUM: ignore null, 只能用于数字类型，字符类型的统计结果为0，日期类型统计结果是毫秒数相加。</li>
<li>for each group</li>
<li>can put <code>Distinct</code> inside (), such as <code>count(DISTINCT prod_price)</code></li>
</ul>
<ul>
<li>For update: …</li>
<li>DISTINCT</li>
<li>STRAIGHT_JOIN forces the optimizer to join the tables in the order in which they are listed in the FROM clause.</li>
<li>STRAIGHT_JOIN does not apply to any table that the optimizer treats as a const or system table.</li>
<li>SQL_BIG_RESULT or SQL_SMALL_RESULT can be used with GROUP BY or DISTINCT to tell the optimizer that the result set has many rows or is small, respectively. For SQL_BIG_RESULT, MySQL directly uses disk-based temporary tables if they are created, and prefers sorting to using a temporary table with a key on the GROUP BY elements. For SQL_SMALL_RESULT, MySQL uses in-memory temporary tables to store the resulting table instead of using sorting. This should not normally be needed.</li>
<li>SQL_BUFFER_RESULT forces the result to be put into a temporary table. This helps MySQL free the table locks early and helps in cases where it takes a long time to send the result set to the client. This modifier can be used only for top-level SELECT statements, not for subqueries or following UNION.</li>
<li>Named Windows: <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/window-functions-named-windows.html">https://dev.mysql.com/doc/refman/8.0/en/window-functions-named-windows.html</a></li>
<li>Partition: <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/partitioning-selection.html">https://dev.mysql.com/doc/refman/8.0/en/partitioning-selection.html</a></li>
</ul>
<h3 id="Join"><a href="#Join" class="headerlink" title="Join"></a>Join</h3><ul>
<li>inner join</li>
<li>left join, right join<ul>
<li>If there is no match, the columns of the row from the right&#x2F;left table will contain NULL</li>
</ul>
</li>
<li>Full (outer) Join<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM t1</span><br><span class="line">LEFT JOIN t2 ON t1.id = t2.id</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT * FROM t1</span><br><span class="line">RIGHT JOIN t2 ON t1.id = t2.id</span><br><span class="line">WHERE t1.id IS NULL</span><br></pre></td></tr></table></figure></li>
<li>cross join</li>
<li>self join</li>
</ul>
<h3 id="Case-when"><a href="#Case-when" class="headerlink" title="Case when"></a>Case when</h3><p>···<br>CASE WHEN [compare_value] THEN result<br>[WHEN [compare_value] THEN result …]<br>[ELSE result] END (AS new_column)<br>···</p>
<ul>
<li>CASE WHEN case be used in any statement</li>
</ul>
<h3 id="union"><a href="#union" class="headerlink" title="union"></a>union</h3><ul>
<li>union removes duplicates</li>
<li>union all</li>
<li>only one order by statement can be used, which is after the final select statement</li>
</ul>
<h3 id="function"><a href="#function" class="headerlink" title="function"></a>function</h3><h4 id="Number-1"><a href="#Number-1" class="headerlink" title="Number"></a>Number</h4><ul>
<li>abs</li>
<li>round</li>
<li>floor</li>
<li>ceil</li>
<li>power(2,3)</li>
<li>log(7,3)</li>
<li>ln(10)</li>
<li>sqrt(9)</li>
<li>pi()</li>
<li>sin</li>
<li>cos</li>
<li>tan</li>
<li>cot</li>
<li>radians(30): 角度转换弧度</li>
<li>DEGREES(1): 弧度转换角度<h4 id="Time"><a href="#Time" class="headerlink" title="Time"></a>Time</h4><h5 id="system-time"><a href="#system-time" class="headerlink" title="system time"></a>system time</h5></li>
<li>now(): yyyy-MM-dd hh:mm:ss</li>
<li>curdate(): yyyy-MM-dd</li>
<li>curtime(): hh:mm:ss<h5 id="DATE-FORMAT"><a href="#DATE-FORMAT" class="headerlink" title="DATE_FORMAT"></a>DATE_FORMAT</h5></li>
<li>DATE_FORMAT(日期, 表达式)<br>%Y 年份<br>%m 月份<br>%d 日期<br>%w 星期(数字)<br>%W 星期(名称)<br>%j 本年第几天<br>%U 本年第几周<br>%h 小时(12)<br>%H 小时(24)<br>%i 分钟<br>%s 秒<br>%r 时间(12)<br>%T 时间(24)<h5 id="DATE-ADD-and"><a href="#DATE-ADD-and" class="headerlink" title="DATE_ADD() and"></a>DATE_ADD() and</h5></li>
<li>DATE_ADD( 日期 , INTERVAL 15 DAY )</li>
<li>DATEDIFF ( 日期 , 日期 )<h4 id="String-1"><a href="#String-1" class="headerlink" title="String"></a>String</h4>LOWER<br>UPPER<br>LENGTH<br>SELECT CONCAT(“SQL “, “Tutorial “, “is “, “fun!”) AS ConcatenatedString<br>SELECT INSTR(“W3Schools.com”, “3”) AS MatchPosition: 2<br>SELECT INSERT(“W3Schools.com”, 1, 9, “Example”): Example.com<br>REPLACE(“你好先生”,”先生”,”女士”)<br>SELECT SUBSTR(“SQL Tutorial”, 5, 3) AS ExtractString: Tut<br>SELECT SUBSTRING(“SQL Tutorial”, 5, 3) AS ExtractString: Tut<br>SELECT LPAD(“SQL Tutorial”, 20, “ABC”): ABCABCABSQL Tutorial; Left-pad the string with “ABC”, to a total length of 20.<br>RPAD(“Hello”,10,”*”)<br>TRIM(“ 你好先生 “)<h4 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h4>IFNULL( 表达式 , 值 )<br>IF( 表达式 , 值1 , 值2 )</li>
</ul>
<h3 id="common-table-expression-or-CTE"><a href="#common-table-expression-or-CTE" class="headerlink" title="common table expression or CTE"></a>common table expression or CTE</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">WITH salesrep AS (</span><br><span class="line">    SELECT</span><br><span class="line">        employeeNumber,</span><br><span class="line">        CONCAT(firstName, &#x27; &#x27;, lastName) AS salesrepName</span><br><span class="line">    FROM</span><br><span class="line">        employees</span><br><span class="line">    WHERE</span><br><span class="line">        jobTitle = &#x27;Sales Rep&#x27;</span><br><span class="line">),</span><br><span class="line">customer_salesrep AS (</span><br><span class="line">    SELECT</span><br><span class="line">        customerName, salesrepName</span><br><span class="line">    FROM</span><br><span class="line">        customers</span><br><span class="line">            INNER JOIN</span><br><span class="line">        salesrep ON employeeNumber = salesrepEmployeeNumber</span><br><span class="line">)</span><br><span class="line">SELECT</span><br><span class="line">    *</span><br><span class="line">FROM</span><br><span class="line">    customer_salesrep</span><br><span class="line">ORDER BY customerName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WITH RECURSIVE cte_name AS (</span><br><span class="line">    initial_query  -- anchor member</span><br><span class="line">    UNION ALL</span><br><span class="line">    recursive_query -- recursive member that references to the CTE name</span><br><span class="line">)</span><br><span class="line">SELECT * FROM cte_name;</span><br></pre></td></tr></table></figure>
<p>to do: <a target="_blank" rel="noopener" href="https://www.mysqltutorial.org/mysql-recursive-cte/">https://www.mysqltutorial.org/mysql-recursive-cte/</a></p>
<h3 id="subquery"><a href="#subquery" class="headerlink" title="subquery"></a>subquery</h3><ul>
<li>can be in “select”, “from”, “where”</li>
<li>in “from” will have high efficiency, avoid being in “select” or “where”. 查询语句执行的时候要多次的依赖于子查询的结果，这类子查询被<br>称作相关子查询</li>
<li>多行子查询只能出现在WHERE子句和FROM子句中</li>
</ul>
<h3 id="Execution-Order"><a href="#Execution-Order" class="headerlink" title="Execution Order"></a>Execution Order</h3><p>From &gt; join &gt; Where &gt; group by &gt; having &gt; select &gt; distinct &gt; order by &gt; limit</p>
<h3 id="Prepared-statement"><a href="#Prepared-statement" class="headerlink" title="Prepared statement"></a>Prepared statement</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM products</span><br><span class="line">WHERE productCode = ?;</span><br></pre></td></tr></table></figure>
<ul>
<li>When MySQL executes this query with different productcode values, it does not have to fully parse the query. As a result, this helps MySQL execute the query faster, especially when MySQL executes the same query multiple times.</li>
<li>Since the prepared statement uses placeholders (?), this helps avoid many variants of SQL injection hence make your application more secure.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PREPARE stmt1 FROM</span><br><span class="line">	&#x27;SELECT</span><br><span class="line">   	    productCode,</span><br><span class="line">            productName</span><br><span class="line">	FROM products</span><br><span class="line">        WHERE productCode = ?&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SET @pc = &#x27;S10_1678&#x27;;</span><br><span class="line"></span><br><span class="line">EXECUTE stmt1 USING @pc;</span><br><span class="line"></span><br><span class="line">DEALLOCATE PREPARE stmt1;</span><br></pre></td></tr></table></figure>

<h2 id="Constraint"><a href="#Constraint" class="headerlink" title="Constraint"></a>Constraint</h2><h3 id="PK-vs-FK"><a href="#PK-vs-FK" class="headerlink" title="PK vs FK"></a>PK vs FK</h3><ul>
<li>PK<ul>
<li>unique</li>
<li>not null</li>
<li>one but can be multiple columns</li>
<li>can use AUTO_INCREMENT</li>
</ul>
</li>
<li>FK<ul>
<li>primary key in another table</li>
<li>can be null</li>
<li>can have more than one FK</li>
<li>如果形成外键闭环，我们将无法删除任何一张表的记录</li>
</ul>
</li>
</ul>
<h2 id="View"><a href="#View" class="headerlink" title="View"></a>View</h2><ul>
<li>read-only, no storage</li>
</ul>
<h2 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h2><h3 id="Redo-Log-in-InnoDB"><a href="#Redo-Log-in-InnoDB" class="headerlink" title="Redo Log in InnoDB"></a>Redo Log in InnoDB</h3><ul>
<li>Write-ahead logging<ul>
<li>write to redo log, update memory, then disk</li>
<li>when the redo log is full, move to disk to clean some space</li>
</ul>
</li>
<li>Crash-safe: innodb_flush_log_at_trx_commit &#x3D; 1<h3 id="binlog-in-the-server-layer"><a href="#binlog-in-the-server-layer" class="headerlink" title="binlog in the server layer"></a>binlog in the server layer</h3></li>
<li>can be used by all engines</li>
<li>Has statement-based logging: Events contain SQL statements that produce data changes (inserts, updates, deletes)</li>
<li>append</li>
<li>sync_binlog &#x3D; 1 to make sure binlog is not lost</li>
</ul>
<p>InnoDB prepares redo log. Executor updates binlog. InnoDB commits redo log.</p>
<h3 id="Undo-log"><a href="#Undo-log" class="headerlink" title="Undo log"></a>Undo log</h3><ul>
<li><p>When there are no read-views earlier than this undo log record, it will be deleted.<br><img src="/../image/mysql/2.webp" alt="undo log and read-view"><br>Source: <a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/68963">https://time.geekbang.org/column/article/68963</a></p>
</li>
<li><p>Long transaction will cause too many undo log records to stay</p>
</li>
<li><p>To avoid long transaction, set autocommit&#x3D;1</p>
</li>
<li><p>To find long transaction (e.g. 60s):</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">select * from information_schema.innodb_trx where TIME_TO_SEC(timediff(now(),trx_started))&gt;60</span><br></pre></td></tr></table></figure>
<ul>
<li>Analyze general log to avoid long transaction issues</li>
<li>SET_MAX_EXECUTION_TIME</li>
</ul>
<h3 id="How-to-restore"><a href="#How-to-restore" class="headerlink" title="How to restore"></a>How to restore</h3><ul>
<li>Find the most recent full backup. Then based on binlog records later than the most recent full backup, restore data.</li>
<li>back up every day or every week? More frequent, more storage, less RTO(Recovery Time Objective).</li>
</ul>
<h2 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h2><ul>
<li>high isolation will lead to low efficiency</li>
<li>SQL<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION ;</span><br><span class="line"><span class="keyword">SQL</span>语句</span><br><span class="line">[ <span class="keyword">COMMIT</span> <span class="operator">|</span> <span class="keyword">ROLLBACK</span> ] ;</span><br></pre></td></tr></table></figure></li>
<li>ACID</li>
</ul>
<h3 id="Isolation-Levels"><a href="#Isolation-Levels" class="headerlink" title="Isolation Levels"></a>Isolation Levels</h3><ul>
<li><code>SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED</code></li>
<li>read uncommitted: no read-view.</li>
<li>read committed: a read-view is created when a SQL query executes</li>
<li>repeatable read: a read-view is created when the transaction executes “select” so the undo log has data, so data seen in this transaction are the same as what they were when this transaction started.</li>
<li>serializable: read and write will add lock. After a transaction finishes, another transaction can execute.<br><img src="/../image/mysql/1.webp" alt="isolation levels"><br>Source: <a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/68963">https://time.geekbang.org/column/article/68963</a></li>
</ul>
<h2 id="导出与备份"><a href="#导出与备份" class="headerlink" title="导出与备份"></a>导出与备份</h2><ul>
<li>数据导出: 数据<ul>
<li>SQL文档<ul>
<li><code>mysqldump -uroot -p [ no-data ] 逻辑库 &gt; 路径</code></li>
<li>如果业务数据非常多，建议只导出表结构，然后用SELECT INTO OUTFILE把数据导出成文本文档</li>
</ul>
</li>
<li>文本文档</li>
</ul>
</li>
<li>数据备份: 数据文件、日志文件、索引文件等等</li>
<li>全量备份, 增量备份</li>
<li>导入<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">USE demo ;</span><br><span class="line">SOURCE backup.sql ;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="index"><a href="#index" class="headerlink" title="index"></a>index</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX 索引名 ON 表名( 字段 ) ；</span><br><span class="line">ALTER TABLE 表名称 ADD INDEX [ 索引名 ]( 字段 ) ;</span><br><span class="line">SHOW INDEX FROM 表名 ;</span><br><span class="line">DROP INDEX 索引名称 ON 表名 ;</span><br></pre></td></tr></table></figure>
<ul>
<li>different storage engines may have different index implementation.</li>
<li>不要在大字段上创建索引</li>
</ul>
<h3 id="InnoDB-index-model"><a href="#InnoDB-index-model" class="headerlink" title="InnoDB index model"></a>InnoDB index model</h3><ul>
<li>B+ tree<br><img src="/../image/mysql/3.webp" alt="InnoDB index model"></li>
<li>primary key index (called clustered index in InnoDB): leaves store records</li>
<li>non primary key index (called secondary index in InnoDB): leaves store primary key values. If search based on non primary key index, will search the B+ tree of the non primary key index first, find the primary key value, and then search the B+ tree of the primary key index.</li>
<li>index maintenance<ul>
<li>inserting may cause some records to be moved</li>
<li>if a data page is full, inserting will create a new data page</li>
</ul>
</li>
<li>Usually using auto increment as the primary key leads to better performance and less storage. However, for the k-v situation, may use a business column as the primary key</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/DB/" rel="tag"># DB</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/04/07/Design-Pattern/" rel="prev" title="Design Pattern">
      <i class="fa fa-chevron-left"></i> Design Pattern
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/12/Java-Core-Test/" rel="next" title="Java Core Test">
      Java Core Test <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Overview"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#comments"><span class="nav-number">2.</span> <span class="nav-text">comments</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#data-types"><span class="nav-number">3.</span> <span class="nav-text">data types</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Number"><span class="nav-number">4.</span> <span class="nav-text">Number</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#String"><span class="nav-number">5.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Date-and-Time"><span class="nav-number">6.</span> <span class="nav-text">Date and Time</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Queries"><span class="nav-number">7.</span> <span class="nav-text">Queries</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Database"><span class="nav-number">7.1.</span> <span class="nav-text">Database</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Table"><span class="nav-number">7.2.</span> <span class="nav-text">Table</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#constraints"><span class="nav-number">7.2.1.</span> <span class="nav-text">constraints</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Operator"><span class="nav-number">7.3.</span> <span class="nav-text">Operator</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Priority"><span class="nav-number">7.3.1.</span> <span class="nav-text">Priority</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insert"><span class="nav-number">7.4.</span> <span class="nav-text">Insert</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Delete"><span class="nav-number">7.5.</span> <span class="nav-text">Delete</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Update"><span class="nav-number">7.6.</span> <span class="nav-text">Update</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Read"><span class="nav-number">7.7.</span> <span class="nav-text">Read</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Join"><span class="nav-number">7.8.</span> <span class="nav-text">Join</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Case-when"><span class="nav-number">7.9.</span> <span class="nav-text">Case when</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#union"><span class="nav-number">7.10.</span> <span class="nav-text">union</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function"><span class="nav-number">7.11.</span> <span class="nav-text">function</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Number-1"><span class="nav-number">7.11.1.</span> <span class="nav-text">Number</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Time"><span class="nav-number">7.11.2.</span> <span class="nav-text">Time</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#system-time"><span class="nav-number">7.11.2.1.</span> <span class="nav-text">system time</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#DATE-FORMAT"><span class="nav-number">7.11.2.2.</span> <span class="nav-text">DATE_FORMAT</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#DATE-ADD-and"><span class="nav-number">7.11.2.3.</span> <span class="nav-text">DATE_ADD() and</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#String-1"><span class="nav-number">7.11.3.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Condition"><span class="nav-number">7.11.4.</span> <span class="nav-text">Condition</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#common-table-expression-or-CTE"><span class="nav-number">7.12.</span> <span class="nav-text">common table expression or CTE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#subquery"><span class="nav-number">7.13.</span> <span class="nav-text">subquery</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Execution-Order"><span class="nav-number">7.14.</span> <span class="nav-text">Execution Order</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prepared-statement"><span class="nav-number">7.15.</span> <span class="nav-text">Prepared statement</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Constraint"><span class="nav-number">8.</span> <span class="nav-text">Constraint</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PK-vs-FK"><span class="nav-number">8.1.</span> <span class="nav-text">PK vs FK</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#View"><span class="nav-number">9.</span> <span class="nav-text">View</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Log"><span class="nav-number">10.</span> <span class="nav-text">Log</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redo-Log-in-InnoDB"><span class="nav-number">10.1.</span> <span class="nav-text">Redo Log in InnoDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#binlog-in-the-server-layer"><span class="nav-number">10.2.</span> <span class="nav-text">binlog in the server layer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Undo-log"><span class="nav-number">10.3.</span> <span class="nav-text">Undo log</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to-restore"><span class="nav-number">10.4.</span> <span class="nav-text">How to restore</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Transaction"><span class="nav-number">11.</span> <span class="nav-text">Transaction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Isolation-Levels"><span class="nav-number">11.1.</span> <span class="nav-text">Isolation Levels</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E4%B8%8E%E5%A4%87%E4%BB%BD"><span class="nav-number">12.</span> <span class="nav-text">导出与备份</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#index"><span class="nav-number">13.</span> <span class="nav-text">index</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#InnoDB-index-model"><span class="nav-number">13.1.</span> <span class="nav-text">InnoDB index model</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liam Lian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liam Lian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
