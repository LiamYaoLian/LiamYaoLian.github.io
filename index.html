<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"liamyaolian.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Liam Lian&#39;s Blog">
<meta property="og:url" content="https://liamyaolian.github.io/index.html">
<meta property="og:site_name" content="Liam Lian&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Liam Lian">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://liamyaolian.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Liam Lian's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Liam Lian's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2023/01/14/Debounce-and-Throttle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/14/Debounce-and-Throttle/" class="post-title-link" itemprop="url">Debounce and Throttle</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-01-14 15:29:50 / Modified: 16:38:50" itemprop="dateCreated datePublished" datetime="2023-01-14T15:29:50-05:00">2023-01-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>debounce: no input after an interval, send a request<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timerId = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timerId);</span><br><span class="line">    timerId = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> debounceFunc = <span class="title function_">debounce</span>(func, <span class="number">500</span>);</span><br><span class="line"><span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;some-id&#x27;</span>);</span><br><span class="line">input.<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="title function_">debounceFunc</span>(e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>throttle: one request per interval<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timerId = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">let</span> last = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">const</span> remainingTime = last + delay - now;</span><br><span class="line">    <span class="keyword">if</span> (remainingTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">      last = now;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timerId);</span><br><span class="line">      timerId = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">        last = now;</span><br><span class="line">      &#125;, remainingTime);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/12/28/Redux-Thunk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/28/Redux-Thunk/" class="post-title-link" itemprop="url">Redux & Thunk</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-12-28 14:11:36 / Modified: 14:54:16" itemprop="dateCreated datePublished" datetime="2022-12-28T14:11:36-05:00">2022-12-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p>Redux: to save global state</p>
</li>
<li><p>when state changes, render UI components that subscribe to store</p>
</li>
<li><p>store: manage current state.</p>
<ul>
<li>created by passing in a reducer</li>
<li><code>store.getState()</code></li>
<li>to update state: <code>store.dispatch(action)</code> to run reducer inside store to update state; should use <code>import &#123; useSelector, useDispatch &#125; from &#39;react-redux&#39;</code> and <code>const dispatch = useDispatch()</code> as we cannot access store</li>
</ul>
</li>
<li><p>action: obj</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;domain/eventName&quot;</span></span><br><span class="line">  <span class="attr">payload</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>reducer: (state, action) &#x3D;&gt; newState, sync, no side effect, immutable update</p>
<ul>
<li>can only make seemingly mutating logic inside createSlice and createReducer, which use Immer<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">reducerWithImmer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  state.<span class="property">first</span>.<span class="property">second</span>[action.<span class="property">someId</span>].<span class="property">fourth</span> = action.<span class="property">someValue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>slice: logic for a feature, including reducers, actions, etc</p>
<ul>
<li>create<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">createSlice</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;domain&quot;</span>, <span class="attr">initialState</span>: &#123;<span class="attr">value</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;<span class="string">&quot;eventName1&quot;</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">value</span> += <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;eventName2&quot;</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;counter&#x27;</span>,</span><br><span class="line"><span class="attr">initialState</span>: &#123;</span><br><span class="line"><span class="attr">value</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line"><span class="attr">increment</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// Redux Toolkit allows us to write &quot;mutating&quot; logic in reducers. It</span></span><br><span class="line"><span class="comment">// doesn&#x27;t actually mutate the state because it uses the immer library,</span></span><br><span class="line"><span class="comment">// which detects changes to a &quot;draft state&quot; and produces a brand new</span></span><br><span class="line"><span class="comment">// immutable state based off those changes</span></span><br><span class="line">state.<span class="property">value</span> += <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">decrement</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">state.<span class="property">value</span> -= <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">incrementByAmount</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">state.<span class="property">value</span> += action.<span class="property">payload</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; increment, decrement, incrementByAmount &#125; = counterSlice.<span class="property">actions</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">selectCount</span> = state =&gt; state.<span class="property">counter</span>.<span class="property">value</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span></span><br></pre></td></tr></table></figure></li>
<li>auto-generate action creator (i.e. a func to return an action)<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counterSlice.<span class="property">actions</span>.<span class="title function_">increment</span>())</span><br><span class="line"><span class="comment">// &#123;type: &quot;counter/increment&quot;&#125;</span></span><br></pre></td></tr></table></figure></li>
<li>generate reducer<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> newState = counterSlice.<span class="title function_">reducer</span>(</span><br><span class="line">&#123; <span class="attr">value</span>: <span class="number">10</span> &#125;,</span><br><span class="line">counterSlice.<span class="property">actions</span>.<span class="title function_">increment</span>()</span><br><span class="line">)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newState)</span><br><span class="line"><span class="comment">// &#123;value: 11&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>selector: a function to extract info from state: <code>const selectCounterValue = state =&gt; state.value</code></p>
<ul>
<li><code>import &#123; useSelector &#125; from &#39;react-redux&#39;</code> and <code>const someStateValue = useSelector(selector)</code></li>
<li>e.g. <code>const count = useSelector(selectCount)</code></li>
<li>if dispatch, useSelector will re-run selector function. If the selector returns a different value than last time, useSelector will make sure component re-renders.</li>
</ul>
</li>
<li><p>thunk: Redux function that can have asynchronous logic, written using:</p>
<ul>
<li>inside thunk function, (dispatch, getState) &#x3D;&gt; {}</li>
<li>outside creator function, which creates and returns the thunk function<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">incrementAsync</span> = amount =&gt; (<span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">incrementByAmount</span>(amount))</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="title function_">dispatch</span>(<span class="title function_">incrementAsync</span>(<span class="number">5</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fetchUserById</span> = userId =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (dispatch, getState) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> user = <span class="keyword">await</span> userAPI.<span class="title function_">fetchById</span>(userId)</span><br><span class="line">      <span class="title function_">dispatch</span>(<span class="title function_">userLoaded</span>(user))</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>requires redux-thunk middleware, Redux Toolkit’s configureStore function already sets that up</li>
</ul>
</li>
<li><p>provide store</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./app/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> serviceWorker <span class="keyword">from</span> <span class="string">&#x27;./serviceWorker&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Provider</span></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/12/21/React-Performance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/21/React-Performance/" class="post-title-link" itemprop="url">React Performance</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-12-21 18:21:22 / Modified: 18:50:52" itemprop="dateCreated datePublished" datetime="2022-12-21T18:21:22-05:00">2022-12-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h1><ul>
<li>memoize a callback based on dependency array.</li>
<li>My example:<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">&#x27;qs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> auth <span class="keyword">from</span> <span class="string">&#x27;auth-provider&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useAuth&#125; <span class="keyword">from</span> <span class="string">&#x27;../context/auth-context&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useCallback&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> apiUrl = process.<span class="property">env</span>.<span class="property">REACT_APP_API_URL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Config</span> <span class="keyword">extends</span> <span class="title class_">RequestInit</span> &#123;</span><br><span class="line">  token?: <span class="built_in">string</span>;</span><br><span class="line">  data?: <span class="built_in">object</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* sends an HTTP request; logs out if &quot;401: Unauthorized&quot;</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">http</span> = <span class="keyword">async</span> (<span class="params"></span></span><br><span class="line"><span class="params">  endpoint: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  &#123;data, token, headers, ...customConfig&#125;: Config = &#123;&#125;</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="comment">// default method: &#x27;GET&#x27;</span></span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="title class_">Authorization</span>: token ? <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: data ? <span class="string">&#x27;application/json&#x27;</span> : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// may override the default method</span></span><br><span class="line">    ...customConfig,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">method</span>.<span class="title function_">toUpperCase</span>() === <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">    endpoint += <span class="string">`?<span class="subst">$&#123;qs.stringify(data)&#125;</span>`</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    config.<span class="property">body</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data || &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span></span><br><span class="line">    .<span class="title function_">fetch</span>(<span class="string">`<span class="subst">$&#123;apiUrl&#125;</span>/<span class="subst">$&#123;endpoint&#125;</span>`</span>, config)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="keyword">async</span> (response) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 401: Unauthorized</span></span><br><span class="line">      <span class="keyword">if</span> (response.<span class="property">status</span> === <span class="number">401</span>) &#123;</span><br><span class="line">        <span class="keyword">await</span> auth.<span class="title function_">logout</span>();</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(&#123;<span class="attr">message</span>: <span class="string">&#x27;Unauthorized.&#x27;</span>&#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">      <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* returns a function that can send an HTTP request with config and user token</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useHttp</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;user&#125; = <span class="title function_">useAuth</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useCallback</span>(<span class="function">(<span class="params">...[endpoint, config]: Parameters&lt;<span class="keyword">typeof</span> http&gt;</span>) =&gt;</span></span><br><span class="line">    <span class="title function_">http</span>(endpoint, &#123;...config, <span class="attr">token</span>: user?.<span class="property">token</span>&#125;), [user?.<span class="property">token</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h1><ul>
<li>memoize the return value<br><code>const value = useMemo(() =&gt; slowFunction(x, y), [x, y])</code></li>
</ul>
<h1 id="React-memo"><a href="#React-memo" class="headerlink" title="React.memo"></a>React.memo</h1><ul>
<li>memoize a component<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">AllocationTable</span> = (<span class="params">props: AllocationTableProps</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// omit codes</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isEqual</span>(<span class="params">oldProps: AllocationTableProps, newProps: AllocationTableProps</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> oldProps.<span class="property">startDate</span> === newProps.<span class="property">startDate</span></span><br><span class="line">  &amp;&amp; oldProps.<span class="property">endDate</span> === newProps.<span class="property">endDate</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MemoizedAllocationTable</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">AllocationTable</span>, isEqual);</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="React-lazy"><a href="#React-lazy" class="headerlink" title="React.lazy"></a>React.lazy</h1><ul>
<li>import when using</li>
<li>My example:<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">AuthenticatedApp</span> = <span class="title class_">React</span>.<span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;authenticated-app&quot;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UnauthenticatedApp</span> = <span class="title class_">React</span>.<span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;unauthenticated-app&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;user&#125; = <span class="title function_">useAuth</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;App&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ErrorBoundary</span> <span class="attr">fallbackRender</span>=<span class="string">&#123;FullPageErrorFallback&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/*React 16.6 added a <span class="tag">&lt;<span class="name">Suspense</span>&gt;</span> component that lets you “wait” for some code to load and declaratively</span></span><br><span class="line"><span class="language-xml">        specify a loading state (like a spinner) while we’re waiting*/&#125;</span></span><br><span class="line"><span class="language-xml">          &#123;/*React.Suspense: experimental feature*/&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">React.Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">FullPageLoading</span>/&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">            &#123;user ? <span class="tag">&lt;<span class="name">AuthenticatedApp</span>/&gt;</span>) : <span class="tag">&lt;<span class="name">UnauthenticatedApp</span>/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">React.Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  );</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">export default App;</span></span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/12/21/MySQL-Stored-Procedures/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/21/MySQL-Stored-Procedures/" class="post-title-link" itemprop="url">MySQL Stored Procedures</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-12-21 15:31:57 / Modified: 16:00:31" itemprop="dateCreated datePublished" datetime="2022-12-21T15:31:57-05:00">2022-12-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h1><p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/dynamic-pivoting-of-a-table/description/">https://leetcode.com/problems/dynamic-pivoting-of-a-table/description/</a></p>
<h1 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE GetCustomers()</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT</span><br><span class="line">		customerName,</span><br><span class="line">		city,</span><br><span class="line">		state,</span><br><span class="line">		postalCode,</span><br><span class="line">		country</span><br><span class="line">	FROM</span><br><span class="line">		customers</span><br><span class="line">	ORDER BY customerName;    </span><br><span class="line">END$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h1 id="Call"><a href="#Call" class="headerlink" title="Call"></a>Call</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL GetCustomers();</span><br></pre></td></tr></table></figure>
<h1 id="Drop"><a href="#Drop" class="headerlink" title="Drop"></a>Drop</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE [IF EXISTS] stored_procedure_name;</span><br></pre></td></tr></table></figure>
<h1 id="Declare-variable"><a href="#Declare-variable" class="headerlink" title="Declare variable"></a>Declare variable</h1><p>inside <code>begin</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECLARE variable_name datatype(size) [DEFAULT default_value];</span><br></pre></td></tr></table></figure>
<h1 id="Parameter"><a href="#Parameter" class="headerlink" title="Parameter"></a>Parameter</h1><p><code>[IN | OUT | INOUT] parameter_name datatype[(length)]</code></p>
<ul>
<li>in: read-only<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE GetOrderCountByStatus (</span><br><span class="line">	IN  orderStatus VARCHAR(25),</span><br><span class="line">	OUT total INT</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT COUNT(orderNumber)</span><br><span class="line">	INTO total</span><br><span class="line">	FROM orders</span><br><span class="line">	WHERE status = orderStatus;</span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CALL GetOrderCountByStatus(&#x27;Shipped&#x27;,@total);</span><br><span class="line">SELECT @total;</span><br></pre></td></tr></table></figure>
<h1 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h1></li>
<li>IF-THEN-ELSEIF- ELSE</li>
<li>Case<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CASE case_value</span><br><span class="line">   WHEN when_value1 THEN statements</span><br><span class="line">   WHEN when_value2 THEN statements</span><br><span class="line">   ...</span><br><span class="line">   [ELSE else-statements]</span><br><span class="line">END CASE;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CASE</span><br><span class="line">    WHEN search_condition1 THEN statements</span><br><span class="line">    WHEN search_condition1 THEN statements</span><br><span class="line">    ...</span><br><span class="line">    [ELSE else-statements]</span><br><span class="line">END CASE;</span><br></pre></td></tr></table></figure>
<h1 id="Loop"><a href="#Loop" class="headerlink" title="Loop"></a>Loop</h1><h2 id="Loop-1"><a href="#Loop-1" class="headerlink" title="Loop"></a>Loop</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:] LOOP</span><br><span class="line">    statement_list</span><br><span class="line">END LOOP [end_label]</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE LoopDemo;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE LoopDemo()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE x  INT;</span><br><span class="line">	DECLARE str  VARCHAR(255);</span><br><span class="line"></span><br><span class="line">	SET x = 1;</span><br><span class="line">	SET str =  &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">	loop_label:  LOOP</span><br><span class="line">		IF  x &gt; 10 THEN</span><br><span class="line">			LEAVE  loop_label;</span><br><span class="line">		END  IF;</span><br><span class="line"></span><br><span class="line">		SET  x = x + 1;</span><br><span class="line">		IF  (x mod 2) THEN</span><br><span class="line">			ITERATE  loop_label;</span><br><span class="line">		ELSE</span><br><span class="line">			SET  str = CONCAT(str,x,&#x27;,&#x27;);</span><br><span class="line">		END  IF;</span><br><span class="line">	END LOOP;</span><br><span class="line">	SELECT str;</span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h2 id="While"><a href="#While" class="headerlink" title="While"></a>While</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:] WHILE search_condition DO</span><br><span class="line">    statement_list</span><br><span class="line">END WHILE [end_label]</span><br></pre></td></tr></table></figure>
<h2 id="Repeat"><a href="#Repeat" class="headerlink" title="Repeat"></a>Repeat</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:] REPEAT</span><br><span class="line">    statement</span><br><span class="line">UNTIL search_condition</span><br><span class="line">END REPEAT [end_label]</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Leave"><a href="#Leave" class="headerlink" title="Leave"></a>Leave</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEAVE label;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE CheckCredit(</span><br><span class="line">    inCustomerNumber int</span><br><span class="line">)</span><br><span class="line">sp: BEGIN</span><br><span class="line"></span><br><span class="line">    DECLARE customerCount INT;</span><br><span class="line"></span><br><span class="line">    -- check if the customer exists</span><br><span class="line">    SELECT</span><br><span class="line">        COUNT(*)</span><br><span class="line">    INTO customerCount</span><br><span class="line">    FROM</span><br><span class="line">        customers</span><br><span class="line">    WHERE</span><br><span class="line">        customerNumber = inCustomerNumber;</span><br><span class="line"></span><br><span class="line">    -- if the customer does not exist, terminate</span><br><span class="line">    -- the stored procedure</span><br><span class="line">    IF customerCount = 0 THEN</span><br><span class="line">        LEAVE sp;</span><br><span class="line">    END IF;</span><br><span class="line"></span><br><span class="line">    -- other logic</span><br><span class="line">    -- ...</span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line">Cod</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE LeaveDemo(OUT result VARCHAR(100))</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE counter INT DEFAULT 1;</span><br><span class="line">    DECLARE times INT;</span><br><span class="line">    -- generate a random integer between 4 and 10</span><br><span class="line">    SET times  = FLOOR(RAND()*(10-4+1)+4);</span><br><span class="line">    SET result = &#x27;&#x27;;</span><br><span class="line">    disp: LOOP</span><br><span class="line">        -- concatenate counters into the result</span><br><span class="line">        SET result = concat(result,counter,&#x27;,&#x27;);</span><br><span class="line"></span><br><span class="line">        -- exit the loop if counter equals times</span><br><span class="line">        IF counter = times THEN</span><br><span class="line">            LEAVE disp;</span><br><span class="line">        END IF;</span><br><span class="line">        SET counter = counter + 1;</span><br><span class="line">    END LOOP;</span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h1 id="Cursor"><a href="#Cursor" class="headerlink" title="Cursor"></a>Cursor</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DECLARE cursor_name CURSOR FOR SELECT_statement;</span><br><span class="line">OPEN cursor_name;</span><br><span class="line">FETCH cursor_name INTO variables list;</span><br><span class="line">CLOSE cursor_name;</span><br><span class="line">DECLARE CONTINUE HANDLER FOR NOT FOUND SET finished = 1;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE createEmailList (</span><br><span class="line">	INOUT emailList varchar(4000)</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE finished INTEGER DEFAULT 0;</span><br><span class="line">	DECLARE emailAddress varchar(100) DEFAULT &quot;&quot;;</span><br><span class="line"></span><br><span class="line">	-- declare cursor for employee email</span><br><span class="line">	DEClARE curEmail</span><br><span class="line">		CURSOR FOR</span><br><span class="line">			SELECT email FROM employees;</span><br><span class="line"></span><br><span class="line">	-- declare NOT FOUND handler</span><br><span class="line">	DECLARE CONTINUE HANDLER</span><br><span class="line">        FOR NOT FOUND SET finished = 1;</span><br><span class="line"></span><br><span class="line">	OPEN curEmail;</span><br><span class="line"></span><br><span class="line">	getEmail: LOOP</span><br><span class="line">		FETCH curEmail INTO emailAddress;</span><br><span class="line">		IF finished = 1 THEN</span><br><span class="line">			LEAVE getEmail;</span><br><span class="line">		END IF;</span><br><span class="line">		-- build email list</span><br><span class="line">		SET emailList = CONCAT(emailAddress,&quot;;&quot;,emailList);</span><br><span class="line">	END LOOP getEmail;</span><br><span class="line">	CLOSE curEmail;</span><br><span class="line"></span><br><span class="line">END$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h1 id="Handling-Error"><a href="#Handling-Error" class="headerlink" title="Handling Error"></a>Handling Error</h1><ul>
<li><code>DECLARE action HANDLER FOR condition_value statement;</code></li>
<li>action<ul>
<li><code>CONTINUE</code></li>
<li><code>EXIT</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DECLARE EXIT HANDLER FOR SQLEXCEPTION</span><br><span class="line">BEGIN</span><br><span class="line">    ROLLBACK;</span><br><span class="line">    SELECT &#x27;An error has occurred, operation rollbacked and the stored procedure was terminated&#x27;;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DECLARE CONTINUE HANDLER FOR NOT FOUND</span><br><span class="line">SET RowNotFound = 1;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DECLARE CONTINUE HANDLER FOR 1062</span><br><span class="line">SELECT &#x27;Error, duplicate key occurred&#x27;;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE InsertSupplierProduct(</span><br><span class="line">    IN inSupplierId INT,</span><br><span class="line">    IN inProductId INT</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">    -- exit if the duplicate key occurs</span><br><span class="line">    DECLARE EXIT HANDLER FOR 1062</span><br><span class="line">    BEGIN</span><br><span class="line"> 	SELECT CONCAT(&#x27;Duplicate key (&#x27;,inSupplierId,&#x27;,&#x27;,inProductId,&#x27;) occurred&#x27;) AS message;</span><br><span class="line">    END;</span><br><span class="line"></span><br><span class="line">    -- insert a new row into the SupplierProducts</span><br><span class="line">    INSERT INTO SupplierProducts(supplierId,productId)</span><br><span class="line">    VALUES(inSupplierId,inProductId);</span><br><span class="line"></span><br><span class="line">    -- return the products supplied by the supplier id</span><br><span class="line">    SELECT COUNT(*)</span><br><span class="line">    FROM SupplierProducts</span><br><span class="line">    WHERE supplierId = inSupplierId;</span><br><span class="line"></span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h2 id="Precedence"><a href="#Precedence" class="headerlink" title="Precedence"></a>Precedence</h2><ul>
<li>error code</li>
<li>An SQLSTATE may map to many MySQL error codes, therefore, it is less specific.</li>
<li>An SQLEXCPETION or an SQLWARNING is the shorthand for a class of SQLSTATES values so it is the most generic<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE IF EXISTS InsertSupplierProduct;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE InsertSupplierProduct(</span><br><span class="line">    IN inSupplierId INT,</span><br><span class="line">    IN inProductId INT</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">    -- exit if the duplicate key occurs</span><br><span class="line">    DECLARE EXIT HANDLER FOR 1062 SELECT &#x27;Duplicate keys error encountered&#x27; Message;</span><br><span class="line">    DECLARE EXIT HANDLER FOR SQLEXCEPTION SELECT &#x27;SQLException encountered&#x27; Message;</span><br><span class="line">    DECLARE EXIT HANDLER FOR SQLSTATE &#x27;23000&#x27; SELECT &#x27;SQLSTATE 23000&#x27; ErrorCode;</span><br><span class="line"></span><br><span class="line">    -- insert a new row into the SupplierProducts</span><br><span class="line">    INSERT INTO SupplierProducts(supplierId,productId)</span><br><span class="line">    VALUES(inSupplierId,inProductId);</span><br><span class="line"></span><br><span class="line">    -- return the products supplied by the supplier id</span><br><span class="line">    SELECT COUNT(*)</span><br><span class="line">    FROM SupplierProducts</span><br><span class="line">    WHERE supplierId = inSupplierId;</span><br><span class="line"></span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h2 id="Using-a-named-error-condition"><a href="#Using-a-named-error-condition" class="headerlink" title="Using a named error condition"></a>Using a named error condition</h2><code>DECLARE condition_name CONDITION FOR condition_value;</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE IF EXISTS TestProc;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE TestProc()</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE TableNotFound CONDITION for 1146 ;</span><br><span class="line"></span><br><span class="line">    DECLARE EXIT HANDLER FOR TableNotFound</span><br><span class="line">	SELECT &#x27;Please create table abc first&#x27; Message;</span><br><span class="line">    SELECT * FROM abc;</span><br><span class="line">END$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h1 id="Raising-Error"><a href="#Raising-Error" class="headerlink" title="Raising Error"></a>Raising Error</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SIGNAL SQLSTATE | condition_name;</span><br><span class="line">SET condition_information_item_name_1 = value_1,</span><br><span class="line">    condition_information_item_name_1 = value_2, etc;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE AddOrderItem(</span><br><span class="line">		         in orderNo int,</span><br><span class="line">			 in productCode varchar(45),</span><br><span class="line">			 in qty int,</span><br><span class="line">                         in price double,</span><br><span class="line">                         in lineNo int )</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE C INT;</span><br><span class="line"></span><br><span class="line">	SELECT COUNT(orderNumber) INTO C</span><br><span class="line">	FROM orders</span><br><span class="line">	WHERE orderNumber = orderNo;</span><br><span class="line"></span><br><span class="line">	-- check if orderNumber exists</span><br><span class="line">	IF(C != 1) THEN</span><br><span class="line">		SIGNAL SQLSTATE &#x27;45000&#x27;</span><br><span class="line">			SET MESSAGE_TEXT = &#x27;Order No not found in orders table&#x27;;</span><br><span class="line">	END IF;</span><br><span class="line">	-- more code below</span><br><span class="line">	-- ...</span><br><span class="line">END</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/12/21/PL-SQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/21/PL-SQL/" class="post-title-link" itemprop="url">PL-SQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-12-21 11:54:57 / Modified: 15:25:38" itemprop="dateCreated datePublished" datetime="2022-12-21T11:54:57-05:00">2022-12-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   &lt;declarations section&gt;</span><br><span class="line">BEGIN</span><br><span class="line">   &lt;executable command(s)&gt;</span><br><span class="line">EXCEPTION</span><br><span class="line">   &lt;exception handling&gt;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   -- variable declaration</span><br><span class="line">   message  varchar2(20):= &#x27;Hello, World!&#x27;;</span><br><span class="line">BEGIN</span><br><span class="line">   /*</span><br><span class="line">   *  PL/SQL executable statement(s)</span><br><span class="line">   */</span><br><span class="line">   dbms_output.put_line(message);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h1 id="Data-types"><a href="#Data-types" class="headerlink" title="Data types"></a>Data types</h1><h2 id="Scalar"><a href="#Scalar" class="headerlink" title="Scalar"></a>Scalar</h2><ul>
<li>Numeric</li>
<li>Character</li>
<li>Boolean</li>
<li>Datetime</li>
<li>Null</li>
</ul>
<h2 id="Large-Object-LOB"><a href="#Large-Object-LOB" class="headerlink" title="Large Object (LOB)"></a>Large Object (LOB)</h2><p>…</p>
<h2 id="User-Defined-Subtypes"><a href="#User-Defined-Subtypes" class="headerlink" title="User-Defined Subtypes"></a>User-Defined Subtypes</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   SUBTYPE name IS char(20);</span><br><span class="line">   SUBTYPE message IS varchar2(100);</span><br><span class="line">   salutation name;</span><br><span class="line">   greetings message;</span><br><span class="line">BEGIN</span><br><span class="line">   salutation := &#x27;Reader &#x27;;</span><br><span class="line">   greetings := &#x27;Welcome to the World of PL/SQL&#x27;;</span><br><span class="line">   dbms_output.put_line(&#x27;Hello &#x27; || salutation || greetings);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="Composite"><a href="#Composite" class="headerlink" title="Composite"></a>Composite</h2><p>Data items that have internal components that can be accessed individually. For example, collections and records.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>Pointers to other data items</p>
<h1 id="Variable"><a href="#Variable" class="headerlink" title="Variable"></a>Variable</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sales number(10, 2);</span><br><span class="line">pi CONSTANT double precision := 3.1415;</span><br><span class="line">name varchar2(25);</span><br><span class="line">greetings varchar2(20) DEFAULT &#x27;Have a Good Day&#x27;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   c_id customers.id%type := 1;</span><br><span class="line">   c_name  customers.name%type;</span><br><span class="line">   c_addr customers.address%type;</span><br><span class="line">   c_sal  customers.salary%type;</span><br><span class="line">BEGIN</span><br><span class="line">   SELECT name, address, salary INTO c_name, c_addr, c_sal</span><br><span class="line">   FROM customers</span><br><span class="line">   WHERE id = c_id;  </span><br><span class="line">   dbms_output.put_line</span><br><span class="line">   (&#x27;Customer &#x27; ||c_name || &#x27; from &#x27; || c_addr || &#x27; earns &#x27; || c_sal);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   -- Global variables  </span><br><span class="line">   num1 number := 95;  </span><br><span class="line">   num2 number := 85;  </span><br><span class="line">BEGIN  </span><br><span class="line">   dbms_output.put_line(&#x27;Outer Variable num1: &#x27; || num1);</span><br><span class="line">   dbms_output.put_line(&#x27;Outer Variable num2: &#x27; || num2);</span><br><span class="line">   DECLARE  </span><br><span class="line">      -- Local variables</span><br><span class="line">      num1 number := 195;  </span><br><span class="line">      num2 number := 185;  </span><br><span class="line">   BEGIN  </span><br><span class="line">      dbms_output.put_line(&#x27;Inner Variable num1: &#x27; || num1);</span><br><span class="line">      dbms_output.put_line(&#x27;Inner Variable num2: &#x27; || num2);</span><br><span class="line">   END;  </span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<h1 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h1><p>**: exponentiation<br>+, -: identity, negation<br>*, &#x2F;<br>+, -, ||<br>comparison<br>NOT<br>AND<br>OR</p>
<h1 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h1><h2 id="IF-THEN-ELSIF-ELSE"><a href="#IF-THEN-ELSIF-ELSE" class="headerlink" title="IF-THEN-ELSIF-ELSE"></a>IF-THEN-ELSIF-ELSE</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   a number(3) := 100;</span><br><span class="line">BEGIN</span><br><span class="line">   IF ( a = 10 ) THEN</span><br><span class="line">      dbms_output.put_line(&#x27;Value of a is 10&#x27; );</span><br><span class="line">   ELSIF ( a = 20 ) THEN</span><br><span class="line">      dbms_output.put_line(&#x27;Value of a is 20&#x27; );</span><br><span class="line">   ELSIF ( a = 30 ) THEN</span><br><span class="line">      dbms_output.put_line(&#x27;Value of a is 30&#x27; );</span><br><span class="line">   ELSE</span><br><span class="line">       dbms_output.put_line(&#x27;None of the values is matching&#x27;);</span><br><span class="line">   END IF;</span><br><span class="line">   dbms_output.put_line(&#x27;Exact value of a is: &#x27;|| a );  </span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="Case"><a href="#Case" class="headerlink" title="Case"></a>Case</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CASE selector</span><br><span class="line">WHEN &#x27;value1&#x27; THEN S1;</span><br><span class="line">WHEN &#x27;value2&#x27; THEN S2;</span><br><span class="line">WHEN &#x27;value3&#x27; THEN S3;</span><br><span class="line">...</span><br><span class="line">ELSE Sn;  -- default case</span><br><span class="line">END CASE;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CASE</span><br><span class="line">WHEN selector = &#x27;value1&#x27; THEN S1;</span><br><span class="line">WHEN selector = &#x27;value2&#x27; THEN S2;</span><br><span class="line">WHEN selector = &#x27;value3&#x27; THEN S3;</span><br><span class="line">...</span><br><span class="line">ELSE Sn;  -- default case</span><br><span class="line">END CASE;</span><br></pre></td></tr></table></figure>

<h1 id="Loop"><a href="#Loop" class="headerlink" title="Loop"></a>Loop</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LOOP</span><br><span class="line">  Sequence of statements;</span><br><span class="line">END LOOP;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">  x number := 10;</span><br><span class="line">BEGIN</span><br><span class="line">  LOOP</span><br><span class="line">    dbms_output.put_line(x);</span><br><span class="line">    x := x + 10;</span><br><span class="line">    IF x &gt; 50 THEN</span><br><span class="line">      exit;</span><br><span class="line">    END IF;</span><br><span class="line">  END LOOP;</span><br><span class="line">  -- after exit, control resumes here</span><br><span class="line">  dbms_output.put_line(&#x27;After Exit x is: &#x27; || x);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">  x number := 10;</span><br><span class="line">BEGIN</span><br><span class="line">  LOOP</span><br><span class="line">    dbms_output.put_line(x);</span><br><span class="line">    x := x + 10;</span><br><span class="line">    exit WHEN x &gt; 50;</span><br><span class="line">    END LOOP;</span><br><span class="line">    -- after exit, control resumes here</span><br><span class="line">    dbms_output.put_line(&#x27;After Exit x is: &#x27; || x);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   a number(2) := 10;</span><br><span class="line">BEGIN</span><br><span class="line">   WHILE a &lt; 20 LOOP</span><br><span class="line">      dbms_output.put_line(&#x27;value of a: &#x27; || a);</span><br><span class="line">      a := a + 1;</span><br><span class="line">   END LOOP;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="Label"><a href="#Label" class="headerlink" title="Label"></a>Label</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ECLARE</span><br><span class="line">   i number(1);</span><br><span class="line">   j number(1);</span><br><span class="line">BEGIN</span><br><span class="line">   &lt;&lt; outer_loop &gt;&gt;</span><br><span class="line">   FOR i IN 1..3 LOOP</span><br><span class="line">      &lt;&lt; inner_loop &gt;&gt;</span><br><span class="line">      FOR j IN 1..3 LOOP</span><br><span class="line">         dbms_output.put_line(&#x27;i is: &#x27;|| i || &#x27; and j is: &#x27; || j);</span><br><span class="line">      END loop inner_loop;</span><br><span class="line">   END loop outer_loop;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="Control"><a href="#Control" class="headerlink" title="Control"></a>Control</h2><ul>
<li>exit</li>
<li>continue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONTINUE;</span><br></pre></td></tr></table></figure></li>
<li>goto<br>not recommended to use</li>
</ul>
<h1 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE varray_type_name IS VARRAY(n) of &lt;element_type&gt;</span><br><span class="line"></span><br><span class="line">TYPE varray_type_name IS VARRAY(n) of &lt;element_type&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   type namesarray IS VARRAY(5) OF VARCHAR2(10);</span><br><span class="line">   type grades IS VARRAY(5) OF INTEGER;</span><br><span class="line">   names namesarray;</span><br><span class="line">   marks grades;</span><br><span class="line">   total integer;</span><br><span class="line">BEGIN</span><br><span class="line">   names := namesarray(&#x27;Kavita&#x27;, &#x27;Pritam&#x27;, &#x27;Ayan&#x27;, &#x27;Rishav&#x27;, &#x27;Aziz&#x27;);</span><br><span class="line">   marks:= grades(98, 97, 78, 87, 92);</span><br><span class="line">   total := names.count;</span><br><span class="line">   dbms_output.put_line(&#x27;Total &#x27;|| total || &#x27; Students&#x27;);</span><br><span class="line">   FOR i in 1 .. total LOOP</span><br><span class="line">      dbms_output.put_line(&#x27;Student: &#x27; || names(i) || &#x27;</span><br><span class="line">      Marks: &#x27; || marks(i));</span><br><span class="line">   END LOOP;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<p>In Oracle environment, the starting index for varrays is always 1.</p>
<p>Elements of a varray could also be a %ROWTYPE of any database table or %TYPE of any database table field.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   CURSOR c_customers is</span><br><span class="line">   SELECT  name FROM customers;</span><br><span class="line">   type c_list is varray (6) of customers.name%type;</span><br><span class="line">   name_list c_list := c_list();</span><br><span class="line">   counter integer :=0;</span><br><span class="line">BEGIN</span><br><span class="line">   FOR n IN c_customers LOOP</span><br><span class="line">      counter := counter + 1;</span><br><span class="line">      name_list.extend;</span><br><span class="line">      name_list(counter)  := n.name;</span><br><span class="line">      dbms_output.put_line(&#x27;Customer(&#x27;||counter ||&#x27;):&#x27;||name_list(counter));</span><br><span class="line">   END LOOP;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<h1 id="Procedure"><a href="#Procedure" class="headerlink" title="Procedure"></a>Procedure</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE [OR REPLACE] PROCEDURE procedure_name</span><br><span class="line">[(parameter_name [IN | OUT | IN OUT] type [, ...])]</span><br><span class="line">&#123;IS | AS&#125;</span><br><span class="line">BEGIN</span><br><span class="line">  &lt; procedure_body &gt;</span><br><span class="line">END [procedure_name];</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE PROCEDURE greetings</span><br><span class="line">AS</span><br><span class="line">BEGIN</span><br><span class="line">   dbms_output.put_line(&#x27;Hello World!&#x27;);</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">EXECUTE greetings;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE procedure-name;</span><br></pre></td></tr></table></figure>
<p>The AS keyword is used instead of the IS keyword for creating a standalone procedure.</p>
<ul>
<li>in: read-only, default</li>
<li>out</li>
<li>in out<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   a number;</span><br><span class="line">PROCEDURE squareNum(x IN OUT number) IS</span><br><span class="line">BEGIN</span><br><span class="line">  x := x * x;</span><br><span class="line">END;  </span><br><span class="line">BEGIN</span><br><span class="line">   a:= 23;</span><br><span class="line">   squareNum(a);</span><br><span class="line">   dbms_output.put_line(&#x27; Square of (23): &#x27; || a);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="function"><a href="#function" class="headerlink" title="function"></a>function</h1><p>returns a value</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE [OR REPLACE] FUNCTION function_name</span><br><span class="line">[(parameter_name [IN | OUT | IN OUT] type [, ...])]</span><br><span class="line">RETURN return_datatype</span><br><span class="line">&#123;IS | AS&#125;</span><br><span class="line">BEGIN</span><br><span class="line">   &lt; function_body &gt;</span><br><span class="line">END [function_name];</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   c number(2);</span><br><span class="line">BEGIN</span><br><span class="line">   c := totalCustomers();</span><br><span class="line">   dbms_output.put_line(&#x27;Total no. of Customers: &#x27; || c);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<h1 id="cursor"><a href="#cursor" class="headerlink" title="cursor"></a>cursor</h1><p>A cursor holds the rows (one or more) returned by a SQL statement.</p>
<h2 id="Implicit-Cursors"><a href="#Implicit-Cursors" class="headerlink" title="Implicit Cursors"></a>Implicit Cursors</h2><p>For INSERT operations, the cursor holds the data that needs to be inserted. For UPDATE and DELETE operations, the cursor identifies the rows that would be affected.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DECLARE  </span><br><span class="line">   total_rows number(2);</span><br><span class="line">BEGIN</span><br><span class="line">   UPDATE customers</span><br><span class="line">   SET salary = salary + 500;</span><br><span class="line">   IF sql%notfound THEN</span><br><span class="line">      dbms_output.put_line(&#x27;no customers selected&#x27;);</span><br><span class="line">   ELSIF sql%found THEN</span><br><span class="line">      total_rows := sql%rowcount;</span><br><span class="line">      dbms_output.put_line( total_rows || &#x27; customers selected &#x27;);</span><br><span class="line">   END IF;  </span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="Explicit-Cursors"><a href="#Explicit-Cursors" class="headerlink" title="Explicit Cursors"></a>Explicit Cursors</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CURSOR c_customers IS</span><br><span class="line">   SELECT id, name, address FROM customers;</span><br><span class="line"></span><br><span class="line">OPEN c_customers;</span><br><span class="line"></span><br><span class="line">FETCH c_customers INTO c_id, c_name, c_addr;</span><br><span class="line"></span><br><span class="line">CLOSE c_customers;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   c_id customers.id%type;</span><br><span class="line">   c_name customers.name%type;</span><br><span class="line">   c_addr customers.address%type;</span><br><span class="line">   CURSOR c_customers is</span><br><span class="line">      SELECT id, name, address FROM customers;</span><br><span class="line">BEGIN</span><br><span class="line">   OPEN c_customers;</span><br><span class="line">   LOOP</span><br><span class="line">   FETCH c_customers into c_id, c_name, c_addr;</span><br><span class="line">      EXIT WHEN c_customers%notfound;</span><br><span class="line">      dbms_output.put_line(c_id || &#x27; &#x27; || c_name || &#x27; &#x27; || c_addr);</span><br><span class="line">   END LOOP;</span><br><span class="line">   CLOSE c_customers;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h1 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h1><h2 id="Table-Based-Records"><a href="#Table-Based-Records" class="headerlink" title="Table-Based Records"></a>Table-Based Records</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   customer_rec customers%rowtype;</span><br><span class="line">BEGIN</span><br><span class="line">   SELECT * into customer_rec</span><br><span class="line">   FROM customers</span><br><span class="line">   WHERE id = 5;  </span><br><span class="line">   dbms_output.put_line(&#x27;Customer ID: &#x27; || customer_rec.id);</span><br><span class="line">   dbms_output.put_line(&#x27;Customer Name: &#x27; || customer_rec.name);</span><br><span class="line">   dbms_output.put_line(&#x27;Customer Address: &#x27; || customer_rec.address);</span><br><span class="line">   dbms_output.put_line(&#x27;Customer Salary: &#x27; || customer_rec.salary);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="Cursor-Based-Records"><a href="#Cursor-Based-Records" class="headerlink" title="Cursor-Based Records"></a>Cursor-Based Records</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   CURSOR customer_cur is</span><br><span class="line">      SELECT id, name, address  </span><br><span class="line">      FROM customers;</span><br><span class="line">   customer_rec customer_cur%rowtype;</span><br><span class="line">BEGIN</span><br><span class="line">   OPEN customer_cur;</span><br><span class="line">   LOOP</span><br><span class="line">      FETCH customer_cur into customer_rec;</span><br><span class="line">      EXIT WHEN customer_cur%notfound;</span><br><span class="line">      DBMS_OUTPUT.put_line(customer_rec.id || &#x27; &#x27; || customer_rec.name);</span><br><span class="line">   END LOOP;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="User-Defined-Records"><a href="#User-Defined-Records" class="headerlink" title="User-Defined Records"></a>User-Defined Records</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">TYPE books IS RECORD</span><br><span class="line">(title  varchar(50),</span><br><span class="line">   author  varchar(50),</span><br><span class="line">   subject varchar(100),</span><br><span class="line">   book_id   number);</span><br><span class="line">book1 books;</span><br><span class="line">book2 books;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   type books is record</span><br><span class="line">      (title varchar(50),</span><br><span class="line">      author varchar(50),</span><br><span class="line">      subject varchar(100),</span><br><span class="line">      book_id number);</span><br><span class="line">   book1 books;</span><br><span class="line">   book2 books;</span><br><span class="line">BEGIN</span><br><span class="line">   -- Book 1 specification</span><br><span class="line">   book1.title  := &#x27;C Programming&#x27;;</span><br><span class="line">   book1.author := &#x27;Nuha Ali &#x27;;  </span><br><span class="line">   book1.subject := &#x27;C Programming Tutorial&#x27;;</span><br><span class="line">   book1.book_id := 6495407;  </span><br><span class="line">   -- Book 2 specification</span><br><span class="line">   book2.title := &#x27;Telecom Billing&#x27;;</span><br><span class="line">   book2.author := &#x27;Zara Ali&#x27;;</span><br><span class="line">   book2.subject := &#x27;Telecom Billing Tutorial&#x27;;</span><br><span class="line">   book2.book_id := 6495700;  </span><br><span class="line"></span><br><span class="line">  -- Print book 1 record</span><br><span class="line">   dbms_output.put_line(&#x27;Book 1 title : &#x27;|| book1.title);</span><br><span class="line">   dbms_output.put_line(&#x27;Book 1 author : &#x27;|| book1.author);</span><br><span class="line">   dbms_output.put_line(&#x27;Book 1 subject : &#x27;|| book1.subject);</span><br><span class="line">   dbms_output.put_line(&#x27;Book 1 book_id : &#x27; || book1.book_id);</span><br><span class="line"></span><br><span class="line">   -- Print book 2 record</span><br><span class="line">   dbms_output.put_line(&#x27;Book 2 title : &#x27;|| book2.title);</span><br><span class="line">   dbms_output.put_line(&#x27;Book 2 author : &#x27;|| book2.author);</span><br><span class="line">   dbms_output.put_line(&#x27;Book 2 subject : &#x27;|| book2.subject);</span><br><span class="line">   dbms_output.put_line(&#x27;Book 2 book_id : &#x27;|| book2.book_id);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   type books is record</span><br><span class="line">      (title  varchar(50),</span><br><span class="line">      author  varchar(50),</span><br><span class="line">      subject varchar(100),</span><br><span class="line">      book_id   number);</span><br><span class="line">   book1 books;</span><br><span class="line">   book2 books;  </span><br><span class="line">PROCEDURE printbook (book books) IS</span><br><span class="line">BEGIN</span><br><span class="line">   dbms_output.put_line (&#x27;Book  title :  &#x27; || book.title);</span><br><span class="line">   dbms_output.put_line(&#x27;Book  author : &#x27; || book.author);</span><br><span class="line">   dbms_output.put_line( &#x27;Book  subject : &#x27; || book.subject);</span><br><span class="line">   dbms_output.put_line( &#x27;Book book_id : &#x27; || book.book_id);</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line">   -- Book 1 specification</span><br><span class="line">   book1.title  := &#x27;C Programming&#x27;;</span><br><span class="line">   book1.author := &#x27;Nuha Ali &#x27;;  </span><br><span class="line">   book1.subject := &#x27;C Programming Tutorial&#x27;;</span><br><span class="line">   book1.book_id := 6495407;</span><br><span class="line"></span><br><span class="line">   -- Book 2 specification</span><br><span class="line">   book2.title := &#x27;Telecom Billing&#x27;;</span><br><span class="line">   book2.author := &#x27;Zara Ali&#x27;;</span><br><span class="line">   book2.subject := &#x27;Telecom Billing Tutorial&#x27;;</span><br><span class="line">   book2.book_id := 6495700;  </span><br><span class="line"></span><br><span class="line">   -- Use procedure to print book info</span><br><span class="line">   printbook(book1);</span><br><span class="line">   printbook(book2);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<h1 id="Exception"><a href="#Exception" class="headerlink" title="Exception"></a>Exception</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   &lt;declarations section&gt;</span><br><span class="line">BEGIN</span><br><span class="line">   &lt;executable command(s)&gt;</span><br><span class="line">EXCEPTION</span><br><span class="line">   &lt;exception handling goes here &gt;</span><br><span class="line">   WHEN exception1 THEN  </span><br><span class="line">      exception1-handling-statements  </span><br><span class="line">   WHEN exception2  THEN  </span><br><span class="line">      exception2-handling-statements  </span><br><span class="line">   WHEN exception3 THEN  </span><br><span class="line">      exception3-handling-statements</span><br><span class="line">   ........</span><br><span class="line">   WHEN others THEN</span><br><span class="line">      exception3-handling-statements</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   c_id customers.id%type := 8;</span><br><span class="line">   c_name customerS.Name%type;</span><br><span class="line">   c_addr customers.address%type;</span><br><span class="line">BEGIN</span><br><span class="line">   SELECT  name, address INTO  c_name, c_addr</span><br><span class="line">   FROM customers</span><br><span class="line">   WHERE id = c_id;  </span><br><span class="line">   DBMS_OUTPUT.PUT_LINE (&#x27;Name: &#x27;||  c_name);</span><br><span class="line">   DBMS_OUTPUT.PUT_LINE (&#x27;Address: &#x27; || c_addr);</span><br><span class="line"></span><br><span class="line">EXCEPTION</span><br><span class="line">   WHEN no_data_found THEN</span><br><span class="line">      dbms_output.put_line(&#x27;No such customer!&#x27;);</span><br><span class="line">   WHEN others THEN</span><br><span class="line">      dbms_output.put_line(&#x27;Error!&#x27;);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   exception_name EXCEPTION;</span><br><span class="line">BEGIN</span><br><span class="line">   IF condition THEN</span><br><span class="line">      RAISE exception_name;</span><br><span class="line">   END IF;</span><br><span class="line">EXCEPTION</span><br><span class="line">   WHEN exception_name THEN</span><br><span class="line">   statement;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="User-defined-exception"><a href="#User-defined-exception" class="headerlink" title="User-defined exception"></a>User-defined exception</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   my-exception EXCEPTION;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   c_id customers.id%type := &amp;cc_id;</span><br><span class="line">   c_name customerS.Name%type;</span><br><span class="line">   c_addr customers.address%type;  </span><br><span class="line">   -- user defined exception</span><br><span class="line">   ex_invalid_id  EXCEPTION;</span><br><span class="line">BEGIN</span><br><span class="line">   IF c_id &lt;= 0 THEN</span><br><span class="line">      RAISE ex_invalid_id;</span><br><span class="line">   ELSE</span><br><span class="line">      SELECT  name, address INTO  c_name, c_addr</span><br><span class="line">      FROM customers</span><br><span class="line">      WHERE id = c_id;</span><br><span class="line">      DBMS_OUTPUT.PUT_LINE (&#x27;Name: &#x27;||  c_name);  </span><br><span class="line">      DBMS_OUTPUT.PUT_LINE (&#x27;Address: &#x27; || c_addr);</span><br><span class="line">   END IF;</span><br><span class="line"></span><br><span class="line">EXCEPTION</span><br><span class="line">   WHEN ex_invalid_id THEN</span><br><span class="line">      dbms_output.put_line(&#x27;ID must be greater than zero!&#x27;);</span><br><span class="line">   WHEN no_data_found THEN</span><br><span class="line">      dbms_output.put_line(&#x27;No such customer!&#x27;);</span><br><span class="line">   WHEN others THEN</span><br><span class="line">      dbms_output.put_line(&#x27;Error!&#x27;);  </span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="Pre-defined-exception"><a href="#Pre-defined-exception" class="headerlink" title="Pre-defined exception"></a>Pre-defined exception</h2><p>…</p>
<h1 id="Triggers"><a href="#Triggers" class="headerlink" title="Triggers"></a>Triggers</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CREATE [OR REPLACE ] TRIGGER trigger_name  </span><br><span class="line">&#123;BEFORE | AFTER | INSTEAD OF &#125;  </span><br><span class="line">&#123;INSERT [OR] | UPDATE [OR] | DELETE&#125;  </span><br><span class="line">[OF col_name]  </span><br><span class="line">ON table_name  </span><br><span class="line">[REFERENCING OLD AS o NEW AS n]  </span><br><span class="line">[FOR EACH ROW]  </span><br><span class="line">WHEN (condition)   </span><br><span class="line">DECLARE</span><br><span class="line">   Declaration-statements</span><br><span class="line">BEGIN  </span><br><span class="line">   Executable-statements</span><br><span class="line">EXCEPTION</span><br><span class="line">   Exception-handling-statements</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TRIGGER display_salary_changes</span><br><span class="line">BEFORE DELETE OR INSERT OR UPDATE ON customers</span><br><span class="line">FOR EACH ROW</span><br><span class="line">WHEN (NEW.ID &gt; 0)</span><br><span class="line">DECLARE</span><br><span class="line">   sal_diff number;</span><br><span class="line">BEGIN</span><br><span class="line">   sal_diff := :NEW.salary  - :OLD.salary;</span><br><span class="line">   dbms_output.put_line(&#x27;Old salary: &#x27; || :OLD.salary);</span><br><span class="line">   dbms_output.put_line(&#x27;New salary: &#x27; || :NEW.salary);</span><br><span class="line">   dbms_output.put_line(&#x27;Salary difference: &#x27; || sal_diff);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<h1 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE PACKAGE cust_sal AS</span><br><span class="line">   PROCEDURE find_sal(c_id customers.id%type);</span><br><span class="line">END cust_sal;</span><br></pre></td></tr></table></figure>
<p>All objects placed in the specification are called public objects. Any subprogram not in the package specification but coded in the package body is called a private object.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE PACKAGE BODY cust_sal AS  </span><br><span class="line"></span><br><span class="line">   PROCEDURE find_sal(c_id customers.id%TYPE) IS</span><br><span class="line">   c_sal customers.salary%TYPE;</span><br><span class="line">   BEGIN</span><br><span class="line">      SELECT salary INTO c_sal</span><br><span class="line">      FROM customers</span><br><span class="line">      WHERE id = c_id;</span><br><span class="line">      dbms_output.put_line(&#x27;Salary: &#x27;|| c_sal);</span><br><span class="line">   END find_sal;</span><br><span class="line">END cust_sal;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package_name.element_name;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   code customers.id%type := &amp;cc_id;</span><br><span class="line">BEGIN</span><br><span class="line">   cust_sal.find_sal(code);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<ul>
<li>create specification<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE PACKAGE c_package AS</span><br><span class="line">   -- Adds a customer</span><br><span class="line">   PROCEDURE addCustomer(c_id   customers.id%type,</span><br><span class="line">   c_name customers.Name%type,</span><br><span class="line">   c_age  customers.age%type,</span><br><span class="line">   c_addr customers.address%type,  </span><br><span class="line">   c_sal  customers.salary%type);</span><br><span class="line"></span><br><span class="line">   -- Removes a customer</span><br><span class="line">   PROCEDURE delCustomer(c_id  customers.id%TYPE);</span><br><span class="line">   --Lists all customers</span><br><span class="line">   PROCEDURE listCustomer;</span><br><span class="line"></span><br><span class="line">END c_package;</span><br></pre></td></tr></table></figure></li>
<li>create body<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE PACKAGE BODY c_package AS</span><br><span class="line">   PROCEDURE addCustomer(c_id  customers.id%type,</span><br><span class="line">      c_name customers.Name%type,</span><br><span class="line">      c_age  customers.age%type,</span><br><span class="line">      c_addr  customers.address%type,  </span><br><span class="line">      c_sal   customers.salary%type)</span><br><span class="line">   IS</span><br><span class="line">   BEGIN</span><br><span class="line">      INSERT INTO customers (id,name,age,address,salary)</span><br><span class="line">         VALUES(c_id, c_name, c_age, c_addr, c_sal);</span><br><span class="line">   END addCustomer;</span><br><span class="line"></span><br><span class="line">   PROCEDURE delCustomer(c_id   customers.id%type) IS</span><br><span class="line">   BEGIN</span><br><span class="line">      DELETE FROM customers</span><br><span class="line">      WHERE id = c_id;</span><br><span class="line">   END delCustomer;  </span><br><span class="line"></span><br><span class="line">   PROCEDURE listCustomer IS</span><br><span class="line">   CURSOR c_customers is</span><br><span class="line">      SELECT  name FROM customers;</span><br><span class="line">   TYPE c_list is TABLE OF customers.Name%type;</span><br><span class="line">   name_list c_list := c_list();</span><br><span class="line">   counter integer :=0;</span><br><span class="line">   BEGIN</span><br><span class="line">      FOR n IN c_customers LOOP</span><br><span class="line">      counter := counter +1;</span><br><span class="line">      name_list.extend;</span><br><span class="line">      name_list(counter) := n.name;</span><br><span class="line">      dbms_output.put_line(&#x27;Customer(&#x27; ||counter|| &#x27;)&#x27;||name_list(counter));</span><br><span class="line">      END LOOP;</span><br><span class="line">   END listCustomer;</span><br><span class="line"></span><br><span class="line">END c_package;</span><br></pre></td></tr></table></figure></li>
<li>use<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   code customers.id%type:= 8;</span><br><span class="line">BEGIN</span><br><span class="line">   c_package.addcustomer(7, &#x27;Rajnish&#x27;, 25, &#x27;Chennai&#x27;, 3500);</span><br><span class="line">   c_package.addcustomer(8, &#x27;Subham&#x27;, 32, &#x27;Delhi&#x27;, 7500);</span><br><span class="line">   c_package.listcustomer;</span><br><span class="line">   c_package.delcustomer(code);</span><br><span class="line">   c_package.listcustomer;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h1><p>TODO</p>
<h1 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h1><ul>
<li>A transaction starts when one of the following events take place −<ul>
<li>The first SQL statement is performed after connecting to the database.</li>
<li>At each new SQL statement issued after a transaction is completed.</li>
</ul>
</li>
<li>A transaction ends when one of the following events take place −<ul>
<li>A COMMIT or a ROLLBACK statement is issued.</li>
<li>A DDL statement, such as CREATE TABLE statement, is issued; because in that case a COMMIT is automatically performed.</li>
<li>A DML statement fails; in that case a ROLLBACK is automatically performed for undoing that DML statement.</li>
<li>some others</li>
</ul>
</li>
<li><code>ROLLBACK [TO SAVEPOINT &lt; savepoint_name&gt;]; </code></li>
<li><code>SAVEPOINT &lt; savepoint_name &gt;;</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO CUSTOMERS (ID,NAME,AGE,ADDRESS,SALARY)</span><br><span class="line">VALUES (7, &#x27;Rajnish&#x27;, 27, &#x27;HP&#x27;, 9500.00 );</span><br><span class="line"></span><br><span class="line">INSERT INTO CUSTOMERS (ID,NAME,AGE,ADDRESS,SALARY)</span><br><span class="line">VALUES (8, &#x27;Riddhi&#x27;, 21, &#x27;WB&#x27;, 4500.00 );</span><br><span class="line">SAVEPOINT sav1;</span><br><span class="line"></span><br><span class="line">UPDATE CUSTOMERS</span><br><span class="line">SET SALARY = SALARY + 1000;</span><br><span class="line">ROLLBACK TO sav1;</span><br><span class="line"></span><br><span class="line">UPDATE CUSTOMERS</span><br><span class="line">SET SALARY = SALARY + 1000</span><br><span class="line">WHERE ID = 7;</span><br><span class="line">UPDATE CUSTOMERS</span><br><span class="line">SET SALARY = SALARY + 1000</span><br><span class="line">WHERE ID = 8;</span><br><span class="line"></span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure></li>
<li><code>SET AUTOCOMMIT ON;</code></li>
</ul>
<h1 id="OO"><a href="#OO" class="headerlink" title="OO"></a>OO</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE address AS OBJECT</span><br><span class="line">(house_no varchar2(10),</span><br><span class="line"> street varchar2(30),</span><br><span class="line"> city varchar2(20),</span><br><span class="line"> state varchar2(10),</span><br><span class="line"> pincode varchar2(10)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE customer AS OBJECT</span><br><span class="line">(code number(5),</span><br><span class="line"> name varchar2(30),</span><br><span class="line"> contact_no varchar2(12),</span><br><span class="line"> addr address,</span><br><span class="line"> member procedure display</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   residence address;</span><br><span class="line">BEGIN</span><br><span class="line">   residence := address(&#x27;103A&#x27;, &#x27;M.G.Road&#x27;, &#x27;Jaipur&#x27;, &#x27;Rajasthan&#x27;,&#x27;201301&#x27;);</span><br><span class="line">   dbms_output.put_line(&#x27;House No: &#x27;|| residence.house_no);</span><br><span class="line">   dbms_output.put_line(&#x27;Street: &#x27;|| residence.street);</span><br><span class="line">   dbms_output.put_line(&#x27;City: &#x27;|| residence.city);</span><br><span class="line">   dbms_output.put_line(&#x27;State: &#x27;|| residence.state);</span><br><span class="line">   dbms_output.put_line(&#x27;Pincode: &#x27;|| residence.pincode);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE rectangle AS OBJECT</span><br><span class="line">(length number,</span><br><span class="line"> width number,</span><br><span class="line"> member function enlarge( inc number) return rectangle,</span><br><span class="line"> member procedure display,</span><br><span class="line"> map member function measure return number</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE BODY rectangle AS</span><br><span class="line">   MEMBER FUNCTION enlarge(inc number) return rectangle IS</span><br><span class="line">   BEGIN</span><br><span class="line">      return rectangle(self.length + inc, self.width + inc);</span><br><span class="line">   END enlarge;  </span><br><span class="line">   MEMBER PROCEDURE display IS</span><br><span class="line">   BEGIN  </span><br><span class="line">      dbms_output.put_line(&#x27;Length: &#x27;|| length);</span><br><span class="line">      dbms_output.put_line(&#x27;Width: &#x27;|| width);</span><br><span class="line">   END display;  </span><br><span class="line">   MAP MEMBER FUNCTION measure return number IS</span><br><span class="line">   BEGIN</span><br><span class="line">      return (sqrt(length*length + width*width));</span><br><span class="line">   END measure;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   r1 rectangle;</span><br><span class="line">   r2 rectangle;</span><br><span class="line">   r3 rectangle;</span><br><span class="line">   inc_factor number := 5;</span><br><span class="line">BEGIN</span><br><span class="line">   r1 := rectangle(3, 4);</span><br><span class="line">   r2 := rectangle(5, 7);</span><br><span class="line">   r3 := r1.enlarge(inc_factor);</span><br><span class="line">   r3.display;  </span><br><span class="line">   IF (r1 &gt; r2) THEN -- calling measure function</span><br><span class="line">      r1.display;</span><br><span class="line">   ELSE</span><br><span class="line">      r2.display;</span><br><span class="line">   END IF;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE rectangle AS OBJECT</span><br><span class="line">(length number,</span><br><span class="line"> width number,</span><br><span class="line"> member procedure display,</span><br><span class="line"> order member function measure(r rectangle) return number</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE BODY rectangle AS</span><br><span class="line">   MEMBER PROCEDURE display IS</span><br><span class="line">   BEGIN</span><br><span class="line">      dbms_output.put_line(&#x27;Length: &#x27;|| length);</span><br><span class="line">      dbms_output.put_line(&#x27;Width: &#x27;|| width);</span><br><span class="line">   END display;  </span><br><span class="line">   ORDER MEMBER FUNCTION measure(r rectangle) return number IS</span><br><span class="line">   BEGIN</span><br><span class="line">      IF(sqrt(self.length*self.length + self.width*self.width)&gt;</span><br><span class="line">         sqrt(r.length*r.length + r.width*r.width)) then</span><br><span class="line">         return(1);</span><br><span class="line">      ELSE</span><br><span class="line">         return(-1);</span><br><span class="line">      END IF;</span><br><span class="line">   END measure;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   r1 rectangle;</span><br><span class="line">   r2 rectangle;</span><br><span class="line">BEGIN</span><br><span class="line">   r1 := rectangle(23, 44);</span><br><span class="line">   r2 := rectangle(15, 17);</span><br><span class="line">   r1.display;</span><br><span class="line">   r2.display;</span><br><span class="line">   IF (r1 &gt; r2) THEN -- calling measure function</span><br><span class="line">      r1.display;</span><br><span class="line">   ELSE</span><br><span class="line">      r2.display;</span><br><span class="line">   END IF;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE rectangle AS OBJECT</span><br><span class="line">(length number,</span><br><span class="line"> width number,</span><br><span class="line"> member function enlarge( inc number) return rectangle,</span><br><span class="line"> NOT FINAL member procedure display) NOT FINAL</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE BODY rectangle AS</span><br><span class="line">   MEMBER FUNCTION enlarge(inc number) return rectangle IS</span><br><span class="line">   BEGIN</span><br><span class="line">      return rectangle(self.length + inc, self.width + inc);</span><br><span class="line">   END enlarge;  </span><br><span class="line">   MEMBER PROCEDURE display IS</span><br><span class="line">   BEGIN</span><br><span class="line">      dbms_output.put_line(&#x27;Length: &#x27;|| length);</span><br><span class="line">      dbms_output.put_line(&#x27;Width: &#x27;|| width);</span><br><span class="line">   END display;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE tabletop UNDER rectangle</span><br><span class="line">(   </span><br><span class="line">   material varchar2(20),</span><br><span class="line">   OVERRIDING member procedure display</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE BODY tabletop AS</span><br><span class="line">OVERRIDING MEMBER PROCEDURE display IS</span><br><span class="line">BEGIN</span><br><span class="line">   dbms_output.put_line(&#x27;Length: &#x27;|| length);</span><br><span class="line">   dbms_output.put_line(&#x27;Width: &#x27;|| width);</span><br><span class="line">   dbms_output.put_line(&#x27;Material: &#x27;|| material);</span><br><span class="line">END display;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">   t1 tabletop;</span><br><span class="line">   t2 tabletop;</span><br><span class="line">BEGIN</span><br><span class="line">   t1:= tabletop(20, 10, &#x27;Wood&#x27;);</span><br><span class="line">   t2 := tabletop(50, 30, &#x27;Steel&#x27;);</span><br><span class="line">   t1.display;</span><br><span class="line">   t2.display;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE TYPE rectangle AS OBJECT</span><br><span class="line">(length number,</span><br><span class="line"> width number,</span><br><span class="line"> NOT INSTANTIABLE NOT FINAL MEMBER PROCEDURE display)  </span><br><span class="line"> NOT INSTANTIABLE NOT FINAL</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/12/13/Spring-V2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/13/Spring-V2/" class="post-title-link" itemprop="url">Spring V2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-12-13 12:58:36" itemprop="dateCreated datePublished" datetime="2022-12-13T12:58:36-05:00">2022-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-12-14 13:18:42" itemprop="dateModified" datetime="2022-12-14T13:18:42-05:00">2022-12-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="IoC-and-DI"><a href="#IoC-and-DI" class="headerlink" title="IoC and DI"></a>IoC and DI</h1><ul>
<li>inversion of control. developer control -&gt; framework control</li>
<li>dependency injection: how to implement IoC</li>
<li>Spring IoC container</li>
<li>bean: objects managed by Spring IoC container<h2 id="Bean-lifecycle"><a href="#Bean-lifecycle" class="headerlink" title="Bean lifecycle"></a>Bean lifecycle</h2></li>
<li>IoC container prepares to init</li>
<li>objects call constructors</li>
<li>inject fields into objects</li>
<li>object calls init-method, <code>@PreDestroy</code></li>
<li>IoC container finishes initiation</li>
<li>run business codes</li>
<li>IoC container prepare to be destroy, <code>@PostConstruct</code></li>
<li>object calls destroy-method</li>
<li>IoC container is destroyed<h2 id="Annotation"><a href="#Annotation" class="headerlink" title="Annotation"></a>Annotation</h2><h3 id="Configuration-Class"><a href="#Configuration-Class" class="headerlink" title="Configuration Class"></a>Configuration Class</h3></li>
<li><code>@Bean</code>: on method, returned object is bean, bean id is method name</li>
<li><code>@Configuration</code>: configuration class</li>
<li><code>@Scope</code><ul>
<li>singleton: default; constructed when IoC container starts, unless postpone construction by “lazy-init” until using<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@Scope(value = ConfigurableBeanFactory.SCOPE_SINGLETON)</span><br><span class="line">public Person personSingleton() &#123;</span><br><span class="line">    return new Person();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>prototype: constructed when getBean() or injected; not managed by IoC container, will not trigger destroy-method, will destory by GC;</li>
<li>request</li>
<li>session</li>
<li>application</li>
<li>websocket</li>
</ul>
</li>
<li><code>@Primary</code>: inject this object among objects of the same type, on <code>@Bean</code> or <code>@Component</code></li>
<li><code>@ComponentScan(basePackages=&quot;&quot;)</code></li>
</ul>
<h3 id="Injection"><a href="#Injection" class="headerlink" title="Injection"></a>Injection</h3><ul>
<li><p><code>@Resource</code>: by name first, then by class</p>
</li>
<li><p><code>@Autowired</code>: by class</p>
</li>
<li><p><code>@Inject</code>: by class, not support “required”</p>
</li>
<li><p><code>@Named</code>: by name</p>
</li>
<li><p><code>@Value($&#123;metaDate&#125;</code></p>
</li>
<li><p><code>@ConfigurationProperties(prefix = &quot;school&quot;)</code>: <a target="_blank" rel="noopener" href="https://www.baeldung.com/configuration-properties-in-spring-boot">https://www.baeldung.com/configuration-properties-in-spring-boot</a></p>
</li>
</ul>
<h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h3><ul>
<li><code>@Component</code>: on class</li>
<li><code>@RestController</code></li>
<li><code>@Service</code></li>
<li><code>@Repository</code></li>
<li><code>@Mapper</code>: MyBatis annotation, using it can get rid of <code>@MapperScan(basePackages = &quot;&quot;)</code></li>
</ul>
<h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><ul>
<li><code>@RequestMapping</code>: on class</li>
<li><code>@GetMapping</code>, etc</li>
<li><code>@PathVariable</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/api/employees/&#123;id&#125;/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getEmployeesByIdAndName</span><span class="params">(<span class="meta">@PathVariable</span> String id, <span class="meta">@PathVariable</span> String name)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ID: &quot;</span> + id + <span class="string">&quot;, name: &quot;</span> + name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// can also handle the optional path variables</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/api/employeeswithmapvariable/&#123;id&#125;/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getEmployeesByIdAndNameWithMapVariable</span><span class="params">(<span class="meta">@PathVariable</span> Map&lt;String, String&gt; pathVarsMap)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> pathVarsMap.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> pathVarsMap.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (id != <span class="literal">null</span> &amp;&amp; name != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ID: &quot;</span> + id + <span class="string">&quot;, name: &quot;</span> + name;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Missing Parameters&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &#123; &quot;/api/employeeswithrequiredfalse&quot;, &quot;/api/employeeswithrequiredfalse/&#123;id&#125;&quot; &#125;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getEmployeesByIdWithRequiredFalse</span><span class="params">(<span class="meta">@PathVariable(required = false)</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (id != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ID: &quot;</span> + id;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ID missing&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &#123; &quot;/api/employeeswithoptional&quot;, &quot;/api/employeeswithoptional/&#123;id&#125;&quot; &#125;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getEmployeesByIdWithOptional</span><span class="params">(<span class="meta">@PathVariable</span> Optional&lt;String&gt; id)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (id.isPresent()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ID: &quot;</span> + id.get();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ID missing&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>@RequestBody</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/request&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity <span class="title function_">postController</span><span class="params">(</span></span><br><span class="line"><span class="params">  <span class="meta">@RequestBody</span> LoginForm loginForm)</span> &#123;</span><br><span class="line"></span><br><span class="line">    exampleService.fakeAuthenticate(loginForm);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(HttpStatus.OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginForm</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -i \</span><br><span class="line">-H &quot;Accept: application/json&quot; \</span><br><span class="line">-H &quot;Content-Type:application/json&quot; \</span><br><span class="line">-X POST --data</span><br><span class="line">  &#x27;&#123;&quot;username&quot;: &quot;johnny&quot;, &quot;password&quot;: &quot;password&quot;&#125;&#x27; &quot;https://localhost:8080/.../request&quot;</span><br></pre></td></tr></table></figure></li>
<li><code>@RequestParam</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/api/foos&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">addFoo</span><span class="params">(<span class="meta">@RequestParam(name = &quot;id&quot;)</span> String fooId, <span class="meta">@RequestParam</span> String name)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ID: &quot;</span> + fooId + <span class="string">&quot; Name: &quot;</span> + name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/api/foos?id=1&amp;name=somename</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/api/foos&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getFoos</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ID: &quot;</span> + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/api/foos&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getFoos</span><span class="params">(<span class="meta">@RequestParam</span> Optional&lt;String&gt; id)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ID: &quot;</span> + id.orElseGet(() -&gt; <span class="string">&quot;not provided&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/api/foos&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getFoos</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;test&quot;)</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ID: &quot;</span> + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/api/foos&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">updateFoos</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String,String&gt; params)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Parameters are &quot;</span> + params.entrySet();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/api/foos&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getFoos</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;String&gt; id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;IDs are &quot;</span> + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/spring-mvc-basics/api/foos?id=1,2,3</span><br><span class="line">----</span><br><span class="line">IDs are [1,2,3]</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/spring-mvc-basics/api/foos?id=1&amp;id=2</span><br><span class="line">----</span><br><span class="line">IDs are [1,2]</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h3><ul>
<li><code>@EnableCaching</code>: on configuration class</li>
<li><code>@Cacheable</code></li>
<li><code>@CacheEvict</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value = &quot;::user&quot;, key=&quot;&#123;#userId&#125;&quot;, cacheManager = &quot;cacheManager1Hour&quot;)</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectByPrimaryKey(userId);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CacheEvict(value = &quot;::user&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUserFromCache</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line">    <span class="comment">// Intentionally blank</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><code>@CachePut</code>: <code>@Cacheable</code> will skip running the method, whereas <code>@CachePut</code> will actually run the method and then put its results in the cache<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CachePut(value=&quot;addresses&quot;, condition=&quot;#customer.name==&#x27;Tom&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">(Customer customer)</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CachePut(value=&quot;addresses&quot;, unless=&quot;#result.length()&lt;64&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">(Customer customer)</span> &#123;...&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>@CacheConfig</code>: on the class level to avoid declaring many times<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@CacheConfig(cacheNames=&#123;&quot;addresses&quot;&#125;)</span><br><span class="line">public class CustomerDataService &#123;</span><br><span class="line"></span><br><span class="line">@Cacheable</span><br><span class="line">public String getAddress(Customer customer) &#123;...&#125;</span><br></pre></td></tr></table></figure>
Reference: <a target="_blank" rel="noopener" href="https://www.baeldung.com/spring-cache-tutorial">https://www.baeldung.com/spring-cache-tutorial</a></li>
</ul>
<h3 id="Schedule"><a href="#Schedule" class="headerlink" title="Schedule"></a>Schedule</h3><ul>
<li><code>@Scheduled(fixedDelay=5000)</code>: <a target="_blank" rel="noopener" href="https://www.baeldung.com/spring-scheduled-tasks">https://www.baeldung.com/spring-scheduled-tasks</a></li>
</ul>
<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><ul>
<li>XML</li>
<li>class</li>
<li>annotation</li>
</ul>
<h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><ul>
<li>aspect: a class that cuts across many classes, <code>@Aspect</code></li>
<li>join point: a point during the execution of a program<ul>
<li><code>JoinPoint</code></li>
<li><code>ProceedingJoinPoint</code>: besides functionality of <code>JoinPoint</code>, can control whether the target method is executed or not</li>
</ul>
</li>
<li>advice: action<ul>
<li>before</li>
<li>after returning</li>
<li>after throwing</li>
<li>after: after normal or exceptional return</li>
<li>around<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ll.spring.aop.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodChecker</span> &#123;</span><br><span class="line">    <span class="comment">// AspectJ ProceedingJoinPoint is extension of JoinPoint</span></span><br><span class="line">    <span class="comment">// proceed(): executes target method</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">check</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>().getTime();</span><br><span class="line">            <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">            <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>().getTime();</span><br><span class="line">            <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> endTime - startTime;</span><br><span class="line">            <span class="keyword">if</span> (duration &gt;= <span class="number">1000</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> pjp.getTarget().getClass().getName();</span><br><span class="line">                <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> pjp.getSignature().getName();</span><br><span class="line">                <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss SSS&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">now</span> <span class="operator">=</span> sdf.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">                System.out.println(<span class="string">&quot;=======&quot;</span> + now + <span class="string">&quot;:&quot;</span> + className + <span class="string">&quot;.&quot;</span> + methodName + <span class="string">&quot;(&quot;</span> + duration + <span class="string">&quot;ms)======&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Exception message:&quot;</span> + throwable.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> throwable;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>pointcut: a predicate that matches join points to run advice<ul>
<li><code>*</code></li>
<li><code>..</code>: package wildcard</li>
<li><code>(..)</code>: parameter wildcard<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">execution(public * com.ll..*.*(..)) // all methods of all classes in package com.ll</span><br><span class="line">execution(* com.ll..*Service.*(..)) // only to services</span><br><span class="line">execution(String com.ll..*Service.*(..)) // only to methods returning String</span><br><span class="line">execution(* com.ll..*Service.create*(..)) // method name</span><br><span class="line">execution(* com.ll..*Service.*(String,*)) // parameter</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>target object: object being advised by aspects<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2></li>
<li>if target class implements interface, use JDK dynamic proxy, otherwise use CGLIB</li>
<li>Spring AOP uses AspectJ Weaver to do pointcut match</li>
</ul>
<h1 id="Declarative-transactions"><a href="#Declarative-transactions" class="headerlink" title="Declarative transactions"></a>Declarative transactions</h1><ul>
<li>uses TransactionManager</li>
<li>is AOP around advice in nature<h2 id="Propagation"><a href="#Propagation" class="headerlink" title="Propagation"></a>Propagation</h2></li>
<li>PROPAGATION_REQUIRED: default. If current transaction exist, join, otherwise create a new transaction for itself<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMain</span><span class="params">()</span>&#123;</span><br><span class="line">    save(a1);</span><br><span class="line">    testB();    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testB</span><span class="params">()</span>&#123;</span><br><span class="line">    save(b1);  </span><br><span class="line">    <span class="keyword">throw</span> Exception;     </span><br><span class="line">    save(b2);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// testMain and testB are rollback. No data is saved.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMain</span><span class="params">()</span>&#123;</span><br><span class="line">    save(a1);  </span><br><span class="line">    testB();    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testB</span><span class="params">()</span>&#123;</span><br><span class="line">    save(b1);  </span><br><span class="line">    <span class="keyword">throw</span> Exception;    </span><br><span class="line">    save(b2);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// testB creates a new transaction and will roll back. testMain does not have a transaction.</span></span><br><span class="line"><span class="comment">// a1 is saved into DB. b1 and b2 are not saved into DB.</span></span><br></pre></td></tr></table></figure></li>
<li>PROPAGATION_SUPPORTS: If current transaction exist, join, otherwise execute without transaction<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMain</span><span class="params">()</span>&#123;</span><br><span class="line">    save(a1);  </span><br><span class="line">    testB();    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.SUPPORTS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testB</span><span class="params">()</span>&#123;</span><br><span class="line">    save(b1);</span><br><span class="line">    <span class="keyword">throw</span> Exception;     </span><br><span class="line">    save(b2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a1 and b1 are saved to DB. b2 is not.</span></span><br><span class="line"><span class="comment">// if testMain is required, no data is saved.</span></span><br></pre></td></tr></table></figure></li>
<li>PROPAGATION_MANDATORY: If current transaction exist, join, otherwise throw an exception<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMain</span><span class="params">()</span>&#123;</span><br><span class="line">    save(a1);  </span><br><span class="line">    testB();    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.MANDATORY)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testB</span><span class="params">()</span>&#123;</span><br><span class="line">    save(b1);  </span><br><span class="line">    <span class="keyword">throw</span> Exception;</span><br><span class="line">    save(b2);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a1 is saved to DB. b1 and b2 are not, because testB is not executed</span></span><br><span class="line"><span class="comment">// if testMain is required, no data is saved.</span></span><br></pre></td></tr></table></figure></li>
<li>PROPAGATION_REQUIRES_NEW: Create a new transaction. If current transaction exist, suspend the current transaction.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMain</span><span class="params">()</span>&#123;</span><br><span class="line">    save(a1);  </span><br><span class="line">    testB();    </span><br><span class="line">    <span class="keyword">throw</span> Exception;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testB</span><span class="params">()</span>&#123;</span><br><span class="line">    save(b1);  </span><br><span class="line">    save(b2);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a1 is not saved. b1 and b2 are saved.</span></span><br><span class="line"><span class="comment">// if testB is required, no data is saved.</span></span><br></pre></td></tr></table></figure></li>
<li>PROPAGATION_NOT_SUPPORTED: Execute without transaction. If current transaction exist, suspend the current transaction.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMain</span><span class="params">()</span>&#123;</span><br><span class="line">    save(a1);  </span><br><span class="line">    testB();    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.NOT_SUPPORTED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testB</span><span class="params">()</span>&#123;</span><br><span class="line">    save(b1);  </span><br><span class="line">    <span class="keyword">throw</span> Exception;     </span><br><span class="line">    save(b2);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a1 and b2 are not saved. b1 is saved. testB throws an exception, which causes testMain to roll back.</span></span><br></pre></td></tr></table></figure></li>
<li>PROPAGATION_NEVER: Execute non-transactionally, throw an exception if a transaction exists.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMain</span><span class="params">()</span>&#123;</span><br><span class="line">    A(a1);  <span class="comment">//调用A入参a1</span></span><br><span class="line">    testB();    <span class="comment">//调用testB</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.NEVER)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testB</span><span class="params">()</span>&#123;</span><br><span class="line">    B(b1);  <span class="comment">//调用B入参b1</span></span><br><span class="line">    B(b2);  <span class="comment">//调用B入参b2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// no data is saved, because an exception is thrown due to &quot;NEVER&quot; and testB will not be executed</span></span><br></pre></td></tr></table></figure></li>
<li>PROPAGATION_NESTED: If current transaction exists, nest a transaction, otherwise create a new transaction for itself. If parent transaction rolls back, the child transaction also rolls back.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMain</span><span class="params">()</span>&#123;</span><br><span class="line">    save(a1);  </span><br><span class="line">    testB();    </span><br><span class="line">    <span class="keyword">throw</span> Exception;     </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.NESTED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testB</span><span class="params">()</span>&#123;</span><br><span class="line">    save(b1);  </span><br><span class="line">    save(b2);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// no data is not saved.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMain</span><span class="params">()</span>&#123;</span><br><span class="line">    save(a1);  </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      testB();    </span><br><span class="line">    &#125; <span class="keyword">catch</span>（Exception e)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    save(a2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.NESTED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testB</span><span class="params">()</span>&#123;</span><br><span class="line">    save(b1);</span><br><span class="line">    <span class="keyword">throw</span> Exception;   </span><br><span class="line">    save(b2);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a1 and a2 are saved. b1 and b2 are not. testMain catches, so only testB rolls back.</span></span><br><span class="line"><span class="comment">// if testB is REQUIRED, no data is saved even if testMain catches.</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Spring-MVC-HandlerInterceptor"><a href="#Spring-MVC-HandlerInterceptor" class="headerlink" title="Spring MVC HandlerInterceptor"></a>Spring MVC HandlerInterceptor</h1><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/fly910905/article/details/86537648">https://blog.csdn.net/fly910905/article/details/86537648</a></li>
<li>servlet filter -&gt; interceptor -&gt; controller advice -&gt; aspect -&gt; controller<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ll.demo.restful.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccessHistoryInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(AccessHistoryInterceptor.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">log</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        log.append(request.getRemoteAddr());</span><br><span class="line">        log.append(<span class="string">&quot;|&quot;</span>);</span><br><span class="line">        log.append(request.getRequestURL());</span><br><span class="line">        log.append(<span class="string">&quot;|&quot;</span>);</span><br><span class="line">        log.append(request.getHeader(<span class="string">&quot;user-agent&quot;</span>));</span><br><span class="line">        logger.info(log.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// request can pass</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>handler is either an inceptor or a controller</li>
<li>prehandle() – called before the execution of the actual handler</li>
<li>postHandle() – called after the handler is executed</li>
<li>afterCompletion() – called after the complete request is finished and the view is generated</li>
<li>process<br><img src="/../image/spring-mvc/1.png" alt="Spring MVC Process"></li>
</ul>
<h1 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h1><p>TODO</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/12/08/Multi-Thread-Summry/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/08/Multi-Thread-Summry/" class="post-title-link" itemprop="url">Multi-Thread Summary</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-12-08 17:25:15" itemprop="dateCreated datePublished" datetime="2022-12-08T17:25:15-05:00">2022-12-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-12-10 20:00:39" itemprop="dateModified" datetime="2022-12-10T20:00:39-05:00">2022-12-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-fundamental/" itemprop="url" rel="index"><span itemprop="name">Java fundamental</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h1><ul>
<li>every thread has its own method-call stack. Calculate parameters first, push parameters to method-call stack, and then execute method body<br><img src="/../image/multi-thread/CPU_cache.webp" alt="CPU cache"></li>
</ul>
<h1 id="Frequently-Used-Methods"><a href="#Frequently-Used-Methods" class="headerlink" title="Frequently-Used Methods"></a>Frequently-Used Methods</h1><h2 id="Runnable"><a href="#Runnable" class="headerlink" title="Runnable"></a>Runnable</h2><ul>
<li>void run()<h2 id="Thread-implements-Runnable"><a href="#Thread-implements-Runnable" class="headerlink" title="Thread implements Runnable"></a>Thread implements Runnable</h2></li>
<li>constructors<ul>
<li>Thread()</li>
<li>Thread(Runnable target)</li>
<li>Thread(Runnable target, String name)</li>
<li>Thread(String name)</li>
</ul>
</li>
<li>void start()  </li>
<li>void run()<ul>
<li><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/difference-between-thread-start-and-thread-run-in-java/#:~:text=Multiple%20invocation%3A%20In%20Java&#39;s%20multi,just%20a%20normal%20method%20calling">https://www.geeksforgeeks.org/difference-between-thread-start-and-thread-run-in-java/#:~:text=Multiple%20invocation%3A%20In%20Java&#39;s%20multi,just%20a%20normal%20method%20calling</a>.</li>
</ul>
</li>
<li>void join(), void join(milliseconds)</li>
<li>static void sleep(long millis)</li>
<li>static void yield()<ul>
<li>A hint to the scheduler that the current thread is willing to yield its current use of a processor.</li>
</ul>
</li>
<li>void interrupt()<ul>
<li><code>threadToBeInterrupted.interrupt()</code></li>
<li>t.interrupt() will set interrupt status be to true.</li>
<li>after being interrupted, usually the thread will throw InterruptedException. Need to determine how to handle that. Throwing InterruptedException will set interrupt status to be false, so we may need to add <code>t.interrupt();</code> in catch block to reset it to be true.<h3 id="Communication"><a href="#Communication" class="headerlink" title="Communication"></a>Communication</h3></li>
</ul>
</li>
<li>wait(), notify(), notifyAll() need to be inside <code>synchronized</code></li>
<li>wait() will release lock</li>
<li>notify() will notify randomly</li>
<li>Sometimes need to use notifyAll() instead of notify(), otherwise the thread needs to be notified may not be notify<h2 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import java.util.concurrent.Callable;</span><br><span class="line">public class ThirdThread implements Callable&lt;String&gt; &#123;</span><br><span class="line">  @override</span><br><span class="line">  public String call() throws Exception &#123;</span><br><span class="line">    String str = &quot;the third way to create a thread&quot;;</span><br><span class="line">    return str;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ThirdThreadTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    Callable&lt;String&gt; call = new ThirdThread();</span><br><span class="line">    FutureTask&lt;String&gt; ft = new FutureTask&lt;&gt;(call);</span><br><span class="line">    Thread thread = new Thread(ft);</span><br><span class="line"></span><br><span class="line">    thread.start();</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      System.out.println(ft.get()); // get the result after the thread finishes, i.e. &quot;the third way to create a thread&quot;</span><br><span class="line">    &#125; catch (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Life-Cycle"><a href="#Life-Cycle" class="headerlink" title="Life Cycle"></a>Life Cycle</h1><ul>
<li>New</li>
<li>start() -&gt; Runnable</li>
<li>Running<ul>
<li>uses CPU</li>
<li>will turn into Runnable if time share is used up or yield()</li>
<li>will turn into Blocked if calls <code>child.join()</code> or <code>child.join(milliseconds)</code>, wait(), <code>t.sleep(milliseconds)</code>, sends I&#x2F;O request</li>
</ul>
</li>
<li>Blocked</li>
<li>Terminated: after run() finishes or throws an error</li>
</ul>
<h1 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h1><ul>
<li>When to use<ul>
<li>each thread needs an object<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class ThreadSafeFormatter &#123;</span><br><span class="line">  // the initial value will be set at the first time get() is called  </span><br><span class="line">  public static ThreadLocal&lt;SimpleDateFormat&gt; dateFormatter</span><br><span class="line">    = ThreadLocal.withInitial(() -&gt; new SimpleDateFormat(&quot;HH:mm:ss&quot;));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>each thread wants to use global variable without the hassle of passing paramters<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">class UserContextHolder &#123;</span><br><span class="line"></span><br><span class="line">    public static ThreadLocal&lt;User&gt; holder = new ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Service1 &#123;</span><br><span class="line"></span><br><span class="line">  public void process(String name) &#123;</span><br><span class="line">      User user = new User(&quot;Liam&quot;);</span><br><span class="line">      UserContextHolder.holder.set(user);</span><br><span class="line">      new Service2().process();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Service2 &#123;</span><br><span class="line"></span><br><span class="line">    public void process() &#123;</span><br><span class="line">        User user = UserContextHolder.holder.get();</span><br><span class="line">        ThreadSafeFormatter.dateFormatThreadLocal.get();</span><br><span class="line">        System.out.println(&quot;Service2 has gotten: &quot; + user.name);</span><br><span class="line">        new Service3().process();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Service3 &#123;</span><br><span class="line"></span><br><span class="line">    public void process() &#123;</span><br><span class="line">        User user = UserContextHolder.holder.get();</span><br><span class="line">        System.out.println(&quot;Service3 has gotten: &quot; + user.name);</span><br><span class="line">        UserContextHolder.holder.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>prevent OOM<ul>
<li>after finishing using ThreadLocal, call <code>void remove()</code></li>
</ul>
</li>
</ul>
<h1 id="Safety"><a href="#Safety" class="headerlink" title="Safety"></a>Safety</h1><ul>
<li>need to consider when we will have<ul>
<li>will change the global variable</li>
<li>or there is “escaping”:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">final int x;</span><br><span class="line">  // Wrong contructor</span><br><span class="line">  public FinalFieldExample() &#123;</span><br><span class="line">    x = 3;</span><br><span class="line">    y = 4;</span><br><span class="line">    // &quot;escaping&quot;. if the thread reads x through global.obj, it may get 0</span><br><span class="line">    global.obj = this;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>reason: race condition: result depends on timing of execution of threads</li>
<li>visibility: happens-before<ul>
<li>order within same thread</li>
<li>writing volatile (read in and write to memory rather than CPU cache)</li>
<li>A happens-before B and B happens-before C, then A happens-before C</li>
<li>For the same lock, locking happends-before unlocking. To make addOne() visible to get():<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class SafeCalc &#123;</span><br><span class="line">  long value = 0L;</span><br><span class="line">  synchronized long get() &#123; return value; &#125;</span><br><span class="line">  synchronized void addOne() &#123; value += 1; &#125;&#125;</span><br></pre></td></tr></table></figure></li>
<li>a thread changes variable within critical area</li>
<li>child thread can see operation results of parent thread before the child thread is started by start()</li>
<li>parent thread calls join(), after child thread finishes, parent thread can see operation results of child thread<h1 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private final Object</span><br><span class="line">  lock = new Object();</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>synchronized</code> will writing thread id into lock object head</li>
<li>lock should be unchangable and should not be reused (e.g. Integer, String, Boolean will be reused). Ratio of resources to lock should be N : 1.</li>
</ul>
<h2 id="Dead-Lock"><a href="#Dead-Lock" class="headerlink" title="Dead Lock"></a>Dead Lock</h2><ul>
<li>when: occupy and wait, cannot deprive, wait loop</li>
<li>solution<ul>
<li>release resources being occupied if the thread cannot get other resources needed</li>
<li>avoid wait loop. For example, when acquiring resources, start from the resource with smaller id<h2 id="Live-Lock"><a href="#Live-Lock" class="headerlink" title="Live Lock"></a>Live Lock</h2></li>
</ul>
</li>
<li>when: “give way” example</li>
<li>solution: random</li>
</ul>
<h1 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h1><ul>
<li>No lock or do not lock for too long</li>
</ul>
<h1 id="JUC"><a href="#JUC" class="headerlink" title="JUC"></a>JUC</h1><h2 id="ThreadPool"><a href="#ThreadPool" class="headerlink" title="ThreadPool"></a>ThreadPool</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor(</span><br><span class="line">  int corePoolSize,</span><br><span class="line">  int maximumPoolSize,</span><br><span class="line">  long keepAliveTime,</span><br><span class="line">  TimeUnit unit,</span><br><span class="line">  BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="line">  ThreadFactory threadFactory,</span><br><span class="line">  RejectedExecutionHandler handler)</span><br></pre></td></tr></table></figure>
<p>some handers:</p>
<ul>
<li>CallerRunsPolicy</li>
<li>AbortPolicy: default, throws RejectedExecutionException</li>
<li>DiscardPolicy</li>
<li>DiscardOldestPolicy</li>
<li>can custom handler<br>allowCoreThreadTimeOut(boolean value)<br>unbounded LinkedBlockingQueue may cause OOM, should use bounded:<br><code>BlockingQueue workQueue = new LinkedBlockingQueue&lt;&gt;(2);</code></li>
</ul>
<ul>
<li>need to catch exception thrown by execute()</li>
<li>How many threads<ul>
<li>CPU-intensive: CPU cores + 1</li>
<li>I&#x2F;O-intensive: CPU cores * [ 1 +（I&#x2F;O time &#x2F; CPU time）], need stress test. Initial value could be 2 * cores + 1 (<a target="_blank" rel="noopener" href="https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing">https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing</a>)</li>
</ul>
</li>
<li>give the thread a meaningful name</li>
</ul>
<h2 id="CompletionService"><a href="#CompletionService" class="headerlink" title="CompletionService"></a>CompletionService</h2><ul>
<li>adding finished task to a blocking queue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ExecutorCompletionService(Executor executor) // using unbounded LinkedBlockingQueue</span><br><span class="line">ExecutorCompletionService(Executor executor, BlockingQueue&gt; completionQueue)</span><br><span class="line"></span><br><span class="line">Future&lt;V&gt; submit(Callable&lt;V&gt; task);</span><br><span class="line">Future&lt;V&gt; submit(Runnable task, V result);</span><br><span class="line">Future&lt;V&gt; take() throws InterruptedException;</span><br><span class="line">Future&lt;V&gt; poll();</span><br><span class="line">Future&lt;V&gt; poll(long timeout, TimeUnit unit) throws InterruptedException;</span><br></pre></td></tr></table></figure>
<h2 id="Atomic"><a href="#Atomic" class="headerlink" title="Atomic"></a>Atomic</h2></li>
<li>when: if only one shared variable<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Test &#123;</span><br><span class="line">  AtomicLong count =</span><br><span class="line">    new AtomicLong(0);</span><br><span class="line">  void add10K() &#123;</span><br><span class="line">    int idx = 0;</span><br><span class="line">    while(idx++ &lt; 10000) &#123;</span><br><span class="line">      count.getAndIncrement();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>primitive<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">getAndIncrement()</span><br><span class="line">getAndDecrement()</span><br><span class="line">incrementAndGet()</span><br><span class="line">decrementAndGet()</span><br><span class="line"></span><br><span class="line">getAndAdd(delta)</span><br><span class="line"></span><br><span class="line">addAndGet(delta)</span><br><span class="line">compareAndSet(expect, update)</span><br><span class="line"></span><br><span class="line">// new value can be calcuated by func</span><br><span class="line">getAndUpdate(func)</span><br><span class="line">updateAndGet(func)</span><br><span class="line">getAndAccumulate(x,func)</span><br><span class="line">accumulateAndGet(x,func)</span><br></pre></td></tr></table></figure></li>
<li>ABA issue</li>
<li>AtomicReference, AtomicStampedReference, AtomicMarkableReference<ul>
<li><code>AtomicStampedReference&lt;T&gt;(value, stamp)</code></li>
</ul>
</li>
<li>AtomicIntegerArray, AtomicLongArray, AtomicReferenceArray</li>
<li>AtomicIntegerFieldUpdater, AtomicLongFieldUpdater, AtomicReferenceFieldUpdater</li>
<li>DoubleAccumulator, DoubleAdder, LongAccumulator, LongAdder</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/12/07/Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/07/Docker/" class="post-title-link" itemprop="url">Docker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-12-07 13:36:45" itemprop="dateCreated datePublished" datetime="2022-12-07T13:36:45-05:00">2022-12-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-12-08 12:43:59" itemprop="dateModified" datetime="2022-12-08T12:43:59-05:00">2022-12-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker pull ubuntu:18.04</span><br><span class="line">docker run -it ubuntu:18.04 sh</span><br><span class="line"></span><br><span class="line"># commands below will be executed in the container</span><br><span class="line">cat /etc/os-release</span><br><span class="line">apt update</span><br><span class="line">apt install -y wget redis</span><br><span class="line">redis-server &amp;</span><br></pre></td></tr></table></figure>
<p><code>docker pull</code> to pull images from remote registry<br><code>docker images</code> to list local images<br><code>docker rmi</code> to remove local images<br><code>-d</code><br><code>-it</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/12/06/Redis-Basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/06/Redis-Basic/" class="post-title-link" itemprop="url">Redis Basic</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-12-06 16:28:35 / Modified: 20:39:26" itemprop="dateCreated datePublished" datetime="2022-12-06T16:28:35-05:00">2022-12-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><ul>
<li>One thread, I&#x2F;O multiplexing<h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1></li>
<li>GETSET command sets a key to a new value, returning the old value as the result</li>
<li>Set value if key not exist</li>
<li>Set value if key exists<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; set mykey newval nx</span><br><span class="line">(nil)</span><br><span class="line">&gt; set mykey newval xx</span><br><span class="line">OK</span><br></pre></td></tr></table></figure></li>
<li>Set value with expiration<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; set key 100 ex 10</span><br><span class="line">OK</span><br><span class="line">&gt; ttl key</span><br><span class="line">(integer) 9</span><br></pre></td></tr></table></figure></li>
<li>mset<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; mset a 10 b 20 c 30</span><br><span class="line">OK</span><br><span class="line">&gt; mget a b c</span><br><span class="line">1) &quot;10&quot;</span><br><span class="line">2) &quot;20&quot;</span><br><span class="line">3) &quot;30&quot;</span><br></pre></td></tr></table></figure></li>
<li>atomic: That even multiple clients issuing INCR against the same key will never enter into a race condition</li>
</ul>
<ul>
<li>incr</li>
<li>incrby</li>
<li>decr</li>
<li>decrby<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; set counter 100</span><br><span class="line">OK</span><br><span class="line">&gt; incr counter</span><br><span class="line">(integer) 101</span><br><span class="line">&gt; incr counter</span><br><span class="line">(integer) 102</span><br><span class="line">&gt; incrby counter 50</span><br><span class="line">(integer) 152</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>exists</li>
<li>del</li>
<li>type<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; exists mykey</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; del mykey</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; type mykey</span><br><span class="line">string</span><br><span class="line">&gt; del mykey</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; type mykey</span><br><span class="line">none</span><br></pre></td></tr></table></figure></li>
<li>expire in 5 seconds<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; expire key 5</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
Note: In order to set and check expires in milliseconds, check the PEXPIRE and the PTTL commands, and the full list of SET options.<h1 id="List"><a href="#List" class="headerlink" title="List"></a>List</h1></li>
<li>Redis lists are implemented via Linked Lists<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; rpush mylist A</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; rpush mylist B</span><br><span class="line">(integer) 2</span><br><span class="line">&gt; lpush mylist first</span><br><span class="line">(integer) 3</span><br><span class="line">&gt; lrange mylist 0 -1</span><br><span class="line">1) &quot;first&quot;</span><br><span class="line">2) &quot;A&quot;</span><br><span class="line">3) &quot;B&quot;</span><br></pre></td></tr></table></figure></li>
<li>lrange is for display<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; rpush mylist 1 2 3 4 5 &quot;foo bar&quot;</span><br><span class="line">(integer) 9</span><br><span class="line">&gt; lrange mylist 0 -1</span><br><span class="line">1) &quot;first&quot;</span><br><span class="line">2) &quot;A&quot;</span><br><span class="line">3) &quot;B&quot;</span><br><span class="line">4) &quot;1&quot;</span><br><span class="line">5) &quot;2&quot;</span><br><span class="line">6) &quot;3&quot;</span><br><span class="line">7) &quot;4&quot;</span><br><span class="line">8) &quot;5&quot;</span><br><span class="line">9) &quot;foo bar&quot;</span><br></pre></td></tr></table></figure></li>
<li>ltrim will change the list<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; rpush mylist 1 2 3 4 5</span><br><span class="line">(integer) 5</span><br><span class="line">&gt; ltrim mylist 0 2</span><br><span class="line">OK</span><br><span class="line">&gt; lrange mylist 0 -1</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br></pre></td></tr></table></figure></li>
<li>blpop and brpop will block if the list is empty<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; brpop tasks 5</span><br><span class="line">1) &quot;tasks&quot;</span><br><span class="line">2) &quot;do_something&quot;</span><br></pre></td></tr></table></figure>
“wait for elements in the list tasks, but return NULL if after 5 seconds no element is available”. 0 means waiting forever</li>
</ul>
<ul>
<li>the first client that blocked waiting for a list, is served first when an element is pushed by some other client, and so forth.</li>
</ul>
<ul>
<li>BLMOVE</li>
<li>Automatic creation and removal of keys</li>
</ul>
<ol>
<li>When we add an element to an aggregate data type, if the target key does not exist, an empty aggregate data type is created before adding the element.</li>
<li>When we remove elements from an aggregate data type, if the value remains empty, the key is automatically destroyed. The Stream data type is the only exception to this rule.</li>
<li>Calling a read-only command such as LLEN (which returns the length of the list), or a write command removing elements, with an empty key, always produces the same result as if the key is holding an empty aggregate type of the type the command expects to find.</li>
</ol>
<h1 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; hset user:1000 username antirez birthyear 1977 verified 1</span><br><span class="line">(integer) 3</span><br><span class="line">&gt; hget user:1000 username</span><br><span class="line">&quot;antirez&quot;</span><br><span class="line">&gt; hget user:1000 birthyear</span><br><span class="line">&quot;1977&quot;</span><br><span class="line">&gt; hgetall user:1000</span><br><span class="line">1) &quot;username&quot;</span><br><span class="line">2) &quot;antirez&quot;</span><br><span class="line">3) &quot;birthyear&quot;</span><br><span class="line">4) &quot;1977&quot;</span><br><span class="line">5) &quot;verified&quot;</span><br><span class="line">6) &quot;1&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; hmget user:1000 username birthyear no-such-field</span><br><span class="line">1) &quot;antirez&quot;</span><br><span class="line">2) &quot;1977&quot;</span><br><span class="line">3) (nil)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; hincrby user:1000 birthyear 10</span><br><span class="line">(integer) 1987</span><br><span class="line">&gt; hincrby user:1000 birthyear 10</span><br><span class="line">(integer) 1997</span><br></pre></td></tr></table></figure>
<h1 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; sadd myset 1 2 3</span><br><span class="line">(integer) 3</span><br><span class="line">&gt; smembers myset</span><br><span class="line">1. 3</span><br><span class="line">2. 1</span><br><span class="line">3. 2</span><br><span class="line">&gt; sismember myset 3</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; sismember myset 30</span><br><span class="line">(integer) 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>intersection between different sets<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sinter tag:1:news tag:2:news tag:10:news tag:27:news</span><br></pre></td></tr></table></figure></li>
<li>SPOP command removes a random element, returning it to the client</li>
<li>SRANDMEMBER will return a random element without removing it</li>
<li>Number of elements<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; scard game:1:deck</span><br><span class="line">(integer) 47</span><br></pre></td></tr></table></figure>
<h1 id="Sorted-sets"><a href="#Sorted-sets" class="headerlink" title="Sorted sets"></a>Sorted sets</h1></li>
<li>zadd key score value<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; zadd hackers 1940 &quot;Alan Kay&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1957 &quot;Sophie Wilson&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1953 &quot;Richard Stallman&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1949 &quot;Anita Borg&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1965 &quot;Yukihiro Matsumoto&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1914 &quot;Hedy Lamarr&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1916 &quot;Claude Shannon&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1969 &quot;Linus Torvalds&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1912 &quot;Alan Turing&quot;</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>If B and A are two elements with a different score, then A &gt; B if A.score is &gt; B.score.</li>
<li>If B and A have exactly the same score, then A &gt; B if the A string is lexicographically greater than the B string. B and A strings can’t be equal since sorted sets only have unique elements.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrange hackers 0 -1</span><br><span class="line">1) &quot;Alan Turing&quot;</span><br><span class="line">2) &quot;Hedy Lamarr&quot;</span><br><span class="line">3) &quot;Claude Shannon&quot;</span><br><span class="line">4) &quot;Alan Kay&quot;</span><br><span class="line">5) &quot;Anita Borg&quot;</span><br><span class="line">6) &quot;Richard Stallman&quot;</span><br><span class="line">7) &quot;Sophie Wilson&quot;</span><br><span class="line">8) &quot;Yukihiro Matsumoto&quot;</span><br><span class="line">9) &quot;Linus Torvalds&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrevrange hackers 0 -1</span><br><span class="line">1) &quot;Linus Torvalds&quot;</span><br><span class="line">2) &quot;Yukihiro Matsumoto&quot;</span><br><span class="line">3) &quot;Sophie Wilson&quot;</span><br><span class="line">4) &quot;Richard Stallman&quot;</span><br><span class="line">5) &quot;Anita Borg&quot;</span><br><span class="line">6) &quot;Alan Kay&quot;</span><br><span class="line">7) &quot;Claude Shannon&quot;</span><br><span class="line">8) &quot;Hedy Lamarr&quot;</span><br><span class="line">9) &quot;Alan Turing&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrange hackers 0 -1 withscores</span><br><span class="line">1) &quot;Alan Turing&quot;</span><br><span class="line">2) &quot;1912&quot;</span><br><span class="line">3) &quot;Hedy Lamarr&quot;</span><br><span class="line">4) &quot;1914&quot;</span><br><span class="line">5) &quot;Claude Shannon&quot;</span><br><span class="line">6) &quot;1916&quot;</span><br><span class="line">7) &quot;Alan Kay&quot;</span><br><span class="line">8) &quot;1940&quot;</span><br><span class="line">9) &quot;Anita Borg&quot;</span><br><span class="line">10) &quot;1949&quot;</span><br><span class="line">11) &quot;Richard Stallman&quot;</span><br><span class="line">12) &quot;1953&quot;</span><br><span class="line">13) &quot;Sophie Wilson&quot;</span><br><span class="line">14) &quot;1957&quot;</span><br><span class="line">15) &quot;Yukihiro Matsumoto&quot;</span><br><span class="line">16) &quot;1965&quot;</span><br><span class="line">17) &quot;Linus Torvalds&quot;</span><br><span class="line">18) &quot;1969&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrangebyscore hackers -inf 1950</span><br><span class="line">1) &quot;Alan Turing&quot;</span><br><span class="line">2) &quot;Hedy Lamarr&quot;</span><br><span class="line">3) &quot;Claude Shannon&quot;</span><br><span class="line">4) &quot;Alan Kay&quot;</span><br><span class="line">5) &quot;Anita Borg&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; zremrangebyscore hackers 1940 1960</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrank hackers &quot;Anita Borg&quot;</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure>
ZREVRANK</li>
</ul>
<ul>
<li>Lexicographical scores<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; zadd hackers 0 &quot;Alan Kay&quot; 0 &quot;Sophie Wilson&quot; 0 &quot;Richard Stallman&quot; 0</span><br><span class="line">  &quot;Anita Borg&quot; 0 &quot;Yukihiro Matsumoto&quot; 0 &quot;Hedy Lamarr&quot; 0 &quot;Claude Shannon&quot;</span><br><span class="line">  0 &quot;Linus Torvalds&quot; 0 &quot;Alan Turing&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrange hackers 0 -1</span><br><span class="line">1) &quot;Alan Kay&quot;</span><br><span class="line">2) &quot;Alan Turing&quot;</span><br><span class="line">3) &quot;Anita Borg&quot;</span><br><span class="line">4) &quot;Claude Shannon&quot;</span><br><span class="line">5) &quot;Hedy Lamarr&quot;</span><br><span class="line">6) &quot;Linus Torvalds&quot;</span><br><span class="line">7) &quot;Richard Stallman&quot;</span><br><span class="line">8) &quot;Sophie Wilson&quot;</span><br><span class="line">9) &quot;Yukihiro Matsumoto&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrangebylex hackers [B [P</span><br><span class="line">1) &quot;Claude Shannon&quot;</span><br><span class="line">2) &quot;Hedy Lamarr&quot;</span><br><span class="line">3) &quot;Linus Torvalds&quot;</span><br></pre></td></tr></table></figure>
Just calling ZADD against an element already included in the sorted set will update its score (and position) with O(log(N)) time complexity.<h1 id="Bitmap"><a href="#Bitmap" class="headerlink" title="Bitmap"></a>Bitmap</h1>a set of bit-oriented operations defined on the String type<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; setbit key 10 1</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; getbit key 10</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; getbit key 11</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>
The SETBIT command takes as its first argument the bit number, and as its second argument the value to set the bit to, which is 1 or 0.<br>GETBIT just returns the value of the bit at the specified index. Out of range bits (addressing a bit that is outside the length of the string stored into the target key) are always considered to be zero.</li>
</ul>
<p>There are three commands operating on group of bits:</p>
<p>BITOP performs bit-wise operations between different strings. The provided operations are AND, OR, XOR and NOT.<br>BITCOUNT performs population counting, reporting the number of bits set to 1.<br>BITPOS finds the first bit having the specified value of 0 or 1.</p>
<h1 id="HyperLogLogs"><a href="#HyperLogLogs" class="headerlink" title="HyperLogLogs"></a>HyperLogLogs</h1><ul>
<li>to estimate unique things with standard error of &lt; 1%.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; pfadd hll a b c d</span><br><span class="line"> (integer) 1</span><br><span class="line"> &gt; pfcount hll</span><br><span class="line"> (integer) 4</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h1><h1 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h1><ul>
<li><p>RDB (Redis Database): point-in-time snapshots of your dataset at specified intervals.</p>
<ul>
<li>pro<ul>
<li>single file, good for backup and disaster recovery</li>
<li>maximize performance because parent process forks a child to persist</li>
<li>faster restart compared to AOF</li>
<li>On replicas, RDB supports partial resynchronizations after restarts and failovers.</li>
</ul>
</li>
<li>con<ul>
<li>may have data loss</li>
<li>fork() can be time consuming if the dataset is big, and may result in Redis stopping serving clients for some milliseconds or even for one second if the dataset is very big and the CPU performance is not great. AOF also needs to fork() but less frequently</li>
</ul>
</li>
</ul>
</li>
<li><p>AOF (Append Only File): AOF persistence logs every write operation received by the server. These operations can then be replayed again at server startup, reconstructing the original dataset. Commands are logged using the same format as the Redis protocol itself.</p>
<ul>
<li>con<ul>
<li>AOF files are usually bigger than the equivalent RDB files for the same dataset.</li>
<li>AOF can be slower than RDB depending on the exact fsync policy.</li>
</ul>
</li>
</ul>
</li>
<li><p>No persistence</p>
</li>
<li><p>RDB + AOF</p>
</li>
<li><p>In the case both AOF and RDB persistence are enabled (recommended) and Redis restarts the AOF file will be used to reconstruct the original dataset since it is guaranteed to be the most complete</p>
</li>
</ul>
<h1 id="Issues"><a href="#Issues" class="headerlink" title="Issues"></a>Issues</h1><ul>
<li>Cache avalanche<ul>
<li>cache is not available and all requests reach DB</li>
<li>solution<ul>
<li>circuit breaker</li>
<li>master-slave or cluster to ensure avaibility</li>
</ul>
</li>
</ul>
</li>
<li>cache penetration<ul>
<li>frequenly query a data (e.g. ID &#x3D; -1) that does not exist in both DB and cache, crush the DB</li>
<li>solution<ul>
<li>check with codes (e.g. id cannot be less than 0)</li>
<li>save to Redis with null as value, TTL 30</li>
<li>Bloom Filter &#x2F;&#x2F; TODO</li>
</ul>
</li>
</ul>
</li>
<li>expired hotspot<ul>
<li>solution<ul>
<li>set hotspot to “never expire”</li>
<li>do not make a lot of keys expire at the same time</li>
<li>lock to ensure requests regarding the same data will not reach DB at the same time<h1 id="Cache-elimination-strategy"><a href="#Cache-elimination-strategy" class="headerlink" title="Cache elimination strategy"></a>Cache elimination strategy</h1>noeviction<br>allkeys-lru<br>volatile-lru<br>allkeys-random<br>volatile-random<br>volatile-ttl</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="Implement-queue"><a href="#Implement-queue" class="headerlink" title="Implement queue"></a>Implement queue</h1><ul>
<li>delayed queue: sorted set, timestamp as score, zrangebyscore to get data added n seconds ago</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/11/30/MySQL-Optimization-V2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/30/MySQL-Optimization-V2/" class="post-title-link" itemprop="url">MySQL Optimization V2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-11-30 10:05:46 / Modified: 16:33:09" itemprop="dateCreated datePublished" datetime="2022-11-30T10:05:46-05:00">2022-11-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Transaction-and-Lock"><a href="#Transaction-and-Lock" class="headerlink" title="Transaction and Lock"></a>Transaction and Lock</h1><ul>
<li><p>Use InnoDB (default setting) reduces great hassle. Transaction is implemented by storage engine. If your transaction uses Table A and Table B and Table B’s storage engine does not support transaction, MySQL does not throw an error and data on Table B will not be rolled back.<br>Note: Lock is release on commit or roll back.</p>
</li>
<li><p>Use lock with smaller granularity to allow more concurrency. But more locks consumes more resources. It is a trade off.</p>
</li>
<li><p>Retry after deadlock is detected. InnoDB storage engine will notice circular dependencies and return an error instantly. InnoDB rolls back the transaction that has the fewest exclusive row locks.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Transaction 1</span><br><span class="line">START TRANSACTION;</span><br><span class="line">UPDATE StockPrice SET close = 45.50 WHERE stock_id = 4 and date = ‘2020-05-01’;</span><br><span class="line">UPDATE StockPrice SET close = 19.80 WHERE stock_id = 3 and date = ‘2020-05-02’;</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Transaction 2</span><br><span class="line">START TRANSACTION;</span><br><span class="line">UPDATE StockPrice SET high = 20.12 WHERE stock_id = 3 and date = &#x27;2020-05-02&#x27;;</span><br><span class="line">UPDATE StockPrice SET high = 47.20 WHERE stock_id = 4 and date = &#x27;2020-05-01&#x27;;</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure></li>
<li><p>If you set AUTOCOMMIT &#x3D; 0, you are always in a transaction until you issue a COMMIT or ROLLBACK. MySQL then starts a new transaction immediately.</p>
</li>
<li><p>If You set AUTOCOMMIT &#x3D; 1, use <code>begin</code> and <code>start transaction</code> if one transaction has many queries<br>Note: Certain commands (typically DDL such as ALTER TABLE, but may be others such as LOCK TABLES) cause MySQL to commit the transaction before they execute.</p>
</li>
<li><p>Choose the suitable isolation level: READ COMMITTED, READ UNCOMMITTED, REPEATABLE READ, (usually not choose) SERIALIZABLE</p>
</li>
<li><p>Understand how MVCC allows most read queries not needing to acquire locks. <code>READ COMMITTED</code> and <code>REPEATABLE READ</code> use MVCC, while <code>READ UNCOMMITTED</code> and <code>SERIALIZABLE</code> do not need it.<br>InnoDB implements MVCC by assigning a transaction ID for each transaction at the first time the transaction reads any data. When a record is modified within that transaction, an undo record that explains how to revert that change is written to the undo log, and the rollback pointer of the transaction is pointed at that undo log record.</p>
</li>
<li><p>May need to use explicit locking:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT ... FOR SHARE          // After MySQL 8.0</span><br><span class="line">SELECT ... FOR UPDATE</span><br></pre></td></tr></table></figure>
<p>S Lock: Other sessions can read the rows, but cannot modify them until your transaction commits. If any of these rows were changed by another transaction that has not yet committed, your query waits until that transaction ends and then uses the latest values.</p>
</li>
</ul>
<p>X Lock: If one transaction adds an X lock on a record, other transactions cannot add locks on it but need to wait.</p>
<h1 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h1><h2 id="Data-Type"><a href="#Data-Type" class="headerlink" title="Data Type"></a>Data Type</h2><ol>
<li>Smaller is usually better than bigger. For example, if <code>TINYINT</code> is sufficient, it is more efficient than <code>INT</code>.</li>
<li>Estimate conservatively. Realizing the data type is not big enough after the code has been in production is more painful.</li>
<li>Simple is good. For example, integers are cheaper than characters.</li>
<li>Avoid <code>null</code> if possible. Set a default value to leverage index.</li>
<li><code>DECIMAL</code> is precise but more expensive. In some high-volume cases, use a BIGINT instead and store the data as some multiple of the smallest fraction of currency. For example, multiply all dollar amounts by a million and store the result in a BIGINT.</li>
<li><code>VARCHAR</code> require less storage space than fixed-length types because it uses only as much space as it needs. However, because the rows are variable length, they can grow when you update them, which can cause extra work. If a row grows and no longer fits in its original location, the behavior is storage engine dependent. For example, InnoDB may need to split the page to fit the row into it. It’s usually worth using VARCHAR when the maximum column length is much larger than the average length; when updates to the field are rare, so fragmentation is not a problem; and when you’re using a complex character set such as UTF-8, where each character uses a variable number of bytes of storage.</li>
<li>Using ENUM instead of a string type. ENUM is 1 or 2 bytes. ENUM is stored as integers as the sequence specified in the definition. Avoid <code>ENUM(&#39;1&#39;, &#39;2&#39;, &#39;3&#39;)</code>. ENUM will be converted to string in a string context. If you want to sort them alphabetically:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT e FROM enum_test ORDER BY FIELD(e, &#x27;apple&#x27;, &#x27;dog&#x27;, &#x27;fish&#x27;);</span><br></pre></td></tr></table></figure></li>
<li>DATETIME is independent of TIMEZONE, 8 bytes, millisecond-precision, from the year 1000 to the year 9999. TIMESTAMP depends on TIMEZONE, 4 bytes, second-precision, from 1970-1-1 midnight GMT to 2038-1-19. MySQL server, operating system, and client connections all have time zone settings.</li>
</ol>
<h2 id="Primary-KEY"><a href="#Primary-KEY" class="headerlink" title="Primary KEY"></a>Primary KEY</h2><ol>
<li>Once you choose a type for PK, make sure you use the same type in all related tables</li>
<li>The Smaller, the better</li>
<li>Integer is usually better than string</li>
<li>Avoid random number, because values will be distributed over a large space. If you still want to use UUID, convert it into 16-byte numbers with UNHEX() and store them in a BINARY(16) column. You can retrieve the values in hexadecimal format with the HEX() function.</li>
</ol>
<h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><ul>
<li>If a table have hundreds of columns, even if we only use a few columns, InnoDB will parse all columns, which is expensive.</li>
</ul>
<h2 id="Summary-Table"><a href="#Summary-Table" class="headerlink" title="Summary Table"></a>Summary Table</h2><ul>
<li>To improve performance</li>
</ul>
<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><h2 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B Tree"></a>B Tree</h2><ul>
<li>Avoid duplicate, redundant, unused indices, because MySQL has to maintain each index separately.</li>
<li>Use cluster index if possible. Cluster index leaf stores the row. Non-cluster index leaf stores PK.</li>
<li>The leaf pages can perform better if they are physically sequential, otherwise it’s called “fragmented” and range scans or full index scans are slower. Avoid that with random values such as UUID. To defragment data, you can either run OPTIMIZE TABLE or dump and reload the data.</li>
<li>Use multicolumn index if possible instead of many indices on single columns (because MySQL needs to do “index merge” for the latter one), and consider:<ul>
<li>using covering index, which is an index that contains (or “covers”) all the data needed to satisfy a query.</li>
<li>the left-most rule when deciding the order of columns.</li>
<li>what sorting is needed in queries. B-tree indexes stores the data in sorted order, and MySQL can exploit that for ORDER BY and GROUP BY. Ordering the results by the index does not work if a column in ORDER BY is not in the index or the order in ORDER BY is not the order of the index. If you need to sort in different directions, a trick is to store a reversed or negated value.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE rental (</span><br><span class="line"> ...</span><br><span class="line"> PRIMARY KEY (rental_id),</span><br><span class="line"> UNIQUE KEY rental_date (rental_date,inventory_id,customer_id),</span><br><span class="line"> KEY idx_fk_inventory_id (inventory_id),</span><br><span class="line"> KEY idx_fk_customer_id (customer_id),</span><br><span class="line"> KEY idx_fk_staff_id (staff_id),</span><br><span class="line"> ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">... WHERE rental_date = &#x27;2005-05-25&#x27; ORDER BY inventory_id, staff_id;</span><br><span class="line"># does not use index because the ORDER BY refers to a column that isn’t in the index</span><br></pre></td></tr></table></figure>
The ORDER BY clause needs to form a leftmost prefix of the index unless leading columns are constants.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE rental (</span><br><span class="line"> ...</span><br><span class="line"> PRIMARY KEY (rental_id),</span><br><span class="line"> UNIQUE KEY rental_date (rental_date,inventory_id,customer_id),</span><br><span class="line"> KEY idx_fk_inventory_id (inventory_id),</span><br><span class="line"> KEY idx_fk_customer_id (customer_id),</span><br><span class="line"> KEY idx_fk_staff_id (staff_id),</span><br><span class="line"> ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT rental_id, staff_id FROM sakila.rental</span><br><span class="line">    -&gt; WHERE rental_date = &#x27;2005-05-25&#x27;</span><br><span class="line">    -&gt; ORDER BY inventory_id, customer_id\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line"> type: ref</span><br><span class="line"> possible_keys: rental_date</span><br><span class="line"> key: rental_date</span><br><span class="line"> rows: 1</span><br><span class="line"> Extra: Using where</span><br></pre></td></tr></table></figure>
If the query joins multiple tables, ordering the results by the index works only when all columns in the ORDER BY clause refer to the first table.</li>
<li>Assuming there is no sorting and group by, the column that can filter out the most rows should be the leftest.</li>
</ul>
</li>
<li>Consider using prefix to save storage. You must define prefix if you want to index BLOB, TEXT, or very long VARCHAR columns, because MySQL disallows indexing their full length.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE cities ADD KEY (city(7));</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Query-Tuning"><a href="#Query-Tuning" class="headerlink" title="Query Tuning"></a>Query Tuning</h1><h2 id="Slower-to-Fast"><a href="#Slower-to-Fast" class="headerlink" title="Slower to Fast"></a>Slower to Fast</h2><p>constants<br>unique index lookups<br>range scans<br>index scans<br>full table scans</p>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><ol>
<li>Avoid <code>SELECT *</code>. Only include columns needed.</li>
<li>Choose the suitable query size. It is a trade-off between:</li>
</ol>
<ul>
<li>reduce the number of connections established.</li>
<li>avoid locking for too long if there is a lock.</li>
</ul>
<ol start="3">
<li>Do not perform calculation on index column while filtering. An example that violates this:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT actor_id FROM actor WHERE actor_id + 1 = 5;</span><br></pre></td></tr></table></figure></li>
<li>Join</li>
</ol>
<ul>
<li>Avoid join too many tables. Join them in application.</li>
<li>The table has fewer rows that meet the ON criteria should be the “driver” table. You can manually use this rule in STRAIGHT JOIN, LEFT JOIN, and RIGHT JOIN.</li>
<li>If optimizer decides to join the tables in the order B, A, you need to add indexes only on the second table (Table A) in the join order.</li>
</ul>
<ol start="5">
<li>Avoid correlated subqueries:</li>
</ol>
<ul>
<li>Method 1: Replace IN with EXISTS  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM film</span><br><span class="line">  -&gt; WHERE EXISTS(</span><br><span class="line">  -&gt;    SELECT * FROM film_actor WHERE actor_id = 1</span><br><span class="line">  -&gt;       AND film_actor.film_id = film.film_id);</span><br></pre></td></tr></table></figure></li>
<li>Method 2: Join. But this may not be more efficient because it will join all rows that can be joined first before filtering.</li>
<li>Method 3: Generate the IN list with GROUP_CONCAT in another query</li>
</ul>
<ol start="6">
<li>GROUP BY and ORDER BY</li>
</ol>
<ul>
<li>Use columns in the same table in GROUP BY and ORDER BY to leverage index.</li>
<li>Use index if possible</li>
<li>Move the WITH ROLLUP functionality into your application code.</li>
</ul>
<ol start="7">
<li>LIMIT with large offet<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT film_id, description FROM sakila.film ORDER BY title LIMIT 50, 5;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>Method 1:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT film.film_id, film.description</span><br><span class="line">    -&gt; FROM sakila.film</span><br><span class="line">    -&gt;    INNER JOIN (</span><br><span class="line">    -&gt;       SELECT film_id FROM sakila.film</span><br><span class="line">    -&gt;       ORDER BY title LIMIT 50, 5</span><br><span class="line">    -&gt;    ) AS lim USING(film_id);</span><br></pre></td></tr></table></figure></li>
<li>Method 2: position is indexed<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT film_id, description FROM sakila.film</span><br><span class="line">WHERE position BETWEEN 50 AND 54 ORDER BY position;</span><br></pre></td></tr></table></figure></li>
<li>Method 3<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM sakila.rental</span><br><span class="line">-&gt; WHERE rental_id &lt; 16030</span><br><span class="line">-&gt; ORDER BY rental_id DESC LIMIT 20;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="8">
<li>Replace <code>OR</code> with <code>IN</code>. MySQL uses binary search on the <code>IN</code> list. However, <code>IN</code> list that is too long may hurt performance,<br>because the optimizer may copy the list for all related tables (due to a WHERE, ON, or USING clause that sets the column equals to that on another table).</li>
<li>Union:</li>
</ol>
<ul>
<li>add filtering  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(SELECT first_name, last_name</span><br><span class="line"> FROM sakila.actor</span><br><span class="line"> ORDER BY last_name)</span><br><span class="line">UNION ALL</span><br><span class="line">(SELECT first_name, last_name</span><br><span class="line"> FROM sakila.customer</span><br><span class="line"> ORDER BY last_name)</span><br><span class="line">LIMIT 20;</span><br></pre></td></tr></table></figure>
  Should be:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(SELECT first_name, last_name</span><br><span class="line"> FROM sakila.actor</span><br><span class="line"> ORDER BY last_name</span><br><span class="line"> LIMIT 20)</span><br><span class="line">UNION ALL</span><br><span class="line">(SELECT first_name, last_name</span><br><span class="line"> FROM sakila.customer</span><br><span class="line"> ORDER BY last_name</span><br><span class="line"> LIMIT 20)</span><br><span class="line">LIMIT 20;</span><br></pre></td></tr></table></figure></li>
<li>If sorting is not needed, use UNION ALL, because UNION will sort.</li>
</ul>
<ol start="10">
<li><p>MAX() and MIN()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT MIN(actor_id) FROM sakila.actor WHERE first_name = &#x27;PENELOPE&#x27;;</span><br></pre></td></tr></table></figure>
<p>Can be:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT actor_id FROM sakila.actor USE INDEX(PRIMARY)</span><br><span class="line">    -&gt; WHERE first_name = &#x27;PENELOPE&#x27; LIMIT 1;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Count()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT SUM(IF(color = &#x27;blue&#x27;, 1, 0)) AS blue,SUM(IF(color = &#x27;red&#x27;, 1, 0))</span><br><span class="line">AS red FROM items;</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liam Lian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liam Lian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
