<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"liamyaolian.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Liam Lian&#39;s Blog">
<meta property="og:url" content="https://liamyaolian.github.io/index.html">
<meta property="og:site_name" content="Liam Lian&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Liam Lian">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://liamyaolian.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Liam Lian's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Liam Lian's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/06/06/Multi-Thread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/06/Multi-Thread/" class="post-title-link" itemprop="url">Multi-Thread</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-06-06 10:31:56" itemprop="dateCreated datePublished" datetime="2022-06-06T10:31:56-04:00">2022-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-06-14 10:56:11" itemprop="dateModified" datetime="2022-06-14T10:56:11-04:00">2022-06-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Multi-Thread-Programming-Core"><a href="#Multi-Thread-Programming-Core" class="headerlink" title="Multi-Thread Programming Core"></a>Multi-Thread Programming Core</h2><ul>
<li>Division</li>
<li>Notification after finishing</li>
<li>Exclusion: allow only one thread to access a shared variable during a period<ul>
<li>how: use lock or make it read-only</li>
</ul>
</li>
</ul>
<h2 id="Why-Bug"><a href="#Why-Bug" class="headerlink" title="Why Bug?"></a>Why Bug?</h2><ul>
<li><p>visible: after a thread changes a variable, another thread can see the result immediately</p>
<ul>
<li>有一个共享变量 abc，在一个线程里设置了 abc 的值 abc&#x3D;3，你思考一下，有哪些办法可以让其他线程能够看到abc&#x3D;&#x3D;3？</li>
<li>CPU cache<br><img src="/../image/multi-thread/CPU_cache.webp" alt="CPU cache"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">add10K</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(idx++ &lt; <span class="number">10000</span>) &#123;</span><br><span class="line">      count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">calc</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Test</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    <span class="comment">// 创建两个线程，执行add()操作</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">th1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">      test.add10K();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">th2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">      test.add10K();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 启动两个线程</span></span><br><span class="line">    th1.start();</span><br><span class="line">    th2.start();</span><br><span class="line">    <span class="comment">// 等待两个线程执行结束</span></span><br><span class="line">    th1.join();</span><br><span class="line">    th2.join();</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Atomic</p>
<ul>
<li>count +&#x3D; 1:<ul>
<li>get count from memory to CPU register</li>
<li>update count to count + 1 in CPU register</li>
<li>save to memory or (if use cache) CPU cache<br><img src="/../image/multi-thread/thread_switching.webp" alt="thread switching"></li>
</ul>
</li>
</ul>
</li>
<li><p>Compiler optimization changes the code sequence</p>
</li>
<li><p>按需禁用缓存以及编译优化</p>
<ul>
<li>volatile: read in and write to memory rather than CPU cache</li>
<li>synchronized</li>
<li>final<ul>
<li>Java 1.5以后，只要我们提供正确构造函数没有“逸出”，就不会出问题了<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 以下代码来源于【参考1】</span></span><br><span class="line"><span class="keyword">final</span> <span class="type">int</span> x;</span><br><span class="line"><span class="comment">// 错误的构造函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">FinalFieldExample</span><span class="params">()</span> &#123;</span><br><span class="line">  x = <span class="number">3</span>;</span><br><span class="line">  y = <span class="number">4</span>;</span><br><span class="line">  <span class="comment">// 此处就是this逸出，线程通过 global.obj 读取 x 是有可能读到 0 的</span></span><br><span class="line">  global.obj = <span class="built_in">this</span>;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>Happens-Before: 前一个操作的结果对后续操作可见<ul>
<li>在一个线程中，按照程序顺序，前面的操作 Happens-Before 于后续的操作</li>
<li>对一个 volatile 变量的写操作， Happens-Before 于后续对这个 volatile 变量的读操作。</li>
<li>如果 A Happens-Before B，且 B Happens-Before C，那么 A Happens-Before C。</li>
<li>管程（Java: synchronized，在进入同步块之前，会自动加锁，而在代码块执行完会自动释放锁）中，一个锁的解锁 Happens-Before 于后续对这个锁的加锁</li>
<li>线程 start() 规则：主线程 A 启动子线程 B 后，子线程 B 能够看到主线程在启动子线程 B 前的操作</li>
<li>线程 join() 规则：指主线程 A 等待子线程 B 完成（主线程 A 通过调用子线程 B 的 join() 方法实现），当子线程 B 完成后（主线程 A 中 join() 方法返回），主线程能够看到子线程对共享变量的操作</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h2><ul>
<li>同一时刻只有一个线程执行临界区的代码<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class X &#123;</span><br><span class="line">  // 修饰非静态方法 锁定当前实例</span><br><span class="line">  synchronized void foo() &#123;</span><br><span class="line">    // 临界区</span><br><span class="line">  &#125;</span><br><span class="line">  // 修饰静态方法 锁定当前类的 Class 对象</span><br><span class="line">  synchronized static void bar() &#123;</span><br><span class="line">    // 临界区</span><br><span class="line">  &#125;</span><br><span class="line">  // 修饰代码块 锁定obj</span><br><span class="line">  Object obj = new Object()；</span><br><span class="line">  void baz() &#123;</span><br><span class="line">    synchronized(obj) &#123;</span><br><span class="line">      // 临界区</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></li>
<li>前一个线程在临界区修改的共享变量（该操作在解锁之前），对后续进入临界区（该操作在加锁之后）的线程是可见的</li>
<li>受保护资源和锁之间的合理关系是 N:1 的关系。不可以多锁保护一个资源，会没有可见性保证。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class Account &#123;</span><br><span class="line">  // 锁：保护账户余额</span><br><span class="line">  private final Object balLock</span><br><span class="line">    = new Object();</span><br><span class="line">  // 账户余额  </span><br><span class="line">  private Integer balance;</span><br><span class="line">  // 锁：保护账户密码</span><br><span class="line">  private final Object pwLock</span><br><span class="line">    = new Object();</span><br><span class="line">  // 账户密码</span><br><span class="line">  private String password;</span><br><span class="line"></span><br><span class="line">  // 取款</span><br><span class="line">  void withdraw(Integer amt) &#123;</span><br><span class="line">    synchronized(balLock) &#123;</span><br><span class="line">      if (this.balance &gt; amt)&#123;</span><br><span class="line">        this.balance -= amt;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // 查看余额</span><br><span class="line">  Integer getBalance() &#123;</span><br><span class="line">    synchronized(balLock) &#123;</span><br><span class="line">      return balance;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 更改密码</span><br><span class="line">  void updatePassword(String pw)&#123;</span><br><span class="line">    synchronized(pwLock) &#123;</span><br><span class="line">      this.password = pw;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // 查看密码</span><br><span class="line">  String getPassword() &#123;</span><br><span class="line">    synchronized(pwLock) &#123;</span><br><span class="line">      return password;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>也可以用一把互斥锁来保护多个资源，例如我们可以用 this 这一把锁来管理账户类里所有的资源：账户余额和用户密码，示例程序中所有的方法都增加同步关键字 synchronized 就可以了。</li>
<li>细粒度锁：用不同的锁对受保护资源进行精细化管理，能够提升性能。</li>
<li>不能用可变对象做锁</li>
</ul>
<h2 id="Local-variable-is-thread-safe"><a href="#Local-variable-is-thread-safe" class="headerlink" title="Local variable is thread-safe"></a>Local variable is thread-safe</h2><h2 id="OOP"><a href="#OOP" class="headerlink" title="OOP"></a>OOP</h2><ul>
<li>shared variable encapsulation<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">long</span> value;</span><br><span class="line">  <span class="keyword">synchronized</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">synchronized</span> <span class="type">long</span> <span class="title function_">addOne</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ++value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>unchanged shared variable: final</li>
<li>constraints among shared variables<ul>
<li>having “if”, may have race condition</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/05/31/Design-Pattern-Summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/31/Design-Pattern-Summary/" class="post-title-link" itemprop="url">Design Pattern Summary</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-05-31 16:40:37 / Modified: 22:00:58" itemprop="dateCreated datePublished" datetime="2022-05-31T16:40:37-04:00">2022-05-31</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Code-Quality"><a href="#Code-Quality" class="headerlink" title="Code Quality"></a>Code Quality</h2><ol>
<li>Clarify</li>
<li>Core objects</li>
<li>Use cases and test cases</li>
<li>Classes and relations</li>
</ol>
<ul>
<li>功能相近在同一个类中</li>
<li>relations: 一个类改动很少导致另一个类改动<ul>
<li>Generalization + Realization</li>
<li>Dependency<ul>
<li>Association: Aggregation + Composition</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="5">
<li>Correctness</li>
<li>Document</li>
</ol>
<ul>
<li>class and function: what, why, and how</li>
</ul>
<h3 id="OOP"><a href="#OOP" class="headerlink" title="OOP"></a>OOP</h3><ol>
<li>encapsulation: to control how to access (get and set) and hide details</li>
</ol>
<ul>
<li>Collections.unmodifiableList</li>
<li>avoid global variable and method as much as possible</li>
</ul>
<ol start="2">
<li>abstraction: to hide details of implementation and only expose what to do</li>
<li>inheritance: is-a, to increase reusability</li>
</ol>
<ul>
<li>review interface and abstract class</li>
<li>if inheritance relations among classes will not change frequently, and there are few horizontally and vertically, can use</li>
</ul>
<ol start="4">
<li>polymorphism</li>
</ol>
<h3 id="Principle"><a href="#Principle" class="headerlink" title="Principle"></a>Principle</h3><h4 id="SOLID"><a href="#SOLID" class="headerlink" title="SOLID"></a>SOLID</h4><ul>
<li>Single Responsibility Principle</li>
<li>Open Closed Principle: open for extension , but closed for modification<ul>
<li>abstract changable codes</li>
</ul>
</li>
<li>Liskov Substitution Principle: functions that use references to base classes must be able to use objects of derived classes without knowing it<ul>
<li>respect the contract: what to do, input, output, exception</li>
</ul>
</li>
<li>Interface Segregation Principle: clients should not be forced to depend upon interfaces that they do not use  </li>
<li>Dependency Inversion Principle: High-level modules shouldn’t depend on low-level modules. Both modules should depend on abstractions.<ul>
<li>Program to interface, if there may be multiple implementation ways</li>
<li>调用者属于高层，被调用者属于低层。</li>
</ul>
</li>
</ul>
<h4 id="多用组合少用继承"><a href="#多用组合少用继承" class="headerlink" title="多用组合少用继承"></a>多用组合少用继承</h4><ul>
<li>change is-a to has-a to avoid too many layers of inheritance</li>
</ul>
<h4 id="KISS-and-YAGNI"><a href="#KISS-and-YAGNI" class="headerlink" title="KISS and YAGNI"></a>KISS and YAGNI</h4><ul>
<li>don’t write features that we don’t need now</li>
<li>don’t introduce a dependency that we don’t need now</li>
<li>don’t recreate a wheel</li>
<li>colleagues can understand</li>
<li>don’t optimize non-bottleneck</li>
</ul>
<h4 id="DRY"><a href="#DRY" class="headerlink" title="DRY"></a>DRY</h4><ul>
<li>功能重复、代码执行重复，而非实现重复</li>
</ul>
<h4 id="Modularity"><a href="#Modularity" class="headerlink" title="Modularity"></a>Modularity</h4><ul>
<li>业务逻辑与非业务逻辑分离<ul>
<li>AOP</li>
</ul>
</li>
</ul>
<h4 id="Law-of-Demeter-The-Least-Knowledge-Principle"><a href="#Law-of-Demeter-The-Least-Knowledge-Principle" class="headerlink" title="Law of Demeter: The Least Knowledge Principle"></a>Law of Demeter: The Least Knowledge Principle</h4><ul>
<li>避免依赖不该依赖的模块，有依赖关系的类只依赖必要的接口</li>
</ul>
<h4 id="Layer"><a href="#Layer" class="headerlink" title="Layer"></a>Layer</h4><ul>
<li>通用代码下沉</li>
</ul>
<h4 id="Reusability"><a href="#Reusability" class="headerlink" title="Reusability"></a>Reusability</h4><ul>
<li>第一次编写代码不用考虑复用性，第二次使用时重构</li>
<li>what to do, input, output, exception</li>
</ul>
<h4 id="Testability"><a href="#Testability" class="headerlink" title="Testability"></a>Testability</h4><ul>
<li>避免未决行为</li>
</ul>
<h3 id="Design-Pattern-Create"><a href="#Design-Pattern-Create" class="headerlink" title="Design Pattern: Create"></a>Design Pattern: Create</h3><p><img src="/../image/design-pattern-summary/frequently-used.png" alt="Frequently Used"></p>
<h4 id="Singleton"><a href="#Singleton" class="headerlink" title="Singleton"></a>Singleton</h4><ul>
<li>create and provide only one instance by itself</li>
<li>implementation<ul>
<li>private constructor</li>
<li>private static reference to object</li>
<li>public static method to create and get. Need to consider whether to add lock</li>
</ul>
</li>
<li>type<ul>
<li>hungry: Instantiate when loading the class; thread-safe</li>
<li>lazy: instantiate when using; not thread-safe<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//懒汉式：类内实例对象创建时并不直接初始化，直到第一次调用get方法时，才完成初始化操作</span></span><br><span class="line"><span class="comment">//时间换空间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IdGenerator</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> IdGenerator instance;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">IdGenerator</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add lock 并发度很低</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> IdGenerator <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> <span class="title class_">IdGenerator</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>double checked locking<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IdGenerator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> IdGenerator instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">IdGenerator</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(IdGenerator.class) &#123; <span class="comment">// 此处为类级别的锁</span></span><br><span class="line">          <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">IdGenerator</span>();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ```  </span><br><span class="line">- 静态内部类: 类似饿汉式，但又能做到了延迟加载</span><br><span class="line">  ```java</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IdGenerator</span> &#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">private</span> <span class="title function_">IdGenerator</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// static class intance created when getInstance() is called</span></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">IdGenerator</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IdGenerator</span>();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ```  </span><br><span class="line">- 枚举</span><br><span class="line">  ```java</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">IdGenerator</span> &#123;</span><br><span class="line">      INSTANCE;</span><br><span class="line">      <span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>con<ul>
<li>违背了基于接口而非实现的设计原则，难以继承</li>
<li>会隐藏类之间的依赖关系</li>
<li>如果未来某一天，我们需要在代码中创建两个实例或多个实例，那就要对代码有比较大的改动</li>
<li>对代码的可测试性不友好：单例类这种硬编码式的使用方式，导致无法实现 mock 替换。</li>
<li>不支持有参数的构造函数</li>
</ul>
</li>
<li>解决不支持有参数的构造函数的问题<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PARAM_A</span> <span class="operator">=</span> <span class="number">123</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PARAM_B</span> <span class="operator">=</span> <span class="number">245</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> paramA;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> paramB;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.paramA = Config.PARAM_A;</span><br><span class="line">      <span class="built_in">this</span>.paramB = Config.PARAM_B;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">        instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ```  </span><br><span class="line">* 解决隐藏类之间的依赖关系的问题</span><br><span class="line">  ```java</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 老的使用方式</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">demofunction</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> IdGenerator.getInstance().getId();</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 新的使用方式：依赖注入</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">demofunction</span><span class="params">(IdGenerator idGenerator)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> idGenerator.getId();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 外部调用demofunction()的时候，传入idGenerator</span></span><br><span class="line">  <span class="type">IdGenerator</span> <span class="variable">idGenerator</span> <span class="operator">=</span> IdGenerator.getInsance();</span><br><span class="line">  demofunction(idGenerator);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Factory"><a href="#Factory" class="headerlink" title="Factory"></a>Factory</h4><ul>
<li>when to use<ul>
<li>隔离复杂性：封装复杂的创建逻辑，调用者无需了解如何创建对象。</li>
<li>控制复杂度：将创建代码抽离出来，让原本的函数或类职责更单一，代码更简洁。</li>
<li>封装变化：创建逻辑有可能变化</li>
<li>代码复用：创建代码抽离到独立的工厂类之后可以复用。</li>
</ul>
</li>
</ul>
<h5 id="Simple-Factory-x2F-Static-Factory-Method-Pattern"><a href="#Simple-Factory-x2F-Static-Factory-Method-Pattern" class="headerlink" title="Simple Factory &#x2F; Static Factory Method Pattern"></a>Simple Factory &#x2F; Static Factory Method Pattern</h5><ul>
<li>当每个对象的创建逻辑都比较简单的时候，使用简单工厂模式<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigSource</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> RuleConfig <span class="title function_">load</span><span class="params">(String ruleConfigFilePath)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ruleConfigFileExtension</span> <span class="operator">=</span> getFileExtension(ruleConfigFilePath);</span><br><span class="line">    <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> RuleConfigParserFactory.createParser(ruleConfigFileExtension);</span><br><span class="line">    <span class="keyword">if</span> (parser == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidRuleConfigException</span>(</span><br><span class="line">              <span class="string">&quot;Rule config file format is not supported: &quot;</span> + ruleConfigFilePath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">configText</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//从ruleConfigFilePath文件中读取配置文本到configText中</span></span><br><span class="line">    <span class="type">RuleConfig</span> <span class="variable">ruleConfig</span> <span class="operator">=</span> parser.parse(configText);</span><br><span class="line">    <span class="keyword">return</span> ruleConfig;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">getFileExtension</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">    <span class="comment">//...解析文件名获取扩展名，比如rule.json，返回json</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;json&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">(String configFormat)</span> &#123;</span><br><span class="line">    <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;json&quot;</span>.equalsIgnoreCase(configFormat)) &#123;</span><br><span class="line">      parser = <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;xml&quot;</span>.equalsIgnoreCase(configFormat)) &#123;</span><br><span class="line">      parser = <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;yaml&quot;</span>.equalsIgnoreCase(configFormat)) &#123;</span><br><span class="line">      parser = <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParser</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;properties&quot;</span>.equalsIgnoreCase(configFormat)) &#123;</span><br><span class="line">      parser = <span class="keyword">new</span> <span class="title class_">PropertiesRuleConfigParser</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> parser;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, RuleConfigParser&gt; cachedParsers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    cachedParsers.put(<span class="string">&quot;json&quot;</span>, <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>());</span><br><span class="line">    cachedParsers.put(<span class="string">&quot;xml&quot;</span>, <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>());</span><br><span class="line">    cachedParsers.put(<span class="string">&quot;yaml&quot;</span>, <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParser</span>());</span><br><span class="line">    cachedParsers.put(<span class="string">&quot;properties&quot;</span>, <span class="keyword">new</span> <span class="title class_">PropertiesRuleConfigParser</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">(String configFormat)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (configFormat == <span class="literal">null</span> || configFormat.isEmpty()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;<span class="comment">//返回null还是IllegalArgumentException全凭你自己说了算</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> cachedParsers.get(configFormat.toLowerCase());</span><br><span class="line">    <span class="keyword">return</span> parser;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="Factory-Method"><a href="#Factory-Method" class="headerlink" title="Factory Method"></a>Factory Method</h5><ul>
<li>如果我们非得要将 if 分支逻辑去掉，那该怎么办呢？比较经典处理方法就是利用多态. 工厂方法模式比起简单工厂模式更加符合开闭原则. 当对象的创建逻辑比较复杂，不只是简单的 new 一下就可以，而是要组合其他类对象，做各种初始化操作的时候，我们推荐使用工厂方法模式，将复杂的创建逻辑拆分到多个工厂类中，让每个工厂类都不至于过于复杂。而使用简单工厂模式，将所有的创建逻辑都放到一个工厂类中，会导致这个工厂类变得很复杂。  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">  IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YamlRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PropertiesRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigSource</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> RuleConfig <span class="title function_">load</span><span class="params">(String ruleConfigFilePath)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ruleConfigFileExtension</span> <span class="operator">=</span> getFileExtension(ruleConfigFilePath);</span><br><span class="line"></span><br><span class="line">    <span class="type">IRuleConfigParserFactory</span> <span class="variable">parserFactory</span> <span class="operator">=</span> RuleConfigParserFactoryMap.getParserFactory(ruleConfigFileExtension);</span><br><span class="line">    <span class="keyword">if</span> (parserFactory == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidRuleConfigException</span>(<span class="string">&quot;Rule config file format is not supported: &quot;</span> + ruleConfigFilePath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> parserFactory.createParser();</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">configText</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//从ruleConfigFilePath文件中读取配置文本到configText中</span></span><br><span class="line">    <span class="type">RuleConfig</span> <span class="variable">ruleConfig</span> <span class="operator">=</span> parser.parse(configText);</span><br><span class="line">    <span class="keyword">return</span> ruleConfig;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">getFileExtension</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">    <span class="comment">//...解析文件名获取扩展名，比如rule.json，返回json</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;json&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//因为工厂类只包含方法，不包含成员变量，完全可以复用，</span></span><br><span class="line"><span class="comment">//不需要每次都创建新的工厂类对象，所以，简单工厂模式的第二种实现思路更加合适。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigParserFactoryMap</span> &#123; <span class="comment">//工厂的工厂</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, IRuleConfigParserFactory&gt; cachedFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    cachedFactories.put(<span class="string">&quot;json&quot;</span>, <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParserFactory</span>());</span><br><span class="line">    cachedFactories.put(<span class="string">&quot;xml&quot;</span>, <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParserFactory</span>());</span><br><span class="line">    cachedFactories.put(<span class="string">&quot;yaml&quot;</span>, <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParserFactory</span>());</span><br><span class="line">    cachedFactories.put(<span class="string">&quot;properties&quot;</span>, <span class="keyword">new</span> <span class="title class_">PropertiesRuleConfigParserFactory</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> IRuleConfigParserFactory <span class="title function_">getParserFactory</span><span class="params">(String type)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="literal">null</span> || type.isEmpty()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">IRuleConfigParserFactory</span> <span class="variable">parserFactory</span> <span class="operator">=</span> cachedFactories.get(type.toLowerCase());</span><br><span class="line">    <span class="keyword">return</span> parserFactory;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ul>
<li>当每个对象的创建逻辑都比较复杂的时候，为了避免设计一个过于庞大的简单工厂类，使用工厂方法模式，将创建逻辑拆分得更细，每个对象的创建逻辑独立到各自的工厂类中</li>
</ul>
<h5 id="Abstract-Factory"><a href="#Abstract-Factory" class="headerlink" title="Abstract Factory"></a>Abstract Factory</h5><ul>
<li><p>not used frequently</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">针对规则配置的解析器：基于接口IRuleConfigParser</span><br><span class="line">JsonRuleConfigParser</span><br><span class="line">XmlRuleConfigParser</span><br><span class="line">YamlRuleConfigParser</span><br><span class="line">PropertiesRuleConfigParser</span><br><span class="line"></span><br><span class="line">针对系统配置的解析器：基于接口ISystemConfigParser</span><br><span class="line">JsonSystemConfigParser</span><br><span class="line">XmlSystemConfigParser</span><br><span class="line">YamlSystemConfigParser</span><br><span class="line">PropertiesSystemConfigParser</span><br></pre></td></tr></table></figure>
<p>  针对这种特殊的场景，如果还是继续用工厂方法来实现的话，我们要针对每个 parser 都编写一个工厂类，也就是要编写 8 个工厂类。如果我们未来还需要增加针对业务配置的解析器（比如 IBizConfigParser），那就要再对应地增加 4 个工厂类。而我们知道，过多的类也会让系统难维护。这个问题该怎么解决呢？抽象工厂就是针对这种非常特殊的场景而诞生的。我们可以让一个工厂负责创建多个不同类型的对象（IRuleConfigParser、ISystemConfigParser 等），而不是只创建一种 parser 对象。这样就可以有效地减少工厂类的个数。具体的代码实现如下所示：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IConfigParserFactory</span> &#123;</span><br><span class="line">  IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">()</span>;</span><br><span class="line">  ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">//此处可以扩展新的parser类型，比如IBizConfigParser</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonSystemConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XmlSystemConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 省略YamlConfigParserFactory和PropertiesConfigParserFactory代码</span></span><br></pre></td></tr></table></figure>
<h4 id="Builder"><a href="#Builder" class="headerlink" title="Builder"></a>Builder</h4></li>
<li><p>创建一种类型的复杂对象，通过设置不同的可选参数，“定制化”地创建不同的对象</p>
</li>
<li><p>When to use</p>
<ul>
<li>如果必填的属性有很多：若把这些必填属性放到构造函数中设置，构造函数参数列表太长；若把必填属性通过 set() 方法设置，无法校验这些必填属性是否已经填写。</li>
<li>如果类的属性之间有依赖关系，使用构造函数配合 set()  的方法，无法校验约束条件。</li>
<li>如果希望对象在创建好之后不能再修改属性值，就不能暴露 并使用set() 方法。</li>
</ul>
</li>
<li><p>Example<br>校验逻辑放置到 Builder 类中，先创建建造者，并且通过 set() 方法设置建造者的变量值，然后在使用 build() 方法真正创建对象之前，做集中的校验，校验通过之后才会创建对象。除此之外，我们把 ResourcePoolConfig 的构造函数改为 private 私有权限。这样我们就只能通过建造者来创建 ResourcePoolConfig 类对象。并且，ResourcePoolConfig 没有提供任何 set() 方法，这样我们创建出来的对象就是不可变对象了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourcePoolConfig</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> maxTotal;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> maxIdle;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> minIdle;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">ResourcePoolConfig</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = builder.name;</span><br><span class="line">    <span class="built_in">this</span>.maxTotal = builder.maxTotal;</span><br><span class="line">    <span class="built_in">this</span>.maxIdle = builder.maxIdle;</span><br><span class="line">    <span class="built_in">this</span>.minIdle = builder.minIdle;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...省略getter方法...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//我们将Builder类设计成了ResourcePoolConfig的内部类。</span></span><br><span class="line">  <span class="comment">//我们也可以将Builder类设计成独立的非内部类ResourcePoolConfigBuilder。</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_MAX_TOTAL</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_MAX_IDLE</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_MIN_IDLE</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxTotal</span> <span class="operator">=</span> DEFAULT_MAX_TOTAL;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxIdle</span> <span class="operator">=</span> DEFAULT_MAX_IDLE;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">minIdle</span> <span class="operator">=</span> DEFAULT_MIN_IDLE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResourcePoolConfig <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">// 校验逻辑放到这里来做，包括必填项校验、依赖关系校验、约束条件校验等</span></span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isBlank(name)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (maxIdle &gt; maxTotal) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (minIdle &gt; maxTotal || minIdle &gt; maxIdle) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResourcePoolConfig</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isBlank(name)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.name = name;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">setMaxTotal</span><span class="params">(<span class="type">int</span> maxTotal)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (maxTotal &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.maxTotal = maxTotal;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">setMaxIdle</span><span class="params">(<span class="type">int</span> maxIdle)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (maxIdle &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.maxIdle = maxIdle;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">setMinIdle</span><span class="params">(<span class="type">int</span> minIdle)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (minIdle &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.minIdle = minIdle;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这段代码会抛出IllegalArgumentException，因为minIdle&gt;maxIdle</span></span><br><span class="line"><span class="type">ResourcePoolConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourcePoolConfig</span>.Builder()</span><br><span class="line">        .setName(<span class="string">&quot;dbconnectionpool&quot;</span>)</span><br><span class="line">        .setMaxTotal(<span class="number">16</span>)</span><br><span class="line">        .setMaxIdle(<span class="number">10</span>)</span><br><span class="line">        .setMinIdle(<span class="number">12</span>)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Prototype"><a href="#Prototype" class="headerlink" title="Prototype"></a>Prototype</h4><ul>
<li>not frequently used</li>
<li>creating is expensive and instances are similar</li>
<li>ways<ul>
<li>shallow clone, deep clone, shallow clone + deep clone</li>
</ul>
</li>
</ul>
<h3 id="Design-Pattern-Structure"><a href="#Design-Pattern-Structure" class="headerlink" title="Design Pattern: Structure"></a>Design Pattern: Structure</h3><h4 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h4><ul>
<li><h2 id="在不改变原始类，通过引入代理类来给原始类附加功能。"><a href="#在不改变原始类，通过引入代理类来给原始类附加功能。" class="headerlink" title="在不改变原始类，通过引入代理类来给原始类附加功能。"></a>在不改变原始类，通过引入代理类来给原始类附加功能。</h2></li>
<li><p>Types<br>UserController 类只负责业务功能。代理类 UserControllerProxy 负责在业务代码执行前后附加其他逻辑代码，并通过委托的方式调用原始类来执行业务代码</p>
<ul>
<li><p>代理类和原始类实现相同接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserController</span> &#123;</span><br><span class="line">  UserVo <span class="title function_">login</span><span class="params">(String telephone, String password)</span>;</span><br><span class="line">  UserVo <span class="title function_">register</span><span class="params">(String telephone, String password)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> <span class="keyword">implements</span> <span class="title class_">IUserController</span> &#123;</span><br><span class="line">  <span class="comment">//...省略其他属性和方法...</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> UserVo <span class="title function_">login</span><span class="params">(String telephone, String password)</span> &#123;</span><br><span class="line">    <span class="comment">//...省略login逻辑...</span></span><br><span class="line">    <span class="comment">//...返回UserVo数据...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> UserVo <span class="title function_">register</span><span class="params">(String telephone, String password)</span> &#123;</span><br><span class="line">    <span class="comment">//...省略register逻辑...</span></span><br><span class="line">    <span class="comment">//...返回UserVo数据...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerProxy</span> <span class="keyword">implements</span> <span class="title class_">IUserController</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> MetricsCollector metricsCollector;</span><br><span class="line">  <span class="keyword">private</span> UserController userController;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">UserControllerProxy</span><span class="params">(UserController userController)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.userController = userController;</span><br><span class="line">    <span class="built_in">this</span>.metricsCollector = <span class="keyword">new</span> <span class="title class_">MetricsCollector</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> UserVo <span class="title function_">login</span><span class="params">(String telephone, String password)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">startTimestamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 委托</span></span><br><span class="line">    <span class="type">UserVo</span> <span class="variable">userVo</span> <span class="operator">=</span> userController.login(telephone, password);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">endTimeStamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">long</span> <span class="variable">responseTime</span> <span class="operator">=</span> endTimeStamp - startTimestamp;</span><br><span class="line">    <span class="type">RequestInfo</span> <span class="variable">requestInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RequestInfo</span>(<span class="string">&quot;login&quot;</span>, responseTime, startTimestamp);</span><br><span class="line">    metricsCollector.recordRequest(requestInfo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> userVo;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> UserVo <span class="title function_">register</span><span class="params">(String telephone, String password)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">startTimestamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="type">UserVo</span> <span class="variable">userVo</span> <span class="operator">=</span> userController.register(telephone, password);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">endTimeStamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">long</span> <span class="variable">responseTime</span> <span class="operator">=</span> endTimeStamp - startTimestamp;</span><br><span class="line">    <span class="type">RequestInfo</span> <span class="variable">requestInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RequestInfo</span>(<span class="string">&quot;register&quot;</span>, responseTime, startTimestamp);</span><br><span class="line">    metricsCollector.recordRequest(requestInfo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> userVo;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//UserControllerProxy使用举例</span></span><br><span class="line"><span class="comment">//因为原始类和代理类实现相同的接口，是基于接口而非实现编程</span></span><br><span class="line"><span class="comment">//将UserController类对象替换为UserControllerProxy类对象，不需要改动太多代码</span></span><br><span class="line"><span class="type">IUserController</span> <span class="variable">userController</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserControllerProxy</span>(<span class="keyword">new</span> <span class="title class_">UserController</span>());</span><br></pre></td></tr></table></figure></li>
<li><p>代理类继承原始类  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerProxy</span> <span class="keyword">extends</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> MetricsCollector metricsCollector;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">UserControllerProxy</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.metricsCollector = <span class="keyword">new</span> <span class="title class_">MetricsCollector</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> UserVo <span class="title function_">login</span><span class="params">(String telephone, String password)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">startTimestamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="type">UserVo</span> <span class="variable">userVo</span> <span class="operator">=</span> <span class="built_in">super</span>.login(telephone, password);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">endTimeStamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">long</span> <span class="variable">responseTime</span> <span class="operator">=</span> endTimeStamp - startTimestamp;</span><br><span class="line">    <span class="type">RequestInfo</span> <span class="variable">requestInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RequestInfo</span>(<span class="string">&quot;login&quot;</span>, responseTime, startTimestamp);</span><br><span class="line">    metricsCollector.recordRequest(requestInfo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> userVo;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> UserVo <span class="title function_">register</span><span class="params">(String telephone, String password)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">startTimestamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="type">UserVo</span> <span class="variable">userVo</span> <span class="operator">=</span> <span class="built_in">super</span>.register(telephone, password);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">endTimeStamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">long</span> <span class="variable">responseTime</span> <span class="operator">=</span> endTimeStamp - startTimestamp;</span><br><span class="line">    <span class="type">RequestInfo</span> <span class="variable">requestInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RequestInfo</span>(<span class="string">&quot;register&quot;</span>, responseTime, startTimestamp);</span><br><span class="line">    metricsCollector.recordRequest(requestInfo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> userVo;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//UserControllerProxy使用举例</span></span><br><span class="line"><span class="type">UserController</span> <span class="variable">userController</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserControllerProxy</span>();  </span><br></pre></td></tr></table></figure></li>
<li><p>dynamic proxy</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricsCollectorProxy</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> MetricsCollector metricsCollector;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">MetricsCollectorProxy</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.metricsCollector = <span class="keyword">new</span> <span class="title class_">MetricsCollector</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">createProxy</span><span class="params">(Object proxiedObject)</span> &#123;</span><br><span class="line">    Class&lt;?&gt;[] interfaces = proxiedObject.getClass().getInterfaces();</span><br><span class="line">    <span class="type">DynamicProxyHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DynamicProxyHandler</span>(proxiedObject);</span><br><span class="line">    <span class="keyword">return</span> Proxy.newProxyInstance(proxiedObject.getClass().getClassLoader(), interfaces, handler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">DynamicProxyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object proxiedObject;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DynamicProxyHandler</span><span class="params">(Object proxiedObject)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.proxiedObject = proxiedObject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">      <span class="type">long</span> <span class="variable">startTimestamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">      <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(proxiedObject, args);</span><br><span class="line">      <span class="type">long</span> <span class="variable">endTimeStamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">      <span class="type">long</span> <span class="variable">responseTime</span> <span class="operator">=</span> endTimeStamp - startTimestamp;</span><br><span class="line">      <span class="type">String</span> <span class="variable">apiName</span> <span class="operator">=</span> proxiedObject.getClass().getName() + <span class="string">&quot;:&quot;</span> + method.getName();</span><br><span class="line">      <span class="type">RequestInfo</span> <span class="variable">requestInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RequestInfo</span>(apiName, responseTime, startTimestamp);</span><br><span class="line">      metricsCollector.recordRequest(requestInfo);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MetricsCollectorProxy使用举例</span></span><br><span class="line"><span class="type">MetricsCollectorProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MetricsCollectorProxy</span>();</span><br><span class="line"><span class="type">IUserController</span> <span class="variable">userController</span> <span class="operator">=</span> (IUserController) proxy.createProxy(<span class="keyword">new</span> <span class="title class_">UserController</span>());  </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="Bridge"><a href="#Bridge" class="headerlink" title="Bridge"></a>Bridge</h4><ul>
<li>组合优于继承，有一个骨架代码，业务逻辑委派给具体的library。例如JDBC委派给MySQL Driver<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MsgSender</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TelephoneMsgSender</span> <span class="keyword">implements</span> <span class="title class_">MsgSender</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> List&lt;String&gt; telephones;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">TelephoneMsgSender</span><span class="params">(List&lt;String&gt; telephones)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.telephones = telephones;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailMsgSender</span> <span class="keyword">implements</span> <span class="title class_">MsgSender</span> &#123;</span><br><span class="line">  <span class="comment">// 与TelephoneMsgSender代码结构类似，所以省略...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMsgSender</span> <span class="keyword">implements</span> <span class="title class_">MsgSender</span> &#123;</span><br><span class="line">  <span class="comment">// 与TelephoneMsgSender代码结构类似，所以省略...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">  <span class="keyword">protected</span> MsgSender msgSender;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Notification</span><span class="params">(MsgSender msgSender)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.msgSender = msgSender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SevereNotification</span> <span class="keyword">extends</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">SevereNotification</span><span class="params">(MsgSender msgSender)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(msgSender);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    msgSender.send(message);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UrgencyNotification</span> <span class="keyword">extends</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">  <span class="comment">// 与SevereNotification代码结构类似，所以省略...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NormalNotification</span> <span class="keyword">extends</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">  <span class="comment">// 与SevereNotification代码结构类似，所以省略...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrivialNotification</span> <span class="keyword">extends</span> <span class="title class_">Notification</span> &#123;</span><br><span class="line">  <span class="comment">// 与SevereNotification代码结构类似，所以省略...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h4><ul>
<li>组合关系；装饰器类和原始类继承同样的父类，这样我们可以对原始类嵌套多个装饰器类；附加的是跟原始类相关的增强功能<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// 代理模式的代码结构(下面的接口也可以替换成抽象类)</span><br><span class="line">public interface IA &#123;</span><br><span class="line">  void f();</span><br><span class="line">&#125;</span><br><span class="line">public class A impelements IA &#123;</span><br><span class="line">  public void f() &#123; //... &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class AProxy implements IA &#123;</span><br><span class="line">  private IA a;</span><br><span class="line">  public AProxy(IA a) &#123;</span><br><span class="line">    this.a = a;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public void f() &#123;</span><br><span class="line">    // 新添加的代理逻辑</span><br><span class="line">    a.f();</span><br><span class="line">    // 新添加的代理逻辑</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 装饰器模式的代码结构(下面的接口也可以替换成抽象类)</span><br><span class="line">public interface IA &#123;</span><br><span class="line">  void f();</span><br><span class="line">&#125;</span><br><span class="line">public class A implements IA &#123;</span><br><span class="line">  public void f() &#123; //... &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class ADecorator implements IA &#123;</span><br><span class="line">  private IA a;</span><br><span class="line">  public ADecorator(IA a) &#123;</span><br><span class="line">    this.a = a;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public void f() &#123;</span><br><span class="line">    // 功能增强代码</span><br><span class="line">    a.f();</span><br><span class="line">    // 功能增强代码</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h4><ul>
<li><p>它将不兼容的接口转换为可兼容的接口。类适配器使用继承关系来实现，对象适配器使用组合关系来实现</p>
<ul>
<li>统一多个类的接口设计<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ASensitiveWordsFilter</span> &#123; <span class="comment">// A敏感词过滤系统提供的接口</span></span><br><span class="line">  <span class="comment">//text是原始文本，函数输出用***替换敏感词之后的文本</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">filterSexyWords</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">filterPoliticalWords</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BSensitiveWordsFilter</span>  &#123; <span class="comment">// B敏感词过滤系统提供的接口</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">filter</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CSensitiveWordsFilter</span> &#123; <span class="comment">// C敏感词过滤系统提供的接口</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">filter</span><span class="params">(String text, String mask)</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 未使用适配器模式之前的代码：代码的可测试性、扩展性不好</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RiskManagement</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">ASensitiveWordsFilter</span> <span class="variable">aFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ASensitiveWordsFilter</span>();</span><br><span class="line">  <span class="keyword">private</span> <span class="type">BSensitiveWordsFilter</span> <span class="variable">bFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BSensitiveWordsFilter</span>();</span><br><span class="line">  <span class="keyword">private</span> <span class="type">CSensitiveWordsFilter</span> <span class="variable">cFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CSensitiveWordsFilter</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">filterSensitiveWords</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">maskedText</span> <span class="operator">=</span> aFilter.filterSexyWords(text);</span><br><span class="line">    maskedText = aFilter.filterPoliticalWords(maskedText);</span><br><span class="line">    maskedText = bFilter.filter(maskedText);</span><br><span class="line">    maskedText = cFilter.filter(maskedText, <span class="string">&quot;***&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> maskedText;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用适配器模式进行改造</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ISensitiveWordsFilter</span> &#123; <span class="comment">// 统一接口定义</span></span><br><span class="line">  String <span class="title function_">filter</span><span class="params">(String text)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ASensitiveWordsFilterAdaptor</span> <span class="keyword">implements</span> <span class="title class_">ISensitiveWordsFilter</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> ASensitiveWordsFilter aFilter;</span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">filter</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">maskedText</span> <span class="operator">=</span> aFilter.filterSexyWords(text);</span><br><span class="line">    maskedText = aFilter.filterPoliticalWords(maskedText);</span><br><span class="line">    <span class="keyword">return</span> maskedText;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...省略BSensitiveWordsFilterAdaptor、CSensitiveWordsFilterAdaptor...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展性更好，更加符合开闭原则，如果添加一个新的敏感词过滤系统，</span></span><br><span class="line"><span class="comment">// 这个类完全不需要改动；而且基于接口而非实现编程，代码的可测试性更好。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RiskManagement</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> List&lt;ISensitiveWordsFilter&gt; filters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSensitiveWordsFilter</span><span class="params">(ISensitiveWordsFilter filter)</span> &#123;</span><br><span class="line">    filters.add(filter);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">filterSensitiveWords</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">maskedText</span> <span class="operator">=</span> text;</span><br><span class="line">    <span class="keyword">for</span> (ISensitiveWordsFilter filter : filters) &#123;</span><br><span class="line">      maskedText = filter.filter(maskedText);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maskedText;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure></li>
<li>假设我们依赖的外部系统在接口设计方面有缺陷（比如包含大量静态方法），引入之后会影响到我们自身代码的可测试性。为了隔离设计上的缺陷，我们希望对外部系统提供的接口进行二次封装，抽象出更好的接口设计，这个时候就可以使用适配器模式了。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class CD &#123; //这个类来自外部sdk，我们无权修改它的代码</span><br><span class="line">  //...</span><br><span class="line">  public static void staticFunction1() &#123; //... &#125;</span><br><span class="line"></span><br><span class="line">  public void uglyNamingFunction2() &#123; //... &#125;</span><br><span class="line"></span><br><span class="line">  public void tooManyParamsFunction3(int paramA, int paramB, ...) &#123; //... &#125;</span><br><span class="line"></span><br><span class="line">   public void lowPerformanceFunction4() &#123; //... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 使用适配器模式进行重构</span><br><span class="line">public interface ITarget &#123;</span><br><span class="line">  void function1();</span><br><span class="line">  void function2();</span><br><span class="line">  void fucntion3(ParamsWrapperDefinition paramsWrapper);</span><br><span class="line">  void function4();</span><br><span class="line">  //...</span><br><span class="line">&#125;</span><br><span class="line">// 注意：适配器类的命名不一定非得末尾带Adaptor</span><br><span class="line">public class CDAdaptor extends CD implements ITarget &#123;</span><br><span class="line">  //...</span><br><span class="line">  public void function1() &#123;</span><br><span class="line">     super.staticFunction1();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public void function2() &#123;</span><br><span class="line">    super.uglyNamingFucntion2();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public void function3(ParamsWrapperDefinition paramsWrapper) &#123;</span><br><span class="line">     super.tooManyParamsFunction3(paramsWrapper.getParamA(), ...);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public void function4() &#123;</span><br><span class="line">    //...reimplement it...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>替换依赖的外部系统<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// 外部系统A</span><br><span class="line">public interface IA &#123;</span><br><span class="line">  //...</span><br><span class="line">  void fa();</span><br><span class="line">&#125;</span><br><span class="line">public class A implements IA &#123;</span><br><span class="line">  //...</span><br><span class="line">  public void fa() &#123; //... &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 在我们的项目中，外部系统A的使用示例</span><br><span class="line">public class Demo &#123;</span><br><span class="line">  private IA a;</span><br><span class="line">  public Demo(IA a) &#123;</span><br><span class="line">    this.a = a;</span><br><span class="line">  &#125;</span><br><span class="line">  //...</span><br><span class="line">&#125;</span><br><span class="line">Demo d = new Demo(new A());</span><br><span class="line"></span><br><span class="line">// 将外部系统A替换成外部系统B</span><br><span class="line">public class BAdaptor implemnts IA &#123;</span><br><span class="line">  private B b;</span><br><span class="line">  public BAdaptor(B b) &#123;</span><br><span class="line">    this.b= b;</span><br><span class="line">  &#125;</span><br><span class="line">  public void fa() &#123;</span><br><span class="line">    //...</span><br><span class="line">    b.fb();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 借助BAdaptor，Demo的代码中，调用IA接口的地方都无需改动，</span><br><span class="line">// 只需要将BAdaptor如下注入到Demo即可。</span><br><span class="line">Demo d = new Demo(new BAdaptor(new B()));</span><br></pre></td></tr></table></figure></li>
<li>在做版本升级的时候，对于一些要废弃的接口，我们不直接将其删除，而是暂时保留，并且标注为 deprecated，并将内部实现逻辑委托为新的接口实现。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Collections</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Emueration <span class="title function_">emumeration</span><span class="params">(<span class="keyword">final</span> Collection c)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Enumeration</span>() &#123;</span><br><span class="line">      <span class="type">Iterator</span> <span class="variable">i</span> <span class="operator">=</span> c.iterator();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasMoreElments</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> i.hashNext();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> Object <span class="title function_">nextElement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> i.next():</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure></li>
<li>适配不同格式的数据<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">      <span class="type">List</span> <span class="variable">stooges</span> <span class="operator">=</span> Arrays.asList(<span class="string">&quot;Larry&quot;</span>, <span class="string">&quot;Moe&quot;</span>, <span class="string">&quot;Curly&quot;</span>);</span><br><span class="line">    ```  </span><br><span class="line">* 如果 Adaptee 接口并不多，那两种实现方式都可以。</span><br><span class="line">* 如果 Adaptee 接口很多，而且 Adaptee 和 ITarget 接口定义大部分都相同，那我们推荐使用类适配器，因为 Adaptor 复用父类 Adaptee 的接口，比起对象适配器的实现方式，Adaptor 的代码量要少一些。</span><br><span class="line">* 如果 Adaptee 接口很多，而且 Adaptee 和 ITarget 接口定义大部分都不相同，那我们推荐使用对象适配器，因为组合结构相对于继承更加灵活。</span><br></pre></td></tr></table></figure>
&#x2F;&#x2F; 类适配器: 基于继承<br>public interface ITarget {<br>void f1();<br>void f2();<br>void fc();<br>}</li>
</ul>
<p>public class Adaptee {<br>  public void fa() { &#x2F;&#x2F;… }<br>  public void fb() { &#x2F;&#x2F;… }<br>  public void fc() { &#x2F;&#x2F;… }<br>}</p>
<p>public class Adaptor extends Adaptee implements ITarget {<br>  public void f1() {<br>    super.fa();<br>  }</p>
<p>  public void f2() {<br>    &#x2F;&#x2F;…重新实现f2()…<br>  }</p>
<p>  &#x2F;&#x2F; 这里fc()不需要实现，直接继承自Adaptee，这是跟对象适配器最大的不同点<br>}</p>
<p>&#x2F;&#x2F; 对象适配器：基于组合<br>public interface ITarget {<br>  void f1();<br>  void f2();<br>  void fc();<br>}</p>
<p>public class Adaptee {<br>  public void fa() { &#x2F;&#x2F;… }<br>  public void fb() { &#x2F;&#x2F;… }<br>  public void fc() { &#x2F;&#x2F;… }<br>}</p>
<p>public class Adaptor implements ITarget {<br>  private Adaptee adaptee;</p>
<p>  public Adaptor(Adaptee adaptee) {<br>    this.adaptee &#x3D; adaptee;<br>  }</p>
<p>  public void f1() {<br>    adaptee.fa(); &#x2F;&#x2F;委托给Adaptee<br>  }</p>
<p>  public void f2() {<br>    &#x2F;&#x2F;…重新实现f2()…<br>  }</p>
<p>  public void fc() {<br>    adaptee.fc();<br>  }<br>}</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### Design Pattern: Behavior</span><br><span class="line">* 类或对象之间的交互</span><br><span class="line">#### Observer</span><br><span class="line">* Define a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically</span><br><span class="line">```java</span><br><span class="line"></span><br><span class="line">public interface Subject &#123;</span><br><span class="line">  void registerObserver(Observer observer);</span><br><span class="line">  void removeObserver(Observer observer);</span><br><span class="line">  void notifyObservers(Message message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public interface Observer &#123;</span><br><span class="line">  void update(Message message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ConcreteSubject implements Subject &#123;</span><br><span class="line">  private List&lt;Observer&gt; observers = new ArrayList&lt;Observer&gt;();</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void registerObserver(Observer observer) &#123;</span><br><span class="line">    observers.add(observer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void removeObserver(Observer observer) &#123;</span><br><span class="line">    observers.remove(observer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void notifyObservers(Message message) &#123;</span><br><span class="line">    for (Observer observer : observers) &#123;</span><br><span class="line">      observer.update(message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ConcreteObserverOne implements Observer &#123;</span><br><span class="line">  @Override</span><br><span class="line">  public void update(Message message) &#123;</span><br><span class="line">    //TODO: 获取消息通知，执行自己的逻辑...</span><br><span class="line">    System.out.println(&quot;ConcreteObserverOne is notified.&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ConcreteObserverTwo implements Observer &#123;</span><br><span class="line">  @Override</span><br><span class="line">  public void update(Message message) &#123;</span><br><span class="line">    //TODO: 获取消息通知，执行自己的逻辑...</span><br><span class="line">    System.out.println(&quot;ConcreteObserverTwo is notified.&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Demo &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    ConcreteSubject subject = new ConcreteSubject();</span><br><span class="line">    subject.registerObserver(new ConcreteObserverOne());</span><br><span class="line">    subject.registerObserver(new ConcreteObserverTwo());</span><br><span class="line">    subject.notifyObservers(new Message());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h3><ul>
<li>naming consistency  </li>
<li>sorting<ul>
<li>sort imported packaging alphabetically</li>
<li>static to normal</li>
<li>high level to low level</li>
<li>public, protected, private</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/05/08/Redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/08/Redis/" class="post-title-link" itemprop="url">Redis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-05-08 11:49:20 / Modified: 14:33:14" itemprop="dateCreated datePublished" datetime="2022-05-08T11:49:20-04:00">2022-05-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><ul>
<li>daemonize yes</li>
<li>port: change 6379 to other</li>
<li>logfile: change to “redis.log”</li>
<li>requirepass foobared &#x2F;&#x2F; foobared is the password</li>
<li>protected-mode no &#x2F;&#x2F;allow remote access</li>
<li>databases</li>
<li>bind 0.0.0.0 &#x2F;&#x2F; means allow a computer with any IP to access. Usually should use the IP of the server rather than 0.0.0.0</li>
</ul>
<h2 id="redis-cli"><a href="#redis-cli" class="headerlink" title="redis-cli"></a>redis-cli</h2><ul>
<li>netstat - tulpn | grep redis</li>
<li>redis-cli -p 6380</li>
<li>auth foobared</li>
<li>ping</li>
<li>exit</li>
<li>shutdown</li>
<li>select 0 &#x2F;&#x2F; select database No. 0</li>
<li>set name lily &#x2F;&#x2F; 设置key&#x3D;name,value&#x3D;lily</li>
<li>get hello &#x2F;&#x2F; 获得key&#x3D;hello结果</li>
<li>keys he* &#x2F;&#x2F; 根据Pattern表达式查询符合条件的Key</li>
<li>dbsize &#x2F;&#x2F; 返回key的总数</li>
<li>exists a &#x2F;&#x2F; 检查key&#x3D;a是否存在</li>
<li>del a &#x2F;&#x2F; 删除key&#x3D;a的数据</li>
<li>expire hello 20 &#x2F;&#x2F; 设置key&#x3D;hello 20秒后过期</li>
<li>ttl hello &#x2F;&#x2F; 查看key&#x3D;a的过期剩余时间</li>
<li>keys *</li>
</ul>
<h2 id="Data-Type"><a href="#Data-Type" class="headerlink" title="Data Type"></a>Data Type</h2><ul>
<li>String &#x2F;&#x2F; String最大512mb, 建议单个kv不超过100kb</li>
<li>List</li>
<li>Hash</li>
<li>Set</li>
<li>Zset &#x2F;&#x2F; 有序集合</li>
</ul>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>get: get hello 获得key&#x3D;hello结果<br>set: set hello world 设置key&#x3D;hello,value&#x3D;hello<br>mset: mset hello world java best 一次性设置多个值<br>mget: mget hello java 一次性获取多个值<br>del: del hello 删除key&#x3D;hello<br>incr: incr count key值自增1<br>decr: decr count key值自减1<br>incrby: incrby count 99 自增指定步长<br>decrby: decrby count 99 自减指定步长</p>
<h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>hget: <code>hget emp:1 age</code> 获取hash中key&#x3D;age的值<br>hset: <code>hset emp:1 age 23</code> 设置hash中age&#x3D;23<br>hmset: <code>hmset emp:1 age 30 name kaka</code> 设置hash多个值<br>hmget: <code>hmget emp:1 age name</code> 获取hash多个值<br>hgetall: <code>hgetall emp:1</code> 获取hash所有值<br>hdel: <code>hdel emp:1 age</code> 删除user:1的age<br>hexists: <code>hexists emp:1 name</code> 检查是否存在<br>hlen: <code>hlen emp:1</code> 获取指定长度</p>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><ul>
<li>List列表最大长度为2的32次方-1，可以包含40亿个元素</li>
</ul>
<p>rpush listkey c b a - 右侧插入<br>lpush listkey f e d - 左侧插入<br>rpop listkey - 右侧弹出<br>lpop listkey - 左侧弹出<br>llen listkey - 获取长度<br>lrange listkey 0 2 &#x2F;&#x2F; start at 0, end at 2 (included)<br>lrange listkey 0 -1 &#x2F;&#x2F; These offsets can also be negative numbers indicating offsets starting at the end of the list. For example, -1 is the last element of the list, -2 the penultimate, and so on.</p>
<p>defcba</p>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>smembers set1<br>sadd set1 a<br>sinter set1 set2 &#x2F;&#x2F;交集元素<br>sunion set1 set2 &#x2F;&#x2F; union<br>sdiff set1 set2 &#x2F;&#x2F; in set1 but not in set2</p>
<h3 id="Zset"><a href="#Zset" class="headerlink" title="Zset"></a>Zset</h3><p>zadd zset1 100 a<br>zadd zset1 101 b<br>zrange zset1 0 -1 withscores&#x2F;&#x2F; print a and b and their scores, -1 means all<br>zrangebyscore zset1 100 103</p>
<h2 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.9</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.imooc.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheSample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CacheSample</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.132.144&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Goods&gt; goodsList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Goods&gt;();</span><br><span class="line">            goodsList.add(<span class="keyword">new</span> <span class="title class_">Goods</span>(<span class="number">8818</span>, <span class="string">&quot;红富士苹果&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">3.5f</span>));</span><br><span class="line">            goodsList.add(<span class="keyword">new</span> <span class="title class_">Goods</span>(<span class="number">8819</span>, <span class="string">&quot;进口脐橙&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">5f</span>));</span><br><span class="line">            goodsList.add(<span class="keyword">new</span> <span class="title class_">Goods</span>(<span class="number">8820</span>, <span class="string">&quot;进口香蕉&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">25f</span>));</span><br><span class="line">            jedis.auth(<span class="string">&quot;12345&quot;</span>);</span><br><span class="line">            jedis.select(<span class="number">3</span>);</span><br><span class="line">            <span class="keyword">for</span> (Goods goods : goodsList) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(goods);</span><br><span class="line">                System.out.println(json);</span><br><span class="line">                <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;goods:&quot;</span> + goods.getGoodsId();</span><br><span class="line">                jedis.set(key , json);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CacheSample</span>();</span><br><span class="line">        System.out.printf(<span class="string">&quot;请输入要查询的商品编号：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">goodsId</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in).next();</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.132.144&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            jedis.auth(<span class="string">&quot;12345&quot;</span>);</span><br><span class="line">            jedis.select(<span class="number">3</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;goods:&quot;</span> + goodsId;</span><br><span class="line">            <span class="keyword">if</span>(jedis.exists(key))&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> jedis.get(key);</span><br><span class="line">                System.out.println(json);</span><br><span class="line">                <span class="type">Goods</span> <span class="variable">g</span> <span class="operator">=</span> JSON.parseObject(json, Goods.class);</span><br><span class="line">                System.out.println(g.getGoodsName());</span><br><span class="line">                System.out.println(g.getPrice());</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;您输入的商品编号不存在，请重新输入！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.imooc.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTestor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.132.144&quot;</span> , <span class="number">6379</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis.auth(<span class="string">&quot;12345&quot;</span>);</span><br><span class="line">            jedis.select(<span class="number">2</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Redis连接成功&quot;</span>);</span><br><span class="line">            <span class="comment">//字符串</span></span><br><span class="line">            jedis.set(<span class="string">&quot;sn&quot;</span> , <span class="string">&quot;7781-9938&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sn</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;sn&quot;</span>);</span><br><span class="line">            System.out.println(sn);</span><br><span class="line">            jedis.mset(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;title&quot;</span> , <span class="string">&quot;婴幼儿奶粉&quot;</span> , <span class="string">&quot;num&quot;</span> , <span class="string">&quot;20&quot;</span>&#125;);</span><br><span class="line">            List&lt;String&gt; goods =  jedis.mget(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;sn&quot;</span> , <span class="string">&quot;title&quot;</span> , <span class="string">&quot;num&quot;</span>&#125;);</span><br><span class="line">            System.out.println(goods);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">num</span> <span class="operator">=</span> jedis.incr(<span class="string">&quot;num&quot;</span>);</span><br><span class="line">            System.out.println(num);</span><br><span class="line">            <span class="comment">//Hash</span></span><br><span class="line">            jedis.hset(<span class="string">&quot;student:3312&quot;</span> , <span class="string">&quot;name&quot;</span> , <span class="string">&quot;张晓明&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> jedis.hget(<span class="string">&quot;student:3312&quot;</span> , <span class="string">&quot;name&quot;</span>);</span><br><span class="line">            System.out.println(name);</span><br><span class="line">            Map&lt;String,String&gt; studentMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">            studentMap.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;李兰&quot;</span>);</span><br><span class="line">            studentMap.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;18&quot;</span>);</span><br><span class="line">            studentMap.put(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;3313&quot;</span>);</span><br><span class="line">            jedis.hmset(<span class="string">&quot;student:3313&quot;</span>, studentMap);</span><br><span class="line">            Map&lt;String,String&gt; smap =  jedis.hgetAll(<span class="string">&quot;student:3313&quot;</span>);</span><br><span class="line">            System.out.println(smap);</span><br><span class="line">            <span class="comment">//List</span></span><br><span class="line">            jedis.del(<span class="string">&quot;letter&quot;</span>);</span><br><span class="line">            jedis.rpush(<span class="string">&quot;letter&quot;</span> , <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;d&quot;</span> , <span class="string">&quot;e&quot;</span> , <span class="string">&quot;f&quot;</span>&#125;);</span><br><span class="line">            jedis.lpush(<span class="string">&quot;letter&quot;</span> ,  <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;c&quot;</span> , <span class="string">&quot;b&quot;</span> , <span class="string">&quot;a&quot;</span>&#125;);</span><br><span class="line">            List&lt;String&gt; letter =  jedis.lrange(<span class="string">&quot;letter&quot;</span> , <span class="number">0</span> , -<span class="number">1</span>);</span><br><span class="line">            jedis.lpop(<span class="string">&quot;letter&quot;</span>);</span><br><span class="line">            jedis.rpop(<span class="string">&quot;letter&quot;</span>);</span><br><span class="line">            letter = jedis.lrange(<span class="string">&quot;letter&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">            System.out.println(letter);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/05/07/Example-AOP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/07/Example-AOP/" class="post-title-link" itemprop="url">Example - AOP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-05-07 22:57:03 / Modified: 22:57:55" itemprop="dateCreated datePublished" datetime="2022-05-07T22:57:03-04:00">2022-05-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Below is how to use AOP to configure log.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebLogAspect</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(WebLogAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public * co.avasta.abc.controller.*.*(..)))</span><span class="string">&quot;)</span></span><br><span class="line"><span class="string">    public void webLog() &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @Before(&quot;</span>webLog()<span class="string">&quot;)</span></span><br><span class="line"><span class="string">    public void doBefore(JoinPoint joinPoint) &#123;</span></span><br><span class="line"><span class="string">        // log the request</span></span><br><span class="line"><span class="string">        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span></span><br><span class="line"><span class="string">        HttpServletRequest request = attributes.getRequest();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        log.info(&quot;</span>URL: <span class="string">&quot; + request.getRequestURL().toString());</span></span><br><span class="line"><span class="string">        log.info(&quot;</span>HTTP_METHOD: <span class="string">&quot; + request.getMethod());</span></span><br><span class="line"><span class="string">        log.info(&quot;</span>IP: <span class="string">&quot; + request.getRemoteAddr());</span></span><br><span class="line"><span class="string">        log.info(&quot;</span>CLASS_METHOD: <span class="string">&quot; + joinPoint.getSignature().getDeclaringTypeName() + &quot;</span>.<span class="string">&quot; + joinPoint.getSignature().getName());</span></span><br><span class="line"><span class="string">        log.info(&quot;</span>ARGS: <span class="string">&quot; + Arrays.toString(joinPoint.getArgs()));</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @AfterReturning(returning = &quot;</span>res<span class="string">&quot;, pointcut = &quot;</span>webLog()<span class="string">&quot;)</span></span><br><span class="line"><span class="string">    public void doAfterReturning(Object res) throws JsonProcessingException &#123;</span></span><br><span class="line"><span class="string">        // res to JSON</span></span><br><span class="line"><span class="string">        log.info(&quot;</span>RESPONSE:<span class="string">&quot; + new ObjectMapper().writeValueAsString(res));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/04/23/user/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/23/user/" class="post-title-link" itemprop="url">User</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-23 13:13:23 / Modified: 15:00:42" itemprop="dateCreated datePublished" datetime="2022-04-23T13:13:23-04:00">2022-04-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/project/" itemprop="url" rel="index"><span itemprop="name">project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h2><ul>
<li>password<ul>
<li>MD5</li>
<li>salt</li>
</ul>
</li>
<li>redirect to index page<ul>
<li><code>window.location.href = json.redirect_url</code></li>
</ul>
</li>
</ul>
<h2 id="Log-out"><a href="#Log-out" class="headerlink" title="Log out"></a>Log out</h2><ul>
<li>invalidate session</li>
<li>redirect to “&#x2F;login.html”</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/04/22/Spring-MVC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/22/Spring-MVC/" class="post-title-link" itemprop="url">Spring MVC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-22 13:53:00" itemprop="dateCreated datePublished" datetime="2022-04-22T13:53:00-04:00">2022-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-25 00:34:26" itemprop="dateModified" datetime="2022-04-25T00:34:26-04:00">2022-04-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><ul>
<li>Model</li>
<li>View</li>
<li>Controller</li>
</ul>
<h2 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h2><ul>
<li>Maven依赖spring-webmvc</li>
<li>web.xml配置DispatcherServlet<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--DispatchServlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            DispatcherServlet是Spring MVC最核心的对象</span></span><br><span class="line"><span class="comment">            DispatcherServlet用于拦截Http请求,</span></span><br><span class="line"><span class="comment">            并根据请求的URL调用与之对应的Controller方法,来完成Http请求的处理</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--applicationContext.xml--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            在Web应用启动时自动创建Spring IOC容器,</span></span><br><span class="line"><span class="comment">            并初始化DispatcherServlet</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>0<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&quot;/&quot; 代表拦截所有请求--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>formContentFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.FormContentFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>formContentFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>配置applicationContext的mvc标记<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:mv</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">            http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">            http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">            http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">            http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">            http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    context:component-scan 标签作用</span></span><br><span class="line"><span class="comment">    在Spring IOC初始化过程中,自动创建并管理com.ll.springmvc及子包中</span></span><br><span class="line"><span class="comment">    拥有以下注解的对象.</span></span><br><span class="line"><span class="comment">    @Repository</span></span><br><span class="line"><span class="comment">    @Service</span></span><br><span class="line"><span class="comment">    @Controller</span></span><br><span class="line"><span class="comment">    @Component</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ll.springmvc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--启用Spring MVC的注解开发模式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;conversionService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;supportedMediaTypes&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- response.setContentType(&quot;text/html;charset=utf-8&quot;) --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span>text/plain;charset=utf-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span>text/html;charset=utf-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span>application/json;charset=utf-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将图片/JS/CSS等静态资源排除在外,可提高执行效率 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.ll.springmvc.converter.MyDateConverter&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;ViewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;contentType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/html;charset=utf-8&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.ftl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;freemarkerConfig&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateLoaderPath&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/ftl&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;freemarkerSettings&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;defaultEncoding&quot;</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>开发Controller控制器</li>
</ul>
<h2 id="URL-Mapping"><a href="#URL-Mapping" class="headerlink" title="URL Mapping"></a>URL Mapping</h2><ul>
<li><code>@RequestMapping</code></li>
<li><code>@GetMapping</code></li>
<li><code>@PostMapping</code></li>
</ul>
<h2 id="接收请求参数"><a href="#接收请求参数" class="headerlink" title="接收请求参数"></a>接收请求参数</h2><ul>
<li><p>使用Controller方法参数接收</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;/m1&quot; method=&quot;post&quot;&gt;</span><br><span class="line">  &lt;input name=&quot;username&quot;/&gt;</span><br><span class="line">  &lt;input name=&quot;password&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">@PostMapping(&quot;/m1&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String post(String username , Long password)&#123;</span><br><span class="line">  return username + &quot;:&quot; + password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用Java Bean接收数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;/m1&quot; method=&quot;post&quot;&gt;</span><br><span class="line">  &lt;input name=&quot;username&quot;/&gt;</span><br><span class="line">  &lt;input name=&quot;password&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">@PostMapping(&quot;/m1&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String post(User user)&#123;</span><br><span class="line">  return user.getUsername() + &quot;:&quot; + user.getPassword();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>make sure parameter name consistent with “name” in html</li>
</ul>
</li>
<li><p>利用@RequestParam为参数设置默认值</p>
</li>
<li><p>使用Map对象接收请求参数及注意事项: if there are multiple parameters with the same name, will only save the first</p>
</li>
<li><p>复杂内容表单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">用户名:&lt;input name=&quot;username&quot;&gt;</span><br><span class="line">密码: &lt;input name=&quot;password&quot;&gt;</span><br><span class="line">-------------------------------------------</span><br><span class="line">姓名:&lt;input name=&quot;idcard.name&quot;&gt;</span><br><span class="line">身份证:&lt;input name=&quot;idcard.idno&quot;&gt;</span><br><span class="line">过期时间:&lt;input name=&quot;idcard.expire&quot;&gt;</span><br><span class="line"></span><br><span class="line">public class User&#123;</span><br><span class="line">  private String username;</span><br><span class="line">  private String password;</span><br><span class="line">  private IDcard idcard = new IDCard();</span><br><span class="line">  //getter and setter ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class IDcard&#123;</span><br><span class="line">  private String name;</span><br><span class="line">  private String idno;</span><br><span class="line">  private Date expire;</span><br><span class="line">  //getter and setter ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>日期类型转换</p>
<ul>
<li><code>@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</code> on the controller param and the entity field</li>
<li>Converter class and applicationContext.xml<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ll.springmvc.converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyDateConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, Date&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">convert</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">d</span> <span class="operator">=</span> sdf.parse(s);</span><br><span class="line">            <span class="keyword">return</span> d;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.ll.springmvc.converter.MyDateConverter&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h2><ul>
<li>Get请求乱码: server.xml增加URIEncoding属性</li>
<li>Post请求乱码: web.xml配置CharacterEncodingFilter</li>
<li>Response响应乱码 - Spring配置StringHttpMessageConverter</li>
</ul>
<h2 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h2><ul>
<li><code>@ResponseBody</code><ul>
<li>方法被@ResponseBody描述，SpringMVC响应String字符串本身</li>
<li>方法不存在@ResponseBody，则SpringMVC处理String指代的视图</li>
</ul>
</li>
<li>ModelAndView: 默认的View是JSP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/find_user&quot;)</span><br><span class="line">public ModelAndView findUser(Integer userId)&#123;</span><br><span class="line">  //创建对象</span><br><span class="line">  ModelAndView mav = new ModelAndView(&quot;/index.jsp&quot;);</span><br><span class="line">  //调用业务方法产生数据</span><br><span class="line">  User u = userService.findById(userId)</span><br><span class="line">  //将数据(Model)存放到ModelAndView对象中</span><br><span class="line">  mav.addObject(&quot;user&quot; , u);</span><br><span class="line">  return mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;h1&gt;员工信息&lt;/h1&gt;</span><br><span class="line">  &lt;h2&gt;用户名:$&#123;user.username&#125;&lt;/h2&gt;</span><br><span class="line">  &lt;h3&gt;姓名:$&#123;user.name&#125;&lt;/h2&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>mav.addObject()方法设置的属性默认存放在当前请求中</li>
<li>默认ModelAndView使用请求转发(forward)至页面; 重定向使用new ModelAndView(“redirect:&#x2F;index.jsp”)</li>
</ul>
</li>
</ul>
<h2 id="Freemarker"><a href="#Freemarker" class="headerlink" title="Freemarker"></a>Freemarker</h2><ul>
<li>add dependency</li>
<li>configure beans “ViewResolver” and “freemarkerConfig”. Please applicationContext.xml above</li>
</ul>
<h2 id="Inceptor"><a href="#Inceptor" class="headerlink" title="Inceptor"></a>Inceptor</h2><ul>
<li>similer to Filter but different implementations. Inceptor is implemented based on Spring AOP.<h3 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h3></li>
<li>dependency</li>
<li>implements HandlerInceptor<ul>
<li>preHandle</li>
<li>postHandle</li>
<li>afterCompletion: after response data generated</li>
</ul>
</li>
<li>applicationContext.xml<h3 id="Example-用户流量拦截器"><a href="#Example-用户流量拦截器" class="headerlink" title="Example: 用户流量拦截器"></a>Example: 用户流量拦截器</h3></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ll.restful.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccessHistoryInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(AccessHistoryInterceptor.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">log</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        log.append(request.getRemoteAddr());</span><br><span class="line">        log.append(<span class="string">&quot;|&quot;</span>);</span><br><span class="line">        log.append(request.getRequestURL());</span><br><span class="line">        log.append(<span class="string">&quot;|&quot;</span>);</span><br><span class="line">        log.append(request.getHeader(<span class="string">&quot;user-agent&quot;</span>));</span><br><span class="line">        logger.info(log.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">//不filter掉</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>add dependency for logback</li>
<li>logback.xml<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>[%thread] %d %level %logger&#123;10&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- RollingFileAppender creates a log file per day --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;accessHistoryLog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- where to save the log files --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>d:/logs/history.%d.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>[%thread] %d %level %logger&#123;10&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--additivity=&quot;false&quot; means that it will only be saved to the log file rather than printed in console--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.ll.restful.interceptor.AccessHistoryInterceptor&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;accessHistoryLog&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>applicationContext.xml<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/resources/**&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.imooc.restful.interceptor.AccessHistoryInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h2><ul>
<li>handler is a controller or an inceptor<br><img src="/../image/spring-mvc/1.png" alt="Spring MVC Process"></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/04/20/Other-Backend-Topics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/20/Other-Backend-Topics/" class="post-title-link" itemprop="url">Other Backend Topics</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-20 18:49:54 / Modified: 18:57:42" itemprop="dateCreated datePublished" datetime="2022-04-20T18:49:54-04:00">2022-04-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><ul>
<li>a container to install the program and its environment<h3 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h3></li>
<li>镜像类似于Java中的类，而容器就是实例</li>
<li>容器可修改，镜像不可修改</li>
<li>同一个镜像可生成多个容器独立运行，他们之间没有任何干扰<h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3></li>
<li>client提供给用户一个终端，用户输入 Docker 提供的命令来管理本地或远程的服务器<h3 id="Daemon"><a href="#Daemon" class="headerlink" title="Daemon"></a>Daemon</h3></li>
<li>Daemon：服务端守护进程，接收 Client 发送的命令并执行相应的操作<h3 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h3></li>
<li>download images<ul>
<li>docker pull [OPTIONS] NAME[:TAG]</li>
<li>docker images [OPTIONS] [REPOSITORY[:TAG]]</li>
</ul>
</li>
<li>docker run [OPTIONS] IMAGE [COMMAND] [ARG…]</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/04/19/MyBatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/19/MyBatis/" class="post-title-link" itemprop="url">MyBatis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-19 17:12:44" itemprop="dateCreated datePublished" datetime="2022-04-19T17:12:44-04:00">2022-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 18:06:01" itemprop="dateModified" datetime="2022-04-20T18:06:01-04:00">2022-04-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><h3 id="Dependency"><a href="#Dependency" class="headerlink" title="Dependency"></a>Dependency</h3><h3 id="mybatis-config-xml"><a href="#mybatis-config-xml" class="headerlink" title="mybatis-config.xml"></a>mybatis-config.xml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;!-- goods_id ==&gt; goodsId 驼峰命名转换 --&gt;</span><br><span class="line">        &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;!-- 配置SLF4J日志组件 --&gt;</span><br><span class="line">        &lt;setting name=&quot;logImpl&quot; value=&quot;SLF4J&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br><span class="line">    &lt;!--启用Pagehelper分页插件--&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin interceptor=&quot;com.github.pagehelper.PageInterceptor&quot;&gt;</span><br><span class="line">            &lt;!--设置数据库类型--&gt;</span><br><span class="line">            &lt;property name=&quot;helperDialect&quot; value=&quot;mysql&quot;/&gt;</span><br><span class="line">            &lt;!--分页合理化--&gt;</span><br><span class="line">            &lt;property name=&quot;reasonable&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--设置默认指向的数据库--&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;!--配置环境，不同的环境不同的id名字--&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;!-- 采用JDBC方式对数据库事务进行commit/rollback --&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;&gt;&lt;/transactionManager&gt;</span><br><span class="line">            &lt;!--采用连接池方式管理数据库连接--&gt;</span><br><span class="line">            &lt;!--&lt;dataSource type=&quot;POOLED&quot;&gt;--&gt;</span><br><span class="line">            &lt;dataSource type=&quot;com.ll.mybatis.datasource.C3P0DataSourceFactory&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/babytun?useUnicode=true&amp;amp;characterEncoding=UTF-8&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;user&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;initialPoolSize&quot; value=&quot;5&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;maxPoolSize&quot; value=&quot;20&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;minPoolSize&quot; value=&quot;5&quot;/&gt;</span><br><span class="line">                &lt;!--...--&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">        &lt;environment id=&quot;prd&quot;&gt;</span><br><span class="line">            &lt;!-- 采用JDBC方式对数据库事务进行commit/rollback --&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;&gt;&lt;/transactionManager&gt;</span><br><span class="line">            &lt;!--采用连接池方式管理数据库连接--&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://192.168.1.155:3306/babytun?useUnicode=true&amp;amp;characterEncoding=UTF-8&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line"></span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;mappers/goods.xml&quot;/&gt;</span><br><span class="line">        &lt;mapper resource=&quot;mappers/goods_detail.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h3><h3 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;goods&quot;&gt;</span><br><span class="line">    &lt;!--开启了二级缓存</span><br><span class="line">        eviction是缓存的清除策略,当缓存对象数量达到上限后,自动触发对应算法对缓存对象清除</span><br><span class="line">            1.LRU – 最近最久未使用:移除最长时间不被使用的对象。</span><br><span class="line">            O1 O2 O3 O4 .. O512</span><br><span class="line">            14 99 83 1     893</span><br><span class="line">            2.FIFO – 先进先出:按对象进入缓存的顺序来移除它们。</span><br><span class="line">            3.SOFT – 软引用:移除基于垃圾收集器状态和软引用规则的对象。</span><br><span class="line">            4.WEAK – 弱引用:更积极的移除基于垃圾收集器状态和弱引用规则的对象。</span><br><span class="line">        flushInterval 间隔多久自动清空缓存，单位毫秒</span><br><span class="line">        size 保存对象或集合（1个集合算一个对象）的上限</span><br><span class="line">        readOnly true代表从缓存取出对象本身，false代表从缓存取出对象的副本</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;cache eviction=&quot;LRU&quot; flushInterval=&quot;600000&quot; size=&quot;512&quot; readOnly=&quot;true&quot;/&gt;</span><br><span class="line">    &lt;select id=&quot;selectAll&quot; resultType=&quot;com.ll.mybatis.entity.Goods&quot; useCache=&quot;false&quot;&gt;</span><br><span class="line">        select * from t_goods order by goods_id desc limit 10</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;!-- 单参数传递,使用parameterType指定参数的数据类型即可,SQL中#&#123;value&#125;提取参数--&gt;</span><br><span class="line">    &lt;select id=&quot;selectById&quot; parameterType=&quot;Integer&quot; resultType=&quot;com.ll.mybatis.entity.Goods&quot;&gt;</span><br><span class="line">        select * from t_goods where  goods_id = #&#123;value&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 多参数传递时,使用parameterType指定Map接口,SQL中#&#123;key&#125;提取参数 --&gt;</span><br><span class="line">    &lt;select id=&quot;selectByPriceRange&quot; parameterType=&quot;java.util.Map&quot; resultType=&quot;com.ll.mybatis.entity.Goods&quot;&gt;</span><br><span class="line">        select * from t_goods</span><br><span class="line">        where</span><br><span class="line">          current_price between  #&#123;min&#125; and #&#123;max&#125;</span><br><span class="line">        order by current_price</span><br><span class="line">        limit 0,#&#123;limt&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 利用LinkedHashMap保存多表关联结果</span><br><span class="line">        MyBatis会将每一条记录包装为LinkedHashMap对象</span><br><span class="line">        key是字段名  value是字段对应的值 , 字段类型根据表结构进行自动判断</span><br><span class="line">        优点: 易于扩展,易于使用</span><br><span class="line">        缺点: 太过灵活,无法进行编译时检查</span><br><span class="line">     --&gt;</span><br><span class="line">    &lt;select id=&quot;selectGoodsMap&quot; resultType=&quot;java.util.LinkedHashMap&quot; flushCache=&quot;true&quot;&gt;</span><br><span class="line">        select g.* , c.category_name,&#x27;1&#x27; as test from t_goods g , t_category c</span><br><span class="line">        where g.category_id = c.category_id</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--结果映射--&gt;</span><br><span class="line">    &lt;resultMap id=&quot;rmGoods&quot; type=&quot;com.ll.mybatis.dto.GoodsDTO&quot;&gt;</span><br><span class="line">        &lt;!--设置主键字段与属性映射--&gt;</span><br><span class="line">        &lt;id property=&quot;goods.goodsId&quot; column=&quot;goods_id&quot;&gt;&lt;/id&gt;</span><br><span class="line">        &lt;!--设置非主键字段与属性映射--&gt;</span><br><span class="line">        &lt;result property=&quot;goods.title&quot; column=&quot;title&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;goods.originalCost&quot; column=&quot;original_cost&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;goods.currentPrice&quot; column=&quot;current_price&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;goods.discount&quot; column=&quot;discount&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;goods.isFreeDelivery&quot; column=&quot;is_free_delivery&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;goods.categoryId&quot; column=&quot;category_id&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;category.categoryId&quot; column=&quot;category_id&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;category.categoryName&quot; column=&quot;category_name&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;category.parentId&quot; column=&quot;parent_id&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;category.categoryLevel&quot; column=&quot;category_level&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;category.categoryOrder&quot; column=&quot;category_order&quot;&gt;&lt;/result&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;result property=&quot;test&quot; column=&quot;test&quot;/&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;select id=&quot;selectGoodsDTO&quot; resultMap=&quot;rmGoods&quot;&gt;</span><br><span class="line">        select g.* , c.*,&#x27;1&#x27; as test from t_goods g , t_category c</span><br><span class="line">        where g.category_id = c.category_id</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;!--flushCache=&quot;true&quot;在sql执行后强制清空缓存--&gt;</span><br><span class="line">    &lt;insert id=&quot;insert&quot; parameterType=&quot;com.ll.mybatis.entity.Goods&quot; flushCache=&quot;true&quot;&gt;</span><br><span class="line">        INSERT INTO t_goods(title, sub_title, original_cost, current_price, discount, is_free_delivery, category_id)</span><br><span class="line">        VALUES (#&#123;title&#125; , #&#123;subTitle&#125; , #&#123;originalCost&#125;, #&#123;currentPrice&#125;, #&#123;discount&#125;, #&#123;isFreeDelivery&#125;, #&#123;categoryId&#125;)</span><br><span class="line">      &lt;!--&lt;selectKey resultType=&quot;Integer&quot; keyProperty=&quot;goodsId&quot; order=&quot;AFTER&quot;&gt;--&gt;</span><br><span class="line">          &lt;!--select last_insert_id()--&gt;</span><br><span class="line">      &lt;!--&lt;/selectKey&gt;--&gt;</span><br><span class="line">      &lt;!--selectKey applies to all relational databases; useGeneratedKeys applies to databases that support auto increment PK--&gt;</span><br><span class="line">      &lt;!--Oracle: doesn&#x27;t have auto increment PK--&gt;</span><br><span class="line">      &lt;!--&lt;selectKey resultType=&quot;Integer&quot; keyProperty=&quot;goodsId&quot; order=&quot;BEFORE&quot;&gt;--&gt;</span><br><span class="line">          &lt;!--select seq_goods.nextval as id from dual--&gt;</span><br><span class="line">      &lt;!--&lt;/selectKey&gt;--&gt;</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;update id=&quot;update&quot; parameterType=&quot;com.ll.mybatis.entity.Goods&quot;&gt;</span><br><span class="line">        UPDATE t_goods</span><br><span class="line">        SET</span><br><span class="line">          title = #&#123;title&#125; ,</span><br><span class="line">          sub_title = #&#123;subTitle&#125; ,</span><br><span class="line">          original_cost = #&#123;originalCost&#125; ,</span><br><span class="line">          current_price = #&#123;currentPrice&#125; ,</span><br><span class="line">          discount = #&#123;discount&#125; ,</span><br><span class="line">          is_free_delivery = #&#123;isFreeDelivery&#125; ,</span><br><span class="line">          category_id = #&#123;categoryId&#125;</span><br><span class="line">        WHERE</span><br><span class="line">          goods_id = #&#123;goodsId&#125;</span><br><span class="line">    &lt;/update&gt;</span><br><span class="line">    &lt;!--delete from t_goods where goods_id in (1920,1921)--&gt;</span><br><span class="line">    &lt;delete id=&quot;delete&quot; parameterType=&quot;Integer&quot;&gt;</span><br><span class="line">        delete from t_goods where goods_id = #&#123;value&#125;</span><br><span class="line">    &lt;/delete&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;selectByTitle&quot; parameterType=&quot;java.util.Map&quot; resultType=&quot;com.ll.mybatis.entity.Goods&quot;&gt;</span><br><span class="line">        select * from t_goods where title = #&#123;title&#125;</span><br><span class="line">        $&#123;order&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;dynamicSQL&quot; parameterType=&quot;java.util.Map&quot; resultType=&quot;com.ll.mybatis.entity.Goods&quot;&gt;</span><br><span class="line">        select * from t_goods</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">          &lt;if test=&quot;categoryId != null&quot;&gt;</span><br><span class="line">              and category_id = #&#123;categoryId&#125;</span><br><span class="line">          &lt;/if&gt;</span><br><span class="line">          &lt;if test=&quot;currentPrice != null&quot;&gt;</span><br><span class="line">              and current_price &amp;lt; #&#123;currentPrice&#125;</span><br><span class="line">          &lt;/if&gt;</span><br><span class="line">        &lt;/where&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">        resultMap可用于说明一对多或者多对一的映射逻辑</span><br><span class="line">        id 是resultMap属性引用的标志</span><br><span class="line">        type 指向One的实体(Goods)</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;resultMap id=&quot;rmGoods1&quot; type=&quot;com.ll.mybatis.entity.Goods&quot;&gt;</span><br><span class="line">        &lt;!-- 映射goods对象的主键到goods_id字段 --&gt;</span><br><span class="line">        &lt;id column=&quot;goods_id&quot; property=&quot;goodsId&quot;&gt;&lt;/id&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">            collection的含义是,在</span><br><span class="line">            select * from t_goods limit 0,1 得到结果后,对所有Goods对象遍历得到goods_id字段值,</span><br><span class="line">            并代入到goodsDetail命名空间的findByGoodsId的SQL中执行查询,</span><br><span class="line">            将得到的&quot;商品详情&quot;集合赋值给goodsDetails List对象.</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;collection property=&quot;goodsDetails&quot; select=&quot;goodsDetail.selectByGoodsId&quot;</span><br><span class="line">                    column=&quot;goods_id&quot;/&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;select id=&quot;selectOneToMany&quot; resultMap=&quot;rmGoods1&quot;&gt;</span><br><span class="line">        select * from t_goods limit 0,10</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;selectPage&quot; resultType=&quot;com.ll.mybatis.entity.Goods&quot;&gt;</span><br><span class="line">        select * from t_goods where current_price &amp;lt; 1000</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--INSERT INTO table--&gt;</span><br><span class="line">    &lt;!--VALUES (&quot;a&quot; , &quot;a1&quot; , &quot;a2&quot;),(&quot;b&quot; , &quot;b1&quot; , &quot;b2&quot;),(....)--&gt;</span><br><span class="line">    &lt;!--Pro: faster than inserting one. --&gt;</span><br><span class="line">    &lt;!--limitation: 1. cannot get the id of the inserted row. 2. If the SQL query is too long, the server may reject it. Need stress test. --&gt;</span><br><span class="line">    &lt;insert id=&quot;batchInsert&quot; parameterType=&quot;java.util.List&quot;&gt;</span><br><span class="line">        INSERT INTO t_goods(title, sub_title, original_cost, current_price, discount, is_free_delivery, category_id)</span><br><span class="line">        VALUES</span><br><span class="line">        &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; index=&quot;index&quot; separator=&quot;,&quot;&gt;</span><br><span class="line">            (#&#123;item.title&#125;,#&#123;item.subTitle&#125;, #&#123;item.originalCost&#125;, #&#123;item.currentPrice&#125;, #&#123;item.discount&#125;, #&#123;item.isFreeDelivery&#125;, #&#123;item.categoryId&#125;)</span><br><span class="line">        &lt;/foreach&gt;</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">    &lt;!--in (1901,1902)--&gt;</span><br><span class="line">    &lt;delete id=&quot;batchDelete&quot; parameterType=&quot;java.util.List&quot;&gt;</span><br><span class="line">        DELETE FROM t_goods WHERE goods_id in</span><br><span class="line">        &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; index=&quot;index&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;,&quot;&gt;</span><br><span class="line">            #&#123;item&#125;</span><br><span class="line">        &lt;/foreach&gt;</span><br><span class="line">    &lt;/delete&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;goodsDetail&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectByGoodsId&quot; parameterType=&quot;Integer&quot;</span><br><span class="line">            resultType=&quot;com.ll.mybatis.entity.GoodsDetail&quot;&gt;</span><br><span class="line">        select * from t_goods_detail where goods_id = #&#123;value&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;resultMap id=&quot;rmGoodsDetail&quot; type=&quot;com.ll.mybatis.entity.GoodsDetail&quot;&gt;</span><br><span class="line">        &lt;id column=&quot;gd_id&quot; property=&quot;gdId&quot;/&gt;</span><br><span class="line">        &lt;result column=&quot;goods_id&quot; property=&quot;goodsId&quot;/&gt;</span><br><span class="line">        &lt;association property=&quot;goods&quot; select=&quot;goods.selectById&quot; column=&quot;goods_id&quot;&gt;&lt;/association&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;select id=&quot;selectManyToOne&quot; resultMap=&quot;rmGoodsDetail&quot;&gt;</span><br><span class="line">        select * from t_goods_detail limit 0,20</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<h3 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h3><ul>
<li>a Mybatis class used to initialize MyBatis and create SqlSession objects</li>
<li>Singleton</li>
<li>SqlSession uses JDBC<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.ibatis.io.Resources;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.Reader;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * MyBatisUtils工具类,创建全局唯一的SqlSessionFactory对象</span><br><span class="line"> */</span><br><span class="line">public class MyBatisUtils &#123;</span><br><span class="line">    //利用static(静态)属于类不属于对象,且全局唯一</span><br><span class="line">    private static SqlSessionFactory sqlSessionFactory = null;</span><br><span class="line">    //利用静态块在初始化类时实例化sqlSessionFactory</span><br><span class="line">    static &#123;</span><br><span class="line">        Reader reader = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            reader = Resources.getResourceAsReader(&quot;mybatis-config.xml&quot;);</span><br><span class="line">            sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            //初始化错误时,通过抛出异常ExceptionInInitializerError通知调用者</span><br><span class="line">            throw new ExceptionInInitializerError(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * openSession 创建一个新的SqlSession对象</span><br><span class="line">     * @return SqlSession对象</span><br><span class="line">     */</span><br><span class="line">    public static SqlSession openSession()&#123;</span><br><span class="line">        return sqlSessionFactory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 释放一个有效的SqlSession对象</span><br><span class="line">     * @param session 准备释放SqlSession对象</span><br><span class="line">     */</span><br><span class="line">    public static void closeSession(SqlSession session)&#123;</span><br><span class="line">        if(session != null)&#123;</span><br><span class="line">            session.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Manipulate-using-SqlSession"><a href="#Manipulate-using-SqlSession" class="headerlink" title="Manipulate using SqlSession"></a>Manipulate using SqlSession</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br></pre></td><td class="code"><pre><span class="line">package com.ll.mybatis;</span><br><span class="line"></span><br><span class="line">import com.github.pagehelper.Page;</span><br><span class="line">import com.github.pagehelper.PageHelper;</span><br><span class="line">import com.ll.mybatis.dto.GoodsDTO;</span><br><span class="line">import com.ll.mybatis.entity.Goods;</span><br><span class="line">import com.ll.mybatis.entity.GoodsDetail;</span><br><span class="line">import com.ll.mybatis.utils.MyBatisUtils;</span><br><span class="line">import org.apache.ibatis.io.Resources;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.Reader;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">//JUNIT单元测试类</span><br><span class="line">public class MyBatisTestor &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 初始化SqlSessionFactory</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSqlSessionFactory() throws IOException &#123;</span><br><span class="line">        //利用Reader加载classpath下的mybatis-config.xml核心配置文件</span><br><span class="line">        Reader reader = Resources.getResourceAsReader(&quot;mybatis-config.xml&quot;);</span><br><span class="line">        //初始化SqlSessionFactory对象,同时解析mybatis-config.xml文件</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);</span><br><span class="line">        System.out.println(&quot;SessionFactory加载成功&quot;);</span><br><span class="line">        SqlSession sqlSession = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            //创建SqlSession对象,SqlSession是JDBC的扩展类,用于与数据库交互</span><br><span class="line">            sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">            //创建数据库连接(测试用)</span><br><span class="line">            Connection connection = sqlSession.getConnection();</span><br><span class="line">            System.out.println(connection);</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (sqlSession != null)&#123;</span><br><span class="line">                //如果type=&quot;POOLED&quot;,代表使用连接池,close则是将连接回收到连接池中</span><br><span class="line">                //如果type=&quot;UNPOOLED&quot;,代表直连,close则会调用Connection.close()方法关闭连接</span><br><span class="line">                sqlSession.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * MyBatisUtils使用指南</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMyBatisUtils() throws Exception &#123;</span><br><span class="line">        SqlSession sqlSession = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            sqlSession = MyBatisUtils.openSession();</span><br><span class="line">            Connection connection = sqlSession.getConnection();</span><br><span class="line">            System.out.println(connection);</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(sqlSession);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * select查询语句执行</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectAll() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            List&lt;Goods&gt; list = session.selectList(&quot;goods.selectAll&quot;);</span><br><span class="line">            for(Goods g : list)&#123;</span><br><span class="line">                System.out.println(g.getTitle());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 传递单个SQL参数</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectById() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try&#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Goods goods = session.selectOne(&quot;goods.selectById&quot; , 1603);</span><br><span class="line">            System.out.println(goods.getTitle());</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 传递多个SQL参数</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectByPriceRange() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try&#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Map param = new HashMap();</span><br><span class="line">            param.put(&quot;min&quot;,100);</span><br><span class="line">            param.put(&quot;max&quot; , 500);</span><br><span class="line">            param.put(&quot;limt&quot; , 10);</span><br><span class="line">            List&lt;Goods&gt; list = session.selectList(&quot;goods.selectByPriceRange&quot;, param);</span><br><span class="line">            for(Goods g:list)&#123;</span><br><span class="line">                System.out.println(g.getTitle() + &quot;:&quot; + g.getCurrentPrice());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 利用Map接收关联查询结果</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectGoodsMap() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            List&lt;Map&gt; list = session.selectList(&quot;goods.selectGoodsMap&quot;);</span><br><span class="line">            for(Map map : list)&#123;</span><br><span class="line">                System.out.println(map);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 利用ResultMap进行结果映射</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectGoodsDTO() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            List&lt;GoodsDTO&gt; list = session.selectList(&quot;goods.selectGoodsDTO&quot;);</span><br><span class="line">            for (GoodsDTO g : list) &#123;</span><br><span class="line">                System.out.println(g.getGoods().getTitle());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 新增数据</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testInsert() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Goods goods = new Goods();</span><br><span class="line">            goods.setTitle(&quot;测试商品&quot;);</span><br><span class="line">            goods.setSubTitle(&quot;测试子标题&quot;);</span><br><span class="line">            goods.setOriginalCost(200f);</span><br><span class="line">            goods.setCurrentPrice(100f);</span><br><span class="line">            goods.setDiscount(0.5f);</span><br><span class="line">            goods.setIsFreeDelivery(1);</span><br><span class="line">            goods.setCategoryId(43);</span><br><span class="line">            //insert()方法返回值代表本次成功插入的记录总数</span><br><span class="line">            int num = session.insert(&quot;goods.insert&quot;, goods);</span><br><span class="line">            session.commit();//提交事务数据</span><br><span class="line">            System.out.println(goods.getGoodsId());</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            if(session != null)&#123;</span><br><span class="line">                session.rollback();//回滚事务</span><br><span class="line">            &#125;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 更新数据</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testUpdate() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Goods goods = session.selectOne(&quot;goods.selectById&quot;, 739);</span><br><span class="line">            goods.setTitle(&quot;更新测试商品&quot;);</span><br><span class="line">            int num = session.update(&quot;goods.update&quot; , goods);</span><br><span class="line">            session.commit();//提交事务数据</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            if(session != null)&#123;</span><br><span class="line">                session.rollback();//回滚事务</span><br><span class="line">            &#125;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除数据</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testDelete() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try&#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            int num = session.delete(&quot;goods.delete&quot; , 739);</span><br><span class="line">            session.commit();//提交事务数据</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            if(session != null)&#123;</span><br><span class="line">                session.rollback();//回滚事务</span><br><span class="line">            &#125;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 预防SQL注入</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectByTitle() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Map param = new HashMap();</span><br><span class="line">            /*</span><br><span class="line">                $&#123;&#125;原文传值</span><br><span class="line">                select * from t_goods</span><br><span class="line">                where title = &#x27;&#x27; or 1 =1 or title = &#x27;【德国】爱他美婴幼儿配方奶粉1段800g*2罐 铂金版&#x27;</span><br><span class="line">            */</span><br><span class="line">            /*</span><br><span class="line">               #&#123;&#125;预编译</span><br><span class="line">               select * from t_goods</span><br><span class="line">                where title = &quot;&#x27;&#x27; or 1 =1 or title = &#x27;【德国】爱他美婴幼儿配方奶粉1段800g*2罐 铂金版&#x27;&quot;</span><br><span class="line">            */</span><br><span class="line"></span><br><span class="line">            param.put(&quot;title&quot;,&quot;&#x27;&#x27; or 1=1 or title=&#x27;【德国】爱他美婴幼儿配方奶粉1段800g*2罐 铂金版&#x27;&quot;);</span><br><span class="line">            param.put(&quot;order&quot; , &quot; order by title desc&quot;);</span><br><span class="line">            List&lt;Goods&gt; list = session.selectList(&quot;goods.selectByTitle&quot;, param);</span><br><span class="line">            for(Goods g:list)&#123;</span><br><span class="line">                System.out.println(g.getTitle() + &quot;:&quot; + g.getCurrentPrice());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 动态SQL语句</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testDynamicSQL() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Map param = new HashMap();</span><br><span class="line">            param.put(&quot;categoryId&quot;, 44);</span><br><span class="line">            param.put(&quot;currentPrice&quot;, 500);</span><br><span class="line">            //查询条件</span><br><span class="line">            List&lt;Goods&gt; list = session.selectList(&quot;goods.dynamicSQL&quot;, param);</span><br><span class="line">            for(Goods g:list)&#123;</span><br><span class="line">                System.out.println(g.getTitle() + &quot;:&quot; +</span><br><span class="line">                        g.getCategoryId()  + &quot;:&quot; + g.getCurrentPrice());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试一级缓存</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testLv1Cache() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Goods goods = session.selectOne(&quot;goods.selectById&quot; , 1603);</span><br><span class="line">            Goods goods1 = session.selectOne(&quot;goods.selectById&quot; , 1603);</span><br><span class="line">            System.out.println(goods.hashCode() + &quot;:&quot; + goods1.hashCode());</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Goods goods = session.selectOne(&quot;goods.selectById&quot; , 1603);</span><br><span class="line">            session.commit();//commit提交时对该namespace缓存强制清空</span><br><span class="line">            Goods goods1 = session.selectOne(&quot;goods.selectById&quot; , 1603);</span><br><span class="line">            System.out.println(goods.hashCode() + &quot;:&quot; + goods1.hashCode());</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试二级缓存</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testLv2Cache() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Goods goods = session.selectOne(&quot;goods.selectById&quot; , 1603);</span><br><span class="line">            System.out.println(goods.hashCode());</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Goods goods = session.selectOne(&quot;goods.selectById&quot; , 1603);</span><br><span class="line">            System.out.println(goods.hashCode());</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 一对多对象关联查询</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testOneToMany() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            List&lt;Goods&gt; list = session.selectList(&quot;goods.selectOneToMany&quot;);</span><br><span class="line">            for(Goods goods:list) &#123;</span><br><span class="line">                System.out.println(goods.getTitle() + &quot;:&quot; + goods.getGoodsDetails().size());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试多对一对象关联映射</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testManyToOne() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            List&lt;GoodsDetail&gt; list = session.selectList(&quot;goodsDetail.selectManyToOne&quot;);</span><br><span class="line">            for(GoodsDetail gd:list) &#123;</span><br><span class="line">                System.out.println(gd.getGdPicUrl() + &quot;:&quot; + gd.getGoods().getTitle());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    /**</span><br><span class="line">     * PageHelper分页查询</span><br><span class="line">     */</span><br><span class="line">    public void testSelectPage() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            /*startPage方法会自动将下一次查询进行分页*/</span><br><span class="line">            PageHelper.startPage(2,10);</span><br><span class="line">            Page&lt;Goods&gt; page = (Page) session.selectList(&quot;goods.selectPage&quot;);</span><br><span class="line">            System.out.println(&quot;总页数:&quot; + page.getPages());</span><br><span class="line">            System.out.println(&quot;总记录数:&quot; + page.getTotal());</span><br><span class="line">            System.out.println(&quot;开始行号:&quot; + page.getStartRow());</span><br><span class="line">            System.out.println(&quot;结束行号:&quot; + page.getEndRow());</span><br><span class="line">            System.out.println(&quot;当前页码:&quot; + page.getPageNum());</span><br><span class="line">            List&lt;Goods&gt; data = page.getResult();//当前页数据</span><br><span class="line">            for (Goods g : data) &#123;</span><br><span class="line">                System.out.println(g.getTitle());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;&quot;);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量插入测试</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testBatchInsert() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            long st = new Date().getTime();</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            List list = new ArrayList();</span><br><span class="line">            for (int i = 0; i &lt; 10000; i++) &#123;</span><br><span class="line">                Goods goods = new Goods();</span><br><span class="line">                goods.setTitle(&quot;测试商品&quot;);</span><br><span class="line">                goods.setSubTitle(&quot;测试子标题&quot;);</span><br><span class="line">                goods.setOriginalCost(200f);</span><br><span class="line">                goods.setCurrentPrice(100f);</span><br><span class="line">                goods.setDiscount(0.5f);</span><br><span class="line">                goods.setIsFreeDelivery(1);</span><br><span class="line">                goods.setCategoryId(43);</span><br><span class="line">                //insert()方法返回值代表本次成功插入的记录总数</span><br><span class="line"></span><br><span class="line">                list.add(goods);</span><br><span class="line">            &#125;</span><br><span class="line">            session.insert(&quot;goods.batchInsert&quot;, list);</span><br><span class="line">            session.commit();//提交事务数据</span><br><span class="line">            long et = new Date().getTime();</span><br><span class="line">            System.out.println(&quot;执行时间:&quot; + (et - st) + &quot;毫秒&quot;);</span><br><span class="line">//            System.out.println(goods.getGoodsId());</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            if (session != null) &#123;</span><br><span class="line">                session.rollback();//回滚事务</span><br><span class="line">            &#125;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 10000次数据插入对比测试用例</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testInsert1() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            long st = new Date().getTime();</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            List list = new ArrayList();</span><br><span class="line">            for(int i = 0 ; i &lt; 10000 ; i++) &#123;</span><br><span class="line">                Goods goods = new Goods();</span><br><span class="line">                goods.setTitle(&quot;测试商品&quot;);</span><br><span class="line">                goods.setSubTitle(&quot;测试子标题&quot;);</span><br><span class="line">                goods.setOriginalCost(200f);</span><br><span class="line">                goods.setCurrentPrice(100f);</span><br><span class="line">                goods.setDiscount(0.5f);</span><br><span class="line">                goods.setIsFreeDelivery(1);</span><br><span class="line">                goods.setCategoryId(43);</span><br><span class="line">                //insert()方法返回值代表本次成功插入的记录总数</span><br><span class="line"></span><br><span class="line">                session.insert(&quot;goods.insert&quot; , goods);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            session.commit();//提交事务数据</span><br><span class="line">            long et = new Date().getTime();</span><br><span class="line">            System.out.println(&quot;执行时间:&quot; + (et-st) + &quot;毫秒&quot;);</span><br><span class="line">//            System.out.println(goods.getGoodsId());</span><br><span class="line">        &#125; catch (Exception e)&#123;</span><br><span class="line">            if(session != null)&#123;</span><br><span class="line">                session.rollback();//回滚事务</span><br><span class="line">            &#125;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量删除测试</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testBatchDelete() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            long st = new Date().getTime();</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            List list = new ArrayList();</span><br><span class="line">            list.add(1920);</span><br><span class="line">            list.add(1921);</span><br><span class="line">            list.add(1922);</span><br><span class="line">            session.delete(&quot;goods.batchDelete&quot;, list);</span><br><span class="line">            session.commit();//提交事务数据</span><br><span class="line">            long et = new Date().getTime();</span><br><span class="line">            System.out.println(&quot;执行时间:&quot; + (et - st) + &quot;毫秒&quot;);</span><br><span class="line">//            System.out.println(goods.getGoodsId());</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            if (session != null) &#123;</span><br><span class="line">                session.rollback();//回滚事务</span><br><span class="line">            &#125;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="vs"><a href="#vs" class="headerlink" title="${} vs #{}"></a>${} vs #{}</h2></li>
<li>${}: if use this, cannot allow the front end to input the value. Should use pre-set values to prevent SQL injection.</li>
<li>#{}: precompilation to prevent SQL injection</li>
</ul>
<h2 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>logback.xml<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">   &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">       &lt;encoder&gt;</span><br><span class="line">           &lt;pattern&gt;[%thread] %d&#123;HH:mm:ss.SSS&#125; %-5level %logger&#123;36&#125; - %msg%n&lt;/pattern&gt;</span><br><span class="line">       &lt;/encoder&gt;</span><br><span class="line">   &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">        日志输出级别(优先级高到低):</span><br><span class="line">        error: 错误 - 系统的故障日志</span><br><span class="line">        warn: 警告 - 存在风险或使用不当的日志</span><br><span class="line">        info: 一般性消息 // &quot;info&quot; and above are used in production environtment</span><br><span class="line">        debug: 程序内部用于调试信息 // &quot;debug&quot; and above are used in development environment</span><br><span class="line">        trace: 程序运行的跟踪信息</span><br><span class="line">     --&gt;</span><br><span class="line">    &lt;root level=&quot;debug&quot;&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;console&quot;/&gt;</span><br><span class="line">    &lt;/root&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h2><ul>
<li>一级缓存默认开启,缓存范围SqlSession会话</li>
<li>二级缓存手动开启,属于范围Mapper Namespace</li>
<li>Namespace includes SqlSessions</li>
<li>写操作commit提交时对该namespace或SqlSession缓存强制清空</li>
<li>配置useCache&#x3D;false可以不用缓存</li>
<li>配置flushCache&#x3D;true代表强制清空缓存</li>
</ul>
<h2 id="PageHelper"><a href="#PageHelper" class="headerlink" title="PageHelper"></a>PageHelper</h2><ul>
<li><p>maven引入PageHelper与jsqlparser</p>
</li>
<li><p>mybatis-config.xml增加Plugin配置</p>
</li>
<li><p>代码中使用PageHelper.startPage()自动分页</p>
</li>
<li><p>MySQL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from table limit 10,20;</span><br></pre></td></tr></table></figure></li>
<li><p>Oracle</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select t3.* from (</span><br><span class="line">  select t2.*, rownum as row_num from (</span><br><span class="line">    select * from table order by id asc</span><br><span class="line">  ) t2 where rownum&lt;=20</span><br><span class="line">) t3</span><br><span class="line">where t2.row_num&gt;11</span><br></pre></td></tr></table></figure></li>
<li><p>SQL Server 2000</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select top 3 * from table</span><br><span class="line">where</span><br><span class="line">id not in</span><br><span class="line">(select top 15 id from table)</span><br></pre></td></tr></table></figure></li>
<li><p>SQL Server 2012+</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from table order by id</span><br><span class="line">offset 4 rows fetch next 5 rows only</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="C3P0"><a href="#C3P0" class="headerlink" title="C3P0"></a>C3P0</h2><ul>
<li>dependency</li>
<li>C3P0DataSourceFactory<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.ll.mybatis.datasource;</span><br><span class="line"></span><br><span class="line">import com.mchange.v2.c3p0.ComboPooledDataSource;</span><br><span class="line">import org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * C3P0与MyBatis兼容使用的数据源工厂类</span><br><span class="line"> */</span><br><span class="line">public class C3P0DataSourceFactory extends UnpooledDataSourceFactory &#123;</span><br><span class="line">    public C3P0DataSourceFactory()&#123;</span><br><span class="line">        this.dataSource = new ComboPooledDataSource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>mybatis-config.xml</li>
</ul>
<h2 id="Annotation"><a href="#Annotation" class="headerlink" title="Annotation"></a>Annotation</h2><ul>
<li><code>@Insert</code></li>
<li><code>@Update</code></li>
<li><code>@Delete</code></li>
<li><code>@Select</code></li>
<li><code>@Param</code> 参数映射</li>
<li><code>@Results</code> <resultMap> 结果映射</li>
<li><code>@Result</code><id><result> 字段映射<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package com.ll.mybatis.dao;</span><br><span class="line"></span><br><span class="line">import com.ll.mybatis.dto.GoodsDTO;</span><br><span class="line">import com.ll.mybatis.entity.Goods;</span><br><span class="line">import org.apache.ibatis.annotations.*;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface GoodsDAO &#123;</span><br><span class="line">    @Select(&quot;select * from t_goods where current_price between  #&#123;min&#125; and #&#123;max&#125; order by current_price limit 0,#&#123;limt&#125;&quot;)</span><br><span class="line">    public List&lt;Goods&gt; selectByPriceRange(@Param(&quot;min&quot;) Float min ,@Param(&quot;max&quot;) Float max ,@Param(&quot;limt&quot;) Integer limt);</span><br><span class="line"></span><br><span class="line">    @Insert(&quot;INSERT INTO t_goods(title, sub_title, original_cost, current_price, discount, is_free_delivery, category_id) VALUES (#&#123;title&#125; , #&#123;subTitle&#125; , #&#123;originalCost&#125;, #&#123;currentPrice&#125;, #&#123;discount&#125;, #&#123;isFreeDelivery&#125;, #&#123;categoryId&#125;)&quot;)</span><br><span class="line">    //&lt;selectKey&gt;</span><br><span class="line">    @SelectKey(statement = &quot;select last_insert_id()&quot; , before = false , keyProperty = &quot;goodsId&quot; , resultType = Integer.class)</span><br><span class="line">    public int insert(Goods goods);</span><br><span class="line"></span><br><span class="line">    @Select(&quot;select * from t_goods&quot;)</span><br><span class="line">    //&lt;resultMap&gt;</span><br><span class="line">    @Results(&#123;</span><br><span class="line">            //&lt;id&gt;</span><br><span class="line">          @Result(column = &quot;goods_id&quot; ,property = &quot;goodsId&quot; , id = true) ,</span><br><span class="line">            //&lt;result&gt;</span><br><span class="line">            @Result(column = &quot;title&quot; ,property = &quot;title&quot;),</span><br><span class="line">            @Result(column = &quot;current_price&quot; ,property = &quot;currentPrice&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    public List&lt;GoodsDTO&gt; selectAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;!-- goods_id ==&gt; goodsId 驼峰命名转换 --&gt;</span><br><span class="line">        &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--设置默认指向的数据库--&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;!--配置环境，不同的环境不同的id名字--&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;!-- 采用JDBC方式对数据库事务进行commit/rollback --&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;&gt;&lt;/transactionManager&gt;</span><br><span class="line">            &lt;!--采用连接池方式管理数据库连接--&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/babytun?useUnicode=true&amp;amp;characterEncoding=UTF-8&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;!--&lt;mapper class=&quot;com.ll.mybatis.dao.GoodsDAO&quot;/&gt;--&gt;</span><br><span class="line">        &lt;package name=&quot;com.ll.mybatis.dao&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">package com.ll.mybatis;</span><br><span class="line"></span><br><span class="line">import com.ll.mybatis.dao.GoodsDAO;</span><br><span class="line">import com.ll.mybatis.dto.GoodsDTO;</span><br><span class="line">import com.ll.mybatis.entity.Goods;</span><br><span class="line">import com.ll.mybatis.utils.MyBatisUtils;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">//JUNIT单元测试类</span><br><span class="line">public class MyBatisTestor &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectByPriceRange() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try&#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            GoodsDAO goodsDAO = session.getMapper(GoodsDAO.class);</span><br><span class="line">            List&lt;Goods&gt; list = goodsDAO.selectByPriceRange(100f, 500f, 20);</span><br><span class="line">            System.out.println(list.size());</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 新增数据</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testInsert() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try&#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            Goods goods = new Goods();</span><br><span class="line">            goods.setTitle(&quot;测试商品&quot;);</span><br><span class="line">            goods.setSubTitle(&quot;测试子标题&quot;);</span><br><span class="line">            goods.setOriginalCost(200f);</span><br><span class="line">            goods.setCurrentPrice(100f);</span><br><span class="line">            goods.setDiscount(0.5f);</span><br><span class="line">            goods.setIsFreeDelivery(1);</span><br><span class="line">            goods.setCategoryId(43);</span><br><span class="line">            GoodsDAO goodsDAO = session.getMapper(GoodsDAO.class);</span><br><span class="line">            //insert()方法返回值代表本次成功插入的记录总数</span><br><span class="line">            int num = goodsDAO.insert(goods);</span><br><span class="line">            session.commit();//提交事务数据</span><br><span class="line">            System.out.println(goods.getGoodsId());</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            if(session != null)&#123;</span><br><span class="line">                session.rollback();//回滚事务</span><br><span class="line">            &#125;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectAll() throws Exception &#123;</span><br><span class="line">        SqlSession session = null;</span><br><span class="line">        try&#123;</span><br><span class="line">            session = MyBatisUtils.openSession();</span><br><span class="line">            GoodsDAO goodsDAO = session.getMapper(GoodsDAO.class);</span><br><span class="line">            List&lt;GoodsDTO&gt; list = goodsDAO.selectAll();</span><br><span class="line">            System.out.println(list.size());</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            throw e;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            MyBatisUtils.closeSession(session);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/04/19/jQuery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/19/jQuery/" class="post-title-link" itemprop="url">jQuery</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-19 16:46:32" itemprop="dateCreated datePublished" datetime="2022-04-19T16:46:32-04:00">2022-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-23 00:41:47" itemprop="dateModified" datetime="2022-04-23T00:41:47-04:00">2022-04-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h2><ul>
<li><p>jQuery(选择器表达式)</p>
</li>
<li><p>$(选择器表达式)</p>
</li>
<li><p>“*”: all</p>
</li>
<li><p>$(“#id”)</p>
</li>
<li><p>$(“标签”)</p>
</li>
<li><p>$(“.class”)</p>
</li>
<li><p>$(“S1, S2, SN”): or</p>
</li>
<li><p>$(“ancestor descendant”): 后代</p>
</li>
<li><p>$(“ancestor&gt;descendant”): 子</p>
</li>
<li><p>$(“prev~siblings”): 兄弟</p>
</li>
<li><p>$(“selector[attribute&#x3D;value]”)</p>
</li>
<li><p>$(“selector[attribute^&#x3D;value]”): 以某值开头</p>
</li>
<li><p>$(“selector[attribute$&#x3D;value]”): 以某值结尾</p>
</li>
<li><p>$(“selector[attribute*&#x3D;value]”): 包含某值</p>
</li>
<li><p>$(“selector:first”)</p>
</li>
<li><p>$(“selector:last”)</p>
</li>
<li><p>$(“selector:even”)</p>
</li>
<li><p>$(“selector:odd”)</p>
</li>
<li><p>$(“selector:eq(n)”)</p>
</li>
<li><p>form</p>
<ul>
<li>$(“selector:input”)</li>
<li>$(“selector:text”)</li>
<li>$(“selector:password”)</li>
<li>$(“selector:submit”)</li>
<li>$(“selector:reset”)</li>
</ul>
</li>
<li><p>attr(name|properties|key): 获取或设置元素属性</p>
</li>
<li><p>removeAttr(name)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html &gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;操作元素属性&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.myclass &#123;</span><br><span class="line">	font-style: italic;</span><br><span class="line">	color: darkblue;</span><br><span class="line">&#125;</span><br><span class="line">/* 高亮css类 */</span><br><span class="line">.highlight &#123;</span><br><span class="line">	color: red;</span><br><span class="line">	font-size: 30px;</span><br><span class="line">	background: lightblue;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div class=&quot;section&quot;&gt;</span><br><span class="line">		&lt;h2&gt;jQuery选择器实验室&lt;/h2&gt;</span><br><span class="line">		&lt;input style=&quot;height: 24px&quot; id=&quot;txtSelector&quot; /&gt;</span><br><span class="line">		&lt;button id=&quot;btnSelect&quot; style=&quot;height: 30px&quot;&gt;选择&lt;/button&gt;</span><br><span class="line">		&lt;hr /&gt;</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">			&lt;p id=&quot;welcome&quot;&gt;欢迎来到选择器实验室&lt;/p&gt;</span><br><span class="line">			&lt;ul&gt;</span><br><span class="line">				&lt;li&gt;搜索引擎：&lt;a href=&quot;http://www.baidu.com&quot;&gt;百度&lt;/a&gt; &lt;span&gt; &lt;a</span><br><span class="line">						style=&quot;color: darkgreen&quot; href=&quot;http://www.so.com&quot;&gt;360&lt;/a&gt;</span><br><span class="line">				&lt;/span&gt;</span><br><span class="line">				&lt;/li&gt;</span><br><span class="line">				&lt;li&gt;电子邮箱：&lt;a href=&quot;http://mail.163.com&quot;&gt;网易邮箱&lt;/a&gt; &lt;span&gt; &lt;a</span><br><span class="line">						style=&quot;color: darkgreen&quot; href=&quot;http://mail.qq.com&quot;&gt;QQ邮箱&lt;/a&gt;</span><br><span class="line">				&lt;/span&gt;</span><br><span class="line">				&lt;/li&gt;</span><br><span class="line">				&lt;li&gt;中国名校：&lt;a href=&quot;http://www.tsinghua.edu.cn&quot;&gt;清华大学&lt;/a&gt; &lt;span&gt;</span><br><span class="line">						&lt;a style=&quot;color: darkgreen&quot; href=&quot;https://www.pku.edu.cn/&quot;&gt;北京大学&lt;/a&gt;</span><br><span class="line">				&lt;/span&gt;</span><br><span class="line">				&lt;/li&gt;</span><br><span class="line">			&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">			&lt;span class=&quot;myclass &quot;&gt;我是拥有myclass类的span标签&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">			&lt;p class=&quot;myclass&quot;&gt;我是拥有myclass的p标签&lt;/p&gt;</span><br><span class="line">			&lt;form id=&quot;info&quot; action=&quot;#&quot; method=&quot;get&quot;&gt;</span><br><span class="line">				&lt;div&gt;</span><br><span class="line">					用户名：&lt;input type=&quot;text&quot; name=&quot;uname&quot; value=&quot;admin&quot; /&gt; 密码：&lt;input</span><br><span class="line">						type=&quot;password&quot; name=&quot;upsd&quot; value=&quot;123456&quot; /&gt;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line">				&lt;div&gt;</span><br><span class="line">					婚姻状况： &lt;select id=&quot;marital_status&quot;&gt;</span><br><span class="line">						&lt;option value=&quot;1&quot;&gt;未婚&lt;/option&gt;</span><br><span class="line">						&lt;option value=&quot;2&quot;&gt;已婚&lt;/option&gt;</span><br><span class="line">						&lt;option value=&quot;3&quot;&gt;离异&lt;/option&gt;</span><br><span class="line">						&lt;option value=&quot;4&quot;&gt;丧偶&lt;/option&gt;</span><br><span class="line">					&lt;/select&gt;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line">				&lt;div class=&quot;left clear-left&quot;&gt;</span><br><span class="line">					&lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt; &lt;input type=&quot;reset&quot; value=&quot;重置&quot; /&gt;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">	&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.3.1.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">		var href_attr =  $(&quot;a[href*=&#x27;163&#x27;]&quot;).attr(&quot;href&quot;);</span><br><span class="line">		alert(href_attr);</span><br><span class="line">		$(&quot;a[href*=&#x27;163&#x27;]&quot;).attr(&quot;href&quot; , &quot;http://www.163.com&quot;); // set href to &quot;http://www.163.com&quot;. all items selected will be set</span><br><span class="line">		var attr = $(&quot;a&quot;).attr(&quot;href&quot;); // if multiple items are selected and use =, will assign the first</span><br><span class="line">		alert(attr);</span><br><span class="line">		$(&quot;a&quot;).removeAttr(&quot;href&quot;); // if multiple items are selected, will remove all</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>css(): 获取或设置匹配元素的样式属性</p>
</li>
<li><p>addClass()</p>
</li>
<li><p>removeClass()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">  $(&quot;a&quot;).css(&quot;color&quot; , &quot;red&quot;);</span><br><span class="line">  $(&quot;a&quot;).css(&#123;&quot;color&quot; : &quot;red&quot; , &quot;font-weight&quot; : &quot;bold&quot; , &quot;font-style&quot; : &quot;italic&quot;&#125;);</span><br><span class="line"></span><br><span class="line">  $(&quot;li&quot;).addClass(&quot;highlight myclass&quot;);</span><br><span class="line">  $(&quot;p&quot;).removeClass(&quot;myclass&quot;);</span><br><span class="line">  var color = $(&quot;a&quot;).css(&quot;color&quot;);</span><br><span class="line">  alert(color);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>val()</p>
<ul>
<li>get: <code>$(input[name=&#39;username&#39;]).val()</code></li>
<li>set: <code>$(input[name=&#39;username&#39;]).val(&quot;admin&quot;)</code></li>
</ul>
</li>
<li><p>text(): get or set text of element</p>
</li>
<li><p>html(): get or set html of element</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  $(&quot;input[name=&#x27;uname&#x27;]&quot;).val(&quot;administrator&quot;);</span><br><span class="line">  var v = $(&quot;input[name=&#x27;uname&#x27;]&quot;).val();</span><br><span class="line">  alert(v);</span><br><span class="line">  //text与html方法最大的区别在于对于文本中的html标签是否进行转义</span><br><span class="line">  //$(&quot;span.myclass&quot;).text(&quot;&lt;b&gt;锄禾日当午，汗滴禾下土&lt;/b&gt;&quot;);</span><br><span class="line">  $(&quot;span.myclass&quot;).html(&quot;&lt;b&gt;锄禾日当午，汗滴禾下土&lt;/b&gt;&quot;);</span><br><span class="line"></span><br><span class="line">  var vspan = $(&quot;span.myclass&quot;).text();</span><br><span class="line">  alert(vspan);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>on(“click” , function) - 为选中的页面元素绑定单击事件</p>
</li>
<li><p>click(function) - 是绑定事件的简写形式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">	//onload是指在页面所有资源加载完成后执行</span><br><span class="line">	window.onload = function()&#123;</span><br><span class="line">		//alert(1);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//ready()则是在页面dom被浏览器解释完成后执行</span><br><span class="line">	$(document).ready(function()&#123;</span><br><span class="line">		alert(&quot;页面准备就绪&quot;);</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	//简化形式</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		$(&quot;p.myclass&quot;).on(&quot;click&quot; , function()&#123;</span><br><span class="line">			//this: the element on which the event is called</span><br><span class="line">      //in $(this), we are just passing this as a parameter to jQuery.fn.init()</span><br><span class="line">			$(this).css(&quot;background-color&quot; , &quot;yellow&quot;);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		$(&quot;span.myclass&quot;).click(function()&#123;</span><br><span class="line">			$(this).css(&quot;background-color&quot; , &quot;lightgreen&quot;);</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">		$(&quot;input[name=&#x27;uname&#x27;]&quot;).keypress(function(event)&#123;</span><br><span class="line">			console.log(event);</span><br><span class="line">			if(event.keyCode == 32)&#123;</span><br><span class="line">				$(this).css(&quot;color&quot; , &quot;red&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h2><h3 id="Mouse"><a href="#Mouse" class="headerlink" title="Mouse"></a>Mouse</h3><ul>
<li>click   </li>
<li>dblclick   </li>
<li>mouseenter   </li>
<li>mouseleave  </li>
<li>mouseover<h3 id="Keyboard"><a href="#Keyboard" class="headerlink" title="Keyboard"></a>Keyboard</h3></li>
<li>keypress</li>
<li>keydown</li>
<li>keyup<h3 id="Form"><a href="#Form" class="headerlink" title="Form"></a>Form</h3></li>
<li>submit</li>
<li>change</li>
<li>focus<h3 id="Document-x2F-Window"><a href="#Document-x2F-Window" class="headerlink" title="Document &#x2F; Window"></a>Document &#x2F; Window</h3></li>
<li>load</li>
<li>resize</li>
<li>scroll</li>
<li>unload</li>
</ul>
<h2 id="Ready"><a href="#Ready" class="headerlink" title="Ready"></a>Ready</h2><ul>
<li>$(document).ready(function)</li>
<li>$(function)</li>
</ul>
<h2 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h2><ul>
<li>Asynchronous JavaScript And XML</li>
<li>allow to update some without refreshing<h3 id="Step"><a href="#Step" class="headerlink" title="Step"></a>Step</h3></li>
<li>create XmlHttpReqeust object<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var xmlhttp;</span><br><span class="line">if (window.XMLHttpRequest)</span><br><span class="line">&#123;</span><br><span class="line">// IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码</span><br><span class="line">xmlhttp=new XMLHttpRequest();</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">// IE6, IE5 浏览器执行代码</span><br><span class="line">xmlhttp=new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>send Ajax request<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//创建请求</span><br><span class="line">// false means async</span><br><span class="line">xmlhttp.open(&quot;GET&quot;,&quot;http://localhost/test?name=admin&quot;, true);</span><br><span class="line">//发送到服务器</span><br><span class="line">xmlhttp.send();</span><br></pre></td></tr></table></figure></li>
<li>deals with response<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">xmlhttp.onreadystatechange = function()</span><br><span class="line">&#123;</span><br><span class="line">  //响应已被接收且服务器处理成功时才执行</span><br><span class="line">  if (xmlhttp.readyState == 4 &amp;&amp; xmlhttp.status == 200)</span><br><span class="line">  &#123;</span><br><span class="line">  //获取响应体的文本</span><br><span class="line">  var responseText = xmlhttp.responseText;</span><br><span class="line">  //对服务器结果进行处理</span><br><span class="line">  ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Asynchronous-vs-Synchronous"><a href="#Asynchronous-vs-Synchronous" class="headerlink" title="Asynchronous vs Synchronous"></a>Asynchronous vs Synchronous</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.3.1.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">	//设置ajax的全局默认值</span><br><span class="line">	$.ajaxSetup(&#123;</span><br><span class="line">		&quot;dataType&quot; : &quot;json&quot;,</span><br><span class="line">		&quot;error&quot; : function(xmlhttp)&#123;</span><br><span class="line">			if(xmlhttp.status == &quot;405&quot;)&#123;</span><br><span class="line">				alert(&quot;无效的请求方式&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		/*</span><br><span class="line">			1. url</span><br><span class="line">			2. 要发送的参数，可以是字符串也可以是json</span><br><span class="line">			3. 响应处理函数</span><br><span class="line">			4. dataType(可选) 服务器返回的数据类型(text|json|xml|html|script)</span><br><span class="line"></span><br><span class="line">			$.ajax()</span><br><span class="line">		*/</span><br><span class="line">		$.get(&quot;/ajax/news_list&quot; , &#123;&quot;t&quot; : &quot;tiobe&quot;&#125; , function(json)&#123;</span><br><span class="line">			for(var i = 0 ; i &lt; json.length ; i++)&#123;</span><br><span class="line">				$(&quot;#container&quot;).append(&quot;&lt;h1&gt;&quot; + json[i].title + &quot;&lt;/h1&gt;&quot;)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id=&quot;container&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="jQuery-supports-Ajax"><a href="#jQuery-supports-Ajax" class="headerlink" title="jQuery supports Ajax"></a>jQuery supports Ajax</h2><p>$().ajax(options)</p>
<ul>
<li>url 发送请求地址</li>
<li>type: get | post</li>
<li>data 向服务器传递的参数</li>
<li>dataType: text | json | xml | html | jsonp| script</li>
<li>success 接收响应时的处理函数</li>
<li>error 请求失败时的处理函数<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.3.1.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">	//设置ajax的全局默认值</span><br><span class="line">	$.ajaxSetup(&#123;</span><br><span class="line">		&quot;dataType&quot; : &quot;json&quot;,</span><br><span class="line">		&quot;error&quot; : function(xmlhttp)&#123;</span><br><span class="line">			if(xmlhttp.status == &quot;405&quot;)&#123;</span><br><span class="line">				alert(&quot;无效的请求方式&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		/*</span><br><span class="line">			1. url</span><br><span class="line">			2. 要发送的参数，可以是字符串也可以是json</span><br><span class="line">			3. 响应处理函数</span><br><span class="line">			4. dataType(可选) 服务器返回的数据类型(text|json|xml|html|script)</span><br><span class="line"></span><br><span class="line">			$.ajax()</span><br><span class="line">		*/</span><br><span class="line">		$.get(&quot;/ajax/news_list&quot; , &#123;&quot;t&quot; : &quot;tiobe&quot;&#125; , function(json)&#123;</span><br><span class="line">			for(var i = 0 ; i &lt; json.length ; i++)&#123;</span><br><span class="line">				$(&quot;#container&quot;).append(&quot;&lt;h1&gt;&quot; + json[i].title + &quot;&lt;/h1&gt;&quot;)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id=&quot;container&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.3.1.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">			&quot;url&quot; : &quot;/ajax/news_list&quot;,</span><br><span class="line">			&quot;type&quot; : &quot;get&quot; ,</span><br><span class="line">			&quot;data&quot; : &#123;&quot;t&quot;:&quot;pypl&quot; , &quot;abc&quot;:&quot;123&quot; , &quot;uu&quot;:&quot;777&quot;&#125;,</span><br><span class="line">			//&quot;data&quot; : &quot;t=pypl&amp;abc=123&amp;uu=777&quot; ,</span><br><span class="line">			&quot;dataType&quot; : &quot;json&quot; ,</span><br><span class="line">			&quot;success&quot; : function(json)&#123;</span><br><span class="line">				console.log(json);</span><br><span class="line">				for(var i = 0 ; i &lt; json.length ; i++)&#123;</span><br><span class="line">					$(&quot;#container&quot;).append(&quot;&lt;h1&gt;&quot; + json[i].title + &quot;&lt;/h1&gt;&quot;);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			&quot;error&quot; : function(xmlhttp , errorText)&#123;</span><br><span class="line">				console.log(xmlhttp);</span><br><span class="line">				console.log(errorText);</span><br><span class="line">				if (xmlhttp.status == &quot;405&quot;) &#123;</span><br><span class="line">					alert(&quot;无效的请求方式&quot;);</span><br><span class="line">				&#125; else if(xmlhttp.status == &quot;404&quot;)&#123;</span><br><span class="line">					alert(&quot;未找到URL资源&quot;);</span><br><span class="line">				&#125; else if(xmlhttp.status == &quot;500&quot;)&#123;</span><br><span class="line">					alert(&quot;服务器内部错误，请联系管理员&quot;);</span><br><span class="line">				&#125; else&#123;</span><br><span class="line">					alert(&quot;产生异常，请联系管理员&quot;);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id=&quot;container&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Example-实现二级联动菜单"><a href="#Example-实现二级联动菜单" class="headerlink" title="Example 实现二级联动菜单"></a>Example 实现二级联动菜单</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.3.1.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">			&quot;url&quot; : &quot;/ajax/channel&quot;,</span><br><span class="line">			&quot;data&quot; : &#123;&quot;level&quot; : &quot;1&quot;&#125;,</span><br><span class="line">			&quot;type&quot; : &quot;get&quot; ,</span><br><span class="line">			&quot;dataType&quot; : &quot;json&quot; ,</span><br><span class="line">			&quot;success&quot; : function(json)&#123;</span><br><span class="line">				console.log(json);</span><br><span class="line">				for(var i = 0 ; i &lt; json.length ; i++)&#123;</span><br><span class="line">					var ch = json[i];</span><br><span class="line">					$(&quot;#lv1&quot;).append(&quot;&lt;option value=&#x27;&quot; + ch.code + &quot;&#x27;&gt;&quot; + ch.name + &quot;&lt;/option&gt;&quot;)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	$(function()&#123;</span><br><span class="line">		$(&quot;#lv1&quot;).on(&quot;change&quot; , function()&#123;</span><br><span class="line">			var parent = $(this).val();</span><br><span class="line">			console.log(parent);</span><br><span class="line">			$.ajax(&#123;</span><br><span class="line">				&quot;url&quot; : &quot;/ajax/channel&quot; ,</span><br><span class="line">				&quot;data&quot; : &#123;&quot;level&quot; : &quot;2&quot; , &quot;parent&quot; : parent&#125;,</span><br><span class="line">				&quot;dataType&quot; : &quot;json&quot; ,</span><br><span class="line">				&quot;type&quot; : &quot;get&quot; ,</span><br><span class="line">				&quot;success&quot; : function(json)&#123;</span><br><span class="line">					console.log(json);</span><br><span class="line">					//移除所有lv2下的原始option选项</span><br><span class="line">					$(&quot;#lv2&gt;option&quot;).remove();</span><br><span class="line">					for(var i = 0 ; i &lt; json.length ; i++)&#123;</span><br><span class="line">						var ch = json[i];</span><br><span class="line">						$(&quot;#lv2&quot;).append(&quot;&lt;option value=&#x27;&quot; + ch.code +&quot;&#x27;&gt;&quot; + ch.name + &quot;&lt;/option&gt;&quot;)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;select id=&quot;lv1&quot; style=&quot;width:200px;height:30px&quot;&gt;</span><br><span class="line">	&lt;option selected=&quot;selected&quot;&gt;请选择&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;select id=&quot;lv2&quot; style=&quot;width:200px;height:30px&quot;&gt;&lt;/select&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="从ajax方法衍生的简化方法"><a href="#从ajax方法衍生的简化方法" class="headerlink" title="从ajax方法衍生的简化方法"></a>从ajax方法衍生的简化方法</h2><p>$.get() 发送Get方式Ajax请求<br>$.post() 发送Post方式Ajax请求<br>$.ajaxSetup() 设置Ajax全局默认值</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/04/17/Java-Web/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/17/Java-Web/" class="post-title-link" itemprop="url">Java Web</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-17 19:23:29" itemprop="dateCreated datePublished" datetime="2022-04-17T19:23:29-04:00">2022-04-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-27 18:32:04" itemprop="dateModified" datetime="2022-04-27T18:32:04-04:00">2022-04-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h2><ul>
<li>Extensible Markup Language, has tags, to save and transfer data or config<h3 id="markup"><a href="#markup" class="headerlink" title="markup"></a>markup</h3></li>
<li>lower case, “-“</li>
<li>no duplicate names in different layers</li>
<li>&amp;lt, &amp;gt, &amp;amp, &amp;apos, &amp;quot<h3 id="cdata"><a href="#cdata" class="headerlink" title="cdata"></a>cdata</h3></li>
<li>element content that parser to interpret as character data, not markup</li>
<li><code>&lt;![CDATA[ content here ]]&gt;</code><h3 id="Semantic-constraint"><a href="#Semantic-constraint" class="headerlink" title="Semantic constraint"></a>Semantic constraint</h3><h4 id="dtd"><a href="#dtd" class="headerlink" title="dtd"></a>dtd</h4></li>
<li><!ELEMENT>: to define what elements and how many are allowed<ul>
<li><!ELEMENT hr (employee) >: one “employee” node under the “hr” node</li>
<li><!ELEMENT hr (employee+) >: at least one “employee” node under the “hr” node</li>
<li><!ELEMENT hr (employee*) >: can have 0 to n “employee” nodes under the “hr” node</li>
<li><!ELEMENT hr (employee?) >: at most one “employee” node under the “hr” node</li>
<li><!ELEMENT employee (name, age, salary, department)>: must have four nodes with this order</li>
<li><!ELEMENT name (#PCDATA)>: #PCDATA is text</li>
<li><!ATTLIST employee no CDATA "">: the type of the attribute “no” in “employee” is CDATA and the default value is “”</li>
</ul>
</li>
<li><code>&lt;!DOCTYPE hr SYSTEM &quot;hr.dtd&quot;&gt;</code> in XML to import the dtd file<h4 id="XML-schema"><a href="#XML-schema" class="headerlink" title="XML schema"></a>XML schema</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;schema xmlns=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;</span><br><span class="line">	&lt;element name=&quot;hr&quot;&gt;</span><br><span class="line">		&lt;!-- complexType标签含义是复杂节点，包含子节点时必须使用这个标签 --&gt;</span><br><span class="line">		&lt;complexType&gt;</span><br><span class="line">			&lt;sequence&gt;</span><br><span class="line">				&lt;element name=&quot;employee&quot; minOccurs=&quot;1&quot; maxOccurs=&quot;9999&quot;&gt;</span><br><span class="line">					&lt;complexType&gt;</span><br><span class="line">						&lt;sequence&gt;</span><br><span class="line">							&lt;element name=&quot;name&quot; type=&quot;string&quot;&gt;&lt;/element&gt;</span><br><span class="line">							&lt;element name=&quot;age&quot;&gt;</span><br><span class="line">								&lt;simpleType&gt;</span><br><span class="line">									&lt;restriction base=&quot;integer&quot;&gt;</span><br><span class="line">										&lt;minInclusive value=&quot;18&quot;&gt;&lt;/minInclusive&gt;</span><br><span class="line">										&lt;maxInclusive value=&quot;60&quot;&gt;&lt;/maxInclusive&gt;</span><br><span class="line">									&lt;/restriction&gt;</span><br><span class="line">								&lt;/simpleType&gt;</span><br><span class="line">							&lt;/element&gt;</span><br><span class="line">							&lt;element name=&quot;salary&quot; type=&quot;integer&quot;&gt;&lt;/element&gt;</span><br><span class="line">							&lt;element name=&quot;department&quot;&gt;</span><br><span class="line">								&lt;complexType&gt;</span><br><span class="line">									&lt;sequence&gt;</span><br><span class="line">										&lt;element name=&quot;dname&quot; type=&quot;string&quot;&gt;&lt;/element&gt;</span><br><span class="line">										&lt;element name=&quot;address&quot; type=&quot;string&quot;&gt;&lt;/element&gt;</span><br><span class="line">									&lt;/sequence&gt;</span><br><span class="line">								&lt;/complexType&gt;</span><br><span class="line">							&lt;/element&gt;</span><br><span class="line">						&lt;/sequence&gt;</span><br><span class="line">						&lt;attribute name=&quot;no&quot; type=&quot;string&quot; use=&quot;required&quot;&gt;&lt;/attribute&gt;</span><br><span class="line">					&lt;/complexType&gt;</span><br><span class="line">				&lt;/element&gt;</span><br><span class="line">			&lt;/sequence&gt;</span><br><span class="line">		&lt;/complexType&gt;</span><br><span class="line">	&lt;/element&gt;</span><br><span class="line">&lt;/schema&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h3></li>
<li>document object model</li>
<li>Dom4j<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import org.dom4j.Attribute;</span><br><span class="line">import org.dom4j.Document;</span><br><span class="line">import org.dom4j.DocumentException;</span><br><span class="line">import org.dom4j.Element;</span><br><span class="line">import org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line">public class HrReader &#123;</span><br><span class="line">	public void readXml()&#123;</span><br><span class="line">		String file = &quot;d:/workspace/xml/src/hr.xml&quot;;</span><br><span class="line"></span><br><span class="line">		SAXReader reader = new SAXReader();</span><br><span class="line">		try &#123;</span><br><span class="line">			Document document = reader.read(file);</span><br><span class="line">			Element root = document.getRootElement();</span><br><span class="line">			List&lt;Element&gt; employees =  root.elements(&quot;employee&quot;);</span><br><span class="line">			for (Element employee : employees)&#123;</span><br><span class="line">				Element name = employee.element(&quot;name&quot;);</span><br><span class="line">				String empName = name.getText();</span><br><span class="line">				System.out.println(empName);</span><br><span class="line">				System.out.println(employee.elementText(&quot;age&quot;));</span><br><span class="line">				System.out.println(employee.elementText(&quot;salary&quot;));</span><br><span class="line">				Element department = employee.element(&quot;department&quot;);</span><br><span class="line">				System.out.println(department.element(&quot;dname&quot;).getText());</span><br><span class="line">				System.out.println(department.element(&quot;address&quot;).getText());</span><br><span class="line">				Attribute att = employee.attribute(&quot;no&quot;);</span><br><span class="line">				System.out.println(att.getText());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (DocumentException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		HrReader reader = new HrReader();</span><br><span class="line">		reader.readXml();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.OutputStreamWriter;</span><br><span class="line">import java.io.Writer;</span><br><span class="line"></span><br><span class="line">import org.dom4j.Document;</span><br><span class="line">import org.dom4j.DocumentException;</span><br><span class="line">import org.dom4j.Element;</span><br><span class="line">import org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line">public class HrWriter &#123;</span><br><span class="line">	public void writeXml()&#123;</span><br><span class="line">		String file = &quot;d:/workspace/xml/src/hr.xml&quot;;</span><br><span class="line">		SAXReader reader = new SAXReader();</span><br><span class="line">		try &#123;</span><br><span class="line">			Document document = reader.read(file);</span><br><span class="line">			Element root = document.getRootElement();</span><br><span class="line">			Element employee = root.addElement(&quot;employee&quot;);</span><br><span class="line">			employee.addAttribute(&quot;no&quot;, &quot;3311&quot;);</span><br><span class="line">			Element name = employee.addElement(&quot;name&quot;);</span><br><span class="line">			name.setText(&quot;Liam&quot;);</span><br><span class="line">			employee.addElement(&quot;age&quot;).setText(&quot;37&quot;);</span><br><span class="line">			employee.addElement(&quot;salary&quot;).setText(&quot;3600&quot;);</span><br><span class="line">			Element department = employee.addElement(&quot;department&quot;);</span><br><span class="line">			department.addElement(&quot;dname&quot;).setText(&quot;IT&quot;);</span><br><span class="line">			department.addElement(&quot;address&quot;).setText(&quot;N2J 3C5&quot;);</span><br><span class="line">			Writer writer = new OutputStreamWriter(new FileOutputStream(file) , &quot;UTF-8&quot;);</span><br><span class="line">			document.write(writer);</span><br><span class="line">			writer.close();</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		HrWriter hrWriter = new HrWriter();</span><br><span class="line">		hrWriter.writeXml();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="XPath"><a href="#XPath" class="headerlink" title="XPath"></a>XPath</h3><ul>
<li>to search data in XML<br><img src="/../image/java-web/1.png" alt="Xpath 1"><br><img src="/../image/java-web/2.png" alt="Xpath 2"><br><img src="/../image/java-web/3.png" alt="Xpath 2"></li>
<li>Jaxen<ul>
<li>a Xpath library that supports DOM, XOM, Dom4j, and JDOM</li>
<li>Dom4j depends on Jaxen<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import java.util.List;</span><br><span class="line">import org.dom4j.Document;</span><br><span class="line">import org.dom4j.DocumentException;</span><br><span class="line">import org.dom4j.Element;</span><br><span class="line">import org.dom4j.Node;</span><br><span class="line">import org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line">public class XPathTestor &#123;</span><br><span class="line">	public void xpath(String xpathExp)&#123;</span><br><span class="line">		String file = &quot;E:/lianxi/xml/hr.xml&quot;;</span><br><span class="line">		SAXReader reader = new SAXReader();</span><br><span class="line">		try &#123;</span><br><span class="line">			Document document = reader.read(file);</span><br><span class="line"></span><br><span class="line">			List&lt;Node&gt; nodes = document.selectNodes(xpathExp);</span><br><span class="line">			for(Node node : nodes)&#123;</span><br><span class="line">				Element emp = (Element)node;</span><br><span class="line">				System.out.println(emp.attributeValue(&quot;no&quot;));</span><br><span class="line">				System.out.println(emp.elementText(&quot;name&quot;));</span><br><span class="line">				System.out.println(emp.elementText(&quot;age&quot;));</span><br><span class="line">				System.out.println(emp.elementText(&quot;salary&quot;));</span><br><span class="line">				System.out.println(&quot;==============================&quot;);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125; catch (DocumentException e) &#123;</span><br><span class="line">			// TODO Auto-generated catch block</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		XPathTestor testor = new XPathTestor();</span><br><span class="line">//		testor.xpath(&quot;/hr/employee&quot;);</span><br><span class="line">//		testor.xpath(&quot;//employee&quot;);</span><br><span class="line">//		testor.xpath(&quot;//employee[salary&lt;4000]&quot;);</span><br><span class="line">//		testor.xpath(&quot;//employee[name=&#x27;������&#x27;]&quot;);</span><br><span class="line">//		testor.xpath(&quot;//employee[@no=3304]&quot;);</span><br><span class="line">//		testor.xpath(&quot;//employee[1]&quot;);</span><br><span class="line">//		testor.xpath(&quot;//employee[last()]&quot;);</span><br><span class="line">		//testor.xpath(&quot;//employee[position()&lt;3]&quot;);</span><br><span class="line">		testor.xpath(&quot;//employee[3] | //employee[8]&quot;);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><ul>
<li>Tomcat: web application server software, a container to run Servlet</li>
<li>configuration<ul>
<li>port</li>
<li>ContextPath</li>
<li>应用自动重载</li>
</ul>
</li>
</ul>
<h2 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h2><ul>
<li><p>Server Applet, to create dynamic web content</p>
</li>
<li><p>process: request -&gt; Tomcat -&gt; search in web.xml to find the relevant Servlet -&gt; Servlet runs -&gt; response</p>
</li>
<li><p>steps</p>
<ul>
<li><p>extends HttpServlet</p>
</li>
<li><p>override service(HttpServletRequest request , HttpServletResponse response)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PrintWriter out =  response.getWriter();</span><br><span class="line">out.println(&quot;&lt;a href=&#x27;http://www.baidu.com&#x27;&gt;Baidu&lt;/a&gt;&quot;);</span><br></pre></td></tr></table></figure></li>
<li><p>configure web.xml or use annotation</p>
<ul>
<li>XML<ul>
<li><load-on-startup>0~9999</load-on-startup>, 0 means this Servlet has the highest priority</li>
<li>default home page</li>
<li>status code and page</li>
<li>Servlet 通配符映射及初始化参数<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;3.1&quot;&gt;</span><br><span class="line">  &lt;display-name&gt;servlet_advanced&lt;/display-name&gt;</span><br><span class="line">  &lt;welcome-file-list&gt;</span><br><span class="line">    &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;</span><br><span class="line">    &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;</span><br><span class="line">    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;</span><br><span class="line">    &lt;welcome-file&gt;default.html&lt;/welcome-file&gt;</span><br><span class="line">    &lt;welcome-file&gt;default.htm&lt;/welcome-file&gt;</span><br><span class="line">    &lt;welcome-file&gt;default.jsp&lt;/welcome-file&gt;</span><br><span class="line">  &lt;/welcome-file-list&gt;</span><br><span class="line">  &lt;servlet&gt;</span><br><span class="line">  	&lt;servlet-name&gt;patternServlet&lt;/servlet-name&gt;</span><br><span class="line">  	&lt;servlet-class&gt;com.ll.servlet.pattern.PatternServlet&lt;/servlet-class&gt;</span><br><span class="line">  &lt;/servlet&gt;</span><br><span class="line">  &lt;servlet-mapping&gt;</span><br><span class="line">  	&lt;servlet-name&gt;patternServlet&lt;/servlet-name&gt;</span><br><span class="line">  	&lt;url-pattern&gt;/pattern/*&lt;/url-pattern&gt;</span><br><span class="line">  &lt;/servlet-mapping&gt;</span><br><span class="line">  &lt;context-param&gt;</span><br><span class="line">  	&lt;param-name&gt;copyright&lt;/param-name&gt;</span><br><span class="line">  	&lt;param-value&gt;© 2018 ll.com&lt;/param-value&gt;</span><br><span class="line">  &lt;/context-param&gt;</span><br><span class="line">  &lt;context-param&gt;</span><br><span class="line">  	&lt;param-name&gt;title&lt;/param-name&gt;</span><br><span class="line">  	&lt;param-value&gt;Liam Lian&lt;/param-value&gt;</span><br><span class="line">  &lt;/context-param&gt;</span><br><span class="line">  &lt;!-- 指定错误页面 --&gt;</span><br><span class="line">  &lt;error-page&gt;</span><br><span class="line">  	&lt;error-code&gt;404&lt;/error-code&gt;</span><br><span class="line">  	&lt;location&gt;/error/404.html&lt;/location&gt;</span><br><span class="line">  &lt;/error-page&gt;</span><br><span class="line">  &lt;error-page&gt;</span><br><span class="line">  	&lt;error-code&gt;500&lt;/error-code&gt;</span><br><span class="line">  	&lt;location&gt;/error/500.jsp&lt;/location&gt;</span><br><span class="line">  &lt;/error-page&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>@WebServlet</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@WebServlet(&quot;/anno/*&quot;)</span><br><span class="line">public class AnnotationServlet extends HttpServlet&#123;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">    resp.getWriter().println(&quot;I&#x27;m annotation servlet!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><a href="http://ip:port/context-path/url-mapping">http://ip:port/context-path/url-mapping</a>: context-path is project name by default</p>
</li>
</ul>
</li>
<li><p>methods</p>
<ul>
<li><p>request.getParameter() &#x2F;&#x2F; get one parameter</p>
</li>
<li><p>request.getParameterValues() &#x2F;&#x2F; get multiple parameter values</p>
</li>
<li><p>request.setAttribute(属性名，属性值)</p>
</li>
<li><p>Object attr &#x3D; request.getAttribute(属性名)</p>
</li>
<li><p>request.getRequestURL()</p>
</li>
<li><p>request.getServletContext()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ServletContext context = request.getServletContext();</span><br><span class="line">String copyright = context.getInitParameter(&quot;copyright&quot;);</span><br><span class="line">context.setAttribute(&quot;copyright&quot;, copyright);</span><br></pre></td></tr></table></figure></li>
<li><p>request.getSession()</p>
</li>
<li><p>request.getHeader(“User-Agent”);</p>
</li>
<li><p>service() &#x2F;&#x2F; can deal with all requests</p>
</li>
<li><p>doGet() &#x2F;&#x2F; deal with get requests</p>
</li>
<li><p>doPost &#x2F;&#x2F; deal with post requests</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public void doPost(HttpServletRequest request , HttpServletResponse response) throws IOException&#123;</span><br><span class="line">  String name = request.getParameter(&quot;name&quot;);</span><br><span class="line">  response.getWriter().println(&quot;&lt;h1 style=&#x27;color:red&#x27;&gt;&quot; + name + &quot;&lt;/h1&gt;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>life cycle</p>
<ul>
<li>load: web.xml</li>
<li>constructor</li>
<li>init()</li>
<li>provide service: service(), etc</li>
<li>destroy()</li>
</ul>
</li>
<li><p>note: content in WEB-INF can be accessed only by the server, secure</p>
</li>
</ul>
<h3 id="Forward-and-Redirect"><a href="#Forward-and-Redirect" class="headerlink" title="Forward and Redirect"></a>Forward and Redirect</h3><ul>
<li>request.getRequestDispatcher().forward(): <code>request.getRequestDispatcher(&quot;/direct/index&quot;).forward(request, response);</code><ul>
<li>one request</li>
<li>url that appears will not change</li>
</ul>
</li>
<li>response.sendRedirect(): <code>response.sendRedirect(&quot;/servlet_advanced/direct/index&quot;);</code><ul>
<li>two requests<h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4></li>
</ul>
</li>
<li>sent with request to Tomcat</li>
<li>default<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.Cookie;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/cookies/index&quot;)</span><br><span class="line">public class llIndexServlet extends HttpServlet &#123;</span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">    public llIndexServlet() &#123;</span><br><span class="line">        super();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		Cookie[] cs = request.getCookies();</span><br><span class="line">		if (cs == null) &#123;</span><br><span class="line">			response.getWriter().println(&quot;user not login&quot;);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		String user = null;</span><br><span class="line">		for (Cookie c : cs) &#123;</span><br><span class="line">			System.out.println(c.getName() + &quot;:&quot; + c.getValue());</span><br><span class="line">			if (c.getName().equals(&quot;user&quot;)) &#123;</span><br><span class="line">				user = c.getValue();</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		if (user == null) &#123;</span><br><span class="line">			response.getWriter().println(&quot;user not login&quot;);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			response.getWriter().println(&quot;user:&quot; + user);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.Cookie;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">@WebServlet(&quot;/cookies/login&quot;)</span><br><span class="line">public class llLoginServlet extends HttpServlet &#123;</span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">    public llLoginServlet() &#123;</span><br><span class="line">        super();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		Cookie cookie = new Cookie(&quot;user&quot; , &quot;admin&quot;);</span><br><span class="line">		cookie.setMaxAge(60 * 60 * 24 * 7);</span><br><span class="line">		response.addCookie(cookie);</span><br><span class="line">		response.getWriter().println(&quot;login success&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4></li>
<li>data related to browser window, saved in Tomcat server memory</li>
<li>通过Cookie的SessionId值提取用户数据</li>
<li>methods<ul>
<li>request.getSession()</li>
<li>getAttribute()</li>
<li>setAttribute()</li>
<li>removeAttribute()</li>
<li>setMaxInactiveInterval: 设置Session超时时间<h4 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h4></li>
</ul>
</li>
<li>one global object<h4 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h4></li>
<li>HttpServletRequest</li>
<li>HttpSession</li>
<li>ServletContext: after the application starts and before it closes<h4 id="Char-set"><a href="#Char-set" class="headerlink" title="Char set"></a>Char set</h4></li>
<li>get: before Tomcat 8, server.xml增加URIEncoding&#x3D;”UTF-8”</li>
<li>post: <code>request.setCharacterEncoding(&quot;UTF-8&quot;);</code></li>
<li>response: <code>response.setContentType(&quot;text/html;charset=utf-8&quot;);</code></li>
</ul>
<h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><ul>
<li>对URL进行统一的拦截处理, 过滤器对象在Web应用启动时被创建且全局唯一, 唯一的过滤器对象在并发环境中采用“多线程”提供服务<br>过</li>
<li>implements javax.servlet.Filter</li>
<li>doFilter()</li>
<li>web.xml <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;filter&gt;</span><br><span class="line">  &lt;filter-name&gt;MyFirstFilter&lt;/filter-name&gt;</span><br><span class="line">  &lt;filter-class&gt;com.ll.filter.MyFirstFilter&lt;/filter-class&gt;</span><br><span class="line">&lt;/filter&gt;</span><br><span class="line">&lt;filter-mapping&gt;</span><br><span class="line">  &lt;filter-name&gt;MyFirstFilter&lt;/filter-name&gt;</span><br><span class="line">  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">&lt;/filter-mapping&gt;</span><br></pre></td></tr></table></figure>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@WebFilter (filterName=&quot;MyAnnoationFilter&quot;,urlPatterns=&quot;/*&quot;)</span><br><span class="line"> public class MyAnnotationFilter implements Filter &#123;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;init-param&gt;</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line">import javax.servlet.Filter;</span><br><span class="line">import javax.servlet.FilterChain;</span><br><span class="line">import javax.servlet.FilterConfig;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.ServletRequest;</span><br><span class="line">import javax.servlet.ServletResponse;</span><br><span class="line">import javax.servlet.annotation.WebFilter;</span><br><span class="line">import javax.servlet.annotation.WebInitParam;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">@WebFilter(filterName=&quot;CharacterEncodingFilter&quot;,urlPatterns=&quot;/*&quot;,</span><br><span class="line">	initParams= &#123;</span><br><span class="line">			@WebInitParam(name=&quot;encoding&quot; , value=&quot;GBK&quot;),</span><br><span class="line">			@WebInitParam(name=&quot;p1&quot; , value=&quot;v1&quot;),</span><br><span class="line">			@WebInitParam(name=&quot;p2&quot; , value=&quot;v2&quot;)</span><br><span class="line">	&#125;)</span><br><span class="line">public class CharacterEncodingFilter implements Filter &#123;</span><br><span class="line">	private String encoding;</span><br><span class="line">	@Override</span><br><span class="line">	public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">		encoding = filterConfig.getInitParameter(&quot;encoding&quot;);</span><br><span class="line">		System.out.println(&quot;encoding:&quot;+encoding);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)</span><br><span class="line">			throws IOException, ServletException &#123;</span><br><span class="line">		HttpServletRequest req = (HttpServletRequest)request;</span><br><span class="line">		req.setCharacterEncoding(encoding);</span><br><span class="line">		HttpServletResponse res = (HttpServletResponse)response;</span><br><span class="line">		res.setContentType(&quot;text/html;charset=&quot; + encoding);</span><br><span class="line">		chain.doFilter(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void destroy() &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;filter&gt;</span><br><span class="line">  &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</span><br><span class="line">  &lt;filter-class&gt;com.ll.filter.CharacterEncodingFilter&lt;/filter-class&gt;</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">    &lt;param-name&gt;encoding&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;GBK&lt;/param-value&gt;</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">    &lt;param-name&gt;p1&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;v1&lt;/param-value&gt;</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">    &lt;param-name&gt;p2&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;v2&lt;/param-value&gt;</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">&lt;/filter&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h4></li>
</ul>
</li>
<li>Filter.init()</li>
<li>Filter.doFilter()</li>
<li>Filter.destroy()</li>
</ul>
<h4 id="ServletRequest"><a href="#ServletRequest" class="headerlink" title="ServletRequest"></a>ServletRequest</h4><ul>
<li>ServletRequest是所有请求的顶层接口，代表任何”请求”</li>
<li>HttpServletRequest是Http协议请求的抽象接口，是J2EE标准</li>
<li>RequestFacade是HttpServletRequest接口的实现类，由Tomcat创建</li>
</ul>
<h4 id="x2F-映射的问题"><a href="#x2F-映射的问题" class="headerlink" title="&#x2F; 映射的问题"></a>&#x2F; 映射的问题</h4><ul>
<li>&#x2F; 指映射 Web应用根路径，且只对Servlet生效</li>
<li>默认首页index.jsp会让 &#x2F; 失效</li>
<li>&#x2F; 与 &#x2F;* 含义不同，前者指向根路径，后者代表所有</li>
</ul>
<h4 id="chain"><a href="#chain" class="headerlink" title="chain"></a>chain</h4><ul>
<li>过滤器的执行顺序以<filter-mapping>为准</li>
<li>调用chain.doFilter()将请求向后传递</li>
</ul>
<h2 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h2><ul>
<li><p>Java server page, separate Java code and HTML, in nature is Servlet, .jsp</p>
</li>
<li><p>.jsp -&gt; Servlet source code -&gt;(compiled) byte code</p>
<h4 id="JSP-code-block"><a href="#JSP-code-block" class="headerlink" title="JSP code block"></a>JSP code block</h4></li>
<li><p>&lt;% java code %&gt;: <code>&lt;% System.out.println(&quot;Hello&quot;); %&gt;</code></p>
<h4 id="JSP-declaration-block"><a href="#JSP-declaration-block" class="headerlink" title="JSP declaration block"></a>JSP declaration block</h4></li>
<li><p>&lt;%! java code %&gt;: <code>&lt;%! public int add(int a,int b)&#123;return a+b;&#125; %&gt;</code></p>
<h4 id="output"><a href="#output" class="headerlink" title="output"></a>output</h4></li>
<li><p>&lt;%&#x3D; java code %&gt;: <code>&lt;%= &quot;&lt;b&gt;&quot; + name + &quot;&lt;/b&gt;&quot; %&gt;</code></p>
<h4 id="JSP-commands"><a href="#JSP-commands" class="headerlink" title="JSP commands"></a>JSP commands</h4></li>
<li><p><code>&lt;%@ page import=&quot;java.util.*&quot; %&gt;</code></p>
<ul>
<li>&lt;%@ page %&gt; 定义当前JSP页面全局设置: <code>&lt;%@page import=&quot;java.util.*,java.text.*&quot; contentType=&quot;text/html;charset=utf-8&quot; isErrorPage=&quot;true&quot;%&gt;</code></li>
<li>&lt;%@ include %&gt; 将其他JSP页面与当前JSP页面合并: <code>&lt;%@include file=&quot;include/header.jsp&quot; %&gt;</code></li>
<li>&lt;%@ taglib %&gt; 引入JSP标签库<h4 id="comments"><a href="#comments" class="headerlink" title="comments"></a>comments</h4></li>
</ul>
</li>
<li><p>&lt;%– comments –%&gt;</p>
</li>
<li><p>&#x2F;&#x2F; 、&#x2F;<em>..</em>&#x2F; 用于注释&lt;%%&gt;java代码</p>
</li>
<li><p><code>&lt;!-- html --&gt;</code> HTML注释</p>
<h3 id="JSP-objects"><a href="#JSP-objects" class="headerlink" title="JSP objects"></a>JSP objects</h3></li>
<li><p>request: HttpServletRequest</p>
</li>
<li><p>response: HttpServletResponse</p>
</li>
<li><p>session: HttpSession</p>
</li>
<li><p>application: ServletContext</p>
</li>
<li><p>out: PrintWriter</p>
</li>
<li><p>page: this (this page)</p>
</li>
<li><p>pageContext: PageContext</p>
</li>
<li><p>config: ServletConfig</p>
</li>
<li><p>exception: Throwable</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot; %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		String url = request.getRequestURL().toString(); // HttpServletRequest</span><br><span class="line">		response.getWriter().println(url);//HttpServletResponse</span><br><span class="line">	%&gt;</span><br><span class="line">	&lt;% out.println(&quot;&lt;br&gt;ABCCC&quot;);</span><br><span class="line">		session.setAttribute(&quot;user&quot;, &quot;Liam&quot;);</span><br><span class="line">		out.println((String)session.getAttribute(&quot;user&quot;));</span><br><span class="line">	%&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		String cp = application.getInitParameter(&quot;copyright&quot;) ; //ServletContext</span><br><span class="line">		out.println(&quot;&lt;hr/&gt;&quot;);</span><br><span class="line">		out.println(cp);</span><br><span class="line">		pageContext.getRequest();</span><br><span class="line">		pageContext.getResponse();</span><br><span class="line">		pageContext.getSession();</span><br><span class="line">		pageContext.getServletContext();</span><br><span class="line">	%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page import=&quot;java.util.*,java.text.*&quot; contentType=&quot;text/html;charset=utf-8&quot; %&gt;</span><br><span class="line">&lt;%!</span><br><span class="line">	boolean isPrime(int num)&#123;</span><br><span class="line">		boolean flag = true;</span><br><span class="line">		for(int j = 2 ; j &lt; num ; j++)&#123;</span><br><span class="line">			if(num % j == 0)&#123;</span><br><span class="line">				flag = false;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return flag;</span><br><span class="line">	&#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	List&lt;Integer&gt; primes = new ArrayList();</span><br><span class="line">	for(int i = 2 ; i&lt;=1000 ; i++)&#123;</span><br><span class="line">		boolean flag = isPrime(i);</span><br><span class="line"></span><br><span class="line">		if(flag == true)&#123;</span><br><span class="line">			primes.add(i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	for(int p : primes)&#123;</span><br><span class="line">%&gt;</span><br><span class="line">	&lt;h1 style=&quot;color:red;&quot;&gt;&lt;%=p %&gt;是质数&lt;/h1&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	&#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="EL"><a href="#EL" class="headerlink" title="EL"></a>EL</h3></li>
<li><p>Expression Language, to simplify JSP</p>
</li>
<li><p>${expression}</p>
<h4 id="Scope-1"><a href="#Scope-1" class="headerlink" title="Scope"></a>Scope</h4></li>
<li><p>pageScope: <code>&#123;pageScope.student.name&#125;</code></p>
</li>
<li><p>requestScope</p>
</li>
<li><p>sessionScope</p>
</li>
<li><p>applicationScope</p>
</li>
<li><p>if scope is omitted, EL will try to find the value from the smallest scope to the largest scope</p>
</li>
<li><p>${param.参数名}</p>
</li>
</ul>
<h3 id="JSTL"><a href="#JSTL" class="headerlink" title="JSTL"></a>JSTL</h3><ul>
<li>JSP Standard Tag Library, to simplify JSP</li>
<li>put jar files in <code>/WEB-INF/lib</code><ul>
<li>taglibs-standard-spec-1.2.5.jar</li>
<li>taglibs-standard-impl-1.2.5.jar</li>
<li>taglibs-standard-jstlel-1.2.5.jar: to support EL, optional</li>
<li>taglibs-standard-compat-1.2.5.jar: to be compatible with version 1.0, optional</li>
</ul>
</li>
<li>libraries<ul>
<li>core<ul>
<li><p>&lt;%@ taglib prefix&#x3D;”c” uri&#x3D;”<a target="_blank" rel="noopener" href="http://java.sun.com/jsp/jstl/core&quot;">http://java.sun.com/jsp/jstl/core&quot;</a> %&gt;</p>
</li>
<li><p>&lt;c:if&gt;</p>
</li>
<li><p>&lt;c:choose&gt;, &lt;c:when&gt;, &lt;c:otherwise&gt;</p>
</li>
<li><p>&lt;c:forEach&gt;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach var=&quot;p&quot; items=&quot;$&#123;persons&#125;&quot; varStatus = &quot;idx&quot;&gt;</span><br><span class="line">No. $&#123;idx.index + 1&#125; &lt;br/&gt;</span><br><span class="line">name：$&#123;p.name&#125; sex: $&#123;p.sex&#125; age:$&#123;p.age&#125;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!-- 在Java或者JSP文件中输入 Alt + / 可出现智能提示 --&gt;</span><br><span class="line">&lt;%@ taglib  uri = &quot;http://java.sun.com/jsp/jstl/core&quot; prefix = &quot;c&quot; %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;$&#123;requestScope.score&#125;&lt;/h1&gt;</span><br><span class="line">	&lt;c:if test = &quot;$&#123;score &gt;= 60 &#125;&quot;&gt;</span><br><span class="line">		&lt;h1 style = &quot;color:green&quot;&gt;恭喜，你已通过测试&lt;/h1&gt;</span><br><span class="line">	&lt;/c:if&gt;</span><br><span class="line">	&lt;c:if test = &quot;$&#123;score &lt; 60 &#125;&quot;&gt;</span><br><span class="line">		&lt;h1 style = &quot;color:red&quot;&gt;对不起，再接再厉&lt;/h1&gt;</span><br><span class="line">	&lt;/c:if&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- choose when otherwise --&gt;</span><br><span class="line">	$&#123;grade &#125;</span><br><span class="line">	&lt;c:choose&gt;</span><br><span class="line">		&lt;c:when test=&quot;$&#123;grade == &#x27;A&#x27;&#125;&quot;&gt;</span><br><span class="line">			&lt;h2&gt;你很优秀&lt;/h2&gt;</span><br><span class="line">		&lt;/c:when&gt;</span><br><span class="line">		&lt;c:when test=&quot;$&#123;grade == &#x27;B&#x27; &#125;&quot;&gt;</span><br><span class="line">			&lt;h2&gt;不错呦&lt;/h2&gt;</span><br><span class="line">		&lt;/c:when&gt;</span><br><span class="line">		&lt;c:when test=&quot;$&#123;grade == &#x27;C&#x27; &#125;&quot;&gt;</span><br><span class="line">			&lt;h2&gt;水平一般，需要提高&lt;/h2&gt;</span><br><span class="line">		&lt;/c:when&gt;</span><br><span class="line">		&lt;c:when test = &quot;$&#123;grade == &#x27;D&#x27;&#125;&quot;&gt;</span><br><span class="line">			&lt;h2&gt;需要努力啦，不要气馁&lt;/h2&gt;</span><br><span class="line">		&lt;/c:when&gt;</span><br><span class="line">		&lt;c:otherwise&gt;</span><br><span class="line">			&lt;h2&gt;一切随缘吧&lt;/h2&gt;</span><br><span class="line">		&lt;/c:otherwise&gt;</span><br><span class="line">	&lt;/c:choose&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- forEach标签用于遍历集合</span><br><span class="line">		List companys = (List)request.getAttribute(&quot;companys&quot;)</span><br><span class="line">		for(Company c : companys)&#123;</span><br><span class="line">			out.print(&quot;...&quot;)</span><br><span class="line">		&#125;</span><br><span class="line">		idx = index</span><br><span class="line">		idx.index属性代表循环的索引值（0开始）</span><br><span class="line">	--&gt;</span><br><span class="line">	&lt;c:forEach varStatus=&quot;idx&quot; items = &quot;$&#123;requestScope.companys &#125;&quot; var = &quot;c&quot;&gt;</span><br><span class="line">		&lt;h2&gt;$&#123;idx.index + 1&#125;-$&#123;c.cname &#125;-$&#123;c.url &#125;&lt;/h2&gt;</span><br><span class="line">	&lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>fmt<ul>
<li>&lt;fmt:formatDate value &#x3D; “” pattern &#x3D; “” &#x2F;&gt;</li>
<li>&lt;fmt:formatNumber value &#x3D; “” pattern &#x3D; “”&#x2F;&gt;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; prefix=&quot;fmt&quot; %&gt;</span><br><span class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;%</span><br><span class="line">		request.setAttribute(&quot;amt&quot;, 1987654.326);</span><br><span class="line">		request.setAttribute(&quot;now&quot;, new java.util.Date());</span><br><span class="line">		request.setAttribute(&quot;html&quot;, &quot;&lt;a href=&#x27;index.html&#x27;&gt;index&lt;/a&gt;&quot;);</span><br><span class="line">		request.setAttribute(&quot;nothing&quot;, null);</span><br><span class="line">	%&gt;</span><br><span class="line">	&lt;h2&gt;$&#123;now &#125;&lt;/h2&gt;</span><br><span class="line">	&lt;!--</span><br><span class="line">		formatDate pattern</span><br><span class="line">		yyyy - 四位年</span><br><span class="line">		MM - 两位月</span><br><span class="line">		dd - 两位日</span><br><span class="line">		HH - 24小时制</span><br><span class="line">		hh - 12小时制</span><br><span class="line">		mm - 分钟</span><br><span class="line">		ss - 秒数</span><br><span class="line">		SSS - 毫秒</span><br><span class="line">	 --&gt;</span><br><span class="line">	&lt;h2&gt;</span><br><span class="line">		&lt;fmt:formatDate value=&quot;$&#123;requestScope.now &#125;&quot; pattern=&quot;yyyy年MM月dd日 HH时mm分ss秒 SSS毫秒&quot; /&gt;</span><br><span class="line">	&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">	&lt;h2&gt;$&#123;amt &#125;&lt;/h2&gt;</span><br><span class="line">	&lt;h2&gt;¥&lt;fmt:formatNumber value = &quot;$&#123;amt &#125;&quot; pattern=&quot;0,00.00&quot;&gt;&lt;/fmt:formatNumber&gt;元&lt;/h2&gt;</span><br><span class="line">	&lt;h2&gt;null默认值：&lt;c:out value=&quot;$&#123;nothing &#125;&quot; default=&quot;无&quot;&gt;&lt;/c:out&gt; &lt;/h2&gt;</span><br><span class="line">	&lt;h2&gt;&lt;c:out value=&quot;$&#123; html&#125;&quot; escapeXml=&quot;true&quot;&gt;&lt;/c:out&gt;&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>sql</li>
<li>xml</li>
<li>functions</li>
</ul>
</li>
</ul>
<h3 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h3><ul>
<li>ServletContext - 对全局ServletContext及其属性进行监听</li>
<li>HttpSession - 对用户会话及其属性操作进行监听</li>
<li>ServletRequest - 对请求及属性操作进行监听</li>
<li>ServletContextAttributeListener - 监听全局属性操作</li>
<li>HttpSessionAttributeListener- 监听用户会话属性操作</li>
<li>ServletRequestAttributeListener - 监听请求属性操作</li>
</ul>
<h4 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h4><ul>
<li>implements XxListener</li>
<li><listener> in web.xml or <code>@WebListener</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;listener&gt;</span><br><span class="line">  &lt;listener-class&gt;com.ll.listener.FirstListener&lt;/listener-class&gt;</span><br><span class="line">&lt;/listener&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h2><ul>
<li>REST: architecture principles, resource’s Representational State Transfer. 我们把”资源”具体呈现出来的形式，叫做它的”表现层”（Representation）。客户端和服务器之间，传递这种资源的某种表现层。如果客户端想要操作服务器，必须通过某种手段，让服务器端发生”状态转化”（State Transfer）。</li>
<li>RESTful: obeys the principles of REST</li>
<li>URI: uniform resource identifier</li>
<li>domain name and version<ul>
<li><a target="_blank" rel="noopener" href="https://api.example.com/v1/">https://api.example.com/v1/</a></li>
<li>如果确定API很简单，不会有进一步扩展，可以考虑放在主域名下: <a target="_blank" rel="noopener" href="https://example.org/api/v1/">https://example.org/api/v1/</a></li>
</ul>
</li>
<li>naming<ul>
<li>URI必须具有语义: GET &#x2F;a&#x2F;1 -&gt; GET &#x2F;student&#x2F;1</li>
<li>URI必须使用名词，所用的名词往往与数据库的表格名: POST &#x2F;createArticle&#x2F;1 -&gt; POST &#x2F;article&#x2F;1</li>
<li>URI扁平化，不超两级: GET &#x2F;articles&#x2F;author&#x2F;1 -&gt; GET &#x2F;articles&#x2F;author?id&#x3D;1</li>
<li>URI名词区分单复数: DELETE &#x2F;articles&#x2F;1 -&gt; GET &#x2F;articles?au&#x3D;lily DELETE &#x2F;article&#x2F;1</li>
<li>filtering<ul>
<li>?limit&#x3D;10：指定返回记录的数量</li>
<li>?offset&#x3D;10：指定返回记录的开始位置。</li>
<li>?page&#x3D;2&amp;per_page&#x3D;100：指定第几页，以及每页的记录数。</li>
<li>?sortby&#x3D;name&amp;order&#x3D;asc：指定返回结果按照哪个属性排序，以及排序顺序。</li>
<li>?animal_type_id&#x3D;1：指定筛选条件</li>
</ul>
</li>
<li>不在URI中加入版本号，因为不同的版本，可以理解成同一种资源的不同表现形式。版本号可以在HTTP请求头信息的Accept字段中进行区分（参见Versioning REST Services）：<code>Accept: vnd.example-com.foo+json; version=1.0</code></li>
</ul>
</li>
<li>annotation<ul>
<li><code>@RestController</code></li>
<li><code>@PathVariable</code></li>
<li><code>@GetMapping</code> and <code>@PostMapping</code><h3 id="complex-request"><a href="#complex-request" class="headerlink" title="complex request"></a>complex request</h3></li>
</ul>
</li>
<li>simple request: get, post</li>
<li>complex request: PUT&#x2F;PATCH&#x2F;DELETE、扩展标准请求;需要发送预检请求<br>GET（SELECT）：从服务器取出资源（一项或多项）。<br>POST（CREATE）：在服务器新建一个资源。<br>PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。<br>PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。<br>DELETE（DELETE）：从服务器删除资源。</li>
</ul>
<h3 id="response"><a href="#response" class="headerlink" title="response"></a>response</h3><ul>
<li>GET &#x2F;collection：返回资源对象的列表（数组）</li>
<li>GET &#x2F;collection&#x2F;resource：返回单个资源对象</li>
<li>POST &#x2F;collection：返回新生成的资源对象</li>
<li>PUT &#x2F;collection&#x2F;resource：返回完整的资源对象</li>
<li>PATCH &#x2F;collection&#x2F;resource：返回完整的资源对象</li>
<li>DELETE &#x2F;collection&#x2F;resource：返回一个空文档</li>
</ul>
<h3 id="Hypermedia-API"><a href="#Hypermedia-API" class="headerlink" title="Hypermedia API"></a>Hypermedia API</h3><ul>
<li>最好做到Hypermedia，即返回结果中提供链接，连向其他API方法</li>
<li>比如，当用户向api.example.com的根目录发出请求，会得到这样一个文档。rel表示这个API与当前网址的关系（collection关系，并给出该collection的网址），href表示API的路径，title表示API的标题，type表示返回类型。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;link&quot;: &#123;</span><br><span class="line">  &quot;rel&quot;:   &quot;collection https://www.example.com/zoos&quot;,</span><br><span class="line">  &quot;href&quot;:  &quot;https://api.example.com/zoos&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;List of zoos&quot;,</span><br><span class="line">  &quot;type&quot;:  &quot;application/vnd.yourformat+json&quot;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h2><ul>
<li>同源策略阻止从一个域加载的脚本去获取另一个域上的资源</li>
<li>只要协议、域名、端口有任何一个不同，都被当作是不同的域</li>
<li>浏览器Console看到Access-Control-Allow-Origin就代表跨域了</li>
<li>HTML中允许跨域的标签: <img> <script> <link><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3></li>
<li><a target="_blank" rel="noopener" href="http://ll.com/">http://ll.com</a> <a target="_blank" rel="noopener" href="http://abc.ll.com/">http://abc.ll.com</a> 不能</li>
<li><a target="_blank" rel="noopener" href="http://localhost/">http://localhost</a> <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a> 不能<h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3></li>
<li>CORS是一种机制,使用额外的HTTP头通知浏览器可以访问其他域</li>
<li>URL响应头包含 Access-Control-*指明请求允许跨域</li>
<li><code>@CrossOrigin</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@CrossOrigin(origins = &quot;*&quot;,maxAge = 3600) // origin=&quot;*&quot;代表允许所有域名都可访问该URL; maxAge=3600代表预检请求的缓存时间,单位:秒</span><br><span class="line">public class UserController &#123;</span><br><span class="line">@GetMapping(&quot;/find_user&quot;)</span><br><span class="line">  public User findUser(@RequestParam(value=&quot;id&quot;) Integer id)&#123;</span><br><span class="line">  // codes</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><a href="mvc:cors">mvc:cors</a>: Spring MVC全局跨域配置<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:cors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/api/**&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">allowed-origins</span>=<span class="string">&quot;http://domain1.com, http://domain2.com&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">allowed-methods</span>=<span class="string">&quot;GET, POST&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">max-age</span>=<span class="string">&quot;3600&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/resources/**&quot;</span> <span class="attr">allowed-origins</span>=<span class="string">&quot;*&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:cors</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Freemarker"><a href="#Freemarker" class="headerlink" title="Freemarker"></a>Freemarker</h2><ul>
<li>${属性名}</li>
<li>${属性名!默认值}</li>
<li>${属性名?string}: 格式化输出</li>
<li>if<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if 条件1&gt;</span><br><span class="line">条件1成立执行代码</span><br><span class="line">&lt;#elseif 条件2&gt;</span><br><span class="line">条件2成立执行代码</span><br><span class="line">&lt;#elseif 条件3&gt;</span><br><span class="line">条件3成立执行代码</span><br><span class="line">&lt;#else&gt;</span><br><span class="line">其他情况下执行代码</span><br><span class="line"></span><br><span class="line">&lt;#switch value&gt;</span><br><span class="line">  &lt;#case refValue1&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;#break&gt;</span><br><span class="line">  &lt;#case refValue2&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;#break&gt;</span><br><span class="line">  &lt;#case refValueN&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;#break&gt;</span><br><span class="line">  &lt;#default&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/#switch&gt;</span><br></pre></td></tr></table></figure></li>
<li>iteration<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list students as stu&gt;</span><br><span class="line">  &lt;li&gt;$&#123;stu_index&#125;-$&#123;stu.name&#125;&lt;/li&gt;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line"></span><br><span class="line">&lt;#list map?keys as key&gt;</span><br><span class="line">  $&#123;key&#125;:$&#123;map[key]&#125;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line"></span><br><span class="line">&lt;#list 1..20 as x&gt;</span><br><span class="line">  &lt;li&gt;$&#123;x&#125;&lt;/li&gt;</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure></li>
<li>functions<ul>
<li>substring 截取字符串 "abcdefg"?substring(2,4)</li>
<li>cap_first 首字母大写 "jackson"?cap_first</li>
<li>index_of 查找字符索引 "abcdef"?index_of("b")</li>
<li>length 返回字符串长度 "abcdef"?length</li>
<li>round/floor/ceiling 四舍五入/下取整/上取整 pi?floor</li>
<li>size 得到集合元素总数 students?size</li>
<li>first/last 获取第一个/最后一个元素 student?first</li>
<li>sort_by 按某个属性对集合排序 list?sort_by("time")</li>
</ul>
</li>
<li>与servlet整合<ul>
<li>web.xml<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">  &lt;servlet-name&gt;freemarker&lt;/servlet-name&gt;</span><br><span class="line">  &lt;servlet-class&gt;freemarker.ext.servlet.FreemarkerServlet&lt;/servlet-class&gt;</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">    &lt;param-name&gt;TemplatePath&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;/WEB-INF/ftl&lt;/param-value&gt;</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">  &lt;servlet-name&gt;freemarker&lt;/servlet-name&gt;</span><br><span class="line">  &lt;url-pattern&gt;*.ftl&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></li>
<li>ftl<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link href=&quot;css/bootstrap.css&quot; type=&quot;text/css&quot; rel=&quot;stylesheet&quot;&gt;&lt;/link&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-1.11.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;js/bootstrap.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .pagination &#123;</span><br><span class="line">            margin: 0px</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .pagination &gt; li &gt; a, .pagination &gt; li &gt; span &#123;</span><br><span class="line">            margin: 0 5px;</span><br><span class="line">            border: 1px solid #dddddd;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .glyphicon &#123;</span><br><span class="line">            margin-right: 3px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .form-control[readonly] &#123;</span><br><span class="line">            cursor: pointer;</span><br><span class="line">            background-color: white;</span><br><span class="line">        &#125;</span><br><span class="line">        #dlgPhoto .modal-body&#123;</span><br><span class="line">            text-align: center;</span><br><span class="line">        &#125;</span><br><span class="line">        .preview&#123;</span><br><span class="line"></span><br><span class="line">            max-width: 500px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">        &lt;h1 style=&quot;text-align: center&quot;&gt;llԱ����Ϣ��&lt;/h1&gt;</span><br><span class="line">        &lt;div class=&quot;panel panel-default&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;clearfix panel-heading &quot;&gt;</span><br><span class="line">                &lt;div class=&quot;input-group&quot; style=&quot;width: 500px;&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;table class=&quot;table table-bordered table-hover&quot;&gt;</span><br><span class="line">                &lt;thead&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;th&gt;Index&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;Employee Number&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;Name&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;Department&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;ְJob&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;Salary&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;&amp;nbsp;&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">                &lt;/thead&gt;</span><br><span class="line">                &lt;tbody&gt;</span><br><span class="line">                &lt;#list employee_list as emp&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;emp_index + 1&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;emp.empno?string(&quot;0&quot;)&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;emp.ename&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;emp.department&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td&gt;$&#123;emp.job&#125;&lt;/td&gt;</span><br><span class="line">                    &lt;td style=&quot;color: red;font-weight: bold&quot;&gt;��$&#123;emp.salary?string(&quot;0.00&quot;)&#125;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">				&lt;/#list&gt;</span><br><span class="line">                &lt;/tbody&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
<li>servlet<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.annotation.WebServlet;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Servlet implementation class ListServlet</span><br><span class="line"> */</span><br><span class="line">@WebServlet(&quot;/list&quot;)</span><br><span class="line">public class ListServlet extends HttpServlet &#123;</span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @see HttpServlet#HttpServlet()</span><br><span class="line">     */</span><br><span class="line">    public ListServlet() &#123;</span><br><span class="line">        super();</span><br><span class="line">        // TODO Auto-generated constructor stub</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">	 */</span><br><span class="line">	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		List list = new ArrayList();</span><br><span class="line">		list.add(new Employee(7731,&quot;Liam&quot; , &quot;IT�&quot; , &quot;Engineer&quot; , 8000f));</span><br><span class="line">		list.add(new Employee(8871,&quot;Alex&quot; , &quot;Sales&quot; , &quot;Sales Representative&quot; , 7000f));</span><br><span class="line">		request.getServletContext().setAttribute(&quot;employee_list&quot;, list);</span><br><span class="line">		request.getRequestDispatcher(&quot;/employee.ftl&quot;).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="利用Apache-Commons-FileUpload组件实现上传功能"><a href="#利用Apache-Commons-FileUpload组件实现上传功能" class="headerlink" title="利用Apache Commons FileUpload组件实现上传功能"></a>利用Apache Commons FileUpload组件实现上传功能</h2><ul>
<li>form表单method="post"</li>
<li>form表单enctype="multipart/form-data"</li>
<li>form表单持有file类型input进行文件选择<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page contentType=&quot;text/html;charset=utf-8&quot;%&gt;</span><br><span class="line"><span class="comment">&lt;!-- 修改油画页面 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>作品更新<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css\create.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery-3.4.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/validation.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	&lt;!-- 提交前表单校验 --&gt;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">function</span> <span class="title function_">checkSubmit</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> result = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> r1 = <span class="title function_">checkEmpty</span>(<span class="string">&quot;#pname&quot;</span>,<span class="string">&quot;#errPname&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> r2 = <span class="title function_">checkCategory</span>(<span class="string">&#x27;#category&#x27;</span>, <span class="string">&#x27;#errCategory&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> r3 = <span class="title function_">checkPrice</span>(<span class="string">&#x27;#price&#x27;</span>, <span class="string">&#x27;#errPrice&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> r4 = <span class="title function_">checkFile</span>(<span class="string">&#x27;#painting&#x27;</span>, <span class="string">&#x27;#errPainting&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> r5 = <span class="title function_">checkEmpty</span>(<span class="string">&#x27;#description&#x27;</span>, <span class="string">&#x27;#errDescription&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">if</span> (r1 &amp;&amp; r2 &amp;&amp; r3 &amp;&amp; r4 &amp;&amp; r5)&#123;</span></span><br><span class="line"><span class="language-javascript">			<span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">		&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">			<span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">		&#125;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">legend</span>&gt;</span>作品名称<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;[这里写更新URL]&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span></span></span><br><span class="line"><span class="tag">				<span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span></span></span><br><span class="line"><span class="tag">				<span class="attr">onsubmit</span> = <span class="string">&quot;return checkSubmit()&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;ulform&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span>&gt;</span>油画名称<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;errPname&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;pname&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pname&quot;</span> <span class="attr">onblur</span>=<span class="string">&quot;checkEmpty(&#x27;#pname&#x27;,&#x27;#errPname&#x27;)&quot;</span>/&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span>&gt;</span>油画类型<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;errCategory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;category&quot;</span> <span class="attr">name</span>=<span class="string">&quot;category&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;checkCategory(&#x27;#category&#x27;,&#x27;#errCategory&#x27;)&quot;</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;-1&quot;</span>&gt;</span>请选择油画类型<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>现实主义<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>抽象主义<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span>&gt;</span>油画价格<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;errPrice&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;price&quot;</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> <span class="attr">onblur</span>=<span class="string">&quot;checkPrice(&#x27;#price&#x27;,&#x27;#errPrice&#x27;)&quot;</span>/&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span>&gt;</span>作品预览<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;errPainting&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;preview&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/upload/1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:361px;height:240px&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;painting&quot;</span> <span class="attr">name</span>=<span class="string">&quot;painting&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-left:0px;&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span>/&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span>&gt;</span>详细描述<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;errDescription&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">textarea</span></span></span><br><span class="line"><span class="tag">							<span class="attr">id</span>=<span class="string">&quot;description&quot;</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span></span></span><br><span class="line"><span class="tag">							<span class="attr">onblur</span>=<span class="string">&quot;checkEmpty(&#x27;#description&#x27;,&#x27;#errDescription&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">							&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn-button&quot;</span>&gt;</span>提交表单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ll.mgallery.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileUploadException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ll.mgallery.entity.Painting;</span><br><span class="line"><span class="keyword">import</span> com.ll.mgallery.service.PaintingService;</span><br><span class="line"><span class="keyword">import</span> com.ll.mgallery.utils.PageModel;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/management&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManagementController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">PaintingService</span> <span class="variable">paintingService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaintingService</span>();</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> HttpServlet#HttpServlet()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ManagementController</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">		<span class="comment">//通过method参数区分不同的操作</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;method&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span>(method.equals(<span class="string">&quot;list&quot;</span>)) &#123;<span class="comment">//分页查询列表</span></span><br><span class="line">			<span class="built_in">this</span>.list(request,response);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(method.equals(<span class="string">&quot;delete&quot;</span>)) &#123;</span><br><span class="line">			<span class="built_in">this</span>.delete(request,response);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(method.equals(<span class="string">&quot;show_create&quot;</span>)) &#123;<span class="comment">//显示新增页面</span></span><br><span class="line">			<span class="built_in">this</span>.showCreatePage(request,response);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(method.equals(<span class="string">&quot;create&quot;</span>)) &#123;</span><br><span class="line">			<span class="built_in">this</span>.create(request, response);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(method.equals(<span class="string">&quot;show_update&quot;</span>)) &#123;</span><br><span class="line">			<span class="built_in">this</span>.showUpdatePage(request,response);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(method.equals(<span class="string">&quot;update&quot;</span>)) &#123;</span><br><span class="line">			<span class="built_in">this</span>.update(request,response);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//分页查询列表</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">p</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">		<span class="type">String</span> <span class="variable">r</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;r&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span>(p == <span class="literal">null</span>) &#123;</span><br><span class="line">			p = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(r == <span class="literal">null</span>) &#123;</span><br><span class="line">			r = <span class="string">&quot;6&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">PageModel</span> <span class="variable">pageModel</span> <span class="operator">=</span> paintingService.pagination(Integer.parseInt(p),Integer.parseInt(r));</span><br><span class="line">		request.setAttribute(<span class="string">&quot;pageModel&quot;</span>, pageModel);</span><br><span class="line">		request.getRequestDispatcher(<span class="string">&quot;/WEB-INF/jsp/list.jsp&quot;</span>).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//显示新增页面</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showCreatePage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		request.getRequestDispatcher(<span class="string">&quot;/WEB-INF/jsp/create.jsp&quot;</span>).forward(request, response);		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//新增油画方法</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">//文件上传时的数据处理与标准表单完全不同</span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		String pname = request.getParameter(&quot;pname&quot;);</span></span><br><span class="line"><span class="comment">		System.out.println(pname);</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="comment">//1. 初始化FileUpload组件</span></span><br><span class="line">		<span class="type">FileItemFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DiskFileItemFactory</span>();</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * FileItemFactory 用于将前端表单的数据转换为一个个FileItem对象</span></span><br><span class="line"><span class="comment">		 * ServletFileUpload 则是为FileUpload组件提供Java web的Http请求解析</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="type">ServletFileUpload</span> <span class="variable">sf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletFileUpload</span>(factory);</span><br><span class="line">		<span class="comment">//2. 遍历所有FileItem</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			List&lt;FileItem&gt; formData = sf.parseRequest(request);</span><br><span class="line">			<span class="type">Painting</span> <span class="variable">painting</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Painting</span>();</span><br><span class="line">			<span class="keyword">for</span>(FileItem fi : formData) &#123;</span><br><span class="line">				<span class="keyword">if</span> (fi.isFormField()) &#123;</span><br><span class="line">					System.out.println(<span class="string">&quot;普通输入项:&quot;</span> + fi.getFieldName() + <span class="string">&quot;:&quot;</span> + fi.getString(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">					<span class="keyword">switch</span> (fi.getFieldName()) &#123;</span><br><span class="line">					<span class="keyword">case</span> <span class="string">&quot;pname&quot;</span>:</span><br><span class="line">						painting.setPname(fi.getString(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">case</span> <span class="string">&quot;category&quot;</span>:</span><br><span class="line">						painting.setCategory(Integer.parseInt(fi.getString(<span class="string">&quot;UTF-8&quot;</span>)));</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">case</span> <span class="string">&quot;price&quot;</span>:</span><br><span class="line">						painting.setPrice(Integer.parseInt(fi.getString(<span class="string">&quot;UTF-8&quot;</span>)));</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">case</span> <span class="string">&quot;description&quot;</span>:</span><br><span class="line">						painting.setDescription(fi.getString(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">default</span>:</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					System.out.println(<span class="string">&quot;文件上传项:&quot;</span> + fi.getFieldName());</span><br><span class="line">					<span class="comment">//3.文件保存到服务器目录</span></span><br><span class="line">					<span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> request.getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line">					System.out.println(<span class="string">&quot;上传文件目录:&quot;</span> + path);</span><br><span class="line">					<span class="comment">//String fileName = &quot;test.jpg&quot;;</span></span><br><span class="line">					<span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">					<span class="comment">//fi.getName()得到原始文件名,截取最后一个.后所有字符串,例如:wxml.jpg-&gt;.jpg</span></span><br><span class="line">					<span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> fi.getName().substring(fi.getName().lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">					<span class="comment">//fi.write()写入目标文件</span></span><br><span class="line">					fi.write(<span class="keyword">new</span> <span class="title class_">File</span>(path, fileName + suffix));</span><br><span class="line">					painting.setPreview(<span class="string">&quot;/upload/&quot;</span> + fileName + suffix);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			paintingService.create(painting);<span class="comment">//新增功能</span></span><br><span class="line">			response.sendRedirect(<span class="string">&quot;/management?method=list&quot;</span>);<span class="comment">//返回列表页</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 显示更新页面</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showUpdatePage</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">		<span class="type">Painting</span> <span class="variable">painting</span> <span class="operator">=</span> paintingService.findById(Integer.parseInt(id));</span><br><span class="line">		request.setAttribute(<span class="string">&quot;painting&quot;</span>, painting);</span><br><span class="line">		request.getRequestDispatcher(<span class="string">&quot;/WEB-INF/jsp/update.jsp&quot;</span>).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 实现油画更新</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="type">int</span> <span class="variable">isPreviewModified</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">		<span class="comment">//文件上传时的数据处理与标准表单完全不同</span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		String pname = request.getParameter(&quot;pname&quot;);</span></span><br><span class="line"><span class="comment">		System.out.println(pname);</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="comment">//1. 初始化FileUpload组件</span></span><br><span class="line">		<span class="type">FileItemFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DiskFileItemFactory</span>();</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * FileItemFactory 用于将前端表单的数据转换为一个个FileItem对象</span></span><br><span class="line"><span class="comment">		 * ServletFileUpload 则是为FileUpload组件提供Java web的Http请求解析</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="type">ServletFileUpload</span> <span class="variable">sf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletFileUpload</span>(factory);</span><br><span class="line">		<span class="comment">//2. 遍历所有FileItem</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			List&lt;FileItem&gt; formData = sf.parseRequest(request);</span><br><span class="line">			<span class="type">Painting</span> <span class="variable">painting</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Painting</span>();</span><br><span class="line">			<span class="keyword">for</span>(FileItem fi:formData) &#123;</span><br><span class="line">				<span class="keyword">if</span>(fi.isFormField()) &#123;</span><br><span class="line">					System.out.println(<span class="string">&quot;普通输入项:&quot;</span> + fi.getFieldName() + <span class="string">&quot;:&quot;</span> + fi.getString(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">					<span class="keyword">switch</span> (fi.getFieldName()) &#123;</span><br><span class="line">					<span class="keyword">case</span> <span class="string">&quot;pname&quot;</span>:</span><br><span class="line">						painting.setPname(fi.getString(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">case</span> <span class="string">&quot;category&quot;</span>:</span><br><span class="line">						painting.setCategory(Integer.parseInt(fi.getString(<span class="string">&quot;UTF-8&quot;</span>)));</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">case</span> <span class="string">&quot;price&quot;</span>:</span><br><span class="line">						painting.setPrice(Integer.parseInt(fi.getString(<span class="string">&quot;UTF-8&quot;</span>)));</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">case</span> <span class="string">&quot;description&quot;</span>:</span><br><span class="line">						painting.setDescription(fi.getString(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">case</span> <span class="string">&quot;id&quot;</span>:</span><br><span class="line">						painting.setId(Integer.parseInt(fi.getString(<span class="string">&quot;UTF-8&quot;</span>)));</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">case</span> <span class="string">&quot;isPreviewModified&quot;</span>:</span><br><span class="line">						isPreviewModified = Integer.parseInt(fi.getString(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">default</span>:</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">if</span>(isPreviewModified == <span class="number">1</span>) &#123;</span><br><span class="line">						System.out.println(<span class="string">&quot;文件上传项:&quot;</span> + fi.getFieldName());</span><br><span class="line">						<span class="comment">//3.文件保存到服务器目录</span></span><br><span class="line">						<span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> request.getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line">						System.out.println(<span class="string">&quot;上传文件目录:&quot;</span> + path);</span><br><span class="line">						<span class="comment">//String fileName = &quot;test.jpg&quot;;</span></span><br><span class="line">						<span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">						<span class="comment">//fi.getName()得到原始文件名,截取最后一个.后所有字符串,例如:wxml.jpg-&gt;.jpg</span></span><br><span class="line">						<span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> fi.getName().substring(fi.getName().lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">						<span class="comment">//fi.write()写入目标文件</span></span><br><span class="line">						fi.write(<span class="keyword">new</span> <span class="title class_">File</span>(path,fileName + suffix));</span><br><span class="line">						painting.setPreview(<span class="string">&quot;/upload/&quot;</span> + fileName + suffix);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//更新数据的核心方法</span></span><br><span class="line">			paintingService.update(painting, isPreviewModified);</span><br><span class="line">			response.sendRedirect(<span class="string">&quot;/management?method=list&quot;</span>);<span class="comment">//返回列表页</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 客户端采用Ajax方式提交Http请求</span></span><br><span class="line"><span class="comment">	 * Controller方法处理后不再跳转任何jsp,而是通过响应输出JSON格式字符串</span></span><br><span class="line"><span class="comment">	 * Tips:作为Ajax与服务器交互后,得到的不是整页HTML,而是服务器处理后的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">		<span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			paintingService.delete(Integer.parseInt(id));</span><br><span class="line">			<span class="comment">//&#123;&quot;result&quot;:&quot;ok&quot;&#125;</span></span><br><span class="line">			out.println(<span class="string">&quot;&#123;\&quot;result\&quot;:\&quot;ok\&quot;&#125;&quot;</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			out.println(<span class="string">&quot;&#123;\&quot;result\&quot;:\&quot;&quot;</span> + e.getMessage() + <span class="string">&quot;\&quot;&#125;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Publish"><a href="#Publish" class="headerlink" title="Publish"></a>Publish</h2><ul>
<li>export WAR</li>
<li>put WAR in <code>&#123;TOMCAT_HOME&#125;/webapps</code></li>
<li>start: run bin/startup.bat</li>
<li><code>&#123;TOMCAT_HOME&#125;/conf/server.xml</code>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">           connectionTimeout=&quot;20000&quot;</span><br><span class="line">           redirectPort=&quot;8443&quot; /&gt;</span><br><span class="line">&lt;Context path=&quot;/&quot;&gt; &lt;!-- so that we don&#x27;t need to have the project name in the url --&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Distributed"><a href="#Distributed" class="headerlink" title="Distributed"></a>Distributed</h2><ul>
<li>利用物理架构形成多个自治的处理元素，不共享主内存，但是通过发送信息合作。一个业务分拆多个子业务，部署在不同的服务器上。微服务是架构设计方式，分布式是系统部署方式。<h3 id="单体应用问题"><a href="#单体应用问题" class="headerlink" title="单体应用问题"></a>单体应用问题</h3></li>
<li>代码耦合严重</li>
<li>可用性低<h3 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h3>Consistency：读操作是否总能读到前一个写操作的结果<br>Availability：非故障节点应该在合理的时间内作出合理的响应（不是错误或超时的响应），但是可能不是最新的数据<br>Partition tolerance: 当出现网络分区现象后，系统能够继续“履行职责”，尽管任意数量的消息被节点间的网络丢失（或延迟），系统仍继续运行。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liam Lian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liam Lian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
