<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"liamyaolian.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Liam Lian&#39;s Blog">
<meta property="og:url" content="https://liamyaolian.github.io/page/2/index.html">
<meta property="og:site_name" content="Liam Lian&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Liam Lian">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://liamyaolian.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Liam Lian's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Liam Lian's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/04/12/Java-Core-Test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/12/Java-Core-Test/" class="post-title-link" itemprop="url">Java Core Test</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-12 17:43:13" itemprop="dateCreated datePublished" datetime="2022-04-12T17:43:13-04:00">2022-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-06-04 15:27:43" itemprop="dateModified" datetime="2022-06-04T15:27:43-04:00">2022-06-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h2><h3 id="Primitive"><a href="#Primitive" class="headerlink" title="Primitive"></a>Primitive</h3><p><img src="/../image/java-core-test/1.png" alt="Primitive"></p>
<h3 id="Non-Primitive"><a href="#Non-Primitive" class="headerlink" title="Non-Primitive"></a>Non-Primitive</h3><h4 id="BigDecimal"><a href="#BigDecimal" class="headerlink" title="BigDecimal"></a>BigDecimal</h4><ul>
<li>BigDecimal(val)</li>
<li>BigDecimal(String val)</li>
<li>add</li>
<li>subtract</li>
<li>multiply</li>
<li>public BigDecimal divide(BigDecimal divisor, int scale, RoundingMode roundingMode)</li>
<li>doubleValue(): Converts this BigDecimal to a double.</li>
<li>compareTo(BigDecimal val)</li>
</ul>
<h2 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h2><ul>
<li>if the integer &#x2F; integer (byte, short, char, int, long), result is integer</li>
<li>i++(return and increment) vs ++i</li>
<li>logical operator: short circuit; &amp; vs &amp;&amp;</li>
<li>priority<ul>
<li>member. index[] call function()</li>
<li>positive+ negative- ++ – bitwise complement ~ !</li>
<li><ul>
<li>&#x2F; %</li>
</ul>
</li>
<li>add+ deduct-  </li>
<li>&lt;&lt; signed right shift&gt;&gt;  unsigned right shift&gt;&gt;&gt;</li>
<li>&lt; &lt;&#x3D; &gt; &gt;&#x3D; instanceof</li>
<li>&#x3D;&#x3D; !&#x3D;</li>
<li>&amp;</li>
<li>|</li>
<li>bitwise XOR^</li>
<li>&amp;&amp;</li>
<li>||</li>
<li>? :</li>
<li>&#x3D; +&#x3D; -&#x3D; *&#x3D; &#x2F;&#x3D; %&#x3D; &amp;&#x3D; |&#x3D; ^&#x3D; &lt;&lt;&#x3D; &gt;&gt;&#x3D; &gt;&gt;&gt;&#x3D;</li>
</ul>
</li>
</ul>
<h2 id="Control"><a href="#Control" class="headerlink" title="Control"></a>Control</h2><ul>
<li>Labeled break and continue statements</li>
</ul>
<h2 id="Modifier"><a href="#Modifier" class="headerlink" title="Modifier"></a>Modifier</h2><h3 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h3><ul>
<li>public</li>
<li>private</li>
<li>default<ul>
<li>class and method: same package</li>
</ul>
</li>
<li>protected<ul>
<li>method: same package or subclasses</li>
</ul>
</li>
</ul>
<h3 id="Non-Access"><a href="#Non-Access" class="headerlink" title="Non-Access"></a>Non-Access</h3><h4 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h4><ul>
<li>final: no inheritance</li>
<li>abstract: no instantiation</li>
</ul>
<h4 id="Member"><a href="#Member" class="headerlink" title="Member"></a>Member</h4><ul>
<li>final<ul>
<li>variable<ul>
<li><p>primitive: cannot be modified</p>
</li>
<li><p>non-primitive: cannot refer to another object but the object can be modified</p>
</li>
<li><p>variable as member: should be initialized when being declared or in instance initialization block or constructor</p>
</li>
<li><p>variable in method: should be initialized before using</p>
</li>
</ul>
</li>
<li>method: can be inherited but can’t be overridden; cannot be used on a constructor</li>
</ul>
</li>
<li>static: belong to the class rather than an object; cannot be added to a variable in a method</li>
<li>abstract:<ul>
<li>class: abstract class cannot have <code>final</code></li>
<li>method<ul>
<li>can only be used on methods in an abstract class or an interface.</li>
<li>not have a body.</li>
<li>must be implemented in the subclass unless the subclass is abstract.</li>
<li>cannot have <code>static</code> or <code>private</code></li>
</ul>
</li>
</ul>
</li>
<li>transient: attributes and methods are skipped when serializing the object</li>
<li>synchronized: accessed by only one thread at a time</li>
<li>volatile: the value of an attribute is not cached thread-locally, and is always read from the “main memory”</li>
</ul>
<h3 id="Class-1"><a href="#Class-1" class="headerlink" title="Class"></a>Class</h3><p><img src="/../image/java-core-test/2.png" alt="instantiation"></p>
<ul>
<li>can call a constructor in the first line of another constructor, but cannot call a constructor in a method</li>
<li>Use multiple classes: try to find an accessible class in the current class, if not successful, try to find in the current package<h4 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h4></li>
<li>execution sequence: static block -&gt; instance initialization block -&gt; constructor</li>
<li>static block: cannot assign non-static member variable and declare static member; member declared in static block cannot be accessed from outside</li>
<li>the scope of the variable declared in a method is throughout the method, so we cannot declare the same variable in a block inside the method<h4 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h4></li>
<li>method and block: stack</li>
</ul>
<h4 id="Inner-class"><a href="#Inner-class" class="headerlink" title="Inner class"></a>Inner class</h4><ul>
<li><p>Non-static member inner classes</p>
<ul>
<li>outer$inner.class</li>
<li>cannot have static members</li>
<li><code>Person.Heart heart = new Person().new Heart();</code> or  <code>Person.Heart heart = new Person().getHeart();</code></li>
<li>can access members of the outer class.</li>
<li>方法访问某个变量<ul>
<li>该方法有该名字的成员变量 -&gt; 直接用该变量名</li>
<li>内部类中有该名字的成员变量 -&gt; 使用this.变量名</li>
<li>外部类中有该名字的成员变量 -&gt; 使用外部类的类名.this.非静态变量名 or 外部类的类名.静态变量 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class Outer &#123;</span><br><span class="line"></span><br><span class="line">    private int i = 1;</span><br><span class="line"></span><br><span class="line">    public class Inner &#123;</span><br><span class="line">        private int i = 2;</span><br><span class="line"></span><br><span class="line">        public void print() &#123;</span><br><span class="line">            int i = 3;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">            System.out.println(this.i);</span><br><span class="line">            System.out.println(Outer.this.i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Outer outer = new Outer();</span><br><span class="line">        Inner inner = outer.new Inner();</span><br><span class="line">        inner.print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>Static member inner class</p>
<ul>
<li>cannot directly access non-static members of the outer class but can access them through an instance of the outer class</li>
<li><code>Person.Heart heart = new Person.Heart();</code></li>
<li>方法访问某个变量<ul>
<li>该方法有该名字的成员变量 -&gt; 直接用该变量名</li>
<li>内部类中有该名字的成员变量 -&gt; 使用this.变量名</li>
<li>外部类中有该名字的static 成员变量 -&gt; 使用外部类的类名.变量名</li>
<li>外部类中有该名字的non-static 成员变量 -&gt; 使用new 外部类的类名().变量名</li>
</ul>
</li>
<li>when to used: when the inner class does not need to access the members of the outer class</li>
<li>outer$inner.class</li>
</ul>
</li>
<li><p>Method inner class</p>
<ul>
<li><p>scope: method</p>
</li>
<li><p>cannot have access modifier and static</p>
</li>
<li><p>cannot have static member but can have final and abstract member</p>
</li>
<li><p>类中普通方法如需访问外部方法中的局部变量，则该变量也需定义为final（jdk1.8之后底层默认会给该变量加上final）<br>···<br>public class Outer {<br>   private int s &#x3D; 100;<br>   private int out_i &#x3D; 1;<br>   public void f(final int k){<br> final int s &#x3D; 200;<br> final int j &#x3D; 10;<br> class Inner{ &#x2F;&#x2F;定义在方法内部<br>     int s &#x3D; 300;&#x2F;&#x2F;可以定义与外部类同名的变量<br>     &#x2F;&#x2F;static int m &#x3D; 20;&#x2F;&#x2F;不可以定义静态变量<br>     Inner(int k){<br>         inner_f(k);<br>     }<br>     int inner_i &#x3D; 100;<br>     void inner_f(int k){<br>         System.out.println(out_i);&#x2F;&#x2F;如果内部类没有与外部类同名的变量，在内部类中可以直接访问外部类的实例变量<br>         System.out.println(k);&#x2F;&#x2F;<em><strong><strong>可以访问外部类的局部变量(即方法内的变量)，但是变量必须是final的</strong></strong></em><br>         &#x2F;&#x2F;System.out.println(i);<br>         System.out.println(s);&#x2F;&#x2F;如果内部类中有与外部类同名的变量，直接用变量名访问的是内部类的变量<br>         System.out.println(this.s);&#x2F;&#x2F;用”this.变量名” 访问的也是内部类变量<br>         System.out.println(Outer.this.s);&#x2F;&#x2F;用外部”外部类类名.this.变量名” 访问的是外部类变量<br>     }<br>}<br>new Inner(k);<br>}</p>
<p>  public static void main(String[] args) {<br>  &#x2F;&#x2F;访问局部内部类必须先有外部类对象<br>  Outer out &#x3D; new Outer();<br>  out.f(3);<br>  }</p>
</li>
</ul>
<p> }<br>   ···</p>
<ul>
<li>outer$1inner.class</li>
<li>when to used: the class only used in this method</li>
</ul>
</li>
<li><p>Anonymous inner class</p>
<ul>
<li>must inherit a class or implement an interface</li>
<li>cannot have access modifier, static, abstract, or final</li>
<li>cannot have static members</li>
<li>cannot have constructor, but can have instance initialization block</li>
<li>outer$1.class</li>
</ul>
</li>
</ul>
<h4 id="Inner-class-in-interface"><a href="#Inner-class-in-interface" class="headerlink" title="Inner class in interface"></a>Inner class in interface</h4><ul>
<li>non-abstract inner: <code>new InterfaceName.Inner();</code>; or import and then <code>new Inner();</code>; or create a “get” method</li>
<li>abstract inner:<ul>
<li>implementation method 1: create a non-abstract class implements the interface. Inside this class, create a non-abstract class to inherit the abstract inner class in the interface.</li>
<li>implementation method 2: Anonymous inner class</li>
</ul>
</li>
</ul>
<h3 id="Wrapper-Class"><a href="#Wrapper-Class" class="headerlink" title="Wrapper Class"></a>Wrapper Class</h3><h4 id="boxing"><a href="#boxing" class="headerlink" title="boxing"></a>boxing</h4><ul>
<li><p>manual boxing</p>
<ul>
<li>new Integer(1);</li>
<li>Integer.valueOf(1);</li>
</ul>
</li>
<li><p>manual unboxing</p>
<ul>
<li>xxValue(): i1.intValue();</li>
</ul>
</li>
</ul>
<h4 id="unboxing"><a href="#unboxing" class="headerlink" title="unboxing"></a>unboxing</h4><ul>
<li><p>&#x3D;, pass pamameter, use operator to do operations</p>
</li>
<li><p>autoboxing: use valueOf()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int intVal = 1;</span><br><span class="line">Integer integerVal = intVal;</span><br></pre></td></tr></table></figure>
</li>
<li><p>auto unboxing: use xxValue()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int intVal = integerVal;</span><br></pre></td></tr></table></figure>
<h4 id="常量池"><a href="#常量池" class="headerlink" title="常量池"></a>常量池</h4></li>
<li><p>.valueOf()</p>
</li>
<li><p>-128 &lt;&#x3D; x &lt;&#x3D; 127</p>
</li>
<li><p>except Float and Double</p>
<h4 id="Compare"><a href="#Compare" class="headerlink" title="Compare"></a>Compare</h4></li>
<li><p>&#x3D;&#x3D; compares addresses</p>
</li>
<li><p><code>a.equals(b)</code> compares type and value. If b is primitive, auto-box it.</p>
<h4 id="Frequently-used-methods"><a href="#Frequently-used-methods" class="headerlink" title="Frequently used methods"></a>Frequently used methods</h4><h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4></li>
<li><p><code>Integer.toString(1);</code></p>
</li>
<li><p><code>Integer.parseInt(&quot;1&quot;);</code> to <code>int</code></p>
</li>
<li><p><code>Integer.valueOf(&quot;1&quot;);</code> to <code>Integer</code></p>
</li>
</ul>
<h3 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h3><ul>
<li>overload: same name, different parameter numbers or types</li>
<li>override<ul>
<li>in subclasses</li>
<li>same name, same parameters (sequence, number, type)</li>
<li>modifier &gt;&#x3D; that of superclass</li>
<li>return<ul>
<li>if return void or primitive: return type should be same as that of superclass</li>
<li>if return non-primitive: return type can be the same of that of the overridden method or its subclass</li>
</ul>
</li>
<li>cannot override constructor, final, and static methods (can declare static methods again)</li>
<li>if subclass and its superclass are in the same package, can override non-private methods except those mentioned above</li>
<li>if subclass and its superclass are not in the same package, can override public or protected methods except those mentioned above</li>
<li>overriding method can throw any unchecked exception</li>
<li>overriding method cannot throw a checked exception that is new or more general than that in the overridden method</li>
</ul>
</li>
<li>variable arguments: <code>int... args</code></li>
</ul>
<h3 id="String-1"><a href="#String-1" class="headerlink" title="String"></a>String</h3><ul>
<li>immutable</li>
<li>&#x3D;&#x3D; address; equals() content</li>
<li>“s” is constant is in the constant pool. <code>String s = new String(&quot;s&quot;)</code> will check the constant pool first. If exist, use directly.</li>
<li><code>new String(&quot;s&quot;)</code> creates “s” in the constant pool first and then create an object on heap.</li>
<li>char array or byte array<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">char[] chars = &#123;&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;d&#x27;,&#x27;e&#x27;&#125;;</span><br><span class="line">String s1 = new String(chars);</span><br><span class="line">String s2 = new String(chars, 1, 2); // bc</span><br><span class="line"></span><br><span class="line">byte[] b = &#123;54, 69, 70, 71, 72&#125;; // ASCII</span><br><span class="line">String s3 = new String(b);</span><br><span class="line">String s4 = new String(b, 1, 2);</span><br><span class="line">String s5 = new String(b, &quot;utf-8&quot;);</span><br><span class="line">String s6 = new String(b, 1, 2, &quot;utf-8&quot;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Frequently-Used-Methods"><a href="#Frequently-Used-Methods" class="headerlink" title="Frequently Used Methods"></a>Frequently Used Methods</h4><p><img src="/../image/java-core-test/7.png" alt="Primitive"></p>
<ul>
<li><code>.getBytes()</code> or <code>.getBytes(&quot;utf-8&quot;)</code></li>
<li>firstName.concat(lastName)</li>
</ul>
<h4 id="StringBuilder"><a href="#StringBuilder" class="headerlink" title="StringBuilder"></a>StringBuilder</h4><ul>
<li>mutable, thread-unsafe<h5 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h5></li>
<li>StringBuilder append(“s”)</li>
<li>StringBuilder insert(position, “s”)</li>
<li>String toString()</li>
<li>int length()</li>
</ul>
<h4 id="StringBuffer"><a href="#StringBuffer" class="headerlink" title="StringBuffer"></a>StringBuffer</h4><ul>
<li>mutable, thread-safe</li>
</ul>
<h3 id="Object-Class"><a href="#Object-Class" class="headerlink" title="Object Class"></a>Object Class</h3><ul>
<li>superclass of any class</li>
<li>equals: addresse1 &#x3D;&#x3D; addresse2</li>
<li>toString: <code>getClass().getName() + &#39;@&#39; + Integer.toHexString(hashCode())</code>; when using sout, used by default</li>
<li>hashCode: This is typically implemented by converting the internal address of the object into an integer, but this implementation technique is not required by the Java™ programming language.</li>
<li>getClass: Returns the runtime class of this object</li>
</ul>
<h4 id="hashCode"><a href="#hashCode" class="headerlink" title="hashCode()"></a>hashCode()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public int hashCode() &#123;</span><br><span class="line">  final int base = 1000000;</span><br><span class="line">  int result = 17;</span><br><span class="line">  final int prime = 31;</span><br><span class="line">  result = (result * prime % base + (type == null ? 0 : type.hashCode()) % base) % base;</span><br><span class="line">  result = (result * prime % base + (containerId == null ? 0 : containerId.hashCode()) % base) % base;</span><br><span class="line">  result = (result * prime % base + (startDate == null ? 0 : startDate.hashCode()) % base) % base;</span><br><span class="line">  result = (result * prime % base + (endDate == null ? 0 : endDate.hashCode()) % base) % base;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="equals"><a href="#equals" class="headerlink" title="equals()"></a>equals()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public boolean equals(Object obj) &#123;</span><br><span class="line">  if (obj == null) &#123;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (this == obj) &#123;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (obj.getClass() == Cat.class) &#123;</span><br><span class="line">    Cat cat = (Cat) obj;</span><br><span class="line">    return cat.getName().equals(name) &amp;&amp; (cat.getAge() == age);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return false;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public boolean equals(Object other) &#123;</span><br><span class="line">  if (other == null) &#123;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (other == this) &#123;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (!(other instanceof CostContainer)) &#123;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  CostContainer obj = (CostContainer) other;</span><br><span class="line">  return obj.getType().equals(type)</span><br><span class="line">      &amp;&amp; obj.getContainerId() == containerId</span><br><span class="line">      &amp;&amp; obj.startDate.equals(startDate)</span><br><span class="line">      &amp;&amp; obj.endDate.equals(endDate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Polymorphism"><a href="#Polymorphism" class="headerlink" title="Polymorphism"></a>Polymorphism</h3><ul>
<li>decide which class’ method to use based on the type of instance that calls a method</li>
<li>need to have<ul>
<li>inheritance</li>
<li>superclass reference refers to subclass instance</li>
</ul>
</li>
<li>upcast: <code>Animal animal = new Cat();</code>. cannot call a method that is not declared in superclass</li>
<li>downcast: <code>Cat cat = (Cat)(new Animal());</code>. can use a method not declared in superclass but declared in subclass. Note the operation priority: <code>((Chinese)person).kungfu();</code>.</li>
<li><code>instanceof</code>: <code>cat instanceof Animal; //true</code>. can only be converted into its original type.</li>
</ul>
<h3 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h3><ul>
<li>is-a</li>
<li>only one superclass</li>
<li>super</li>
<li>constructor<ul>
<li>When construct a subclass, must use the constructor of its superclass. Default is the superclass constructor without parameters. Error if it does not exist.</li>
<li>Use <code>super</code> to call a superclass constructor. Must be put in the first line of the constructor.</li>
</ul>
</li>
</ul>
<h3 id="Interface-vs-Abstract"><a href="#Interface-vs-Abstract" class="headerlink" title="Interface vs Abstract"></a>Interface vs Abstract</h3><h4 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h4><p>···<br>[default or public] interface InterfaceName [extends SuperInterfaceName1, SuperInterfaceName2, …] {<br>    [public static final] TypeName CONSTANT &#x3D; ;<br>    [public abstract] TypeName abstractMethod([args]); &#x2F;&#x2F; no body<br>    [public] default TypeName defaultMethod([args]){}; &#x2F;&#x2F; the overriding method does not need to have <code>default</code>; In the overriding method, can use InterfaceName.super.methodName() to call the original method<br>    [public] static TypeName staticMethod() {}; &#x2F;&#x2F; cannot be inherited or overridden, but the implementation class can declare again<br>}<br>···</p>
<ul>
<li>A class can implement multiple interfaces separated by commas. If so, can inherit only abstract methods</li>
<li>If the implementation class implements multiple interfaces which have the same method, the implementation class should override the method</li>
<li>If the implementation class extends a superclass and implements multiple interfaces and the superclass and interfaces have the same method and the same member variable, and if the implementation class does not override the method, by default the method in the superclass will be used when needed, but cannot tell which member variable to use</li>
</ul>
<h3 id="Exception"><a href="#Exception" class="headerlink" title="Exception"></a>Exception</h3><p><img src="/../image/java-core-test/4.png" alt="Exception and Error"></p>
<ul>
<li><p>checked exception: must use “try-catch” or “throws”</p>
</li>
<li><p>try</p>
</li>
<li><p>catch: optional; catch by type; if caught, will not enter other catch blocks, so put catch blocks for smaller-scope exceptions first and put <code>catch(Exception)</code> at last; <code>System.exit(1);</code> will end the program</p>
</li>
<li><p>finally: optional; will run no matter whether there is an exception; if there is no catch block, must have finally block; used to release resource<br><img src="/../image/java-core-test/5.png" alt="finally"><br><img src="/../image/java-core-test/6.png" alt="finally"></p>
</li>
<li><p>throws: declare some potential exceptions, the method that calls this method will deal with the exception</p>
</li>
<li><p>throw: throw an instance, Throwable or its subclass</p>
</li>
<li><p>the scope of variable declared in try, catch, finally blocks is the block</p>
</li>
<li><p>inherit Throwable or its subclass</p>
</li>
<li><p>exception chain</p>
<ul>
<li>Throwable(String message, Throwable cause)</li>
<li>Throwable(Throwable cause)</li>
<li>initCause(Throwable cause): initialize the cause of this throwable to the specified value.</li>
</ul>
</li>
<li><p>method</p>
</li>
</ul>
<ul>
<li>toString()</li>
<li>getMessage()</li>
<li>printStackTrace()</li>
</ul>
<ul>
<li>common exception types<ul>
<li>Exception</li>
<li>ArithmeticException</li>
<li>ArrayIndexOutOfBoundsException</li>
<li>ArrayStoreException</li>
<li>NullPointerException</li>
<li>ClassNotFoundException</li>
<li>IllegalArgumentException</li>
<li>InputMismatchException</li>
<li>ClassCastException</li>
<li>NumberFormatException</li>
<li>FileNotFoundException</li>
</ul>
</li>
</ul>
<h3 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h3><h4 id="File"><a href="#File" class="headerlink" title="File"></a>File</h4><ul>
<li><p>File(File parent, String child): Creates a new File instance from a parent abstract pathname and a child pathname string.</p>
</li>
<li><p>File(String pathname): Creates a new File instance by converting the given pathname string into an abstract pathname.</p>
</li>
<li><p>File(String parent, String child): Creates a new File instance from a parent pathname string and a child pathname string.</p>
</li>
<li><p>File(URI uri): Creates a new File instance by converting the given file: URI into an abstract pathname.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File file1=new File(&quot;c:\\ll\\io\\score.txt&quot;); // Windows: \\, linux: /</span><br><span class="line">File file1=new File(&quot;c:\\ll&quot;,&quot;io\\score.txt&quot;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>isDirectory()</p>
</li>
<li><p>isFile()</p>
</li>
<li><p>exists()</p>
</li>
<li><p>mkdir()</p>
</li>
<li><p>mkdirs()</p>
</li>
<li><p>createNewFile()</p>
<h4 id="Byte-Stream"><a href="#Byte-Stream" class="headerlink" title="Byte Stream"></a>Byte Stream</h4><h5 id="FileInputStream"><a href="#FileInputStream" class="headerlink" title="FileInputStream"></a>FileInputStream</h5></li>
<li><p>FileInputStream(File file): Creates a FileInputStream by opening a connection to an actual file, the file named by the File object file in the file system.</p>
</li>
<li><p>FileInputStream(FileDescriptor fdObj): Creates a FileInputStream by using the file descriptor fdObj, which represents an existing connection to an actual file in the file system.</p>
</li>
<li><p>FileInputStream(String name): Creates a FileInputStream by opening a connection to an actual file, the file named by the path name name in the file system.</p>
</li>
<li><p>public int read() &#x2F;&#x2F; return the next byte of data, or -1 if the end of the file is reached.</p>
</li>
<li><p>public int read(byte[] b) &#x2F;&#x2F; the total number of bytes read into the buffer, or -1 if there is no more data because the end of the file has been reached.</p>
</li>
<li><p>public int read(byte[] b, int off, int len) &#x2F;&#x2F; off is the byte array starting index from which we save data</p>
</li>
<li><p>public void close()</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">public class FileInputDemo1 &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">		try &#123;</span><br><span class="line">			FileInputStream fis = new FileInputStream(&quot;ll.txt&quot;);</span><br><span class="line"></span><br><span class="line">			int n = 0;</span><br><span class="line"></span><br><span class="line">			while((n = fis.read()) != -1)&#123;</span><br><span class="line">				System.out.print((char)n);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			fis.close();</span><br><span class="line">		&#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; catch(IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class FileInputDemo2 &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			FileInputStream fis = new FileInputStream(&quot;ll.txt&quot;);</span><br><span class="line">			byte[] b = new byte[100];</span><br><span class="line">			fis.read(b, 0, 5);</span><br><span class="line">			System.out.println(new String(b));</span><br><span class="line">			fis.close();</span><br><span class="line">		&#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; catch (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="FileOutputStream"><a href="#FileOutputStream" class="headerlink" title="FileOutputStream"></a>FileOutputStream</h5><ul>
<li><p>FileOutputStream(File file): Creates a file output stream to write to the file represented by the specified File object.</p>
</li>
<li><p>FileOutputStream(File file, boolean append): Creates a file output stream to write to the file represented by the specified File object.</p>
</li>
<li><p>FileOutputStream(FileDescriptor fdObj): Creates a file output stream to write to the specified file descriptor, which represents an existing connection to an actual file in the file system.</p>
</li>
<li><p>FileOutputStream(String name): Creates a file output stream to write to the file with the specified name.</p>
</li>
<li><p>FileOutputStream(String name, boolean append): Creates a file output stream to write to the file with the specified name.</p>
</li>
<li><p>public void write(int b)</p>
</li>
<li><p>public void write(byte[] b)</p>
</li>
<li><p>public void write(byte[] b, int off, int len) &#x2F;&#x2F; starting from index off in the byte array, save len bytes to the file</p>
</li>
<li><p>public void close()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">public class FileOutputDemo &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		FileOutputStream fos;</span><br><span class="line">		FileInputStream fis;</span><br><span class="line">		try &#123;</span><br><span class="line">			fos = new FileOutputStream(&quot;ll.txt&quot;,true);</span><br><span class="line">			fis = new FileInputStream(&quot;ll.txt&quot;);</span><br><span class="line">			fos.write(50);</span><br><span class="line">			fos.write(&#x27;a&#x27;);</span><br><span class="line">			System.out.println(fis.read());</span><br><span class="line">			System.out.println((char)fis.read());</span><br><span class="line"></span><br><span class="line">      // first opened, first closed</span><br><span class="line">			fos.close();</span><br><span class="line">			fis.close();</span><br><span class="line"></span><br><span class="line">		&#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; catch (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class FileOutputDemo1 &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		// copy a file</span><br><span class="line">		try &#123;</span><br><span class="line">			FileInputStream fis = new FileInputStream(&quot;happy.gif&quot;);</span><br><span class="line">			FileOutputStream fos = new FileOutputStream(&quot;happycopy.gif&quot;);</span><br><span class="line">			int n = 0;</span><br><span class="line">			byte[] b = new byte[1024];</span><br><span class="line">			while ((n = fis.read(b)) != -1) &#123;</span><br><span class="line">				fos.write(b, 0, n);</span><br><span class="line">			&#125;</span><br><span class="line">			fis.close();</span><br><span class="line">			fos.close();</span><br><span class="line">		&#125; catch (FileNotFoundException e) &#123;</span><br><span class="line"></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; catch(IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="BufferedInputStream-and-BufferedOutputStream"><a href="#BufferedInputStream-and-BufferedOutputStream" class="headerlink" title="BufferedInputStream and BufferedOutputStream"></a>BufferedInputStream and BufferedOutputStream</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedInputStream;</span><br><span class="line">import java.io.BufferedOutputStream;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">public class BufferedDemo &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			FileOutputStream fos = new FileOutputStream(&quot;ll.txt&quot;);</span><br><span class="line">			BufferedOutputStream bos = new BufferedOutputStream(fos);</span><br><span class="line">			FileInputStream fis = new FileInputStream(&quot;ll.txt&quot;);</span><br><span class="line">			BufferedInputStream bis = new BufferedInputStream(fis);</span><br><span class="line">			long startTime = System.currentTimeMillis();</span><br><span class="line">			bos.write(50);</span><br><span class="line">			bos.write(&#x27;a&#x27;);</span><br><span class="line">			bos.flush(); // The buffer is not full yet. Force to write the content inf the buffer to the file and clear the buffer</span><br><span class="line"></span><br><span class="line">			System.out.println(bis.read());</span><br><span class="line">			System.out.println((char)bis.read());</span><br><span class="line">			long endTime = System.currentTimeMillis();</span><br><span class="line">			System.out.println(endTime - startTime);</span><br><span class="line"></span><br><span class="line">			fos.close();</span><br><span class="line">			bos.close();</span><br><span class="line">			fis.close();</span><br><span class="line">			bis.close();</span><br><span class="line">		&#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; catch (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="character-stream"><a href="#character-stream" class="headerlink" title="character stream"></a>character stream</h4><h5 id="InputStreamReader-OutputStreamReader-BufferedReader-BufferedWriter"><a href="#InputStreamReader-OutputStreamReader-BufferedReader-BufferedWriter" class="headerlink" title="InputStreamReader, OutputStreamReader, BufferedReader, BufferedWriter"></a>InputStreamReader, OutputStreamReader, BufferedReader, BufferedWriter</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.BufferedWriter;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line">import java.io.OutputStreamWriter;</span><br><span class="line"></span><br><span class="line">public class ReaderDemo &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			FileInputStream fis = new FileInputStream(&quot;ll.txt&quot;);</span><br><span class="line">			InputStreamReader isr = new InputStreamReader(fis, &quot;GBK&quot;);</span><br><span class="line">			BufferedReader br = new BufferedReader(isr);</span><br><span class="line"></span><br><span class="line">			FileOutputStream fos = new FileOutputStream(&quot;ll1.txt&quot;);</span><br><span class="line">			OutputStreamWriter osw = new OutputStreamWriter(fos, &quot;GBK&quot;);</span><br><span class="line">			BufferedWriter bw = new BufferedWriter(osw);</span><br><span class="line"></span><br><span class="line">			int n = 0;</span><br><span class="line">			char[] cbuf = new char[10];</span><br><span class="line"></span><br><span class="line">			while((n = br.read(cbuf)) != -1)&#123;</span><br><span class="line">				bw.write(cbuf, 0, n);</span><br><span class="line">				bw.flush();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			fis.close();</span><br><span class="line">			fos.close();</span><br><span class="line">			isr.close();</span><br><span class="line">			osw.close();</span><br><span class="line">			br.close();</span><br><span class="line">			bw.close();</span><br><span class="line">		&#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		catch (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Serialization"><a href="#Serialization" class="headerlink" title="Serialization"></a>Serialization</h4><ul>
<li>object to bytes</li>
<li>class implements Serializable</li>
<li>ObjectInputStream and ObjectOutputStream<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.ObjectInputStream;</span><br><span class="line">import java.io.ObjectOutputStream;</span><br><span class="line"></span><br><span class="line">public class GoodsTest &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">		Goods goods1 = new Goods(&quot;gd001&quot;, &quot;电脑&quot;, 3000);</span><br><span class="line">		try &#123;</span><br><span class="line">			FileOutputStream fos = new FileOutputStream(&quot;ll.txt&quot;);</span><br><span class="line">			ObjectOutputStream oos = new ObjectOutputStream(fos);</span><br><span class="line">			FileInputStream fis = new FileInputStream(&quot;ll.txt&quot;);</span><br><span class="line">			ObjectInputStream ois = new ObjectInputStream(fis);</span><br><span class="line"></span><br><span class="line">			oos.writeObject(goods1);</span><br><span class="line">			oos.writeBoolean(true);</span><br><span class="line">			oos.flush();</span><br><span class="line"></span><br><span class="line">			try &#123;</span><br><span class="line">				Goods goods = (Goods) ois.readObject();</span><br><span class="line">				System.out.println(goods);</span><br><span class="line">			&#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(ois.readBoolean());</span><br><span class="line"></span><br><span class="line">			fos.close();</span><br><span class="line">			oos.close();</span><br><span class="line">			fis.close();</span><br><span class="line">			ois.close();</span><br><span class="line">		&#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; catch (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h3><h3 id="Generic-Type"><a href="#Generic-Type" class="headerlink" title="Generic Type"></a>Generic Type</h3><ul>
<li>generic type as method parameter<ul>
<li><? extends Goods>; extends a class or an interface</li>
<li><? super Goods></li>
</ul>
</li>
<li>Define a generic type: <code>class ClassName&lt;T, X&gt; &#123;&#125;</code></li>
<li>generic type method<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class ClassName &#123;</span><br><span class="line">  public &lt;T&gt; void printValue(T t) &#123;</span><br><span class="line">    System.out.println(t);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>泛型的类型参数只能是类类型，不能是基本数据类型</li>
</ul>
<h3 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h3><ul>
<li>see the post “Collection”</li>
</ul>
<h3 id="Multithread"><a href="#Multithread" class="headerlink" title="Multithread"></a>Multithread</h3><ul>
<li>Process: to do</li>
<li>Thread</li>
<li>各线程什么时候得到CPU时间，占用多久，是不可预测的</li>
</ul>
<h4 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h4><ul>
<li><p>create an instance of Thread or its subclass</p>
<ul>
<li>Thread implements Runnable</li>
<li>Thread()</li>
<li>Thread(String name)</li>
<li>Thread(Runnable target)</li>
<li>Thread(Runnable target, String name)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mt1.setPriority(Thread.MAX_PRIORITY);</span><br></pre></td></tr></table></figure>
</li>
<li><p>create an instance of a class that implements Runnable</p>
<ul>
<li>only has one method: run()</li>
<li>why to use: can extend only one class; do not want to override other methods in Thread<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> class PrintRunnable implements Runnable &#123;</span><br><span class="line">int i = 1;</span><br><span class="line">@Override</span><br><span class="line">public void run() &#123;</span><br><span class="line"></span><br><span class="line">	while (i &lt;= 10) &#123;</span><br><span class="line">		System.out.println(Thread.currentThread().getName() + &quot;正在运行&quot; + (i++));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> public class Test &#123;</span><br><span class="line"></span><br><span class="line"> 	public static void main(String[] args) &#123;</span><br><span class="line"> 		PrintRunnable pr = new PrintRunnable();</span><br><span class="line"> 		Thread t1 = new Thread(pr);</span><br><span class="line"> 		t1.start();</span><br><span class="line"> 		Thread t2 = new Thread(pr);</span><br><span class="line"> 		t2.start();</span><br><span class="line"></span><br><span class="line"> 	&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Callable&lt;&gt;</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import java.util.concurrent.Callable;</span><br><span class="line">public class ThirdThread implements Callable&lt;String&gt; &#123;</span><br><span class="line">  @override</span><br><span class="line">  public String call() throws Exception &#123;</span><br><span class="line">    String str = &quot;the third way to create a thread&quot;;</span><br><span class="line">    return str;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ThirdThreadTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    Callable&lt;String&gt; call = new ThirdThread();</span><br><span class="line">    FutureTask&lt;String&gt; ft = new FutureTask&lt;&gt;(call);</span><br><span class="line">    Thread thread = new Thread(ft);</span><br><span class="line"></span><br><span class="line">    thread.start();</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      System.out.println(ft.get()); // get the result after the thread finishes, i.e. &quot;the third way to create a thread&quot;</span><br><span class="line">    &#125; catch (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Thread-methods"><a href="#Thread-methods" class="headerlink" title="Thread methods"></a>Thread methods</h4></li>
<li><p>public void run()</p>
</li>
<li><p>public void start()</p>
</li>
<li><p>public static void sleep(long m) &#x2F;&#x2F; millisecond, used to do something periodically</p>
</li>
<li><p>public void join() &#x2F;&#x2F; other threads will execute after this thread finishes</p>
</li>
<li><p>public final void join(long millis) &#x2F;&#x2F; 等待该线程终止的最长时间为millis毫秒。如果millis为0则意味着要一直等下去。</p>
</li>
<li><p>getName()</p>
</li>
<li><p>public int getPriority()</p>
</li>
<li><p>public void setPriority(int newPriority)</p>
</li>
<li><p>wait()</p>
</li>
<li><p>notify() &#x2F;&#x2F; 唤醒一个等待线程</p>
</li>
<li><p>nofifyAll() &#x2F;&#x2F;唤醒所有等待线程</p>
<h4 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h4><p><img src="/../image/java-core-test/8.png" alt="thread lifecycle"></p>
</li>
<li><p>stop() is depreciated</p>
<h4 id="Priority"><a href="#Priority" class="headerlink" title="Priority"></a>Priority</h4></li>
<li><p>1 (MIN_PRIORITY) to 10 (MAX_PRIORITY), default is 5 (NORM_PRIORITY)</p>
</li>
<li><p>the thread with higher priority is not necessarily excuted first</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class MyThread extends Thread &#123;</span><br><span class="line">	private String name;</span><br><span class="line">	public MyThread(String name) &#123;</span><br><span class="line">		this.name=name;</span><br><span class="line">	&#125;</span><br><span class="line">	public void run() &#123;</span><br><span class="line">		for (int i = 1; i &lt;= 50; i++) &#123;</span><br><span class="line">			System.out.println(&quot;线程&quot; + name + &quot;正在运行&quot; + i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">public class PriorityDemo &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		//获取主线程的优先级</span><br><span class="line">		int mainPriority = Thread.currentThread().getPriority();</span><br><span class="line">		//System.out.println(&quot;主线程的优先级为：&quot; + mainPriority);</span><br><span class="line">		MyThread mt1 = new MyThread(&quot;线程1&quot;);</span><br><span class="line">		MyThread mt2 = new MyThread(&quot;线程2&quot;);</span><br><span class="line">		//mt1.setPriority(10);</span><br><span class="line">		mt1.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">		mt2.setPriority(Thread.MIN_PRIORITY);</span><br><span class="line">		mt2.start();</span><br><span class="line">		mt1.start();</span><br><span class="line">		//System.out.println(&quot;线程1的优先级为：&quot; + mt1.getPriority());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h4></li>
<li><p>It is not possible for two invocations of synchronized methods on the same object to interleave. When one thread is executing a synchronized method for an object, all other threads that invoke synchronized methods for the same object block (suspend execution) until the first thread is done with the object.</p>
</li>
<li><p>Second, when a synchronized method exits, it automatically establishes a happens-before relationship with any subsequent invocation of a synchronized method for the same object. This guarantees that changes to the state of the object are visible to all threads.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public synchronized void saveAccount()&#123;&#125;</span><br><span class="line">public static synchronized void saveAccount()&#123;&#125;</span><br><span class="line">synchronized (obj)&#123;……&#125;</span><br><span class="line"></span><br><span class="line">public void drawAccount() &#123;</span><br><span class="line">  synchronized (this) &#123;</span><br><span class="line"></span><br><span class="line">    int balance = getBalance();</span><br><span class="line">    balance = balance - 200;</span><br><span class="line">    try &#123;</span><br><span class="line">      Thread.sleep(1000);</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    setBalance(balance);</span><br><span class="line">    System.out.println(&quot;取款后的帐户余额：&quot; + balance);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Deadlock"><a href="#Deadlock" class="headerlink" title="Deadlock"></a>Deadlock</h4></li>
<li><p>Deadlock describes a condition in which two or more threads are blocked (hung) forever because they are waiting for each other.</p>
</li>
<li><p>notifyAll();</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public class Queue &#123;</span><br><span class="line">	private int n;</span><br><span class="line">	boolean flag = false;</span><br><span class="line"></span><br><span class="line">	public synchronized int get() &#123;</span><br><span class="line">		if (!flag) &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				wait();</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(&quot;消费：&quot; + n);</span><br><span class="line">		flag = false;//消费完毕，容器中没有数据</span><br><span class="line">		notifyAll();</span><br><span class="line">		return n;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public synchronized void set(int n) &#123;</span><br><span class="line">		if (flag) &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				wait();</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line"></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(&quot;生产：&quot; + n);</span><br><span class="line">		this.n = n;</span><br><span class="line">		flag = true;//生产完毕，容器中已经有数据</span><br><span class="line">		notifyAll();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Pool"><a href="#Pool" class="headerlink" title="Pool"></a>Pool</h4><ul>
<li>why<ul>
<li>反复创建线程开销大</li>
<li>过多的线程会占用太多内存; 如果需要创建5个以上的线程，那么就可以使用线程池来管理</li>
</ul>
</li>
<li>constructor<ul>
<li>corePoolSize: int, 线程池在完成初始化后，默认情况下，线程池中并没有任何线程，线程池会等待有任务到来时，再创建新线程去执行任务</li>
<li>maxPoolSize int 最大线程数，详解见下文</li>
<li>keepAliveTime long 保持存活时间</li>
<li>workQueue BlockingQueue 任务存储队列<ul>
<li>直接交接：SynchronousQueue, 容量为0</li>
<li>无界队列：LinkedBlockingQueue</li>
<li>有界的队列：ArrayBlockingQueue</li>
</ul>
</li>
<li>threadFactory ThreadFactory当线程池需要新的线程的时候，会使用threadFactory来生成新的线程<ul>
<li>Executors.defaultThreadFactory()</li>
<li>创建出来的线程都在同一个线程组，拥有同样的NORM_PRIORITY优先级并且都不是守护线程。</li>
<li>如果自己指定ThreadFactory，那么就可以改变线程名、线程组、优先级、是否是守护线程等。通常使用默认的ThreadFactory就可以了。</li>
</ul>
</li>
<li>Handler RejectedExecutionHandler 由于线程池无法接受你所提交的任务的拒绝策略</li>
</ul>
</li>
<li>rule<ul>
<li>如果线程数小于corePoolSize，即使其他工作线程处于空闲状态，也会创建一个新线程来运行新任务。</li>
<li>如果线程数等于（或大于）corePoolSize但少于maximumPoolSize，则将任务放入队列。</li>
<li>如果队列已满，并且线程数小于maxPoolSize，则创建一个新线程来运行任务。只有在队列填满时才创建多于corePoolSize的线程，如果使用的是无界队列（例如LinkedBlockingQueue），那么线程数就不会超过corePoolSize。</li>
<li>如果队列已满，并且线程数大于或等于maxPoolSize，则拒绝该任务。</li>
<li>如果线程池当前的线程数多于corePoolSize，那么如果多余的线程空闲时间超过keepAliveTime，它们就会被终止</li>
</ul>
</li>
<li>how many threads<ul>
<li>CPU密集型（加密、计算hash等）：最佳线程数为CPU核心数的1-2倍左右。</li>
<li>耗时IO型（读写数据库、文件、网络读写等）：最佳线程数一般会大于CPU核心数很多倍</li>
<li>参考Brain Goetz推荐的计算方法：线程数&#x3D;CPU核心数*（1+平均等待时间&#x2F;平均工作时间）</li>
<li>stress test</li>
</ul>
</li>
</ul>
<h3 id="Reflex"><a href="#Reflex" class="headerlink" title="Reflex"></a>Reflex</h3><ul>
<li>运行时动态访问类与对象<h4 id="Class-2"><a href="#Class-2" class="headerlink" title="Class"></a>Class</h4></li>
<li>代表”类和接口”的类</li>
<li>通过Class对象可获取对应类的构造方法&#x2F;方法&#x2F;成员变量</li>
<li>methods<ul>
<li>Class.forName()</li>
<li>classObj.newInstance()</li>
<li>classObj.getConstructor()</li>
<li>classObj.getMethod()</li>
<li>classObj.getField()<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//得到员工类的类对象</span><br><span class="line">Class employeeClass = Class.forName(&quot;com.ll.reflect.entity.Employee&quot;);</span><br><span class="line">//通过员工类默认构造方法创建Employee对象</span><br><span class="line">Employee employee = (Employee)employeeClass.newInstance();</span><br></pre></td></tr></table></figure>
<h4 id="Constructor"><a href="#Constructor" class="headerlink" title="Constructor"></a>Constructor</h4></li>
</ul>
</li>
<li>methods<ul>
<li>classObj.getConstructor(): get a public constructor object</li>
<li>constructorObj.newInstance()<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//得到员工类的类对象</span><br><span class="line">Class employeeClass = Class.forName(&quot;com.ll.reflect.entity.Employee&quot;);</span><br><span class="line">//得到Employee类包含四个参数的构造方法对象</span><br><span class="line">Constructor constructor = employeeClass.getConstructor(new Class[]&#123;</span><br><span class="line">              Integer.class,</span><br><span class="line">              String.class,</span><br><span class="line">              Float.class,</span><br><span class="line">              String.class</span><br><span class="line">            &#125;);</span><br><span class="line">//通过指定构造方法传入数据,创建对象</span><br><span class="line">Employee employee = (Employee) constructor.newInstance(new Object[]&#123;</span><br><span class="line">                      100,</span><br><span class="line">                      &quot;Liam Lian&quot;,</span><br><span class="line">                      3000f,</span><br><span class="line">                      &quot;Product&quot;&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Method-1"><a href="#Method-1" class="headerlink" title="Method"></a>Method</h4></li>
</ul>
</li>
<li>methods<ul>
<li>classObj.getMethod(): get a public method object</li>
<li>methodObj.invoke()<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Method method = employeeClass.getMethod(&quot;updateSalary&quot;, new Class[]&#123;Float.class&#125;);</span><br><span class="line">//执行方法,为Liam Lian上调薪资300元</span><br><span class="line">method.invoke(employee, new Object[]&#123;300f&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Field"><a href="#Field" class="headerlink" title="Field"></a>Field</h4></li>
</ul>
</li>
<li>methods<ul>
<li>classObj.getField(): get a public field object</li>
<li>fieldObj.set()</li>
<li>fieldObj.get()<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Field enameField = employeeClass.getField(&quot;ename&quot;);</span><br><span class="line">enameField.set(employee, &quot;Liam Lian&quot;);</span><br><span class="line">String ename = (String)enameField.get(employee);</span><br></pre></td></tr></table></figure>
<h4 id="getDeclared"><a href="#getDeclared" class="headerlink" title="getDeclared"></a>getDeclared</h4></li>
</ul>
</li>
<li>getDeclaredConstructor(s)|Method(s)|Field(s)获取对应对象<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import com.ll.reflect.entity.Employee;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.InvocationTargetException;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 获取对象所有成员变量值</span><br><span class="line"> */</span><br><span class="line">public class getDeclaredSample &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class employeeClass = Class.forName(&quot;com.ll.reflect.entity.Employee&quot;);</span><br><span class="line">            Constructor constructor = employeeClass.getConstructor(new Class[]&#123;</span><br><span class="line">                    Integer.class, String.class, Float.class, String.class</span><br><span class="line">            &#125;);</span><br><span class="line">            Employee employee = (Employee) constructor.newInstance(new Object[]&#123;</span><br><span class="line">                    100, &quot;Liam Lian&quot;, 3000f, &quot;Product&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">            //获取当前类所有成员变量</span><br><span class="line">            Field[] fields = employeeClass.getDeclaredFields();</span><br><span class="line">            for (Field field : fields)&#123;</span><br><span class="line">                if (field.getModifiers() == 1) &#123; //pubilc修饰</span><br><span class="line">                    Object val = field.get(employee);</span><br><span class="line">                    System.out.println(field.getName() + &quot;:&quot; + val);</span><br><span class="line">                &#125; else if (field.getModifiers() == 2) &#123; //private修饰</span><br><span class="line">                    String methodName = &quot;get&quot; + field.getName().substring(0,1).toUpperCase()</span><br><span class="line">                                        + field.getName().substring(1);</span><br><span class="line">                    Method getMethod = employeeClass.getMethod(methodName);</span><br><span class="line">                    Object ret = getMethod.invoke(employee);</span><br><span class="line">                    System.out.println(field.getName() + &quot;:&quot; + ret);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.UnsupportedEncodingException;</span><br><span class="line">import java.net.URLDecoder;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">public class Application &#123;</span><br><span class="line">    public static void say()&#123;</span><br><span class="line">        Properties properties = new Properties();</span><br><span class="line">        String configPath = Application.class.getResource(&quot;/config.properties&quot;).getPath();</span><br><span class="line">        try &#123;</span><br><span class="line">            configPath = new URLDecoder().decode(configPath, &quot;UTF-8&quot;);</span><br><span class="line">            properties.load(new FileInputStream(configPath));</span><br><span class="line">            String language = properties.getProperty(&quot;language&quot;);</span><br><span class="line">            I18N i18n = (I18N)Class.forName(language).newInstance();</span><br><span class="line">            System.out.println(i18n.say());</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Application.say();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Lambda-and-Functional-Programming"><a href="#Lambda-and-Functional-Programming" class="headerlink" title="Lambda and Functional Programming"></a>Lambda and Functional Programming</h3><ul>
<li>Lambda更简洁的实现匿名内部类与函数声明与调用</li>
<li>Collections.sort(names, (a,b) -&gt; {b.compareTo(a)});</li>
<li>函数式编程是基于函数式接口并使用lambda表达的编程方式; 理念是将代码作为可重用数据代入到程序运行中; 函数式接口是有且只有一个抽象方法的接口; @FunctionalInterface&#x2F;&#x2F;通知编译器这是函数式接口,进行抽象方法检查</li>
</ul>
<h4 id="JDK8-frequently-used"><a href="#JDK8-frequently-used" class="headerlink" title="JDK8 frequently used"></a>JDK8 frequently used</h4><ul>
<li><p>Consumer<T> 对应有一个输入参数无输出的功能代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line">public class ConsumerSample &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        output(s-&gt; System.out.println(&quot;向控制台打印:&quot; + s));</span><br><span class="line">        output(s-&gt;&#123;</span><br><span class="line">            System.out.println(&quot;向XXX网站发送数据包:&quot; + s);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    public static void output(Consumer&lt;String&gt; consumer)&#123;</span><br><span class="line">        String text = &quot;天将降大任于是人也，必先苦其心志，劳其筋骨，饿其体肤，空乏其身，行拂乱其所为。&quot;;</span><br><span class="line">        consumer.accept(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Function&lt;T,R&gt; 对应有一个输入参数且需要返回数据的功能代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import java.util.Random;</span><br><span class="line">import java.util.function.Function;</span><br><span class="line"></span><br><span class="line">public class FunctionSample &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Function&lt;Integer,String&gt; randomStringFunction = l -&gt; &#123;</span><br><span class="line">            String chars = &quot;abcdefghijklmnopqrstuvxwyz0123456789&quot;;</span><br><span class="line">            StringBuffer stringBuffer = new StringBuffer();</span><br><span class="line">            Random random = new Random();</span><br><span class="line">            for (int i = 0 ; i &lt; l ; i++) &#123;</span><br><span class="line">                int position = random.nextInt(chars.length());</span><br><span class="line">                stringBuffer.append(chars.charAt(position));</span><br><span class="line">            &#125;</span><br><span class="line">            return stringBuffer.toString();</span><br><span class="line">        &#125;;</span><br><span class="line">        String randomString = randomStringFunction.apply(32);</span><br><span class="line">        System.out.println(randomString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>Predicate<T> 用于条件判断,固定返回布尔值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.function.Predicate;</span><br><span class="line"></span><br><span class="line">public class PredicateSample &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Predicate&lt;Integer&gt; predicate = n-&gt;n&lt;4;</span><br><span class="line">        boolean result = predicate.test(10);</span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(1,2,3,4,5,6,7,8,9,10);</span><br><span class="line">        filter(list,n-&gt;n%2==1); //取所有奇数</span><br><span class="line">        filter(list,n-&gt;n%2==0); //取所有偶数</span><br><span class="line">        filter(list,n-&gt;n&gt;5 &amp;&amp; n%2==0); //取所有大于5的偶数</span><br><span class="line">    &#125;</span><br><span class="line">    public static void filter(List&lt;Integer&gt; list , Predicate&lt;Integer&gt; predicate)&#123;</span><br><span class="line">        for (Integer num:list) &#123;</span><br><span class="line">            if (predicate.test(num)) &#123;</span><br><span class="line">                System.out.print(num + &quot; &quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//获取List集合中最大的偶数</span><br><span class="line">Optional&lt;Integer&gt; op = Arrays.asList(1,2,3,4,5,6).stream()</span><br><span class="line">.filter(x -&gt; x%2 == 0)</span><br><span class="line">.sorted((a,b) -&gt; b-a)</span><br><span class="line">.findFirst();</span><br><span class="line">System.out.println(op.get());</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Random;</span><br><span class="line">import java.util.stream.IntStream;</span><br><span class="line">import java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Stream流对象的五种创建方式</span><br><span class="line"> */</span><br><span class="line">public class StreamGenerator &#123;</span><br><span class="line">    //1.基于数组进行创建</span><br><span class="line">    @Test</span><br><span class="line">    public void generator1()&#123;</span><br><span class="line">        String[] arr = &#123;&quot;Lily&quot; , &quot;Andy&quot; , &quot;Jackson&quot; , &quot;Smith&quot;&#125;;</span><br><span class="line">        Stream&lt;String&gt; stream = Stream.of(arr);</span><br><span class="line">        stream.forEach(s-&gt;System.out.println(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //2.基于集合进行创建</span><br><span class="line">    @Test</span><br><span class="line">    public void generator2()&#123;</span><br><span class="line">        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">        list.add(&quot;Lily&quot;);</span><br><span class="line">        list.add(&quot;Andy&quot;);</span><br><span class="line">        list.add(&quot;Jackson&quot;);</span><br><span class="line">        list.add(&quot;Smith&quot;);</span><br><span class="line">        Stream&lt;String&gt; stream = list.stream();</span><br><span class="line">        stream.forEach(s-&gt;System.out.println(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //3.利用generate方法创建无限长度流</span><br><span class="line">    @Test</span><br><span class="line">    public void generator3()&#123;</span><br><span class="line">        Stream&lt;Integer&gt; stream = Stream.generate(() -&gt; new Random().nextInt(100000));</span><br><span class="line">        stream.limit(10).forEach(i-&gt;System.out.println(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //4.基于迭代器创建流</span><br><span class="line">    @Test</span><br><span class="line">    public void generator4()&#123;</span><br><span class="line">        Stream&lt;Integer&gt; stream = Stream.iterate(1, n-&gt;n+1);</span><br><span class="line">        stream.limit(100).forEach(i -&gt; System.out.println(i));</span><br><span class="line">    &#125;</span><br><span class="line">    //5.基于字符序列创建流</span><br><span class="line">    @Test</span><br><span class="line">    public void generator5()&#123;</span><br><span class="line">        String str = &quot;abcdefg我的&quot;;</span><br><span class="line">        IntStream stream = str.chars();</span><br><span class="line">        stream.forEach(c -&gt; System.out.println((char)c));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>forEach: 循环遍历</p>
</li>
<li><p>map: map 方法用于映射每个元素到对应的结果</p>
</li>
<li><p>filter: filter 方法用于通过设置的条件过滤出元素</p>
</li>
<li><p>limit: limit 方法用于获取指定数量的流</p>
</li>
<li><p>sorted: sorted 方法用于对流进行排序</p>
</li>
<li><p>Collectors: Collectors 类实现将流转换成集合和聚合元素</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">public class StreamMethod &#123;</span><br><span class="line">    //提取集合中所有偶数并求和</span><br><span class="line">    @Test</span><br><span class="line">    public void case1()&#123;</span><br><span class="line">        List&lt;String&gt; list = Arrays.asList(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot; , &quot;6&quot;);</span><br><span class="line">        int sum = list.stream() //获取stream对象</span><br><span class="line">            .mapToInt(s-&gt;Integer.parseInt(s)) //mapToInt将流中每一个数据转为整数</span><br><span class="line">            .filter(n-&gt;n%2==0) //filter对流数据进行过滤</span><br><span class="line">            .sum();//求和</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //所有名字首字母大写</span><br><span class="line">    @Test</span><br><span class="line">    public void case2()&#123;</span><br><span class="line">        List&lt;String&gt; list = Arrays.asList(&quot;lily&quot;,&quot;smith&quot;,&quot;jackson&quot;);</span><br><span class="line">        List newList = list.stream()</span><br><span class="line">                //按规则对每一个流数据进行转换</span><br><span class="line">                .map(s-&gt;s.substring(0,1).toUpperCase() + s.substring(1))</span><br><span class="line">                //.forEach(s-&gt; System.out.println(s));</span><br><span class="line">                //collect对流数据进行收集,生成新的List/Set</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        System.out.println(newList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //将所有奇数从大到小进行排序,且不许出现重复</span><br><span class="line">    @Test</span><br><span class="line">    public void case3()&#123;</span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(1,60,38,21,51,60,51,73);</span><br><span class="line">        List newList = list.stream().distinct()//去除重复的流数据</span><br><span class="line">            .filter(n-&gt;n%2==1)</span><br><span class="line">            .sorted((a,b)-&gt;b-a) //流数据排序</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        System.out.println(newList);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Reg"><a href="#Reg" class="headerlink" title="Reg"></a>Reg</h3><ul>
<li>A: A</li>
<li>x | y: x or y</li>
<li>[xyz]: x or y or z</li>
<li>[a-z], [A-Z], [0-9]</li>
<li>[^xyz], [^0-9]: not in (x, y, z)</li>
<li><code>\d</code> any number</li>
<li><code>\D</code> 匹配\d规则之外的任意单个字符</li>
<li><code>\w</code> 匹配任意单个字母数字下划线</li>
<li><code>\W</code> 匹配\w之外的任意单个字符</li>
<li><code>\s</code>: a space</li>
<li><code>\n</code> 匹配单个换行符</li>
<li><code>.</code> 匹配任意单个字符(换行符除外)</li>
<li><code>\.</code> 特殊字符,只匹配.</li>
<li>A{3} 精准N次匹配</li>
<li>A{3,} 最少出现N次</li>
<li><code>\d&#123;3,5&#125;</code> 约定出现最少次数与最大次数</li>
<li><code>\d*</code> 可以出现零次至无限次,相当于{0,}</li>
<li><code>\d+</code> 最少出现一次,相当于{1,}</li>
<li><code>\d?</code> 最多出现一次,相当于{0,1}</li>
<li><code>^A.*</code> 头匹配</li>
<li><code>.*A$</code> 尾匹配</li>
<li><code>^A.*A$</code> 全字匹配</li>
<li>(ab){3}(cd){3}分组: abababcdcdcd</li>
<li>Greedy mode: default, use \d{6,8} on 111222333 -&gt; 11122233</li>
<li>Non greedy mode: use \d{6,8}? on 111222333 -&gt; 111222<h4 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=&quot;#&quot; method=&quot;post&quot; id=&quot;frmInfo&quot;&gt;</span><br><span class="line">		&lt;div id=&quot;err&quot; style=&quot;color:red&quot;&gt;</span><br><span class="line"></span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">			姓名:&lt;input id=&quot;name&quot; name=&quot;name&quot;/&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">			身份证:&lt;input id=&quot;idno&quot; name=&quot;idno&quot;/&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">			&lt;input type=&quot;submit&quot; /&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">	&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">		document.getElementById(&quot;frmInfo&quot;).onsubmit = function()&#123;</span><br><span class="line">			//在JS中定义正则表达式对象只需要在 /正则表达式/</span><br><span class="line">			var regex1 = /^[\u4e00-\u9fa5]&#123;2,8&#125;$/;</span><br><span class="line">			var regex2 = /^[1234568]\d&#123;16&#125;[0-9xX]$/</span><br><span class="line">			var name = document.getElementById(&quot;name&quot;).value;</span><br><span class="line">			var idno = document.getElementById(&quot;idno&quot;).value;</span><br><span class="line">			if (regex1.test(name) == false) &#123;//利用正则校验数据,true代表匹配,false代表不匹配</span><br><span class="line">				document.getElementById(&quot;err&quot;).innerHTML = &quot;无效姓名&quot;;</span><br><span class="line">				return false;</span><br><span class="line">			&#125; else if(regex2.test(idno) == false) &#123;</span><br><span class="line">				document.getElementById(&quot;err&quot;).innerHTML = &quot;无效身份证号&quot;;</span><br><span class="line">				return false; // will not submit</span><br><span class="line">			&#125; async else &#123;</span><br><span class="line">				alert(&quot;验证通过,准备提交&quot;)</span><br><span class="line">				return true; // will submit</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line">import java.util.regex.Matcher;</span><br><span class="line">import java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line">public class RegexSample &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		StringBuilder content = new StringBuilder();</span><br><span class="line">		try &#123;</span><br><span class="line">			FileInputStream fis = new FileInputStream(&quot;D:/workspace/regex/WebContent/sample.html&quot;);</span><br><span class="line">			InputStreamReader isr = new InputStreamReader(fis,&quot;UTF-8&quot;);</span><br><span class="line">			BufferedReader bufferedReader = new BufferedReader(isr);</span><br><span class="line">			String lineText = &quot;&quot;;</span><br><span class="line">			while((lineText = bufferedReader.readLine()) != null) &#123;</span><br><span class="line">				content.append(lineText + &quot;\n&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">			bufferedReader.close();</span><br><span class="line">			System.out.println(content);</span><br><span class="line"></span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Pattern p = Pattern.compile(&quot;&lt;li&gt;([\\u4e00-\\u9fa5]&#123;2,10&#125;)([a-zA-Z]+)&lt;/li&gt;&quot;);</span><br><span class="line">		Matcher m = p.matcher(content);</span><br><span class="line">		while(m.find()) &#123;</span><br><span class="line">//			System.out.println(m.group(0));</span><br><span class="line">			String chs = m.group(1);</span><br><span class="line">			String eng = m.group(2);</span><br><span class="line">			System.out.println(chs + &quot;-&quot; + eng);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h3><h4 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h4><ul>
<li>加载并注册JDBC驱动<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">dbDriver</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>; <span class="comment">//JDBC驱动类</span></span><br><span class="line"><span class="type">String</span> <span class="variable">dbURL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/database_name&quot;</span> ; <span class="comment">//连接字符串</span></span><br><span class="line"><span class="type">String</span> <span class="variable">dbUsername</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>; <span class="comment">//数据库用户名</span></span><br><span class="line"><span class="type">String</span> <span class="variable">dbPassword</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>; <span class="comment">//数据库密码</span></span><br><span class="line"><span class="comment">//1.加载并初始化JDBC驱动</span></span><br><span class="line">Class.forName(dbDriver);</span><br><span class="line"><span class="comment">//2.创建数据库连接</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(dbURL, dbUsername, dbPassword);</span><br></pre></td></tr></table></figure>
<ul>
<li>useSSL true(生产) false(开发) 是否禁用ssl</li>
<li>useUnicode true 启用unicode编码传输数据</li>
<li>characterEncoding UTF-8</li>
<li>serverTimezone Asia&#x2F;Shanghai 使用东8时区时间,UTC+8</li>
<li>allowPublicKeyRetrieval true 允许从客户端获取公钥加密传输</li>
</ul>
</li>
<li>创建数据库连接<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(dbURL, dbUsername, dbPassword); <span class="comment">//创建数据库连接</span></span><br></pre></td></tr></table></figure></li>
<li>创建Statement对象<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(dbURL, dbUsername, dbPassword); <span class="comment">//创建数据库连接</span></span><br><span class="line"><span class="comment">//3. 创建Statement对象</span></span><br><span class="line"><span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line"><span class="comment">//4. 执行SQL语句,得到查询结果集ResultSet</span></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(<span class="string">&quot;SELECT * FROM emp&quot;</span>); <span class="comment">//执行SQL语句</span></span><br></pre></td></tr></table></figure>
<ul>
<li>sql参数必须是SELECT</li>
</ul>
</li>
<li>PreparedStatement instead of Statement<ul>
<li>prevent SQL injection</li>
<li>执行效率更高<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 利用PreparedStatement预防SQL注入风险</span></span><br><span class="line"><span class="comment">// 当dname值为&#x27; or 1=1 or 1=&#x27;时 , 查询不到任何结果</span></span><br><span class="line"><span class="comment">// SQL: select * from employee where dname=&#x27;\&#x27; or 1=1 or 1=\&#x27;&#x27;</span></span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from employee where dname = ?&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">pstmt.setString(<span class="number">1</span>, dname); <span class="comment">//设置SQL参数,参数从1开始</span></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> pstmt.executeQuery();</span><br><span class="line"><span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>wrong<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employee <span class="keyword">where</span> ?<span class="operator">=</span><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employee <span class="keyword">where</span> salary <span class="operator">=</span> ?<span class="operator">+</span><span class="number">100</span></span><br><span class="line"><span class="keyword">select</span> ? <span class="keyword">from</span> employee <span class="keyword">where</span> ename <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>遍历查询结果<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//遍历查询结果,</span></span><br><span class="line"><span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">  <span class="type">Integer</span> <span class="variable">empId</span> <span class="operator">=</span> rs.getInt(<span class="number">1</span>);<span class="comment">//得到每行第1列数据,即emp_id</span></span><br><span class="line">  <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;ename&quot;</span>) <span class="comment">//得到每行员工姓名列</span></span><br><span class="line">  <span class="type">Date</span> <span class="variable">hiredate</span> <span class="operator">=</span> rs.getDate(<span class="string">&quot;ename&quot;</span>) <span class="comment">//入职时间,注:java.sql.Date</span></span><br><span class="line">  System.out.println(empId + <span class="string">&quot;-&quot;</span> + ename + <span class="string">&quot;-&quot;</span> + hiredate)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>关闭连接,释放资源<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  <span class="comment">//创建Statement , 执行SQL语句 , 处理ResultSet得到结果</span></span><br><span class="line">  rs.close();</span><br><span class="line">  stmt.close();</span><br><span class="line">  &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">  e.printStackTrace(); <span class="comment">//y异常处理</span></span><br><span class="line">  &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(conn != <span class="literal">null</span>) &#123; <span class="comment">//5. 释放数据库连接</span></span><br><span class="line">  <span class="keyword">try</span>&#123; conn.close(); &#125;<span class="keyword">catch</span>(Exception ex)&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>改造程序预防SQL注入攻击</li>
<li>insert<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String sql= <span class="string">&quot;insert into employee(eno,ename) values(?,?)&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">pstmt.setInt(<span class="number">1</span>,<span class="number">10</span>);</span><br><span class="line">pstmt.setString(<span class="number">2</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line"><span class="comment">//executeUpdate方法返回记录数</span></span><br><span class="line"><span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> pstmt.executeUpdate(); <span class="comment">//cnt=1</span></span><br><span class="line">System.out.println(<span class="string">&quot;数据新增成功&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>update<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String sql= <span class="string">&quot;update employee set salary=salary + 1000 where dname=?&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">pstmt.setString(<span class="number">1</span>,<span class="string">&quot;研发部&quot;</span>);</span><br><span class="line"><span class="comment">//executeUpdate方法返回记录数</span></span><br><span class="line"><span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> pstmt.executeUpdate();</span><br><span class="line">System.out.println(<span class="string">&quot;研发部&quot;</span> + cnt + <span class="string">&quot;名员工提薪1000元&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>delete<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String sql= <span class="string">&quot;delete from employee where eno = ?&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">pstmt.setInt(<span class="number">1</span>, <span class="number">3395</span>);</span><br><span class="line"><span class="comment">//executeUpdate方法返回记录数</span></span><br><span class="line"><span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> pstmt.executeUpdate();</span><br><span class="line">System.out.println(cnt+<span class="string">&quot;名员工数据已被删除&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>Apache Commons DBUtils</li>
<li>JDBC中的事务管理<ul>
<li>conn.setAutoCommit(true), default</li>
<li>conn.commit();</li>
<li>conn.rollback();</li>
</ul>
</li>
<li>实现批量增加员工</li>
<li>基于实体类实现分页数据封装</li>
<li>JDBC中Date日期对象的处理<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ll.jdbc.hrapp.command;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ll.jdbc.common.DbUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增员工数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsertCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入员工编号:&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">eno</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入员工姓名:&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> in.next();</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入员工薪资:&quot;</span>);</span><br><span class="line">        <span class="type">float</span> <span class="variable">salary</span> <span class="operator">=</span> in.nextFloat();</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入隶属部门:&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">dname</span> <span class="operator">=</span> in.next();</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入入职日期：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">strHiredate</span> <span class="operator">=</span> in.next();</span><br><span class="line">        <span class="comment">//JDBC获取日期使用java.sql.Date,其继承自java.util.Date</span></span><br><span class="line">        <span class="comment">//String到java.sql.Date分为两步</span></span><br><span class="line">        <span class="comment">//1.String转为java.util.Date</span></span><br><span class="line">        java.util.<span class="type">Date</span> <span class="variable">udHiredate</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            udHiredate = sdf.parse(strHiredate);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2.java.util.Date转为java.sql.Date</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> udHiredate.getTime();<span class="comment">//获取自1970年到现在的毫秒数</span></span><br><span class="line">        java.sql.<span class="type">Date</span> <span class="variable">sdHiredate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.sql.Date(time);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into employee(eno,ename,salary,dname,hiredate ) values(?,?,?,?,?)&quot;</span>;</span><br><span class="line">            pstmt = conn.prepareStatement(sql);</span><br><span class="line">            pstmt.setInt(<span class="number">1</span>, eno);</span><br><span class="line">            pstmt.setString(<span class="number">2</span>, ename);</span><br><span class="line">            pstmt.setFloat(<span class="number">3</span>, salary);</span><br><span class="line">            pstmt.setString(<span class="number">4</span>,dname);</span><br><span class="line">            pstmt.setDate(<span class="number">5</span>,sdHiredate); <span class="comment">//java.sql.Date</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> pstmt.executeUpdate();<span class="comment">//所有写操作都使用executeUpdate</span></span><br><span class="line">            System.out.println(<span class="string">&quot;cnt:&quot;</span> + cnt);</span><br><span class="line">            System.out.println(ename + <span class="string">&quot;员工入职手续已办理&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.closeConnection(<span class="literal">null</span>,pstmt,conn);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>JDBC数据批处理<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">package com.ll.jdbc.sample;</span><br><span class="line"></span><br><span class="line">import com.ll.jdbc.common.DbUtils;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.PreparedStatement;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * JDBC批处理</span><br><span class="line"> */</span><br><span class="line">public class BatchSample &#123;</span><br><span class="line">    //标准方式插入若干数据</span><br><span class="line">    private static void tc1()&#123;</span><br><span class="line">        Connection conn = null;</span><br><span class="line">        PreparedStatement pstmt = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            long startTime = new Date().getTime();</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            //JDBC默认使用自动提交模式</span><br><span class="line">            conn.setAutoCommit(false);//关闭自动提交</span><br><span class="line">            String sql = &quot;insert into employee(eno,ename,salary,dname) values(?,?,?,?)&quot;;</span><br><span class="line">            for (int i=100000; i&lt;200000; i++)&#123;</span><br><span class="line">                pstmt = conn.prepareStatement(sql);</span><br><span class="line">                pstmt.setInt(1, i);</span><br><span class="line">                pstmt.setString(2, &quot;员工&quot; + i);</span><br><span class="line">                pstmt.setFloat(3, 4000f);</span><br><span class="line">                pstmt.setString(4, &quot;市场部&quot;);</span><br><span class="line">                pstmt.executeUpdate();</span><br><span class="line">            &#125;</span><br><span class="line">            conn.commit();//提交数据</span><br><span class="line">            long endTime = new Date().getTime();</span><br><span class="line">            System.out.println(&quot;tc1()执行时长：&quot; + (endTime-startTime));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            try &#123;</span><br><span class="line">                if(conn != null &amp;&amp; !conn.isClosed()) &#123;</span><br><span class="line">                    conn.rollback();//回滚数据</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;catch (SQLException ex)&#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            DbUtils.closeConnection(null, pstmt, conn);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //使用批处理插入若干数据</span><br><span class="line">    private static void tc2()&#123;</span><br><span class="line">        Connection conn = null;</span><br><span class="line">        PreparedStatement pstmt = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            long startTime = new Date().getTime();</span><br><span class="line">            conn = DbUtils.getConnection();</span><br><span class="line">            //JDBC默认使用自动提交模式</span><br><span class="line">            conn.setAutoCommit(false);//关闭自动提交</span><br><span class="line">            String sql = &quot;insert into employee(eno,ename,salary,dname) values(?,?,?,?)&quot;;</span><br><span class="line">            pstmt = conn.prepareStatement(sql);</span><br><span class="line">            for (int i=200000; i&lt;300000; i++)&#123;</span><br><span class="line">                pstmt.setInt(1, i);</span><br><span class="line">                pstmt.setString(2, &quot;员工&quot; + i);</span><br><span class="line">                pstmt.setFloat(3, 4000f);</span><br><span class="line">                pstmt.setString(4, &quot;市场部&quot;);</span><br><span class="line">                pstmt.addBatch();//将参数加入批处理任务</span><br><span class="line">//                pstmt.executeUpdate();</span><br><span class="line">            &#125;</span><br><span class="line">            pstmt.executeBatch();//执行批处理任务</span><br><span class="line">            conn.commit();//提交数据</span><br><span class="line">            long endTime = new Date().getTime();</span><br><span class="line">            System.out.println(&quot;tc2()执行时长：&quot; + (endTime-startTime));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            try &#123;</span><br><span class="line">                if(conn != null &amp;&amp; !conn.isClosed()) &#123;</span><br><span class="line">                    conn.rollback();//回滚数据</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;catch (SQLException ex)&#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            DbUtils.closeConnection(null, pstmt, conn);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        tc1();</span><br><span class="line">        tc2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>连接池<ul>
<li>连接池负责创建管理连接,程序只负责取用与归还</li>
<li>maxActive should be &gt; user count; initialSize is better to equal to maxActive</li>
<li>Druid<ul>
<li>druid-cofig.properties</li>
</ul>
</li>
<li>C3P0<ul>
<li>c3p0-config.xml</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>Linux发行版选择建议<br>u<br>桌面系统:Ubuntu<br>u<br>服务器操作系统:<br>CentOS<br>（免费）<br>、<br>Red Hat<br>Linux<br>（收费）<br>u<br>特定需求: Debian(稳定性)、<br>Fedora(新特性)、<br>麒麟Linux(国产)</p>
<p>CentOS 7 :<br>主流版本,稳定成熟,大多数服务器的首选版本<br>Centos 7.7</p>
<p>VMware Workstation虚拟机</p>
<p>SSH是专为远程登录和其他网络服务提供的安全性协议</p>
<p>Linux命令格式<br>命令 [参数选项] [文件或路径]<br>cd<br>切换目录<br>pwd<br>查看当前目录<br>l<br>s、<br>l<br>l<br>显示目录内容<br>mkdir<br>创建目录<br>cp<br>复制文件与目录<br>mv<br>移动或重命名文件<br>rm<br>删除文件或目录<br>find<br>查找目录或文件</p>
<p>vim文本编辑器<br>vim<br>[选项]<br>[文件]<br>u<br>普通模式:默认模式,文本只读,不可编辑<br>u<br>编辑模式:编辑文本模式,普通模式按i键进入,Esc键退出<br>u<br>命令模式:执行保存、<br>搜索、<br>退出等操作<br>delete或x<br>删除单个字符<br>dd<br>删除整行<br>&#x2F;str<br>全文查找str字符串,n下一个,N前一个<br>:<br>%<br>s&#x2F;old&#x2F;new&#x2F;g<br>替换文件内所有old字符串为new<br>u<br>撤销最近一次操作<br>:wq或者:wq!<br>退出并保存,只读文件要额外加!<br>:<br>q!<br>强制退出放弃保存</p>
<p>常用文本工具<br>echo<br>屏幕打印与文本输出<br>cat<br>合并文件或查看文件内容<br>tail<br>显示文件内容尾部<br>grep<br>文本过滤工具</p>
<p>文件输入与输出<br>u<br>文件输入：<br>&lt;<br>(重写)<br>或者<br>&lt;&lt;<br>(追加)<br>u<br>文件输出：&gt; (重写) 或者 &gt;&gt; (追加)</p>
<p>gzip<br>tar<br>tar<br>zcvf<br>tomcat.tar.gz<br>&#x2F;usr&#x2F;local&#x2F;tomcat</p>
<p>tar<br>zxvf<br>tomcat.tar.gz<br>-C<br>&#x2F;usr&#x2F;local&#x2F;tomcat</p>
<p>z<br>通过gzip压缩或解压<br>c<br>创建新的tar.gz文件<br>v<br>显示执行过程<br>f<br>指定压缩文件名称<br>x<br>解压缩tar.gz文件<br>-C<br>指定解压缩目录</p>
<h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><ul>
<li>project manamgement tool</li>
<li>plug-in to export jar: maven-assembly-plugin<h4 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h4></li>
<li>mvn archetype:generate 创建Maven工程结构</li>
<li>mvn compile 编译源代码</li>
<li>mvn test 执行测试用例</li>
<li>mvn clean 清除产生的项目</li>
<li>mvn package 项目打包</li>
<li>mvn install 安装至本地仓库<h4 id="package"><a href="#package" class="headerlink" title="package"></a>package</h4>to do</li>
</ul>
<h3 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h3><ul>
<li>ctrl + shift + T: create test class</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/04/07/MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/07/MySQL/" class="post-title-link" itemprop="url">MySQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-07 20:25:28" itemprop="dateCreated datePublished" datetime="2022-04-07T20:25:28-04:00">2022-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-06-13 23:23:22" itemprop="dateModified" datetime="2022-06-13T23:23:22-04:00">2022-06-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><ul>
<li>server layer + storage engine layer<ul>
<li><p>server layer</p>
<ul>
<li>connector: connects client to server; wait_timeout can decide how long it will wait before disconnecting if the client has not sent a query.</li>
<li>cache: After MySQL 8.0, not have this.</li>
<li>analyzer: lexical and syntax analysis</li>
<li>optimizer: which index to use, which table to be joined first</li>
<li>executor: execute; update binlog in disk<br>the server layer has functions, stored procedures, trigger, view, etc</li>
</ul>
</li>
<li><p>storage engine: read and store, update redo log</p>
<ul>
<li>engines: InnoDb, MyISAM, Memory, etc</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"><span class="comment">/**/</span></span><br></pre></td></tr></table></figure>

<h2 id="Data-types"><a href="#Data-types" class="headerlink" title="Data types"></a>Data types</h2><h3 id="Number"><a href="#Number" class="headerlink" title="Number"></a>Number</h3><ul>
<li>TINYINT</li>
<li>INT: 约21亿</li>
<li>BIGINT</li>
<li>FLOAT, E38</li>
<li>DOUBLE, E308</li>
<li>DECIMAL(m,n): m&lt;&#x3D;65, precise</li>
</ul>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><ul>
<li>char: 255 char</li>
<li>varchar: variable length; 理论65535，不允许空字段时最大65531，允许空字段65532</li>
<li>text: variable length; cannot be PK<ul>
<li>TINYTEXT: 255</li>
<li>TEXT: 65535, recommended</li>
<li>MEDIUMTEXT: 16,777,215</li>
<li>LONGTEXT: 4,294,967,295(4GB)</li>
</ul>
</li>
<li>ENUM</li>
<li>SET: SET(‘one’, ‘two’) NOT NULL can have any of these values:   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;one&#x27;</span></span><br><span class="line"><span class="string">&#x27;two&#x27;</span></span><br><span class="line"><span class="string">&#x27;one,two&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Date-and-Time"><a href="#Date-and-Time" class="headerlink" title="Date and Time"></a>Date and Time</h3><ul>
<li>Year</li>
<li>Date</li>
<li>Time</li>
<li>Datetime: recommended</li>
<li>Timestamp: converted from the current time zone to UTC for storage, and converted back from UTC to the current time zone for retrieval</li>
</ul>
<h2 id="Queries"><a href="#Queries" class="headerlink" title="Queries"></a>Queries</h2><p><img src="/../image/mysql/4.png" alt="undo log and read-view"></p>
<h3 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">drop database (if exists) database_name;</span><br><span class="line">create database database_name;</span><br><span class="line">show databases;</span><br></pre></td></tr></table></figure>

<h3 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> database.table_name (</span><br><span class="line">column1 datatype [<span class="keyword">constraint</span>] [comment],</span><br><span class="line">column2 datatype [<span class="keyword">constraint</span>] [comment],</span><br><span class="line">column3 datatype [<span class="keyword">constraint</span>] [comment],</span><br><span class="line">INDEX [ 索引名称 ] ( 字段 )</span><br><span class="line"><span class="keyword">foreign</span> key (deptno) <span class="keyword">references</span> t_dept(deptno)</span><br><span class="line">....) [comment];</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> (if <span class="keyword">exists</span>) database.table_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> database.new_table_name</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">(<span class="keyword">SELECT</span> column1, column2,...</span><br><span class="line"><span class="keyword">FROM</span> existing_table_name</span><br><span class="line"><span class="keyword">WHERE</span> ....);</span><br><span class="line"></span><br><span class="line"><span class="keyword">Show</span> tables;</span><br><span class="line"><span class="keyword">describe</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称</span><br><span class="line"><span class="keyword">ADD</span> 列<span class="number">1</span> 数据类型 [<span class="keyword">constraint</span>] [COMMENT] ,</span><br><span class="line"><span class="keyword">ADD</span> 列<span class="number">2</span> 数据类型 [<span class="keyword">constraint</span>] [COMMENT] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称</span><br><span class="line">MODIFY 列<span class="number">1</span> 数据类型 [<span class="keyword">constraint</span>] [COMMENT] ,</span><br><span class="line">MODIFY 列<span class="number">2</span> 数据类型 [<span class="keyword">constraint</span>] [COMMENT] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称</span><br><span class="line">CHANGE 列<span class="number">1</span> 新列名<span class="number">1</span> 数据类型 [<span class="keyword">constraint</span>] [COMMENT] ,</span><br><span class="line">CHANGE 列<span class="number">2</span> 新列名<span class="number">2</span> 数据类型 [<span class="keyword">constraint</span>] [COMMENT] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称</span><br><span class="line"><span class="keyword">DROP</span> 列<span class="number">1</span> ,</span><br><span class="line"><span class="keyword">DROP</span> 列<span class="number">2</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 RENAME 新表名 ;</span><br></pre></td></tr></table></figure>
<h4 id="constraints"><a href="#constraints" class="headerlink" title="constraints"></a>constraints</h4><ul>
<li>PRIMARY KEY</li>
<li>NOT NULL</li>
<li>UNIQUE</li>
<li>FOREIGN KEY</li>
</ul>
<h3 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h3><ul>
<li><p>&#x3D;</p>
</li>
<li><p>&lt;&gt;, !&#x3D;</p>
</li>
<li><p>is null, is not null</p>
</li>
<li><p>between and</p>
</li>
<li><p>in</p>
</li>
<li><p>EXISTS</p>
<ul>
<li>EXISTS关键字是把原来在子查询之外的条件判断，写到了子查询的里面<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查询工资等级3和4级的员工信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> empno, ename, sal, comm</span><br><span class="line"><span class="keyword">from</span> t_emp</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_salgrade <span class="keyword">where</span> grade <span class="keyword">in</span> (<span class="number">3</span>, <span class="number">4</span>) <span class="keyword">and</span> sal <span class="keyword">between</span> losal <span class="keyword">and</span> hisal);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>like</p>
<ul>
<li>%: zero or more</li>
<li>_: single</li>
</ul>
</li>
<li><p>regexp</p>
<ul>
<li><code>ename regexp &quot;[a-zA-Z]&#123;4&#125;&quot;</code></li>
</ul>
</li>
<li><p>NOT</p>
</li>
<li><p>AND</p>
</li>
<li><p>OR</p>
</li>
<li><p>XOR</p>
</li>
<li><p>&amp;</p>
</li>
<li><p>|</p>
</li>
<li><p>~: bitwise not</p>
</li>
<li><p>^: bitwise XOR</p>
</li>
<li><p>&lt;&lt;</p>
</li>
<li><blockquote>
<blockquote>
</blockquote>
</blockquote>
</li>
</ul>
<h4 id="Priority"><a href="#Priority" class="headerlink" title="Priority"></a>Priority</h4><ul>
<li>() &gt; NOT &gt; And &gt; Or</li>
</ul>
<h3 id="Insert"><a href="#Insert" class="headerlink" title="Insert"></a>Insert</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">IGNORE只插入数据库不存在</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">INSERT</span> [ IGNORE ] <span class="keyword">INTO</span> 表名 [(字段名 [,字段名] ...)] <span class="keyword">VALUES</span> (值的列表);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 （字段名）(</span><br><span class="line"><span class="keyword">SELECT</span> 字段名或值</span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line"><span class="keyword">WHERE</span> 条件);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> demo.goodsmaster</span><br><span class="line">(itemnumber, barcode, goodsname, specification, unit, price)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">4</span>,<span class="string">&#x27;0003&#x27;</span>,<span class="string">&#x27;尺子&#x27;</span>,<span class="string">&#x27;三角型&#x27;</span>,<span class="string">&#x27;把&#x27;</span>,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*MySQL dialect*/</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 <span class="keyword">SET</span> 字段<span class="number">1</span><span class="operator">=</span>值<span class="number">1</span>, 字段<span class="number">2</span><span class="operator">=</span>值<span class="number">2</span>, ...... ;</span><br></pre></td></tr></table></figure>

<ul>
<li>can skip inserting some columns if null allowed or have default values</li>
<li>ON DUPLICATE: 假设我们要把门店 B 的商品数据，插入到门店 A 的商品表中去，如果有重复的商品编号，就用门店 B 的条码，替换门店 A 的条码，<br>用门店 B 的商品名称，替换门店 A 的商品名称；如果没有重复的编号，就直接把门店 B 的商品数据插入到门店 A 的商品表中。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; SELECT *</span><br><span class="line">    -&gt; FROM demo.goodsmaster;</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">| itemnumber | barcode | goodsname | specification | unit | salesprice |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">|          1 | 0001    | 书        | 16开          | 本   |      89.00 |</span><br><span class="line">|          2 | 0002    | 笔        | 10支装        | 包   |       5.00 |</span><br><span class="line">|          3 | 0003    | 橡皮      | NULL          | 个   |       3.00 |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT *</span><br><span class="line">    -&gt; FROM demo.goodsmaster1;</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">| itemnumber | barcode | goodsname | specification | unit | salesprice |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">|          1 | 0001    | 教科书    | NULL          | NULL |      89.00 |</span><br><span class="line">|          4 | 0004    | 馒头      |               |      |       1.50 |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO demo.goodsmaster</span><br><span class="line">SELECT *</span><br><span class="line">FROM demo.goodsmaster1 as a</span><br><span class="line">ON DUPLICATE KEY UPDATE barcode = a.barcode,goodsname=a.goodsname;</span><br><span class="line">-- 运行结果如下</span><br><span class="line">mysql&gt; SELECT *</span><br><span class="line">    -&gt; FROM demo.goodsmaster;</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">| itemnumber | barcode | goodsname | specification | unit | salesprice |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">|          1 | 0001    | 教科书    | 16开          | 本   |      89.00 |</span><br><span class="line">|          2 | 0002    | 笔        | 10支装        | 包   |       5.00 |</span><br><span class="line">|          3 | 0003    | 橡皮      | NULL          | 个   |       3.00 |</span><br><span class="line">|          4 | 0004    | 馒头      |               |      |       1.50 |</span><br><span class="line">+------------+---------+-----------+---------------+------+------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">DELETE [ IGNORE ] FROM 表名 [ LEFT | RIGHT ] JOIN 表2 ON 条件</span><br><span class="line">WHERE 条件</span><br><span class="line">[ ORDER BY …… ]</span><br><span class="line">[ LIMIT …… ] ;</span><br><span class="line"></span><br><span class="line">// 删除全部数据</span><br><span class="line">DELETE FROM demo.goodsmaster; // undo log</span><br><span class="line">Truncate table table_name; // no in undo log</span><br></pre></td></tr></table></figure>
<ul>
<li>ignore: if foreign key exists so some records cannot be deleted, will ignore these records</li>
<li>sequence: from -&gt; where -&gt; order by -&gt; limit -&gt; delete</li>
</ul>
<h3 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">UPDATE 表名</span><br><span class="line">SET 字段名=值</span><br><span class="line">WHERE 条件</span><br><span class="line">[ ORDER BY …… ]</span><br><span class="line">[ LIMIT param ] ; /*can only have one param*/</span><br></pre></td></tr></table></figure>
<ul>
<li>sequence: from -&gt; where -&gt; order by -&gt; limit -&gt; set</li>
<li>Don’t update primary key</li>
<li>因为WHERE子句中的子查询效率非常低，所以我们可以利用表连接的方式来改造UPDATE语句<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表<span class="number">1</span> [ <span class="keyword">LEFT</span> <span class="operator">|</span> <span class="keyword">RIGHT</span> ] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 条件</span><br><span class="line"><span class="keyword">SET</span> 字段<span class="number">1</span> <span class="operator">=</span> 值<span class="number">1</span> , 字段<span class="number">2</span> <span class="operator">=</span> 值<span class="number">2</span> , …… ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> 表<span class="number">1</span> , 表<span class="number">2</span></span><br><span class="line"><span class="keyword">SET</span> 字段<span class="number">1</span> <span class="operator">=</span> 值<span class="number">1</span> , 字段<span class="number">2</span> <span class="operator">=</span> 值<span class="number">2</span> , ……</span><br><span class="line"><span class="keyword">WHERE</span> 连接条件 ;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SELECT *|字段列表</span><br><span class="line">FROM 数据源</span><br><span class="line">WHERE 条件</span><br><span class="line">GROUP BY 字段</span><br><span class="line">HAVING 条件</span><br><span class="line">ORDER BY 字段</span><br><span class="line">LIMIT 起始点，行数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    [ALL | DISTINCT | DISTINCTROW ]</span><br><span class="line">    [HIGH_PRIORITY]</span><br><span class="line">    [STRAIGHT_JOIN]</span><br><span class="line">    [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]</span><br><span class="line">    [SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]</span><br><span class="line">    select_expr [, select_expr] ...</span><br><span class="line">    [into_option]</span><br><span class="line">    [FROM table_references</span><br><span class="line">      [PARTITION partition_list]]</span><br><span class="line">    [WHERE where_condition]</span><br><span class="line">    [GROUP BY &#123;col_name | expr | position&#125;, ... [WITH ROLLUP]]</span><br><span class="line">    [HAVING where_condition]</span><br><span class="line">    [WINDOW window_name AS (window_spec)</span><br><span class="line">        [, window_name AS (window_spec)] ...]</span><br><span class="line">    [ORDER BY &#123;col_name | expr | position&#125;</span><br><span class="line">      [ASC | DESC], ... [WITH ROLLUP]]</span><br><span class="line">    [LIMIT &#123;[offset,] row_count | row_count OFFSET offset&#125;]</span><br><span class="line">    [into_option]</span><br><span class="line">    [FOR &#123;UPDATE | SHARE&#125;</span><br><span class="line">        [OF tbl_name [, tbl_name] ...]</span><br><span class="line">        [NOWAIT | SKIP LOCKED]</span><br><span class="line">      | LOCK IN SHARE MODE]</span><br><span class="line">    [into_option]</span><br><span class="line"></span><br><span class="line">into_option: &#123;</span><br><span class="line">    INTO OUTFILE &#x27;file_name&#x27;</span><br><span class="line">        [CHARACTER SET charset_name]</span><br><span class="line">        export_options</span><br><span class="line">  | INTO DUMPFILE &#x27;file_name&#x27;</span><br><span class="line">  | INTO var_name [, var_name] ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>Windows<ul>
<li>window functions also operate on a subset of rows but they do not reduce the number of rows returned by the query<br>···<br>window_function_name(expression) OVER (<br> [PARTITION BY <expression>[{,<expression>…}]]<br> [ORDER BY <expression> [ASC|DESC], [{,<expression>…}]] &#x2F;&#x2F; how the rows are ordered within a partition<br> [frame_unit {<frame_start>|<frame_between>}]<br>)</li>
</ul>
</li>
</ul>
<p>&#x2F;&#x2F; running total<br>SUM(total_price) OVER(ORDER BY Sales_Date rows between UNBOUNDED PRECEDING and current row) AS Running_Total<br>···</p>
<ul>
<li><p>A frame is defined with respect to the current row, which allows a frame to move within a partition depending on the position of the current row within its partition.</p>
</li>
<li><p>The frame unit specifies the type of relationship between the current row and frame rows. It can be ROWS or RANGE. The offsets of the current row and frame rows are the row numbers if the frame unit is ROWS and row values the frame unit is RANGE.</p>
</li>
<li><p>The frame_start defines the frame boundary and contains one of the following:</p>
<ul>
<li>UNBOUNDED PRECEDING: frame starts at the first row of the partition.</li>
<li>N PRECEDING: a physical N of rows before the first current row. N can be a literal number or an expression that evaluates to a number.</li>
<li>CURRENT ROW: the row of the current calculation</li>
</ul>
</li>
<li><p>The frame_between defines the frame boundary and is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BETWEEN frame_boundary_1 AND frame_boundary_2   </span><br></pre></td></tr></table></figure>
<p>The frame_boundary_1 and frame_boundary_2 can each contain one of the following:</p>
<ul>
<li>frame_start: as mentioned previously.</li>
<li>UNBOUNDED FOLLOWING: the frame ends at the final row in the partition.</li>
<li>N FOLLOWING: a physical N of rows after the current row.</li>
</ul>
</li>
<li><p>If you don’t specify the frame_definition in the OVER clause, then MySQL uses the following frame by default:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</span><br></pre></td></tr></table></figure>
<p>  <img src="/../image/mysql/5.png" alt="windows function"></p>
</li>
<li><p>Aggregate: Count, Sum, Avg, Min, Max</p>
</li>
<li><p>Offset:</p>
<ul>
<li>first_value(column_name)</li>
<li>last_value(column_name)</li>
<li>lead(<expression>[,offset[, default_value]]): running diff, e.g. y-o-y; If offset is zero, then the LAG() function evaluates the expression for the current row. If you don’t specify the offset, then the LAG() function uses one by default.</li>
<li>lag(<expression>[,offset[, default_value]]): running diff, e.g. y-o-y</li>
</ul>
</li>
<li><p>Rank</p>
<ul>
<li>row_number: Assigns a sequential integer to every row within its partition; application: Removing duplicate rows</li>
<li>rank</li>
<li>dense_rank</li>
</ul>
</li>
</ul>
<ul>
<li><p>distinct</p>
<ul>
<li>If you have null value in the column, select distinct will only show one null value</li>
<li>Select multiple columns: MySQL uses the combination of values in these columns to determine the uniqueness of the row in the result set</li>
</ul>
</li>
<li><p>Use of an unqualified * with other items in the select list may produce a parse error. To avoid this problem, use a qualified tbl_name.* reference:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT AVG(score), t1.* FROM t1 ...</span><br></pre></td></tr></table></figure></li>
<li><p>You need not specify a tbl_name or db_name.tbl_name prefix for a column reference unless the reference would be ambiguous.</p>
</li>
<li><p>The INTO clause, if present, can appear in any position indicated by the syntax description, but within a given statement can appear only once, not in multiple positions.</p>
</li>
<li><p>column alias:</p>
</li>
</ul>
<ul>
<li>it is good practice to be in the habit of using AS explicitly when specifying column aliases.</li>
<li>can be used in GROUP BY, ORDER BY, or HAVING clauses</li>
<li>If the column alias contains spaces, you need to place it inside quotes</li>
<li>The execute order after select can use the alias name, otherwise no. It is not permissible to refer to a column alias in a WHERE clause, because the column value might not yet be determined when the WHERE clause is executed.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT CONCAT(&#x27;Jane&#x27;,&#x27; &#x27;,&#x27;Doe&#x27;) AS &#x27;Full name&#x27;;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>from: table, derived table<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tbl_name [[AS] alias] [index_hint]</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>devrived table must have an alias</li>
<li>If you name more than one table, you are performing a join.</li>
<li>The use of index hints provides the optimizer with information about how to choose indexes during query processing. For a description of the syntax for specifying these hints, see Section 8.9.4, “Index Hints”.You can use SET max_seeks_for_key&#x3D;value as an alternative way to force MySQL to prefer key scans instead of table scans. See Section 5.1.8, “Server System Variables”.</li>
</ul>
<ul>
<li><p>where</p>
<ul>
<li>old: 筛选掉记录最多的条件写在最左侧</li>
</ul>
</li>
<li><p>GROUP BY</p>
<ul>
<li>permits a WITH ROLLUP modifier. See Section 12.20.2, “GROUP BY Modifiers”.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    productLine,</span><br><span class="line">    orderYear,</span><br><span class="line">    SUM(orderValue) totalOrderValue</span><br><span class="line">FROM</span><br><span class="line">    sales</span><br><span class="line">GROUP BY</span><br><span class="line">    productline,</span><br><span class="line">    orderYear</span><br><span class="line">WITH ROLLUP;</span><br></pre></td></tr></table></figure>
<img src="/../image/mysql/6.png" alt="with rollup"><br><a target="_blank" rel="noopener" href="https://www.mysqltutorial.org/mysql-rollup/">https://www.mysqltutorial.org/mysql-rollup/</a></li>
<li>The number of dimension column you selected can not larger than that of followed by clause group by</li>
<li>GROUP_CONCAT函数可以把分组查询中的某个字段拼接成一个字符串</li>
</ul>
</li>
<li><p>order by</p>
<ul>
<li>asc, desc</li>
<li>If ORDER BY occurs within a parenthesized query expression and also is applied in the outer query, the results are undefined and may change in a future version of MySQL.</li>
<li>When you use ORDER BY or GROUP BY to sort a column in a SELECT, the server sorts values using only the initial number of bytes indicated by the max_sort_length system variable.</li>
</ul>
</li>
<li><p>limit:</p>
</li>
</ul>
<ul>
<li>start index is 0</li>
<li><code>limit 1, 2</code>: 1 means starting from 1 (included, first row is 0); 2 means returning 2 records</li>
<li>With one argument, the value specifies the number of rows to return from the beginning of the result set</li>
<li>For prepared statements, you can use placeholders. <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET @skip=1; SET @numrows=5;</span><br><span class="line">PREPARE STMT FROM &#x27;SELECT * FROM tbl LIMIT ?, ?&#x27;;</span><br><span class="line">EXECUTE STMT USING @skip, @numrows;</span><br></pre></td></tr></table></figure></li>
<li>If LIMIT occurs within a parenthesized query expression and also is applied in the outer query, the results are undefined and may change in a future version of MySQL</li>
</ul>
<ul>
<li><p>HAVING</p>
<ul>
<li>The query result includes only groups satisfying the HAVING conditions. (If no GROUP BY is present, all rows implicitly form a single aggregate group.)</li>
<li>The WHERE clause specifies conditions on columns in the select list, but cannot refer to aggregate functions.</li>
<li>SQL standard: HAVING must reference only columns in the GROUP BY clause or columns used in aggregate functions. Extension: permits HAVING to refer to columns in the SELECT list and columns in outer subqueries. If a HAVING column name is used both in GROUP BY and as an aliased column in the select column list, preference is given to the column in the GROUP BY column</li>
</ul>
</li>
<li><p>aggregation function</p>
</li>
</ul>
<ul>
<li>AVG: ignore null, 只能用于数字类型，非数字数据统计结果为0</li>
<li>COUNT<ul>
<li>COUNT(*) to count the number of rows in a table</li>
<li>COUNT(column) ignores NULL values</li>
</ul>
</li>
<li>MAX: ignore null</li>
<li>MIN: ignore null</li>
<li>SUM: ignore null, 只能用于数字类型，字符类型的统计结果为0，日期类型统计结果是毫秒数相加。</li>
<li>for each group</li>
<li>can put <code>Distinct</code> inside (), such as <code>count(DISTINCT prod_price)</code></li>
</ul>
<ul>
<li>For update: …</li>
<li>DISTINCT</li>
<li>STRAIGHT_JOIN forces the optimizer to join the tables in the order in which they are listed in the FROM clause.</li>
<li>STRAIGHT_JOIN does not apply to any table that the optimizer treats as a const or system table.</li>
<li>SQL_BIG_RESULT or SQL_SMALL_RESULT can be used with GROUP BY or DISTINCT to tell the optimizer that the result set has many rows or is small, respectively. For SQL_BIG_RESULT, MySQL directly uses disk-based temporary tables if they are created, and prefers sorting to using a temporary table with a key on the GROUP BY elements. For SQL_SMALL_RESULT, MySQL uses in-memory temporary tables to store the resulting table instead of using sorting. This should not normally be needed.</li>
<li>SQL_BUFFER_RESULT forces the result to be put into a temporary table. This helps MySQL free the table locks early and helps in cases where it takes a long time to send the result set to the client. This modifier can be used only for top-level SELECT statements, not for subqueries or following UNION.</li>
<li>Named Windows: <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/window-functions-named-windows.html">https://dev.mysql.com/doc/refman/8.0/en/window-functions-named-windows.html</a></li>
<li>Partition: <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/partitioning-selection.html">https://dev.mysql.com/doc/refman/8.0/en/partitioning-selection.html</a></li>
</ul>
<h3 id="Join"><a href="#Join" class="headerlink" title="Join"></a>Join</h3><ul>
<li>inner join</li>
<li>left join, right join<ul>
<li>If there is no match, the columns of the row from the right&#x2F;left table will contain NULL</li>
</ul>
</li>
<li>Full (outer) Join<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM t1</span><br><span class="line">LEFT JOIN t2 ON t1.id = t2.id</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT * FROM t1</span><br><span class="line">RIGHT JOIN t2 ON t1.id = t2.id</span><br><span class="line">WHERE t1.id IS NULL</span><br></pre></td></tr></table></figure></li>
<li>cross join</li>
<li>self join</li>
</ul>
<h3 id="Case-when"><a href="#Case-when" class="headerlink" title="Case when"></a>Case when</h3><p>···<br>CASE WHEN [compare_value] THEN result<br>[WHEN [compare_value] THEN result …]<br>[ELSE result] END (AS new_column)<br>···</p>
<ul>
<li>CASE WHEN case be used in any statement</li>
</ul>
<h3 id="union"><a href="#union" class="headerlink" title="union"></a>union</h3><ul>
<li>union removes duplicates</li>
<li>union all</li>
<li>only one order by statement can be used, which is after the final select statement</li>
</ul>
<h3 id="function"><a href="#function" class="headerlink" title="function"></a>function</h3><h4 id="Number-1"><a href="#Number-1" class="headerlink" title="Number"></a>Number</h4><ul>
<li>abs</li>
<li>round</li>
<li>floor</li>
<li>ceil</li>
<li>power(2,3)</li>
<li>log(7,3)</li>
<li>ln(10)</li>
<li>sqrt(9)</li>
<li>pi()</li>
<li>sin</li>
<li>cos</li>
<li>tan</li>
<li>cot</li>
<li>radians(30): 角度转换弧度</li>
<li>DEGREES(1): 弧度转换角度<h4 id="Time"><a href="#Time" class="headerlink" title="Time"></a>Time</h4><h5 id="system-time"><a href="#system-time" class="headerlink" title="system time"></a>system time</h5></li>
<li>now(): yyyy-MM-dd hh:mm:ss</li>
<li>curdate(): yyyy-MM-dd</li>
<li>curtime(): hh:mm:ss<h5 id="DATE-FORMAT"><a href="#DATE-FORMAT" class="headerlink" title="DATE_FORMAT"></a>DATE_FORMAT</h5></li>
<li>DATE_FORMAT(日期, 表达式)<br>%Y 年份<br>%m 月份<br>%d 日期<br>%w 星期(数字)<br>%W 星期(名称)<br>%j 本年第几天<br>%U 本年第几周<br>%h 小时(12)<br>%H 小时(24)<br>%i 分钟<br>%s 秒<br>%r 时间(12)<br>%T 时间(24)<h5 id="DATE-ADD-and"><a href="#DATE-ADD-and" class="headerlink" title="DATE_ADD() and"></a>DATE_ADD() and</h5></li>
<li>DATE_ADD( 日期 , INTERVAL 15 DAY )</li>
<li>DATEDIFF ( 日期 , 日期 )<h4 id="String-1"><a href="#String-1" class="headerlink" title="String"></a>String</h4>LOWER<br>UPPER<br>LENGTH<br>SELECT CONCAT(“SQL “, “Tutorial “, “is “, “fun!”) AS ConcatenatedString<br>SELECT INSTR(“W3Schools.com”, “3”) AS MatchPosition: 2<br>SELECT INSERT(“W3Schools.com”, 1, 9, “Example”): Example.com<br>REPLACE(“你好先生”,”先生”,”女士”)<br>SELECT SUBSTR(“SQL Tutorial”, 5, 3) AS ExtractString: Tut<br>SELECT SUBSTRING(“SQL Tutorial”, 5, 3) AS ExtractString: Tut<br>SELECT LPAD(“SQL Tutorial”, 20, “ABC”): ABCABCABSQL Tutorial; Left-pad the string with “ABC”, to a total length of 20.<br>RPAD(“Hello”,10,”*”)<br>TRIM(“ 你好先生 “)<h4 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h4>IFNULL( 表达式 , 值 )<br>IF( 表达式 , 值1 , 值2 )</li>
</ul>
<h3 id="common-table-expression-or-CTE"><a href="#common-table-expression-or-CTE" class="headerlink" title="common table expression or CTE"></a>common table expression or CTE</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">WITH salesrep AS (</span><br><span class="line">    SELECT</span><br><span class="line">        employeeNumber,</span><br><span class="line">        CONCAT(firstName, &#x27; &#x27;, lastName) AS salesrepName</span><br><span class="line">    FROM</span><br><span class="line">        employees</span><br><span class="line">    WHERE</span><br><span class="line">        jobTitle = &#x27;Sales Rep&#x27;</span><br><span class="line">),</span><br><span class="line">customer_salesrep AS (</span><br><span class="line">    SELECT</span><br><span class="line">        customerName, salesrepName</span><br><span class="line">    FROM</span><br><span class="line">        customers</span><br><span class="line">            INNER JOIN</span><br><span class="line">        salesrep ON employeeNumber = salesrepEmployeeNumber</span><br><span class="line">)</span><br><span class="line">SELECT</span><br><span class="line">    *</span><br><span class="line">FROM</span><br><span class="line">    customer_salesrep</span><br><span class="line">ORDER BY customerName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WITH RECURSIVE cte_name AS (</span><br><span class="line">    initial_query  -- anchor member</span><br><span class="line">    UNION ALL</span><br><span class="line">    recursive_query -- recursive member that references to the CTE name</span><br><span class="line">)</span><br><span class="line">SELECT * FROM cte_name;</span><br></pre></td></tr></table></figure>
<p>to do: <a target="_blank" rel="noopener" href="https://www.mysqltutorial.org/mysql-recursive-cte/">https://www.mysqltutorial.org/mysql-recursive-cte/</a></p>
<h3 id="subquery"><a href="#subquery" class="headerlink" title="subquery"></a>subquery</h3><ul>
<li>can be in “select”, “from”, “where”</li>
<li>in “from” will have high efficiency, avoid being in “select” or “where”. 查询语句执行的时候要多次的依赖于子查询的结果，这类子查询被<br>称作相关子查询</li>
<li>多行子查询只能出现在WHERE子句和FROM子句中</li>
</ul>
<h3 id="Execution-Order"><a href="#Execution-Order" class="headerlink" title="Execution Order"></a>Execution Order</h3><p>From &gt; join &gt; Where &gt; group by &gt; having &gt; select &gt; distinct &gt; order by &gt; limit</p>
<h3 id="Prepared-statement"><a href="#Prepared-statement" class="headerlink" title="Prepared statement"></a>Prepared statement</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM products</span><br><span class="line">WHERE productCode = ?;</span><br></pre></td></tr></table></figure>
<ul>
<li>When MySQL executes this query with different productcode values, it does not have to fully parse the query. As a result, this helps MySQL execute the query faster, especially when MySQL executes the same query multiple times.</li>
<li>Since the prepared statement uses placeholders (?), this helps avoid many variants of SQL injection hence make your application more secure.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PREPARE stmt1 FROM</span><br><span class="line">	&#x27;SELECT</span><br><span class="line">   	    productCode,</span><br><span class="line">            productName</span><br><span class="line">	FROM products</span><br><span class="line">        WHERE productCode = ?&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SET @pc = &#x27;S10_1678&#x27;;</span><br><span class="line"></span><br><span class="line">EXECUTE stmt1 USING @pc;</span><br><span class="line"></span><br><span class="line">DEALLOCATE PREPARE stmt1;</span><br></pre></td></tr></table></figure>

<h2 id="Constraint"><a href="#Constraint" class="headerlink" title="Constraint"></a>Constraint</h2><h3 id="PK-vs-FK"><a href="#PK-vs-FK" class="headerlink" title="PK vs FK"></a>PK vs FK</h3><ul>
<li>PK<ul>
<li>unique</li>
<li>not null</li>
<li>one but can be multiple columns</li>
<li>can use AUTO_INCREMENT</li>
<li>Manual assignment: choose the largest ID, add 1 to make the new ID for the new record<ul>
<li>why: multiple servers, auto_increment will cause duplicates; don’t use business field as PK because the business field may be reused or have duplicates</li>
</ul>
</li>
</ul>
</li>
<li>FK<ul>
<li>primary key in another table</li>
<li>can be null</li>
<li>can have more than one FK</li>
<li>如果形成外键闭环，我们将无法删除任何一张表的记录</li>
</ul>
</li>
</ul>
<h2 id="View"><a href="#View" class="headerlink" title="View"></a>View</h2><ul>
<li>read-only, no storage</li>
</ul>
<h2 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h2><h3 id="General"><a href="#General" class="headerlink" title="General"></a>General</h3><ul>
<li>connection start and end time, all instructions to server<h3 id="Slow"><a href="#Slow" class="headerlink" title="Slow"></a>Slow</h3></li>
<li>my.ini, restart after modifying my.ini</li>
<li><h3 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h3><h3 id="binary-log-in-the-server-layer"><a href="#binary-log-in-the-server-layer" class="headerlink" title="binary log in the server layer"></a>binary log in the server layer</h3></li>
<li>can be used by all engines</li>
<li>Has statement-based logging: Events contain SQL statements that produce data changes (inserts, updates, deletes)</li>
<li>append</li>
<li>sync_binlog &#x3D; 1 to make sure binlog is saved to disk</li>
<li>show  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">show</span> the log that <span class="keyword">is</span> currently written <span class="keyword">into</span></span><br><span class="line"><span class="keyword">SHOW</span> MASTER STATUS; </span><br><span class="line">  </span><br><span class="line"># <span class="keyword">all</span> logs</span><br><span class="line"><span class="keyword">SHOW</span> <span class="type">BINARY</span> LOGS; </span><br><span class="line">  </span><br><span class="line"># <span class="keyword">all</span> statements</span><br><span class="line"><span class="keyword">SHOW</span> BINLOG EVENTS <span class="keyword">in</span> log_name; </span><br><span class="line">  </span><br><span class="line"># <span class="keyword">create</span> <span class="keyword">and</span> <span class="keyword">open</span> a <span class="keyword">new</span> log</span><br><span class="line">FLUSH <span class="type">BINARY</span> LOGS; </span><br><span class="line">  </span><br><span class="line"># recover</span><br><span class="line">mysql <span class="operator">-</span>u 用户 <span class="operator">-</span>p 密码 数据库名称 <span class="operator">&lt;</span> 备份文件</span><br><span class="line"># <span class="comment">--stop-position=yyy可不写</span></span><br><span class="line">mysqlbinlog –<span class="keyword">start</span><span class="operator">-</span>positon<span class="operator">=</span>xxx <span class="comment">--stop-position=yyy 二进制文件名 | mysql -u 用户 -p </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># <span class="keyword">delete</span> <span class="keyword">all</span></span><br><span class="line">RESET MASTER;</span><br><span class="line">  </span><br><span class="line"># 删除比指定二进制日志文件编号小的所有二进制日志文件</span><br><span class="line">PURGE MASTER LOGS <span class="keyword">TO</span> <span class="string">&#x27;GJTECH-PC-bin.000005&#x27;</span>;</span><br><span class="line">  </span><br><span class="line"># backup，备份完成后记录位置，防止修复时难以找到<span class="keyword">start</span><span class="operator">-</span>position</span><br><span class="line">mysqldump <span class="operator">-</span>u 用户 <span class="operator">-</span>p 密码 数据库 <span class="operator">&gt;</span> 备份文件</span><br><span class="line">FLUSH <span class="type">BINARY</span> LOGS;</span><br><span class="line">  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Relay-Bin-Log"><a href="#Relay-Bin-Log" class="headerlink" title="Relay Bin Log"></a>Relay Bin Log</h3></li>
<li>on slave server, read bin log from master server and write into</li>
</ul>
<h3 id="Undo-log"><a href="#Undo-log" class="headerlink" title="Undo log"></a>Undo log</h3><ul>
<li><p>record what data look like before change, allowing rollback and allowing other transactions to read what data look like before it is changed by this transaction</p>
</li>
<li><p>When there are no read-views earlier than this undo log record, it will be deleted.<br><img src="/../image/mysql/2.webp" alt="undo log and read-view"><br>Source: <a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/68963">https://time.geekbang.org/column/article/68963</a></p>
</li>
<li><p>Long transaction will cause too many undo log records to stay</p>
</li>
<li><p>To avoid long transaction, set autocommit&#x3D;1</p>
</li>
<li><p>To find long transaction (e.g. 60s):</p>
</li>
</ul>
<h3 id="Redo-Log-in-InnoDB"><a href="#Redo-Log-in-InnoDB" class="headerlink" title="Redo Log in InnoDB"></a>Redo Log in InnoDB</h3><ul>
<li>used to recover modification of unfinished transaction</li>
<li>Write-ahead logging<ul>
<li>write to redo log, update memory, then disk</li>
<li>when the redo log is full, move to disk to clean some space</li>
</ul>
</li>
<li>Crash-safe: innodb_flush_log_at_trx_commit &#x3D; 1</li>
</ul>
<p>InnoDB prepares redo log. Executor updates binlog. InnoDB commits redo log.</p>
<h3 id="Example-update"><a href="#Example-update" class="headerlink" title="Example: update"></a>Example: update</h3><ol>
<li>执行器找引擎取 ID&#x3D;2 这一行。ID 是主键，引擎直接用树搜索找到这一行。</li>
<li>如果 ID&#x3D;2 这一行所在的数据页本来就在内存中，就直接返回给执行器；否则，需要先从磁盘读入内存，然后再返回。</li>
<li>执行器拿到引擎给的行数据，把这个值加上 1，得到新的一行数据，再调用引擎接口写入这行新数据。</li>
<li>引擎将新数据更新到内存中，同时将这个更新操作记录到 redo log 里面，此时 redo log 处于 prepare 状态。然后告知执行器执行完成了，随时可以提交事务。</li>
<li>执行器生成这个操作的 binlog，并把 binlog 写入磁盘。执行器调用引擎的提交事务接口，引擎把刚刚写入的 redo log 改成提交（commit）状态，更新完成。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">select * from information_schema.innodb_trx where TIME_TO_SEC(timediff(now(),trx_started))&gt;60</span><br></pre></td></tr></table></figure>
<ul>
<li>Analyze general log to avoid long transaction issues</li>
<li>SET_MAX_EXECUTION_TIME</li>
</ul>
<h3 id="How-to-restore"><a href="#How-to-restore" class="headerlink" title="How to restore"></a>How to restore</h3><ul>
<li>Find the most recent full backup. Then based on binlog records later than the most recent full backup, restore data.</li>
<li>back up every day or every week? More frequent, more storage, less RTO(Recovery Time Objective).</li>
</ul>
<h2 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h2><ul>
<li>high isolation will lead to low efficiency</li>
<li>SQL<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION ;</span><br><span class="line"><span class="keyword">SQL</span>语句</span><br><span class="line">[ <span class="keyword">COMMIT</span> <span class="operator">|</span> <span class="keyword">ROLLBACK</span> ] ;</span><br></pre></td></tr></table></figure>
<h3 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h3></li>
<li>事务并不会自动帮你处理 SQL 语句执行中的错误，如果你对事务中的某一步数据操作发生的错误不做处理，继续提交的话，仍然会导致数据不一致。  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">START</span> TRANSACTION;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> demo.mytrans <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">5</span>); <span class="comment">-- 这个插入语句出错了</span></span><br><span class="line">ERROR <span class="number">1136</span> (<span class="number">21</span>S01): <span class="keyword">Column</span> count doesn<span class="string">&#x27;t match value count at row 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; UPDATE demo.inventory SET invquantity = invquantity - 5 WHERE itemnumber = 1;</span></span><br><span class="line"><span class="string">Query OK, 1 row affected (0.00 sec)    -- 后面的更新语句仍然执行成功了</span></span><br><span class="line"><span class="string">Rows matched: 1 Changed: 1 Warnings: 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; COMMIT;</span></span><br><span class="line"><span class="string">Query OK, 0 rows affected (0.03 sec)   -- 事务提交成功了</span></span><br></pre></td></tr></table></figure>
 如果发现事务中的某个操作发生错误，要及时使用回滚；  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> demo.mytrans <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line">ERROR <span class="number">1136</span> (<span class="number">21</span>S01): <span class="keyword">Column</span> count doesn<span class="string">&#x27;t match value count at row 1</span></span><br><span class="line"><span class="string">mysql&gt; SELECT ROW_COUNT();</span></span><br><span class="line"><span class="string">+-------------+</span></span><br><span class="line"><span class="string">| ROW_COUNT() |</span></span><br><span class="line"><span class="string">+-------------+</span></span><br><span class="line"><span class="string">| -1 |</span></span><br><span class="line"><span class="string">+-------------+</span></span><br><span class="line"><span class="string">1 row in set (0.00 sec)</span></span><br></pre></td></tr></table></figure></li>
<li>行锁是在需要的时候才加上的，等到事务结束时才释放。如果你的事务中需要锁多个行，要把最可能造成锁冲突、最可能影响并发度的锁尽量往后放。  </li>
<li>Dead lock<ul>
<li>发起死锁检测（默认innodb_deadlock_detect&#x3D;ON），发现死锁后，InnoDB自动回滚死锁链条中的某一个事务，让其他事务得以继续执行。如果并发能够控制住，比如同一行同时最多只有 10 个线程在更新，那么死锁检测的成本很低 </li>
<li>你可以考虑通过将一行改成逻辑上的多行来减少锁冲突。还是以影院账户为例，可以考虑放在多条记录上，比如 10 个记录，影院的账户总额等于这 10 个记录的值的总和。<br>这样每次要给影院账户加金额的时候，随机选其中一条记录来加。这样每次冲突概率变成原来的 1&#x2F;10，可以减少锁等待个数，也就减少了死锁检测的 CPU 消耗。<h3 id="Isolation-Levels"><a href="#Isolation-Levels" class="headerlink" title="Isolation Levels"></a>Isolation Levels</h3></li>
</ul>
</li>
<li><code>SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED</code></li>
<li>read uncommitted: no read-view.</li>
<li>read committed: a read-view is created when a SQL query of transaction B executes</li>
<li>repeatable read: a read-view is created when the transaction B executes “select” so the undo log has data, so data seen in this transaction are the same as what they were when this transaction started.</li>
<li>serializable: read and write will add lock. After a transaction finishes, another transaction can execute.<br><img src="/../image/mysql/1.webp" alt="isolation levels"><br>Source: <a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/68963">https://time.geekbang.org/column/article/68963</a></li>
</ul>
<h2 id="导出与备份"><a href="#导出与备份" class="headerlink" title="导出与备份"></a>导出与备份</h2><ul>
<li>数据导出: 数据<ul>
<li>SQL文档<ul>
<li><code>mysqldump -uroot -p [ no-data ] 逻辑库 &gt; 路径</code></li>
<li>如果业务数据非常多，建议只导出表结构，然后用SELECT INTO OUTFILE把数据导出成文本文档</li>
</ul>
</li>
<li>文本文档</li>
</ul>
</li>
<li>数据备份: 数据文件、日志文件、索引文件等等</li>
<li>全量备份, 增量备份</li>
<li>导入<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">USE demo ;</span><br><span class="line">SOURCE backup.sql ;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="index"><a href="#index" class="headerlink" title="index"></a>index</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX 索引名 ON 表名( 字段 ) ；</span><br><span class="line">ALTER TABLE 表名称 ADD INDEX [ 索引名 ]( 字段 ) ;</span><br><span class="line">SHOW INDEX FROM 表名 ;</span><br><span class="line">DROP INDEX 索引名称 ON 表名 ;</span><br></pre></td></tr></table></figure>
<ul>
<li>different storage engines may have different index implementation.</li>
<li>Clustered index: defines the physical order in which table records are stored in a database; one clustered index per table; by default is PK</li>
<li>Secondary index</li>
<li>Multiple-column index<ul>
<li>leftmost prefix rule</li>
<li>if filter a field by a range, the field after this field in the multiple-column index will not be filtered by using the multiple-column index any longer.<br>For example, index is (branchnumber, cashiernumber, itemnumber), <code>branchnumber &gt; 10 AND cashiernumber = 1 AND itemnumber = 100</code>: will use index to filter branchnuber,<br>but when filtering cashiernumber, it will not use the index (branchnumber, cashiernumber)</li>
</ul>
</li>
<li>If there are multiple indexes, MySQL will choose the best</li>
<li>Don’t create an index on a big field</li>
</ul>
<h3 id="InnoDB-index-model"><a href="#InnoDB-index-model" class="headerlink" title="InnoDB index model"></a>InnoDB index model</h3><ul>
<li>B+ tree<br><img src="/../image/mysql/3.webp" alt="InnoDB index model"></li>
<li>primary key index (called clustered index in InnoDB): leaves store records</li>
<li>non primary key index (called secondary index in InnoDB): leaves store primary key values. If search based on non primary key index, will search the B+ tree of the non primary key index first, find the primary key value, and then search the B+ tree of the primary key index.</li>
<li>index maintenance<ul>
<li>inserting may cause some records to be moved</li>
<li>if a data page is full, inserting will create a new data page</li>
</ul>
</li>
<li>Usually using auto increment as the primary key leads to better performance and less storage. However, for the k-v situation, may use a business column as the primary key</li>
</ul>
<h2 id="Paradigm"><a href="#Paradigm" class="headerlink" title="Paradigm"></a>Paradigm</h2><ul>
<li>First: atomic: cannot be separated further</li>
<li>Second: every record has a unique identifier; every field depends on the full PK rather than part of PK</li>
<li>Third: cannot have field that depends on non-PK</li>
<li>Business-first: may not obey paradigm 3</li>
</ul>
<h2 id="ER"><a href="#ER" class="headerlink" title="ER"></a>ER</h2><ul>
<li>One entity -&gt; a table</li>
<li>M-N -&gt; a table</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/04/07/Design-Pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/07/Design-Pattern/" class="post-title-link" itemprop="url">Design Pattern</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-07 17:51:29" itemprop="dateCreated datePublished" datetime="2022-04-07T17:51:29-04:00">2022-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-06-14 19:57:39" itemprop="dateModified" datetime="2022-06-14T19:57:39-04:00">2022-06-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Ability"><a href="#Ability" class="headerlink" title="Ability"></a>Ability</h2><p>What:</p>
<ol>
<li>简历：履历、学历、项目</li>
<li>正确 + 写代码快 + 性能 + 质量</li>
<li>架构、高可用、高并发、分布式</li>
<li>沟通能力、公司贡献<br>How:</li>
<li>编程语言，数据结构和算法，设计思想、原则和模式</li>
<li>想想如何用</li>
<li>如果要想在技术上形成壁垒，我们就要从事一些有技术难度、技术挑战的岗位，比如基础架构、中间件、数据库等偏底层的开发，又或者是人工智能算法等入行门槛比较高的细分领域。</li>
</ol>
<h2 id="Code-Quality"><a href="#Code-Quality" class="headerlink" title="Code Quality"></a>Code Quality</h2><ul>
<li>maintainability: quickly update without bugs<ul>
<li>well layered</li>
<li>modularity, high cohesion loose coupling</li>
<li>well-documented</li>
<li>interface-oriented programming</li>
<li>OOP: encapsulation, abstraction</li>
</ul>
</li>
<li>readability</li>
<li>extensibility: open close principle</li>
<li>simplicity</li>
<li>reusability<ul>
<li>inheritance and polymorphism</li>
<li>SRP</li>
<li>high cohesion loose coupling</li>
<li>modularity</li>
</ul>
</li>
<li>testability<br>&#x2F;&#x2F; todo</li>
</ul>
<h2 id="Paradigm"><a href="#Paradigm" class="headerlink" title="Paradigm"></a>Paradigm</h2><ul>
<li>Process-oriented programming: a process is a unit, featuring separation of data structures and methods.</li>
<li>Object-oriented programming: based on class and object. Data structures and methods are in a class.   </li>
<li>Functional programming</li>
</ul>
<h3 id="OOP"><a href="#OOP" class="headerlink" title="OOP"></a>OOP</h3><h4 id="Four-features"><a href="#Four-features" class="headerlink" title="Four features"></a>Four features</h4><ul>
<li><p>encapsulation: control how to access (get and set) and hide details</p>
</li>
<li><p>abstraction: hide details of implementation and only expose what to do</p>
<ul>
<li>may use <code>interface</code>, <code>abstract</code>, or function</li>
<li>when naming a function, avoid implementation details. E.g. <code>getPictureUrl()</code> is better than <code>getAWSPictureUrl()</code> is bad, in case later we change AWS to something else</li>
<li>to increase maintainability and extensibility</li>
</ul>
</li>
<li><p>inheritance: is-a, e.g. dog is an animal</p>
<ul>
<li>Java: a class can only extend a superclass rater than multiple superclasses</li>
<li>if there are too many inheritance layers, maintainability and readability suffer</li>
</ul>
</li>
<li><p>polymorphism: a subclass can replace a superclass</p>
<ul>
<li>override</li>
<li>to increase extensibility and reusability</li>
</ul>
</li>
</ul>
<h4 id="Compared-to-Process-oriented-Programming"><a href="#Compared-to-Process-oriented-Programming" class="headerlink" title="Compared to Process-oriented Programming"></a>Compared to Process-oriented Programming</h4><p>pros:</p>
<ul>
<li>complex application, not linear but like a network</li>
<li>modularity</li>
<li>four features</li>
<li>think like a human</li>
</ul>
<h4 id="Fake-OOP"><a href="#Fake-OOP" class="headerlink" title="Fake OOP"></a>Fake OOP</h4><ul>
<li>add unnecessary getter and setter</li>
<li>the getter returns an object, which may be modified unintendedly. Can use <code>Collections.unmodifiableList()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCart</span> &#123;</span><br><span class="line">  <span class="comment">// ...other codes...</span></span><br><span class="line">  <span class="keyword">public</span> List&lt;ShoppingCartItem&gt; <span class="title function_">getItems</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Collections.unmodifiableList(<span class="built_in">this</span>.items);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnmodifiableList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">UnmodifiableCollection</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...other codes...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">List&lt;ShoppingCartItem&gt; items = cart.getItems();</span><br><span class="line">items.clear();<span class="comment">//will throw UnsupportedOperationException</span></span><br></pre></td></tr></table></figure>

<ul>
<li>global variable and method<ul>
<li>singleton</li>
<li>static attribute</li>
<li>static method: used to manipulate static attribute or data outside</li>
<li>constant: can put config attributes in a class <code>Constants</code></li>
</ul>
</li>
</ul>
<h5 id="POP-example-Constants"><a href="#POP-example-Constants" class="headerlink" title="POP example: Constants"></a>POP example: Constants</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Constants &#123;</span><br><span class="line">  public static final String MYSQL_ADDR_KEY = &quot;mysql_addr&quot;;</span><br><span class="line">  public static final String MYSQL_DB_NAME_KEY = &quot;db_name&quot;;</span><br><span class="line">  public static final String MYSQL_USERNAME_KEY = &quot;mysql_username&quot;;</span><br><span class="line">  public static final String MYSQL_PASSWORD_KEY = &quot;mysql_password&quot;;</span><br><span class="line"></span><br><span class="line">  public static final String REDIS_DEFAULT_ADDR = &quot;192.168.7.2:7234&quot;;</span><br><span class="line">  public static final int REDIS_DEFAULT_MAX_TOTAL = 50;</span><br><span class="line">  public static final int REDIS_DEFAULT_MAX_IDLE = 50;</span><br><span class="line">  public static final int REDIS_DEFAULT_MIN_IDLE = 20;</span><br><span class="line">  public static final String REDIS_DEFAULT_KEY_PREFIX = &quot;rt:&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Using a single Constants may be bad because:</p>
<ul>
<li>when there are too many lines, hard to find one and may conflict with others</li>
<li>long compilation time. Each time <code>Constants</code> is changed, other classes depend on that will be compiled again. When the project is large and we need to do unit test, it will take long.</li>
<li>reusability. If we need to use only some variables in  <code>Constants</code> in another project, we have to import the whole file, which is a waste.</li>
</ul>
<p> How to improve?</p>
<ul>
<li>method 1: Break down  <code>Constants</code> into <code>MysqlConstants</code>, <code>RedisConstants</code>, etc</li>
<li>method 2: put constant in the class that uses it. E.g.  <code>RedisConfig</code> class</li>
</ul>
<h5 id="POP-example-Utils"><a href="#POP-example-Utils" class="headerlink" title="POP example: Utils"></a>POP example: Utils</h5><p>Class A and class B use the same methods. To avoid repetition, we put it in <code>XxxUtils</code>. Use static methods.</p>
<h5 id="POP-example-VO-x2F-BO-x2F-Entity-and-Controller-x2F-Service-x2F-Repository"><a href="#POP-example-VO-x2F-BO-x2F-Entity-and-Controller-x2F-Service-x2F-Repository" class="headerlink" title="POP example: VO&#x2F;BO&#x2F;Entity and Controller&#x2F;Service&#x2F;Repository"></a>POP example: VO&#x2F;BO&#x2F;Entity and Controller&#x2F;Service&#x2F;Repository</h5><ul>
<li>Anemic Demain Model: separation of data and logic<ul>
<li>Entity and Repository</li>
<li>BO and Service</li>
<li>VO and Controller</li>
</ul>
</li>
<li>Rich Demain Model: data and logic are in the same class. Service layer includes service classes and domain classes (similar to BO). 贫血模式重Service轻BO，充血模式轻Service重Domain。适合业务复杂，improve reusability.</li>
</ul>
<h4 id="Interface-vs-Abstract-Class"><a href="#Interface-vs-Abstract-Class" class="headerlink" title="Interface vs Abstract Class"></a>Interface vs Abstract Class</h4><h5 id="Abstract-Class"><a href="#Abstract-Class" class="headerlink" title="Abstract Class"></a>Abstract Class</h5><ul>
<li>is-a</li>
<li>抽象类不允许被实例化，只能被继承</li>
<li>抽象类可以包含属性和方法。方法既可以包含代码实现（比如 Logger 中的 log() 方法），也可以不包含代码实现（比如 Logger 中的 doLog() 方法）。不包含代码实现的方法叫作抽象方法。</li>
<li>子类继承抽象类，必须实现抽象类中的所有抽象方法。<h5 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h5></li>
<li>has a, contract</li>
<li>接口不能包含属性（也就是成员变量）。</li>
<li>接口只能声明方法，方法不能包含代码实现。</li>
<li>类实现接口的时候，必须实现接口中声明的所有方法。</li>
</ul>
<h4 id="Program-to-interface"><a href="#Program-to-interface" class="headerlink" title="Program to interface"></a>Program to interface</h4><ul>
<li>Program to an interface, not an implementation</li>
<li>because when requirements change, implementation will change</li>
<li>如果在我们的业务场景中，某个功能只有一种实现方式，未来也不可能被其他实现方式替换，那我们就没有必要为其设计接口</li>
</ul>
<h4 id="多用组合少用继承"><a href="#多用组合少用继承" class="headerlink" title="多用组合少用继承"></a>多用组合少用继承</h4><ul>
<li><p>Why: too many layers of inheritance -&gt; hurt maintainability</p>
</li>
<li><p>change “is a” to “has a”</p>
</li>
<li><p>Con: 继承改写成组合意味着要做更细粒度的类的拆分. 如果类之间的继承结构稳定（不会轻易改变），继承层次比较浅（比如，最多有两层继承关系），继承关系不复杂，我们就可以大胆地使用继承</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public interface Flyable &#123;</span><br><span class="line">  void fly()；</span><br><span class="line">&#125;</span><br><span class="line">public class FlyAbility implements Flyable &#123;</span><br><span class="line">  @Override</span><br><span class="line">  public void fly() &#123; //... &#125;</span><br><span class="line">&#125;</span><br><span class="line">//省略Tweetable/TweetAbility/EggLayable/EggLayAbility</span><br><span class="line"></span><br><span class="line">public class Ostrich implements Tweetable, EggLayable &#123;//鸵鸟</span><br><span class="line">  private TweetAbility tweetAbility = new TweetAbility(); //组合</span><br><span class="line">  private EggLayAbility eggLayAbility = new EggLayAbility(); //组合</span><br><span class="line">  //... 省略其他属性和方法...</span><br><span class="line">  @Override</span><br><span class="line">  public void tweet() &#123;</span><br><span class="line">    tweetAbility.tweet(); // 委托</span><br><span class="line">  &#125;</span><br><span class="line">  @Override</span><br><span class="line">  public void layEgg() &#123;</span><br><span class="line">    eggLayAbility.layEgg(); // 委托</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Example：接口鉴权的面向对象分析"><a href="#Example：接口鉴权的面向对象分析" class="headerlink" title="Example：接口鉴权的面向对象分析"></a>Example：接口鉴权的面向对象分析</h4><ul>
<li>调用方进行接口请求的时候，将 URL、AppID、密码、时间戳拼接在一起，通过加密算法生成 token，并且将 token、AppID、时间戳拼接在 URL 中，一并发送到微服务端。</li>
<li>微服务端在接收到调用方的接口请求之后，从请求中拆解出 token、AppID、时间戳。</li>
<li>微服务端首先检查传递过来的时间戳跟当前时间，是否在 token 失效时间窗口内。如果已经超过失效时间，那就算接口调用鉴权失败，拒绝接口调用请求。</li>
<li>如果 token 验证没有过期失效，微服务端再从自己的存储中，取出 AppID 对应的密码，通过同样的 token 生成算法，生成另外一个 token，与调用方传递过来的 token 进行匹配；如果一致，则鉴权成功，允许接口调用，否则就拒绝接口调用。</li>
</ul>
<h5 id="划分职责进而识别出有哪些类"><a href="#划分职责进而识别出有哪些类" class="headerlink" title="划分职责进而识别出有哪些类"></a>划分职责进而识别出有哪些类</h5><ul>
<li>method 1:把需求描述中的名词罗列出来，作为可能的候选类，然后再进行筛选</li>
<li>method 2 (better):根据需求描述，把其中涉及的功能点，一个一个罗列出来，然后再去看哪些功能点职责相近，操作同样的属性，是否应该归为同一个类<ul>
<li><p>Example: 功能点</p>
<ul>
<li>把 URL、AppID、密码、时间戳拼接为一个字符串；</li>
<li>对字符串通过加密算法加密生成 token；</li>
<li>将 token、AppID、时间戳拼接到 URL 中，形成新的 URL；</li>
<li>解析 URL，得到 token、AppID、时间戳等信息；</li>
<li>从存储中取出 AppID 和对应的密码；</li>
<li>根据时间戳判断 token 是否过期失效；</li>
<li>验证两个 token 是否匹配；</li>
</ul>
</li>
<li><p>从上面的功能列表中，我们发现，1、2、6、7 都是跟 token 有关，负责 token 的生成、验证；3、4 都是在处理 URL，负责 URL 的拼接、解析；5 是操作   AppID 和密码，负责从存储中读取 AppID 和密码。所以，我们可以粗略地得到三个核心的类：AuthToken、Url、CredentialStorage。AuthToken 负责实现 1、2、6、7 这四个操作；Url 负责 3、4 两个操作；CredentialStorage 负责 5 这个操作。</p>
</li>
</ul>
</li>
</ul>
<h5 id="定义类及其属性和方法"><a href="#定义类及其属性和方法" class="headerlink" title="定义类及其属性和方法"></a>定义类及其属性和方法</h5><p><img src="/../image/design-pattern/1.webp" alt="AuthToken"><br><img src="/../image/design-pattern/2.webp" alt="ApiRequest"><br><img src="/../image/design-pattern/3.webp" alt="CredentialStorage"></p>
<h5 id="定义类与类之间的交互关系"><a href="#定义类与类之间的交互关系" class="headerlink" title="定义类与类之间的交互关系"></a>定义类与类之间的交互关系</h5><ul>
<li>Generalization: 继承</li>
<li>Realization: implement</li>
<li>Aggregation: A 类对象包含 B 类对象，B 类对象的生命周期可以不依赖 A 类对象的生命周期，也就是说可以单独销毁 A 类对象而不影响 B 对象</li>
<li>Composition: A 类对象包含 B 类对象，B 类对象的生命周期依赖 A 类对象的生命周期，B 类对象不可单独存在，比如鸟与翅膀之间的关系</li>
<li>Association: 包含聚合、组合两种关系。 如果 B 类对象是 A 类的成员变量，那 B 类和 A 类就是关联关系</li>
<li>Dependency: 包含关联关系。不管是 B 类对象是 A 类对象的成员变量，还是 A 类的方法使用 B 类对象作为参数或者返回值、局部变量，只要 B 类对象和 A 类对象有任何使用关系，我们都称它们有依赖关系。</li>
<li>下文中，只要 B 类对象是 A 类对象的成员变量，那我们就称，A 类跟 B 类是组合关系。<br><img src="/../image/design-pattern/3.webp" alt="ApiAuthenticator"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApiAuthenticator</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">auth</span><span class="params">(String url)</span>;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">auth</span><span class="params">(ApiRequest apiRequest)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultApiAuthenticatorImpl</span> <span class="keyword">implements</span> <span class="title class_">ApiAuthenticator</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> CredentialStorage credentialStorage;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">DefaultApiAuthenticatorImpl</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.credentialStorage = <span class="keyword">new</span> <span class="title class_">MysqlCredentialStorage</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">DefaultApiAuthenticatorImpl</span><span class="params">(CredentialStorage credentialStorage)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.credentialStorage = credentialStorage;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">auth</span><span class="params">(String url)</span> &#123;</span><br><span class="line">    <span class="type">ApiRequest</span> <span class="variable">apiRequest</span> <span class="operator">=</span> ApiRequest.buildFromUrl(url);</span><br><span class="line">    auth(apiRequest);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">auth</span><span class="params">(ApiRequest apiRequest)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">appId</span> <span class="operator">=</span> apiRequest.getAppId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> apiRequest.getToken();</span><br><span class="line">    <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> apiRequest.getTimestamp();</span><br><span class="line">    <span class="type">String</span> <span class="variable">originalUrl</span> <span class="operator">=</span> apiRequest.getOriginalUrl();</span><br><span class="line"></span><br><span class="line">    <span class="type">AuthToken</span> <span class="variable">clientAuthToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AuthToken</span>(token, timestamp);</span><br><span class="line">    <span class="keyword">if</span> (clientAuthToken.isExpired()) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Token is expired.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> credentialStorage.getPasswordByAppId(appId);</span><br><span class="line">    <span class="type">AuthToken</span> <span class="variable">serverAuthToken</span> <span class="operator">=</span> AuthToken.generate(originalUrl, appId, password, timestamp);</span><br><span class="line">    <span class="keyword">if</span> (!serverAuthToken.match(clientAuthToken)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Token verfication failed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="将类组装起来并提供执行入口"><a href="#将类组装起来并提供执行入口" class="headerlink" title="将类组装起来并提供执行入口"></a>将类组装起来并提供执行入口</h5><h4 id="SOLID-principles"><a href="#SOLID-principles" class="headerlink" title="SOLID principles"></a>SOLID principles</h4><ul>
<li>Single Responsibility Principle: A class or module should have a single responsibility. Whether the module is too big depends on the situation. At the beginning, can have a big module. Later when the module becomes too big, we can break it down. Usually should be less than 200 lines and 10 members.</li>
<li>Open Closed Principle: software entities (modules, classes, functions, etc.) should be open for extension , but closed for modification. 没有破坏原有代码的正常运行和单元测试。时刻具备扩展意识、抽象意识、封装意识。在识别出代码可变部分和不可变部分之后，我们要将可变部分封装起来，隔离变化，提供抽象化的不可变接口，给上层系统使用。当具体的实现发生变化的时候，我们只需要基于相同的抽象接口，扩展一个新的实现，替换掉老的实现即可，上游系统的代码几乎不需要修改。多态、依赖注入、基于接口而非实现编程。</li>
</ul>
<p>最合理的做法是，对于一些比较确定的、短期内可能就会扩展，或者需求改动对代码结构影响比较大的情况，或者实现成本不高的扩展点，在编写代码的时候之后，我们就可以事先做些扩展性设计。但对于一些不确定未来是否要支持的需求，或者实现起来比较复杂的扩展点，我们可以等到有需求驱动的时候，再通过重构代码的方式来支持扩展的需求。</p>
<p>在扩展性和可读性之间做权衡</p>
<ul>
<li><p>Liskov Substitution Principle: Functions that use references to base classes must be able to use objects of derived classes without knowing it<br>子类在设计的时候，要遵守父类的行为约定（或者叫协议）。父类定义了函数的行为约定，那子类可以改变函数的内部实现逻辑，但不能改变函数原有的行为约定。这里的行为约定包括：函数声明要实现的功能；对输入、输出、异常的约定；甚至包括注释中所罗列的任何特殊说明。实际上，定义中父类和子类之间的关系，也可以替换成接口和实现类之间的关系。</p>
</li>
<li><p>Interface Segregation Principle: Clients should not be forced to depend upon interfaces that they do not use</p>
</li>
<li><p>Dependency Inversion Principle: High-level modules shouldn’t depend on low-level modules. Both modules should depend on abstractions. In addition, abstractions shouldn’t depend on details. Details depend on abstractions.调用者属于高层，被调用者属于低层。</p>
</li>
</ul>
<p>“控制”指的是对程序执行流程的控制，而“反转”指的是在没有使用框架之前，程序员自己控制整个程序的执行。在使用框架之后，整个程序的执行流程通过框架来控制。流程的控制权从程序员“反转”给了框架。</p>
<p>依赖注入和控制反转恰恰相反，它是一种具体的编码技巧。我们不通过 new 的方式在类内部创建依赖类的对象，而是将依赖的类对象在外部创建好之后，通过构造函数、函数参数等方式传递（或注入）给类来使用。</p>
<h4 id="KISS-and-YAGNI"><a href="#KISS-and-YAGNI" class="headerlink" title="KISS and YAGNI"></a>KISS and YAGNI</h4><ul>
<li><p>Example</p>
<ul>
<li>一个合法的 IP 地址由四个数字组成，并且通过“.”来进行分割。每组数字的取值范围是 0~255。第一组数字比较特殊，不允许为 0<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 第一种实现方式: 使用正则表达式</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidIpAddressV1</span><span class="params">(String ipAddress)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (StringUtils.isBlank(ipAddress)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;^(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|[1-9])\\.&quot;</span></span><br><span class="line">          + <span class="string">&quot;(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\.&quot;</span></span><br><span class="line">          + <span class="string">&quot;(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\.&quot;</span></span><br><span class="line">          + <span class="string">&quot;(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)$&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> ipAddress.matches(regex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种实现方式: 使用现成的工具类</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidIpAddressV2</span><span class="params">(String ipAddress)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (StringUtils.isBlank(ipAddress)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  String[] ipUnits = StringUtils.split(ipAddress, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (ipUnits.length != <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">    <span class="type">int</span> ipUnitIntValue;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      ipUnitIntValue = Integer.parseInt(ipUnits[i]);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ipUnitIntValue &lt; <span class="number">0</span> || ipUnitIntValue &gt; <span class="number">255</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; ipUnitIntValue == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三种实现方式: 不使用任何工具类</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidIpAddressV3</span><span class="params">(String ipAddress)</span> &#123;</span><br><span class="line">  <span class="type">char</span>[] ipChars = ipAddress.toCharArray();</span><br><span class="line">  <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> ipChars.length;</span><br><span class="line">  <span class="type">int</span> <span class="variable">ipUnitIntValue</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">  <span class="type">boolean</span> <span class="variable">isFirstUnit</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="type">int</span> <span class="variable">unitsCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">    <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> ipChars[i];</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ipUnitIntValue &lt; <span class="number">0</span> || ipUnitIntValue &gt; <span class="number">255</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (isFirstUnit &amp;&amp; ipUnitIntValue == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (isFirstUnit) isFirstUnit = <span class="literal">false</span>;</span><br><span class="line">      ipUnitIntValue = -<span class="number">1</span>;</span><br><span class="line">      unitsCount++;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ipUnitIntValue == -<span class="number">1</span>) ipUnitIntValue = <span class="number">0</span>;</span><br><span class="line">    ipUnitIntValue = ipUnitIntValue * <span class="number">10</span> + (c - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (ipUnitIntValue &lt; <span class="number">0</span> || ipUnitIntValue &gt; <span class="number">255</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (unitsCount != <span class="number">3</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>尽管第三种实现方式性能更高些，但我还是更倾向于选择第二种实现方法。那是因为第三种实现方式实际上是一种过度优化。除非 isValidIpAddress() 函数是影响系统性能的瓶颈代码，否则，这样优化的投入产出比并不高，增加了代码实现的难度、牺牲了代码的可读性，性能上的提升却并不明显</li>
</ul>
</li>
<li><p>不要使用同事可能不懂的技术来实现代码。比如前面例子中的正则表达式，还有一些编程语言中过于高级的语法等。如果在 code review 的时候，同事对你的代码有很多疑问，那就说明你的代码有可能不够“简单”，需要优化啦。</p>
</li>
<li><p>不要重复造轮子，要善于使用已经有的工具类库。经验证明，自己去实现这些类库，出 bug 的概率会更高，维护的成本也比较高。不要过度优化。</p>
</li>
<li><p>不要过度使用一些奇技淫巧（比如，位运算代替算术运算、复杂的条件语句代替 if-else、使用一些过于底层的函数等）来优化代码，牺牲代码的可读性。</p>
</li>
<li><p>不要去设计当前用不到的功能；不要去编写当前用不到的代码。当然，这并不是说我们就不需要考虑代码的扩展性。我们还是要预留好扩展点，等到需要的时候，再去实现 ZooKeeper 存储配置信息这部分代码。</p>
</li>
<li><p>我们不要在项目中提前引入不需要依赖的开发包</p>
</li>
</ul>
<h2 id="Design-Pattern"><a href="#Design-Pattern" class="headerlink" title="Design Pattern"></a>Design Pattern</h2><h3 id="Singleton"><a href="#Singleton" class="headerlink" title="Singleton"></a>Singleton</h3><ul>
<li><p>create and provide only one instance by itself</p>
</li>
<li><p>implementation</p>
<ul>
<li>private constructor</li>
<li>private static reference to object</li>
<li>public static method to create and get. Need to consider whether to add lock</li>
</ul>
</li>
<li><p>type</p>
<ul>
<li><p>hungry: Instantiate when loading the class; thread-safe</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//饿汉式：创建对象实例的时候直接初始化  空间换时间</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonOne</span> &#123;</span><br><span class="line">	<span class="comment">//1、创建类中私有构造</span></span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">SingletonOne</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//2、创建该类型的私有静态实例</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">SingletonOne</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingletonOne</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//3、创建公有静态方法返回静态实例对象</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> SingletonOne <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>lazy: instantiate when using; not thread-safe if not add lock</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//懒汉式：类内实例对象创建时并不直接初始化，直到第一次调用get方法时，才完成初始化操作</span></span><br><span class="line"><span class="comment">//时间换空间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IdGenerator</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> IdGenerator instance;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">IdGenerator</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add lock 并发度很低</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> IdGenerator <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> <span class="title class_">IdGenerator</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>双重校验锁: 既支持延迟加载、又支持高并发的单例实现方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IdGenerator</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> IdGenerator instance;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">IdGenerator</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span>(IdGenerator.class) &#123; <span class="comment">// 此处为类级别的锁</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">          instance = <span class="keyword">new</span> <span class="title class_">IdGenerator</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>静态内部类: 类似饿汉式，但又能做到了延迟加载</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IdGenerator</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">private</span> <span class="title function_">IdGenerator</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// static class: holder  </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">IdGenerator</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IdGenerator</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>枚举</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">IdGenerator</span> &#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>pro</p>
<ul>
<li>save memory</li>
<li>avoid frequent creating</li>
</ul>
</li>
<li><p>con</p>
<ul>
<li>hard to extend</li>
<li>if not used for a long time, lost due to GC</li>
</ul>
</li>
<li><p>when to use</p>
<ul>
<li>save memory</li>
<li>universal handling</li>
<li>multiple instances will cause problems, e.g. 两个线程互相覆盖数据，唯一递增 ID 号码生成器（两个对象会造成重复ID）</li>
</ul>
</li>
<li><p>Example</p>
<ul>
<li>FileWriter 本身是对象级别线程安全的<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Logger &#123;</span><br><span class="line">  private FileWriter writer;</span><br><span class="line">  private static final Logger instance = new Logger();</span><br><span class="line"></span><br><span class="line">  private Logger() &#123;</span><br><span class="line">    File file = new File(&quot;/Users/wangzheng/log.txt&quot;);</span><br><span class="line">    writer = new FileWriter(file, true); //true表示追加写入</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public static Logger getInstance() &#123;</span><br><span class="line">    return instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public void log(String message) &#123;</span><br><span class="line">    writer.write(mesasge);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Logger类的应用示例：</span><br><span class="line">public class UserController &#123;</span><br><span class="line">  public void login(String username, String password) &#123;</span><br><span class="line">    // ...省略业务逻辑代码...</span><br><span class="line">    Logger.getInstance().log(username + &quot; logined!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class OrderController &#123;  </span><br><span class="line">  public void create(OrderVo order) &#123;</span><br><span class="line">    // ...省略业务逻辑代码...</span><br><span class="line">    Logger.getInstance().log(&quot;Created a order: &quot; + order.toString());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="Factory"><a href="#Factory" class="headerlink" title="Factory"></a>Factory</h3><ul>
<li>封装变化：创建逻辑有可能变化</li>
<li>代码复用：创建代码抽离到独立的工厂类之后可以复用。</li>
<li>隔离复杂性：封装复杂的创建逻辑，调用者无需了解如何创建对象。</li>
<li>控制复杂度：将创建代码抽离出来，让原本的函数或类职责更单一，代码更简洁。</li>
</ul>
<h4 id="Simple-Factory-x2F-Static-Factory-Method-Pattern"><a href="#Simple-Factory-x2F-Static-Factory-Method-Pattern" class="headerlink" title="Simple Factory &#x2F; Static Factory Method Pattern"></a>Simple Factory &#x2F; Static Factory Method Pattern</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigSource</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> RuleConfig <span class="title function_">load</span><span class="params">(String ruleConfigFilePath)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ruleConfigFileExtension</span> <span class="operator">=</span> getFileExtension(ruleConfigFilePath);</span><br><span class="line">    <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> RuleConfigParserFactory.createParser(ruleConfigFileExtension);</span><br><span class="line">    <span class="keyword">if</span> (parser == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidRuleConfigException</span>(</span><br><span class="line">              <span class="string">&quot;Rule config file format is not supported: &quot;</span> + ruleConfigFilePath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">configText</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//从ruleConfigFilePath文件中读取配置文本到configText中</span></span><br><span class="line">    <span class="type">RuleConfig</span> <span class="variable">ruleConfig</span> <span class="operator">=</span> parser.parse(configText);</span><br><span class="line">    <span class="keyword">return</span> ruleConfig;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">getFileExtension</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">    <span class="comment">//...解析文件名获取扩展名，比如rule.json，返回json</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;json&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">(String configFormat)</span> &#123;</span><br><span class="line">    <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;json&quot;</span>.equalsIgnoreCase(configFormat)) &#123;</span><br><span class="line">      parser = <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;xml&quot;</span>.equalsIgnoreCase(configFormat)) &#123;</span><br><span class="line">      parser = <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;yaml&quot;</span>.equalsIgnoreCase(configFormat)) &#123;</span><br><span class="line">      parser = <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParser</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;properties&quot;</span>.equalsIgnoreCase(configFormat)) &#123;</span><br><span class="line">      parser = <span class="keyword">new</span> <span class="title class_">PropertiesRuleConfigParser</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> parser;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, RuleConfigParser&gt; cachedParsers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    cachedParsers.put(<span class="string">&quot;json&quot;</span>, <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>());</span><br><span class="line">    cachedParsers.put(<span class="string">&quot;xml&quot;</span>, <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>());</span><br><span class="line">    cachedParsers.put(<span class="string">&quot;yaml&quot;</span>, <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParser</span>());</span><br><span class="line">    cachedParsers.put(<span class="string">&quot;properties&quot;</span>, <span class="keyword">new</span> <span class="title class_">PropertiesRuleConfigParser</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">(String configFormat)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (configFormat == <span class="literal">null</span> || configFormat.isEmpty()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;<span class="comment">//返回null还是IllegalArgumentException全凭你自己说了算</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> cachedParsers.get(configFormat.toLowerCase());</span><br><span class="line">    <span class="keyword">return</span> parser;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Factory-Method"><a href="#Factory-Method" class="headerlink" title="Factory Method"></a>Factory Method</h4><ul>
<li><p>如果我们非得要将 if 分支逻辑去掉，那该怎么办呢？比较经典处理方法就是利用多态. 工厂方法模式比起简单工厂模式更加符合开闭原则. 当对象的创建逻辑比较复杂，不只是简单的 new 一下就可以，而是要组合其他类对象，做各种初始化操作的时候，我们推荐使用工厂方法模式，将复杂的创建逻辑拆分到多个工厂类中，让每个工厂类都不至于过于复杂。而使用简单工厂模式，将所有的创建逻辑都放到一个工厂类中，会导致这个工厂类变得很复杂。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">  IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YamlRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesRuleConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IRuleConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PropertiesRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigSource</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> RuleConfig <span class="title function_">load</span><span class="params">(String ruleConfigFilePath)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ruleConfigFileExtension</span> <span class="operator">=</span> getFileExtension(ruleConfigFilePath);</span><br><span class="line"></span><br><span class="line">    <span class="type">IRuleConfigParserFactory</span> <span class="variable">parserFactory</span> <span class="operator">=</span> RuleConfigParserFactoryMap.getParserFactory(ruleConfigFileExtension);</span><br><span class="line">    <span class="keyword">if</span> (parserFactory == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidRuleConfigException</span>(<span class="string">&quot;Rule config file format is not supported: &quot;</span> + ruleConfigFilePath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">IRuleConfigParser</span> <span class="variable">parser</span> <span class="operator">=</span> parserFactory.createParser();</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">configText</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//从ruleConfigFilePath文件中读取配置文本到configText中</span></span><br><span class="line">    <span class="type">RuleConfig</span> <span class="variable">ruleConfig</span> <span class="operator">=</span> parser.parse(configText);</span><br><span class="line">    <span class="keyword">return</span> ruleConfig;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">getFileExtension</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">    <span class="comment">//...解析文件名获取扩展名，比如rule.json，返回json</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;json&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//因为工厂类只包含方法，不包含成员变量，完全可以复用，</span></span><br><span class="line"><span class="comment">//不需要每次都创建新的工厂类对象，所以，简单工厂模式的第二种实现思路更加合适。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleConfigParserFactoryMap</span> &#123; <span class="comment">//工厂的工厂</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, IRuleConfigParserFactory&gt; cachedFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    cachedFactories.put(<span class="string">&quot;json&quot;</span>, <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParserFactory</span>());</span><br><span class="line">    cachedFactories.put(<span class="string">&quot;xml&quot;</span>, <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParserFactory</span>());</span><br><span class="line">    cachedFactories.put(<span class="string">&quot;yaml&quot;</span>, <span class="keyword">new</span> <span class="title class_">YamlRuleConfigParserFactory</span>());</span><br><span class="line">    cachedFactories.put(<span class="string">&quot;properties&quot;</span>, <span class="keyword">new</span> <span class="title class_">PropertiesRuleConfigParserFactory</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> IRuleConfigParserFactory <span class="title function_">getParserFactory</span><span class="params">(String type)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="literal">null</span> || type.isEmpty()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">IRuleConfigParserFactory</span> <span class="variable">parserFactory</span> <span class="operator">=</span> cachedFactories.get(type.toLowerCase());</span><br><span class="line">    <span class="keyword">return</span> parserFactory;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于规则配置文件解析这个应用场景来说，工厂模式需要额外创建诸多 Factory 类，也会增加代码的复杂性，而且，每个 Factory 类只是做简单的 new 操作，功能非常单薄（只有一行代码），也没必要设计成独立的类，所以，在这个应用场景下，简单工厂模式简单好用，比工厂方法模式更加合适。</p>
</li>
</ul>
<h4 id="Abstract-Factory"><a href="#Abstract-Factory" class="headerlink" title="Abstract Factory"></a>Abstract Factory</h4><ul>
<li>not used frequently<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">针对规则配置的解析器：基于接口IRuleConfigParser</span><br><span class="line">JsonRuleConfigParser</span><br><span class="line">XmlRuleConfigParser</span><br><span class="line">YamlRuleConfigParser</span><br><span class="line">PropertiesRuleConfigParser</span><br><span class="line"></span><br><span class="line">针对系统配置的解析器：基于接口ISystemConfigParser</span><br><span class="line">JsonSystemConfigParser</span><br><span class="line">XmlSystemConfigParser</span><br><span class="line">YamlSystemConfigParser</span><br><span class="line">PropertiesSystemConfigParser</span><br></pre></td></tr></table></figure>
针对这种特殊的场景，如果还是继续用工厂方法来实现的话，我们要针对每个 parser 都编写一个工厂类，也就是要编写 8 个工厂类。如果我们未来还需要增加针对业务配置的解析器（比如 IBizConfigParser），那就要再对应地增加 4 个工厂类。而我们知道，过多的类也会让系统难维护。这个问题该怎么解决呢？抽象工厂就是针对这种非常特殊的场景而诞生的。我们可以让一个工厂负责创建多个不同类型的对象（IRuleConfigParser、ISystemConfigParser 等），而不是只创建一种 parser 对象。这样就可以有效地减少工厂类的个数。具体的代码实现如下所示：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IConfigParserFactory</span> &#123;</span><br><span class="line">  IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">()</span>;</span><br><span class="line">  ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">//此处可以扩展新的parser类型，比如IBizConfigParser</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonSystemConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlConfigParserFactory</span> <span class="keyword">implements</span> <span class="title class_">IConfigParserFactory</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> IRuleConfigParser <span class="title function_">createRuleParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XmlRuleConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> ISystemConfigParser <span class="title function_">createSystemParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">XmlSystemConfigParser</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 省略YamlConfigParserFactory和PropertiesConfigParserFactory代码</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Builder"><a href="#Builder" class="headerlink" title="Builder"></a>Builder</h3><ul>
<li>创建一种类型的复杂对象，通过设置不同的可选参数，“定制化”地创建不同的对象</li>
<li>When to use<ul>
<li>我们把类的必填属性放到构造函数中，强制创建对象的时候就设置。如果必填的属性有很多，把这些必填属性都放到构造函数中设置，那构造函数就又会出现参数列表很长的问题。如果我们把必填属性通过 set() 方法设置，那校验这些必填属性是否已经填写的逻辑就无处安放了。</li>
<li>如果类的属性之间有一定的依赖关系或者约束条件，我们继续使用构造函数配合 set() 方法的设计思路，那这些依赖关系或约束条件的校验逻辑就无处安放了。</li>
<li>如果我们希望创建不可变对象，也就是说，对象在创建好之后，就不能再修改内部的属性值，要实现这个功能，我们就不能在类中暴露 set() 方法。构造函数配合 set() 方法来设置属性值的方式就不适用了。</li>
</ul>
</li>
<li>Example<br>我们可以把校验逻辑放置到 Builder 类中，先创建建造者，并且通过 set() 方法设置建造者的变量值，然后在使用 build() 方法真正创建对象之前，做集中的校验，校验通过之后才会创建对象。除此之外，我们把 ResourcePoolConfig 的构造函数改为 private 私有权限。这样我们就只能通过建造者来创建 ResourcePoolConfig 类对象。并且，ResourcePoolConfig 没有提供任何 set() 方法，这样我们创建出来的对象就是不可变对象了。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourcePoolConfig</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> maxTotal;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> maxIdle;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> minIdle;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">ResourcePoolConfig</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = builder.name;</span><br><span class="line">    <span class="built_in">this</span>.maxTotal = builder.maxTotal;</span><br><span class="line">    <span class="built_in">this</span>.maxIdle = builder.maxIdle;</span><br><span class="line">    <span class="built_in">this</span>.minIdle = builder.minIdle;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...省略getter方法...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//我们将Builder类设计成了ResourcePoolConfig的内部类。</span></span><br><span class="line">  <span class="comment">//我们也可以将Builder类设计成独立的非内部类ResourcePoolConfigBuilder。</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_MAX_TOTAL</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_MAX_IDLE</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_MIN_IDLE</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxTotal</span> <span class="operator">=</span> DEFAULT_MAX_TOTAL;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxIdle</span> <span class="operator">=</span> DEFAULT_MAX_IDLE;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">minIdle</span> <span class="operator">=</span> DEFAULT_MIN_IDLE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResourcePoolConfig <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">// 校验逻辑放到这里来做，包括必填项校验、依赖关系校验、约束条件校验等</span></span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isBlank(name)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (maxIdle &gt; maxTotal) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (minIdle &gt; maxTotal || minIdle &gt; maxIdle) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResourcePoolConfig</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isBlank(name)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.name = name;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">setMaxTotal</span><span class="params">(<span class="type">int</span> maxTotal)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (maxTotal &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.maxTotal = maxTotal;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">setMaxIdle</span><span class="params">(<span class="type">int</span> maxIdle)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (maxIdle &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.maxIdle = maxIdle;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">setMinIdle</span><span class="params">(<span class="type">int</span> minIdle)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (minIdle &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.minIdle = minIdle;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这段代码会抛出IllegalArgumentException，因为minIdle&gt;maxIdle</span></span><br><span class="line"><span class="type">ResourcePoolConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourcePoolConfig</span>.Builder()</span><br><span class="line">        .setName(<span class="string">&quot;dbconnectionpool&quot;</span>)</span><br><span class="line">        .setMaxTotal(<span class="number">16</span>)</span><br><span class="line">        .setMaxIdle(<span class="number">10</span>)</span><br><span class="line">        .setMinIdle(<span class="number">12</span>)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h3><ul>
<li><p>Define a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">(Message message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Message message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteSubject</span> <span class="keyword">implements</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> List&lt;Observer&gt; observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Observer&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">    observers.add(observer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">    observers.remove(observer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">      observer.update(message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteObserverOne</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">    <span class="comment">//<span class="doctag">TODO:</span> 获取消息通知，执行自己的逻辑...</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ConcreteObserverOne is notified.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteObserverTwo</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">    <span class="comment">//<span class="doctag">TODO:</span> 获取消息通知，执行自己的逻辑...</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ConcreteObserverTwo is notified.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ConcreteSubject</span> <span class="variable">subject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteSubject</span>();</span><br><span class="line">    subject.registerObserver(<span class="keyword">new</span> <span class="title class_">ConcreteObserverOne</span>());</span><br><span class="line">    subject.registerObserver(<span class="keyword">new</span> <span class="title class_">ConcreteObserverTwo</span>());</span><br><span class="line">    subject.notifyObservers(<span class="keyword">new</span> <span class="title class_">Message</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
<li><p>Below is against SRP</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> UserService userService; <span class="comment">// 依赖注入</span></span><br><span class="line">  <span class="keyword">private</span> PromotionService promotionService; <span class="comment">// 依赖注入</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Long <span class="title function_">register</span><span class="params">(String telephone, String password)</span> &#123;</span><br><span class="line">    <span class="comment">//省略输入参数的校验代码</span></span><br><span class="line">    <span class="comment">//省略userService.register()异常的try-catch代码</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">userId</span> <span class="operator">=</span> userService.register(telephone, password);</span><br><span class="line">    promotionService.issueNewUserExperienceCash(userId);</span><br><span class="line">    <span class="keyword">return</span> userId;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Refactored using Observer Pattern</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RegObserver</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">handleRegSuccess</span><span class="params">(<span class="type">long</span> userId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegPromotionObserver</span> <span class="keyword">implements</span> <span class="title class_">RegObserver</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> PromotionService promotionService; <span class="comment">// 依赖注入</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRegSuccess</span><span class="params">(<span class="type">long</span> userId)</span> &#123;</span><br><span class="line">    promotionService.issueNewUserExperienceCash(userId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegNotificationObserver</span> <span class="keyword">implements</span> <span class="title class_">RegObserver</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> NotificationService notificationService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRegSuccess</span><span class="params">(<span class="type">long</span> userId)</span> &#123;</span><br><span class="line">    notificationService.sendInboxMessage(userId, <span class="string">&quot;Welcome...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> UserService userService; <span class="comment">// 依赖注入</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;RegObserver&gt; regObservers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一次性设置好，之后也不可能动态的修改</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRegObservers</span><span class="params">(List&lt;RegObserver&gt; observers)</span> &#123;</span><br><span class="line">    regObservers.addAll(observers);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Long <span class="title function_">register</span><span class="params">(String telephone, String password)</span> &#123;</span><br><span class="line">    <span class="comment">//省略输入参数的校验代码</span></span><br><span class="line">    <span class="comment">//省略userService.register()异常的try-catch代码</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">userId</span> <span class="operator">=</span> userService.register(telephone, password);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (RegObserver observer : regObservers) &#123;</span><br><span class="line">      observer.handleRegSuccess(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> userId;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>基于消息队列的实现方式，被观察者和观察者解耦更加彻底，两部分的耦合更小。被观察者完全不感知观察者，同理，观察者也完全不感知被观察者。被观察者只管发送消息到消息队列，观察者只管从消息队列中读取消息来执行相应的逻辑。</p>
</li>
</ul>
<h3 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h3><ul>
<li>Define the skeleton of an algorithm in an operation, deferring some steps to subclasses. Template Method lets subclasses redefine certain steps of an algorithm without changing the algorithm’s structure.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractClass</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">templateMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    method1();</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    method2();</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteClass1</span> <span class="keyword">extends</span> <span class="title class_">AbstractClass</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteClass2</span> <span class="keyword">extends</span> <span class="title class_">AbstractClass</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">AbstractClass</span> <span class="variable">demo</span> <span class="operator">=</span> ConcreteClass1();</span><br><span class="line">demo.templateMethod();</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Chain-of-Responsibility"><a href="#Chain-of-Responsibility" class="headerlink" title="Chain of Responsibility"></a>Chain of Responsibility</h3><ul>
<li>在职责链模式中，多个处理器（也就是刚刚定义中说的“接收对象”）依次处理同一个请求。一个请求先经过 A 处理器处理，然后再把请求传递给 B 处理器，B 处理器处理完后再传递给 C 处理器，以此类推，形成一个链条。链条上的每个处理器各自承担各自的处理职责，所以叫作职责链模式。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="type">Handler</span> <span class="variable">successor</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuccessor</span><span class="params">(Handler successor)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.successor = successor;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">handled</span> <span class="operator">=</span> doHandle();</span><br><span class="line">    <span class="keyword">if</span> (successor != <span class="literal">null</span> &amp;&amp; !handled) &#123;</span><br><span class="line">      successor.handle();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">doHandle</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HandlerA</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">doHandle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">handled</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">return</span> handled;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HandlerB</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">doHandle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">handled</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">return</span> handled;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HandlerChain和Application代码不变</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Coding-Standards"><a href="#Coding-Standards" class="headerlink" title="Coding Standards"></a>Coding Standards</h2><ul>
<li>reference: 《重构》《代码大全》《代码简洁之道》</li>
</ul>
<h2 id="Refactoring"><a href="#Refactoring" class="headerlink" title="Refactoring"></a>Refactoring</h2><ul>
<li>why, what, when, how</li>
<li>unit test, testability</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/03/26/OOD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/26/OOD/" class="post-title-link" itemprop="url">OOD</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-26 13:13:23 / Modified: 13:19:21" itemprop="dateCreated datePublished" datetime="2022-03-26T13:13:23-04:00">2022-03-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OOD/" itemprop="url" rel="index"><span itemprop="name">OOD</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="three-features"><a href="#three-features" class="headerlink" title="three features"></a>three features</h2><ul>
<li>encapsulation: private attribute, getter and setter</li>
<li>inheritance:<ul>
<li>has all attributes and methods of the base class, but cannot access the private members of the base class</li>
<li>can have its own members</li>
<li>can override methods of base class</li>
</ul>
</li>
<li>poly: 所谓多态就是指程序中定义的引用变量所指向的具体类型和通过该引用变量发出的方法调用在编<br>程时并不确定，而是在程序运行期间才确定，即一个引用变量到底会指向哪个类的实例对象，该<br>引用变量发出的方法调用到底是哪个类中实现的方法，必须在由程序运行期间才能决定。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/03/25/Project-SpringBoot-E-commerce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/25/Project-SpringBoot-E-commerce/" class="post-title-link" itemprop="url">Project: SpringBoot E-commerce</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-25 21:58:28 / Modified: 22:18:21" itemprop="dateCreated datePublished" datetime="2022-03-25T21:58:28-04:00">2022-03-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h2><ul>
<li>User</li>
<li>Product</li>
<li>Category</li>
<li>Cart</li>
</ul>
<h3 id="User"><a href="#User" class="headerlink" title="User"></a>User</h3><ul>
<li>Log-in</li>
<li>Log-out</li>
<li>Register</li>
<li>Duplicate name check</li>
<li>Password encrypted storage</li>
<li>Session<ul>
<li>to remember log-in status, save user information in session</li>
</ul>
</li>
<li>Access control</li>
<li>Unified response object</li>
<li>lomlock</li>
<li>Exception enum</li>
<li>Postman</li>
<li>Unified exception handler</li>
<li>Update personal info</li>
</ul>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><h4 id="Challenge"><a href="#Challenge" class="headerlink" title="Challenge"></a>Challenge</h4><ul>
<li>Unified response object</li>
<li>Remembering log-in status</li>
<li>Unified exception handler</li>
</ul>
<h3 id="Product"><a href="#Product" class="headerlink" title="Product"></a>Product</h3><ul>
<li></li>
</ul>
<h4 id="Highlight"><a href="#Highlight" class="headerlink" title="Highlight"></a>Highlight</h4><ul>
<li>UUID: Universally Unique Identifier</li>
<li>MyBatis PageHelper<h4 id="Challenge-1"><a href="#Challenge-1" class="headerlink" title="Challenge"></a>Challenge</h4></li>
<li>search and sort products and query a product by category</li>
</ul>
<h3 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h3><ul>
<li>set category</li>
<li>associate a product to a category<h4 id="Challenge-2"><a href="#Challenge-2" class="headerlink" title="Challenge"></a>Challenge</h4></li>
<li>Swagger</li>
<li>Parameter check</li>
<li>Redis integration</li>
<li>Debug using log</li>
</ul>
<h4 id="Why-use-three-levels"><a href="#Why-use-three-levels" class="headerlink" title="Why use three levels?"></a>Why use three levels?</h4><ul>
<li>To deep, hard to find and manage</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/03/25/Distributed-Transaction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/25/Distributed-Transaction/" class="post-title-link" itemprop="url">Distributed Transaction</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-25 19:56:36 / Modified: 20:55:42" itemprop="dateCreated datePublished" datetime="2022-03-25T19:56:36-04:00">2022-03-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h2><p>a programming execution unit to manipulate data in the databases</p>
<ul>
<li>Atomic: all succeed or all fail</li>
<li>Consistency: does not change the data integrity of database. ?</li>
<li>Isolation: not disturb other transactions</li>
<li>Durability: permanently change</li>
</ul>
<h3 id="Isolation"><a href="#Isolation" class="headerlink" title="Isolation"></a>Isolation</h3><ul>
<li>Read uncommitted</li>
<li>Read committed: ?</li>
<li>Repeatable read: ?</li>
<li>Serializable: ?</li>
</ul>
<h2 id="How-to-ensure-ACID"><a href="#How-to-ensure-ACID" class="headerlink" title="How to ensure ACID"></a>How to ensure ACID</h2><p>InnoDB:</p>
<ul>
<li>A: Undo log</li>
<li>C: Undo log</li>
<li>I: lock</li>
<li>D: Redo log</li>
</ul>
<h3 id="Undo-log"><a href="#Undo-log" class="headerlink" title="Undo log"></a>Undo log</h3><p>record data before manipulation in undo log, rollback</p>
<h3 id="Redo-log"><a href="#Redo-log" class="headerlink" title="Redo log"></a>Redo log</h3><p>record new data in redo log</p>
<h3 id="Issues"><a href="#Issues" class="headerlink" title="Issues"></a>Issues</h3><h2 id="Dirty-Read"><a href="#Dirty-Read" class="headerlink" title="Dirty Read"></a>Dirty Read</h2><h2 id="Phantom-Read"><a href="#Phantom-Read" class="headerlink" title="Phantom Read"></a>Phantom Read</h2><h2 id="Unrepeatable-Read"><a href="#Unrepeatable-Read" class="headerlink" title="Unrepeatable Read"></a>Unrepeatable Read</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><ul>
<li>Make sure data consistent in sub-system.</li>
<li>A big operation consists of small operations on many nodes. Make sure all succeed or fail.</li>
<li>Example: Create order and decrement stock count. All succeed or fail.</li>
</ul>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><ul>
<li>Multiple databases</li>
<li>Sharding</li>
<li>Microservices</li>
</ul>
<h2 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h2><ul>
<li>Consistency: all nodes see the same data at the same time.</li>
<li>Availability: return normal result (success or failure) within reasonable time</li>
<li>Partition tolerance: ?<br>CP or AP<br>Money: CP<br>Internet: AP</li>
</ul>
<h3 id="Consistency"><a href="#Consistency" class="headerlink" title="Consistency"></a>Consistency</h3><ul>
<li>Strong: The data in all nodes is the same at any time</li>
<li>Weak: ?</li>
<li>Eventual: ?</li>
</ul>
<h2 id="BASE"><a href="#BASE" class="headerlink" title="BASE"></a>BASE</h2><p>For AP<br>Eventual instead of strong consistency</p>
<ul>
<li>Basically available: some available: longer response time; lose some functions</li>
<li>Soft state: allow middle state, 即允许系统在不同节点的数据副本之间进⾏数据同步的过程存在延时</li>
<li>Eventually consistent: ?</li>
</ul>
<h3 id="BASE-vs-ACID"><a href="#BASE-vs-ACID" class="headerlink" title="BASE vs ACID"></a>BASE vs ACID</h3><ul>
<li>ACID: strong consistency</li>
<li>BASE: sacrifice consistency for availability</li>
</ul>
<h2 id="How-to-solve-the-consistency-problem"><a href="#How-to-solve-the-consistency-problem" class="headerlink" title="How to solve the consistency problem"></a>How to solve the consistency problem</h2><ul>
<li>avoid distribution</li>
<li>distributed transaction</li>
</ul>
<h2 id="Distributed-Transaction-Type"><a href="#Distributed-Transaction-Type" class="headerlink" title="Distributed Transaction Type"></a>Distributed Transaction Type</h2><ul>
<li>Hard transaction: CP. Suitable for low concurrency and short transaction</li>
<li>Soft transaction: BASE.</li>
</ul>
<h3 id="Hard-transaction"><a href="#Hard-transaction" class="headerlink" title="Hard transaction"></a>Hard transaction</h3><ul>
<li>XA: 2PC, JTA, JTS; 3PC; due to synchronous blocking, low efficiency.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/03/25/ORM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/25/ORM/" class="post-title-link" itemprop="url">ORM</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-25 19:06:05 / Modified: 19:13:58" itemprop="dateCreated datePublished" datetime="2022-03-25T19:06:05-04:00">2022-03-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/framework-fundamental/" itemprop="url" rel="index"><span itemprop="name">framework fundamental</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><ul>
<li>table -&gt; class</li>
<li>record -&gt; object</li>
<li>field -&gt; attribute</li>
</ul>
<h2 id="Pros"><a href="#Pros" class="headerlink" title="Pros"></a>Pros</h2><ul>
<li>use MVC as architecture</li>
<li>automation</li>
<li>more flexibility for programming</li>
</ul>
<h2 id="Cons"><a href="#Cons" class="headerlink" title="Cons"></a>Cons</h2><ul>
<li>need time to config</li>
<li>as to complex queries, hard to write or will have worse performance than SQL</li>
<li>hide the details about how to manipulate databases</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/03/25/SpringBoot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/25/SpringBoot/" class="post-title-link" itemprop="url">SpringBoot</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-25 19:03:20" itemprop="dateCreated datePublished" datetime="2022-03-25T19:03:20-04:00">2022-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-27 15:18:49" itemprop="dateModified" datetime="2022-04-27T15:18:49-04:00">2022-04-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h2><h3 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environments.dev.url</span>=<span class="string">http://ll.com</span></span><br><span class="line"><span class="attr">environments.dev.name</span>=<span class="string">Developer</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/flash_sale?</span></span><br><span class="line"><span class="attr">serverTimezone</span>=<span class="string">GMT&amp;useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true</span></span><br><span class="line"><span class="comment"># 记得更改用户名和密码为本地所使用的</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="comment"># MyBatis Mapper Config</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:mappers/*.xml</span></span><br></pre></td></tr></table></figure>
<h3 id="yml"><a href="#yml" class="headerlink" title="yml"></a>yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environments:</span></span><br><span class="line">  <span class="attr">dev:</span></span><br><span class="line">    <span class="string">url:http://ll.com</span></span><br><span class="line">    <span class="string">name:Developer</span></span><br></pre></td></tr></table></figure>
<h3 id="读取配置"><a href="#读取配置" class="headerlink" title="读取配置"></a>读取配置</h3><ul>
<li><code>@Value(&quot;$&#123;school.grade&#125;&quot;)</code></li>
<li><code>@ConfigurationProperties(prefix = &quot;school&quot;)</code> and <code>@Component</code> on SchoolConfig.java<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述：    读取配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SchoolConfig schoolConfig;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&#123;&quot;/gradefromconfig&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">gradeclass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;年级: &quot;</span> + schoolConfig.grade + <span class="string">&quot; 班级：&quot;</span> + schoolConfig.classnum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="xxApplication-java"><a href="#xxApplication-java" class="headerlink" title="xxApplication.java"></a>xxApplication.java</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@MapperScan(&quot;com.ll.flashsale.db.mappers&quot;)</span><br><span class="line">@ComponentScan(basePackages = &#123;&quot;com.ll&quot;&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="Annotations"><a href="#Annotations" class="headerlink" title="Annotations"></a>Annotations</h2><ul>
<li><code>@Mapper</code></li>
</ul>
<h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><ul>
<li>create project</li>
<li>start application</li>
<li>create a test controller</li>
<li>test the test controller</li>
<li>create database</li>
<li>configure MyBatis</li>
<li>run MyBatis generator</li>
<li>add <code>@MapperScan</code> and <code>@ComponentScan</code></li>
<li>test Dao</li>
<li>add front end</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/03/25/Spring-Cloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/25/Spring-Cloud/" class="post-title-link" itemprop="url">Spring Cloud</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-25 19:03:13" itemprop="dateCreated datePublished" datetime="2022-03-25T19:03:13-04:00">2022-03-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://liamyaolian.github.io/2022/03/25/Microservices/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liam Lian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liam Lian's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/25/Microservices/" class="post-title-link" itemprop="url">Spring Cloud</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-25 19:03:13" itemprop="dateCreated datePublished" datetime="2022-03-25T19:03:13-04:00">2022-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-25 01:17:48" itemprop="dateModified" datetime="2022-04-25T01:17:48-04:00">2022-04-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p>架构风格<br>组件以服务形式来提供<br>服务有独立进程<br>RPC、HTTP远程⽅法调⽤</p>
<h2 id="Pro"><a href="#Pro" class="headerlink" title="Pro"></a>Pro</h2><p>部署效率<br>易于维护<br>团队协作开发成本<br>系统⾼可⽤性<br>灵活扩展<br>技术栈丰富</p>
<h2 id="Con"><a href="#Con" class="headerlink" title="Con"></a>Con</h2><p>运维成本过高<br>接口可能不匹配<br>代码可能重复<br>架构复杂度提高<br>tradeoff</p>
<h2 id="When-to-use"><a href="#When-to-use" class="headerlink" title="When to use"></a>When to use</h2><ul>
<li>开发的⼈员超过10⼈</li>
<li>高流量</li>
<li>业务变化大</li>
<li>不适合对延迟很敏感的低延迟高并发系统</li>
</ul>
<h2 id="How-to-break"><a href="#How-to-break" class="headerlink" title="How to break"></a>How to break</h2><ul>
<li>纵向拆分：评论，发帖，etc</li>
<li>横向拆分：用户模块，因为它被到处用</li>
<li>结合业务综合分析</li>
<li>每个开发人员所负责的服务不应超过3个</li>
</ul>
<h2 id="Two-Streams"><a href="#Two-Streams" class="headerlink" title="Two Streams"></a>Two Streams</h2><h3 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h3><h3 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h3><ul>
<li><p>RPC framework</p>
</li>
<li><p>相比REST，效率RPC更高</p>
</li>
</ul>
<h2 id="微服务重要模块"><a href="#微服务重要模块" class="headerlink" title="微服务重要模块"></a>微服务重要模块</h2><h3 id="服务描述"><a href="#服务描述" class="headerlink" title="服务描述"></a>服务描述</h3><h3 id="注册中⼼"><a href="#注册中⼼" class="headerlink" title="注册中⼼"></a>注册中⼼</h3><h3 id="服务框架"><a href="#服务框架" class="headerlink" title="服务框架"></a>服务框架</h3><h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><h3 id="熔断和降级"><a href="#熔断和降级" class="headerlink" title="熔断和降级"></a>熔断和降级</h3><h3 id="配置中心"><a href="#配置中心" class="headerlink" title="配置中心"></a>配置中心</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liam Lian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liam Lian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
